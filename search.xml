<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>openharmony基础知识学习</title>
      <link href="/2023/03/22/openharmony%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86%E5%AD%A6%E4%B9%A0/"/>
      <url>/2023/03/22/openharmony%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86%E5%AD%A6%E4%B9%A0/</url>
      
        <content type="html"><![CDATA[<h1 id="一、认识常见组件"><a href="#一、认识常见组件" class="headerlink" title="一、认识常见组件"></a>一、认识常见组件</h1><h2 id="1-Cloumn"><a href="#1-Cloumn" class="headerlink" title="1.Cloumn"></a>1.Cloumn</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 沿垂直方向布局的容器。</span></span><br><span class="line"><span class="title class_">Column</span>(value?: &#123;space?: string | number&#125;)&#123;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//space:纵向布局元素垂直方向间距,默认值为0，设负值不生效。</span></span><br><span class="line"><span class="comment">//支持alignItems、justifyContent属性</span></span><br><span class="line"><span class="comment">//alignItems：设置子组件在水平方向上的对齐格式。</span></span><br><span class="line"><span class="comment">//justifyContent：设置子组件在垂直方向上的对齐格式。</span></span><br></pre></td></tr></table></figure><h2 id="2-Flex"><a href="#2-Flex" class="headerlink" title="2.Flex"></a>2.Flex</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//以弹性方式布局子组件的容器组件</span></span><br><span class="line"><span class="title class_">Flex</span>(value?: &#123; direction?: <span class="title class_">FlexDirection</span>, wrap?: <span class="title class_">FlexWrap</span>, justifyContent?: <span class="title class_">FlexAlign</span>, alignItems?: <span class="title class_">ItemAlign</span>, alignContent?: <span class="title class_">FlexAlign</span> &#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">//[具体参数文档](https://docs.openharmony.cn/pages/v3.2Beta/zh-cn/application-dev/reference/arkui-ts/ts-container-flex.md/)</span></span><br></pre></td></tr></table></figure><h2 id="3-List"><a href="#3-List" class="headerlink" title="3.List"></a>3.List</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//列表包含一系列相同宽度的列表项。适合连续、多行呈现同类数据，例如图片和文本。</span></span><br><span class="line"><span class="title class_">List</span>(value?:&#123;space?: number | string, initialIndex?: number, scroller?: <span class="title class_">Scroller</span>&#125;)</span><br><span class="line"><span class="comment">//space:列表项间距</span></span><br><span class="line"><span class="comment">//initialIndex:设置当前List初次加载时视口起始位置显示的item的索引值。如果设置的值超过了当前List最后一个item的索引值，则设置不生效。</span></span><br><span class="line"><span class="comment">//scroller:可滚动组件的控制器。用于与可滚动组件进行绑定。</span></span><br></pre></td></tr></table></figure><h2 id="4-Navigator"><a href="#4-Navigator" class="headerlink" title="4.Navigator"></a>4.Navigator</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//路由容器组件，提供路由跳转能力。</span></span><br><span class="line"><span class="title class_">Navigator</span>(value?: &#123;<span class="attr">target</span>: string, type?: <span class="title class_">NavigationType</span>&#125;)</span><br><span class="line"><span class="comment">//NavigationType：Push/Replace/Back</span></span><br></pre></td></tr></table></figure><h2 id="5-Refresh"><a href="#5-Refresh" class="headerlink" title="5.Refresh"></a>5.Refresh</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//可以进行页面下拉操作并显示刷新动效的容器组件。</span></span><br><span class="line"><span class="title class_">Refresh</span>(<span class="attr">value</span>: &#123; <span class="attr">refreshing</span>: boolean, offset?: number | string , friction?: number | string &#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// xxx.ets</span></span><br><span class="line">@<span class="title class_">Entry</span></span><br><span class="line">@<span class="title class_">Component</span></span><br><span class="line">struct <span class="title class_">RefreshExample</span> &#123;</span><br><span class="line">  @<span class="title class_">State</span> <span class="attr">isRefreshing</span>: boolean = <span class="literal">false</span></span><br><span class="line">  @<span class="title class_">State</span> <span class="attr">counter</span>: number = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">  <span class="title function_">build</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title class_">Column</span>() &#123;</span><br><span class="line">      <span class="title class_">Refresh</span>(&#123; <span class="attr">refreshing</span>: $$this.<span class="property">isRefreshing</span>, <span class="attr">offset</span>: <span class="number">120</span>, <span class="attr">friction</span>: <span class="number">100</span> &#125;) &#123;</span><br><span class="line">        <span class="title class_">Text</span>(<span class="string">&#x27;Pull Down and refresh: &#x27;</span> + <span class="variable language_">this</span>.<span class="property">counter</span>)</span><br><span class="line">          .<span class="title function_">fontSize</span>(<span class="number">30</span>)</span><br><span class="line">          .<span class="title function_">margin</span>(<span class="number">10</span>)</span><br><span class="line">      &#125;</span><br><span class="line">      .<span class="title function_">onStateChange</span>(<span class="function">(<span class="params">refreshStatus: RefreshStatus</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">info</span>(<span class="string">&#x27;Refresh onStatueChange state is &#x27;</span> + refreshStatus)</span><br><span class="line">      &#125;)</span><br><span class="line">      .<span class="title function_">onRefreshing</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">counter</span>++</span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">isRefreshing</span> = <span class="literal">false</span></span><br><span class="line">        &#125;, <span class="number">1000</span>)</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;onRefreshing test&#x27;</span>)</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//ArkTS支持通过$$双向绑定变量，通常应用于状态值频繁改变的变量 </span></span><br><span class="line"><span class="comment">// 当前$$支持基础类型变量，以及@State、@Link和@Prop装饰的变量。</span></span><br><span class="line"><span class="comment">// 当前$$仅支持bindPopup属性方法的show参数，Radio组件的checked属性，Refresh组件的refreshing参数。</span></span><br><span class="line"><span class="comment">//$$绑定的变量变化时，仅渲染刷新当前组件，提高渲染速度。</span></span><br></pre></td></tr></table></figure><h2 id="6-Row"><a href="#6-Row" class="headerlink" title="6.Row"></a>6.Row</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//沿水平方向布局容器。</span></span><br><span class="line"><span class="title class_">Row</span>(value?:&#123;space?: number | string &#125;)</span><br><span class="line"><span class="comment">//alignItems:设置子组件在垂直方向上的对齐格式</span></span><br><span class="line"><span class="comment">//justifyContent:设置子组件在水平方向上的对齐格式</span></span><br></pre></td></tr></table></figure><h2 id="7-Swiper"><a href="#7-Swiper" class="headerlink" title="7.Swiper"></a>7.Swiper</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 滑块视图容器，提供子组件滑动轮播显示的能力。</span></span><br><span class="line"><span class="title class_">Swiper</span>(controller?: <span class="title class_">SwiperController</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// xxx.ets</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyDataSource</span> implements <span class="title class_">IDataSource</span> &#123;</span><br><span class="line">  private <span class="attr">list</span>: number[] = []</span><br><span class="line">  private <span class="attr">listener</span>: <span class="title class_">DataChangeListener</span></span><br><span class="line"></span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">list: number[]</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">list</span> = list</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">totalCount</span>(): number &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">list</span>.<span class="property">length</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">getData</span>(<span class="attr">index</span>: number): any &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">list</span>[index]</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">registerDataChangeListener</span>(<span class="attr">listener</span>: <span class="title class_">DataChangeListener</span>): <span class="keyword">void</span> &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">listener</span> = listener</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">unregisterDataChangeListener</span>(<span class="params"></span>) &#123;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@<span class="title class_">Entry</span></span><br><span class="line">@<span class="title class_">Component</span></span><br><span class="line">struct <span class="title class_">SwiperExample</span> &#123;</span><br><span class="line">  private <span class="attr">swiperController</span>: <span class="title class_">SwiperController</span> = <span class="keyword">new</span> <span class="title class_">SwiperController</span>()</span><br><span class="line">  private <span class="attr">data</span>: <span class="title class_">MyDataSource</span> = <span class="keyword">new</span> <span class="title class_">MyDataSource</span>([])</span><br><span class="line"></span><br><span class="line">  <span class="title function_">aboutToAppear</span>(): <span class="keyword">void</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> list = []</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">1</span>; i &lt;= <span class="number">10</span>; i++) &#123;</span><br><span class="line">      list.<span class="title function_">push</span>(i.<span class="title function_">toString</span>());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">data</span> = <span class="keyword">new</span> <span class="title class_">MyDataSource</span>(list)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">build</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title class_">Column</span>(&#123; <span class="attr">space</span>: <span class="number">5</span> &#125;) &#123;</span><br><span class="line">      <span class="title class_">Swiper</span>(<span class="variable language_">this</span>.<span class="property">swiperController</span>) &#123;</span><br><span class="line">        <span class="title class_">LazyForEach</span>(<span class="variable language_">this</span>.<span class="property">data</span>, <span class="function">(<span class="params">item: string</span>) =&gt;</span> &#123;</span><br><span class="line">          <span class="title class_">Text</span>(item).<span class="title function_">width</span>(<span class="string">&#x27;90%&#x27;</span>).<span class="title function_">height</span>(<span class="number">160</span>).<span class="title function_">backgroundColor</span>(<span class="number">0xAFEEEE</span>).<span class="title function_">textAlign</span>(<span class="title class_">TextAlign</span>.<span class="property">Center</span>).<span class="title function_">fontSize</span>(<span class="number">30</span>)</span><br><span class="line">        &#125;, <span class="function"><span class="params">item</span> =&gt;</span> item)</span><br><span class="line">      &#125;</span><br><span class="line">      .<span class="title function_">cachedCount</span>(<span class="number">2</span>)</span><br><span class="line">      .<span class="title function_">index</span>(<span class="number">1</span>)</span><br><span class="line">      .<span class="title function_">autoPlay</span>(<span class="literal">true</span>)</span><br><span class="line">      .<span class="title function_">interval</span>(<span class="number">4000</span>)</span><br><span class="line">      .<span class="title function_">indicator</span>(<span class="literal">true</span>)</span><br><span class="line">      .<span class="title function_">loop</span>(<span class="literal">true</span>)</span><br><span class="line">      .<span class="title function_">duration</span>(<span class="number">1000</span>)</span><br><span class="line">      .<span class="title function_">itemSpace</span>(<span class="number">0</span>)</span><br><span class="line">      .<span class="title function_">curve</span>(<span class="title class_">Curve</span>.<span class="property">Linear</span>)</span><br><span class="line">      .<span class="title function_">onChange</span>(<span class="function">(<span class="params">index: number</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">info</span>(index.<span class="title function_">toString</span>())</span><br><span class="line">      &#125;)</span><br><span class="line"></span><br><span class="line">      <span class="title class_">Row</span>(&#123; <span class="attr">space</span>: <span class="number">12</span> &#125;) &#123;</span><br><span class="line">        <span class="title class_">Button</span>(<span class="string">&#x27;showNext&#x27;</span>)</span><br><span class="line">          .<span class="title function_">onClick</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">swiperController</span>.<span class="title function_">showNext</span>()</span><br><span class="line">          &#125;)</span><br><span class="line">        <span class="title class_">Button</span>(<span class="string">&#x27;showPrevious&#x27;</span>)</span><br><span class="line">          .<span class="title function_">onClick</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">swiperController</span>.<span class="title function_">showPrevious</span>()</span><br><span class="line">          &#125;)</span><br><span class="line">      &#125;.<span class="title function_">margin</span>(<span class="number">5</span>)</span><br><span class="line">    &#125;.<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">    .<span class="title function_">margin</span>(&#123; <span class="attr">top</span>: <span class="number">5</span> &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="8-Tabs"><a href="#8-Tabs" class="headerlink" title="8.Tabs"></a>8.Tabs</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//通过页签进行内容视图切换的容器组件，每个页签对应一个内容视图。</span></span><br><span class="line"><span class="title class_">Tabs</span>(value?: &#123;barPosition?: <span class="title class_">BarPosition</span>, index?: number, controller?: <span class="title class_">TabsController</span>&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// xxx.ets</span></span><br><span class="line"></span><br><span class="line">@<span class="title class_">Entry</span></span><br><span class="line">@<span class="title class_">Component</span></span><br><span class="line">struct <span class="title class_">TabsExample</span> &#123;</span><br><span class="line">  @<span class="title class_">State</span> <span class="attr">fontColor</span>: string = <span class="string">&#x27;#182431&#x27;</span></span><br><span class="line">  @<span class="title class_">State</span> <span class="attr">selectedFontColor</span>: string = <span class="string">&#x27;#007DFF&#x27;</span></span><br><span class="line">  @<span class="title class_">State</span> <span class="attr">currentIndex</span>: number = <span class="number">0</span></span><br><span class="line">  @<span class="title class_">State</span> <span class="attr">tabArr</span>: <span class="title class_">Array</span>&lt;object&gt; = [</span><br><span class="line">    &#123; <span class="attr">bgColor</span>: <span class="string">&#x27;#00CB87&#x27;</span>, <span class="attr">color</span>: <span class="string">&#x27;green&#x27;</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">bgColor</span>: <span class="string">&#x27;#007DFF&#x27;</span>, <span class="attr">color</span>: <span class="string">&#x27;blue&#x27;</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">bgColor</span>: <span class="string">&#x27;#FFBF00&#x27;</span>, <span class="attr">color</span>: <span class="string">&#x27;yellow&#x27;</span>&#125;, </span><br><span class="line">    &#123; <span class="attr">bgColor</span>: <span class="string">&#x27;#E67C92&#x27;</span>, <span class="attr">color</span>: <span class="string">&#x27;pink&#x27;</span> &#125;]</span><br><span class="line">  private <span class="attr">controller</span>: <span class="title class_">TabsController</span> = <span class="keyword">new</span> <span class="title class_">TabsController</span>()</span><br><span class="line"><span class="comment">//  @Builder装饰器定义了一个如何渲染自定义组件的方法。此装饰器提供了一个修饰方法，其目的是和build函数一致。@Builder装饰器装饰的方法的语法规范与build函数也保持一致。</span></span><br><span class="line">  @<span class="title class_">Builder</span> <span class="title class_">TabBuilder</span>(<span class="attr">index</span>: number, <span class="attr">name</span>: string) &#123;</span><br><span class="line">    <span class="title class_">Column</span>() &#123;</span><br><span class="line">      <span class="title class_">Text</span>(name)</span><br><span class="line">        .<span class="title function_">fontColor</span>(<span class="variable language_">this</span>.<span class="property">currentIndex</span> === index ? <span class="variable language_">this</span>.<span class="property">selectedFontColor</span> : <span class="variable language_">this</span>.<span class="property">fontColor</span>)</span><br><span class="line">        .<span class="title function_">fontSize</span>(<span class="number">16</span>)</span><br><span class="line">        .<span class="title function_">fontWeight</span>(<span class="variable language_">this</span>.<span class="property">currentIndex</span> === index ? <span class="number">500</span> : <span class="number">400</span>)</span><br><span class="line">        .<span class="title function_">lineHeight</span>(<span class="number">22</span>)</span><br><span class="line">        .<span class="title function_">margin</span>(&#123; <span class="attr">top</span>: <span class="number">17</span>, <span class="attr">bottom</span>: <span class="number">7</span> &#125;)</span><br><span class="line">      <span class="title class_">Divider</span>()</span><br><span class="line">        .<span class="title function_">strokeWidth</span>(<span class="number">2</span>)</span><br><span class="line">        .<span class="title function_">color</span>(<span class="string">&#x27;#007DFF&#x27;</span>)</span><br><span class="line">        .<span class="title function_">opacity</span>(<span class="variable language_">this</span>.<span class="property">currentIndex</span> === index ? <span class="number">1</span> : <span class="number">0</span>)</span><br><span class="line">    &#125;.<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">build</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title class_">Column</span>() &#123;</span><br><span class="line">      <span class="title class_">Tabs</span>(&#123; <span class="attr">barPosition</span>: <span class="title class_">BarPosition</span>.<span class="property">Start</span>, <span class="attr">controller</span>: <span class="variable language_">this</span>.<span class="property">controller</span> &#125;) &#123;</span><br><span class="line">        <span class="title class_">ForEach</span>(<span class="variable language_">this</span>.<span class="property">tabArr</span>,<span class="function">(<span class="params">&#123;bgColor,color&#125;,index</span>)=&gt;</span>&#123;</span><br><span class="line">          <span class="title class_">TabContent</span>() &#123;</span><br><span class="line">            <span class="title class_">Column</span>().<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>).<span class="title function_">height</span>(<span class="string">&#x27;100%&#x27;</span>).<span class="title function_">backgroundColor</span>(bgColor)</span><br><span class="line">          &#125;.<span class="title function_">tabBar</span>(<span class="variable language_">this</span>.<span class="title class_">TabBuilder</span>(index, color))</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;</span><br><span class="line">      .<span class="title function_">vertical</span>(<span class="literal">false</span>)</span><br><span class="line">      .<span class="title function_">barMode</span>(<span class="title class_">BarMode</span>.<span class="property">Fixed</span>)</span><br><span class="line">      .<span class="title function_">barWidth</span>(<span class="number">360</span>)</span><br><span class="line">      .<span class="title function_">barHeight</span>(<span class="number">56</span>)</span><br><span class="line">      .<span class="title function_">animationDuration</span>(<span class="number">0</span>)</span><br><span class="line">      .<span class="title function_">onChange</span>(<span class="function">(<span class="params">index: number</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">currentIndex</span> = index</span><br><span class="line">      &#125;)</span><br><span class="line">      .<span class="title function_">width</span>(<span class="number">360</span>)</span><br><span class="line">      .<span class="title function_">height</span>(<span class="number">296</span>)</span><br><span class="line">      .<span class="title function_">margin</span>(&#123; <span class="attr">top</span>: <span class="number">52</span> &#125;)</span><br><span class="line">      .<span class="title function_">backgroundColor</span>(<span class="string">&#x27;#F1F3F5&#x27;</span>)</span><br><span class="line">    &#125;.<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="9-CheckboxGroup与Checkbox"><a href="#9-CheckboxGroup与Checkbox" class="headerlink" title="9.CheckboxGroup与Checkbox"></a>9.CheckboxGroup与Checkbox</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// xxx.ets</span></span><br><span class="line">@<span class="title class_">Entry</span></span><br><span class="line">@<span class="title class_">Component</span></span><br><span class="line">struct <span class="title class_">CheckboxExample</span> &#123;</span><br><span class="line">  <span class="title function_">build</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title class_">Scroll</span>() &#123;</span><br><span class="line">      <span class="title class_">Column</span>() &#123;</span><br><span class="line">        <span class="comment">// 全选按钮</span></span><br><span class="line">        <span class="title class_">Flex</span>(&#123; <span class="attr">justifyContent</span>: <span class="title class_">FlexAlign</span>.<span class="property">Start</span>, <span class="attr">alignItems</span>: <span class="title class_">ItemAlign</span>.<span class="property">Center</span> &#125;) &#123;</span><br><span class="line">          <span class="title class_">CheckboxGroup</span>(&#123; <span class="attr">group</span>: <span class="string">&#x27;checkboxGroup&#x27;</span> &#125;)</span><br><span class="line">            .<span class="title function_">selectedColor</span>(<span class="string">&#x27;#007DFF&#x27;</span>)</span><br><span class="line">            .<span class="title function_">onChange</span>(<span class="function">(<span class="params">itemName: CheckboxGroupResult</span>) =&gt;</span> &#123;</span><br><span class="line">              <span class="variable language_">console</span>.<span class="title function_">info</span>(<span class="string">&quot;checkbox group content&quot;</span> + <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(itemName))</span><br><span class="line">            &#125;)</span><br><span class="line">          <span class="title class_">Text</span>(<span class="string">&#x27;Select All&#x27;</span>).<span class="title function_">fontSize</span>(<span class="number">14</span>).<span class="title function_">lineHeight</span>(<span class="number">20</span>).<span class="title function_">fontColor</span>(<span class="string">&#x27;#182431&#x27;</span>).<span class="title function_">fontWeight</span>(<span class="number">500</span>)</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 选项1</span></span><br><span class="line">        <span class="title class_">Flex</span>(&#123; <span class="attr">justifyContent</span>: <span class="title class_">FlexAlign</span>.<span class="property">Start</span>, <span class="attr">alignItems</span>: <span class="title class_">ItemAlign</span>.<span class="property">Center</span> &#125;) &#123;</span><br><span class="line">          <span class="title class_">Checkbox</span>(&#123; <span class="attr">name</span>: <span class="string">&#x27;checkbox1&#x27;</span>, <span class="attr">group</span>: <span class="string">&#x27;checkboxGroup&#x27;</span> &#125;)</span><br><span class="line">            .<span class="title function_">selectedColor</span>(<span class="string">&#x27;#007DFF&#x27;</span>)</span><br><span class="line">            .<span class="title function_">onChange</span>(<span class="function">(<span class="params">value: boolean</span>) =&gt;</span> &#123;</span><br><span class="line">              <span class="variable language_">console</span>.<span class="title function_">info</span>(<span class="string">&#x27;Checkbox1 change is&#x27;</span> + value)</span><br><span class="line">            &#125;)</span><br><span class="line">          <span class="title class_">Text</span>(<span class="string">&#x27;Checkbox1&#x27;</span>).<span class="title function_">fontSize</span>(<span class="number">14</span>).<span class="title function_">lineHeight</span>(<span class="number">20</span>).<span class="title function_">fontColor</span>(<span class="string">&#x27;#182431&#x27;</span>).<span class="title function_">fontWeight</span>(<span class="number">500</span>)</span><br><span class="line">        &#125;.<span class="title function_">margin</span>(&#123; <span class="attr">left</span>: <span class="number">36</span> &#125;)</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 选项2</span></span><br><span class="line">        <span class="title class_">Flex</span>(&#123; <span class="attr">justifyContent</span>: <span class="title class_">FlexAlign</span>.<span class="property">Start</span>, <span class="attr">alignItems</span>: <span class="title class_">ItemAlign</span>.<span class="property">Center</span> &#125;) &#123;</span><br><span class="line">          <span class="title class_">Checkbox</span>(&#123; <span class="attr">name</span>: <span class="string">&#x27;checkbox2&#x27;</span>, <span class="attr">group</span>: <span class="string">&#x27;checkboxGroup&#x27;</span> &#125;)</span><br><span class="line">            .<span class="title function_">selectedColor</span>(<span class="string">&#x27;#007DFF&#x27;</span>)</span><br><span class="line">            .<span class="title function_">onChange</span>(<span class="function">(<span class="params">value: boolean</span>) =&gt;</span> &#123;</span><br><span class="line">              <span class="variable language_">console</span>.<span class="title function_">info</span>(<span class="string">&#x27;Checkbox2 change is&#x27;</span> + value)</span><br><span class="line">            &#125;)</span><br><span class="line">          <span class="title class_">Text</span>(<span class="string">&#x27;Checkbox2&#x27;</span>).<span class="title function_">fontSize</span>(<span class="number">14</span>).<span class="title function_">lineHeight</span>(<span class="number">20</span>).<span class="title function_">fontColor</span>(<span class="string">&#x27;#182431&#x27;</span>).<span class="title function_">fontWeight</span>(<span class="number">500</span>)</span><br><span class="line">        &#125;.<span class="title function_">margin</span>(&#123; <span class="attr">left</span>: <span class="number">36</span> &#125;)</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 选项3</span></span><br><span class="line">        <span class="title class_">Flex</span>(&#123; <span class="attr">justifyContent</span>: <span class="title class_">FlexAlign</span>.<span class="property">Start</span>, <span class="attr">alignItems</span>: <span class="title class_">ItemAlign</span>.<span class="property">Center</span> &#125;) &#123;</span><br><span class="line">          <span class="title class_">Checkbox</span>(&#123; <span class="attr">name</span>: <span class="string">&#x27;checkbox3&#x27;</span>, <span class="attr">group</span>: <span class="string">&#x27;checkboxGroup&#x27;</span> &#125;)</span><br><span class="line">            .<span class="title function_">selectedColor</span>(<span class="string">&#x27;#007DFF&#x27;</span>)</span><br><span class="line">            .<span class="title function_">onChange</span>(<span class="function">(<span class="params">value: boolean</span>) =&gt;</span> &#123;</span><br><span class="line">              <span class="variable language_">console</span>.<span class="title function_">info</span>(<span class="string">&#x27;Checkbox3 change is&#x27;</span> + value)</span><br><span class="line">            &#125;)</span><br><span class="line">          <span class="title class_">Text</span>(<span class="string">&#x27;Checkbox3&#x27;</span>).<span class="title function_">fontSize</span>(<span class="number">14</span>).<span class="title function_">lineHeight</span>(<span class="number">20</span>).<span class="title function_">fontColor</span>(<span class="string">&#x27;#182431&#x27;</span>).<span class="title function_">fontWeight</span>(<span class="number">500</span>)</span><br><span class="line">        &#125;.<span class="title function_">margin</span>(&#123; <span class="attr">left</span>: <span class="number">36</span> &#125;)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h1 id="二、页面循环与判断"><a href="#二、页面循环与判断" class="headerlink" title="二、页面循环与判断"></a>二、页面循环与判断</h1><h2 id="1-utils文件"><a href="#1-utils文件" class="headerlink" title="1.utils文件"></a>1.utils文件</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// utils/utils.ets</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">FoodData</span> &#123;</span><br><span class="line">  <span class="attr">name</span>: string;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">name: string</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">name</span> = name;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@<span class="title class_">Component</span></span><br><span class="line"><span class="keyword">export</span> struct <span class="title class_">FoodList</span> &#123;</span><br><span class="line">  private <span class="attr">foodItems</span>: <span class="title class_">FoodData</span>[]</span><br><span class="line"></span><br><span class="line">  <span class="title function_">build</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title class_">Column</span>() &#123; <span class="comment">//块级元素，可近似认为div标签</span></span><br><span class="line">      <span class="title class_">List</span>() &#123;  <span class="comment">//类似html中的ul</span></span><br><span class="line">        <span class="title class_">ForEach</span>(<span class="variable language_">this</span>.<span class="property">foodItems</span>, <span class="function">(<span class="params">item,idx</span>) =&gt;</span>&#123;</span><br><span class="line">          <span class="keyword">if</span> (idx&lt;<span class="number">2</span>)&#123;</span><br><span class="line">            <span class="title class_">ListItem</span>() &#123; <span class="comment">// 类似html中的li</span></span><br><span class="line">              <span class="title class_">Text</span>(item.<span class="property">name</span>) <span class="comment">//文本内容,对文字具体操作，可包裹span标签使用</span></span><br><span class="line">                .<span class="title function_">fontSize</span>(<span class="number">30</span>)</span><br><span class="line">                .<span class="title function_">fontColor</span>(<span class="string">&#x27;white&#x27;</span>)</span><br><span class="line">                .<span class="title function_">fontWeight</span>(<span class="string">&#x27;bold&#x27;</span>)</span><br><span class="line"></span><br><span class="line">            &#125;.<span class="title function_">onClick</span>(<span class="function">(<span class="params">e:any</span>)=&gt;</span>&#123;</span><br><span class="line">              <span class="variable language_">console</span>.<span class="title function_">log</span>(item.<span class="property">name</span>)</span><br><span class="line">            &#125;)</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;</span><br><span class="line">      .<span class="title function_">backgroundColor</span>(<span class="title class_">Color</span>.<span class="property">Pink</span>)</span><br><span class="line">      .<span class="title function_">margin</span>(<span class="string">&#x27;20&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="2-引入utils文件"><a href="#2-引入utils文件" class="headerlink" title="2.引入utils文件"></a>2.引入utils文件</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">FoodData</span>, <span class="title class_">FoodList</span> &#125; <span class="keyword">from</span> <span class="string">&quot;../utils/utils&quot;</span>;</span><br></pre></td></tr></table></figure><h1 id="三、路由跳转"><a href="#三、路由跳转" class="headerlink" title="三、路由跳转"></a>三、路由跳转</h1><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> router <span class="keyword">from</span> <span class="string">&#x27;@ohos.router&#x27;</span>;</span><br><span class="line"></span><br><span class="line"> <span class="keyword">let</span> options = &#123;</span><br><span class="line">      <span class="attr">url</span>: <span class="string">&#x27;pages/second&#x27;</span>,</span><br><span class="line">      <span class="attr">params</span>: &#123;</span><br><span class="line">        <span class="attr">text</span>: <span class="string">&#x27;这是第一页的值&#x27;</span>,</span><br><span class="line">        <span class="attr">data</span>: &#123;</span><br><span class="line">          <span class="attr">array</span>: [<span class="number">12</span>, <span class="number">45</span>, <span class="number">78</span>]</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">router.<span class="title function_">pushUrl</span>(options)</span><br><span class="line"><span class="comment">// router.back()</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h1 id="四、AppStorage"><a href="#四、AppStorage" class="headerlink" title="四、AppStorage"></a>四、AppStorage</h1><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// firstPage</span></span><br><span class="line">@<span class="title class_">Entry</span></span><br><span class="line">@<span class="title class_">Component</span></span><br><span class="line">struct <span class="title class_">FirstPage</span> &#123;</span><br><span class="line">  @<span class="title class_">StorageLink</span>(<span class="string">&#x27;varA&#x27;</span>) <span class="attr">aFirstPage</span>: number = <span class="number">1</span> </span><br><span class="line">  @<span class="title class_">StorageProp</span>(<span class="string">&#x27;varB&#x27;</span>) <span class="attr">bFirstPage</span>: number = <span class="number">2</span> <span class="comment">// 单向数据流</span></span><br><span class="line">  private <span class="attr">label</span>: string = <span class="string">&#x27;count&#x27;</span></span><br><span class="line"></span><br><span class="line">  <span class="title function_">build</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title class_">Column</span>() &#123;</span><br><span class="line">      <span class="title class_">Navigator</span>(&#123; <span class="attr">target</span>: <span class="string">&#x27;pages/TempPage&#x27;</span>, <span class="attr">type</span>: <span class="title class_">NavigationType</span>.<span class="property">Push</span> &#125;) &#123;</span><br><span class="line">        <span class="title class_">Text</span>(<span class="string">&quot;Now is FirstPage, Click here and go to SecondPage. \n type:Push&quot;</span>)</span><br><span class="line">          .<span class="title function_">textOverflow</span>(&#123;<span class="attr">overflow</span>:<span class="title class_">TextOverflow</span>.<span class="property">Ellipsis</span>&#125;)</span><br><span class="line">          .<span class="title function_">maxLines</span>(<span class="number">1</span>)</span><br><span class="line">          .<span class="title function_">fontSize</span>(<span class="number">20</span>)</span><br><span class="line">      &#125;</span><br><span class="line">      .<span class="title function_">margin</span>(&#123; <span class="attr">right</span>: <span class="number">24</span>, <span class="attr">left</span>: <span class="number">32</span> &#125;)</span><br><span class="line"></span><br><span class="line">      <span class="title class_">Row</span>(&#123; <span class="attr">space</span>: <span class="number">20</span> &#125;) &#123;</span><br><span class="line">        <span class="title class_">Button</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.label&#125;</span>: <span class="subst">$&#123;<span class="variable language_">this</span>.aFirstPage&#125;</span>`</span>)</span><br><span class="line">          .<span class="title function_">onClick</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">            <span class="title class_">AppStorage</span>.<span class="property">Set</span>&lt;number&gt;(<span class="string">&#x27;varA&#x27;</span>, <span class="title class_">AppStorage</span>.<span class="property">Get</span>&lt;number&gt;(<span class="string">&#x27;varA&#x27;</span>) + <span class="number">1</span>) <span class="comment">//这里</span></span><br><span class="line">          &#125;)</span><br><span class="line">        <span class="title class_">Button</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.label&#125;</span>: <span class="subst">$&#123;<span class="variable language_">this</span>.bFirstPage&#125;</span>`</span>)</span><br><span class="line">          .<span class="title function_">onClick</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">            <span class="title class_">AppStorage</span>.<span class="property">Set</span>&lt;<span class="title class_">Number</span>&gt;(<span class="string">&#x27;varB&#x27;</span>,<span class="variable language_">this</span>.<span class="property">bFirstPage</span> + <span class="number">1</span>)</span><br><span class="line">          &#125;).<span class="title function_">backgroundColor</span>(<span class="string">&#x27;red&#x27;</span>)</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="title class_">Column</span>()&#123;</span><br><span class="line">        <span class="title class_">Image</span>($r(<span class="string">&#x27;app.media.icon&#x27;</span>)).<span class="title function_">borderRadius</span>(<span class="number">200</span>)</span><br><span class="line">      &#125;.<span class="title function_">width</span>(<span class="number">200</span>).<span class="title function_">height</span>(<span class="number">200</span>).<span class="title function_">borderRadius</span>(<span class="number">200</span>).<span class="title function_">border</span>(&#123;<span class="attr">width</span>:<span class="number">2</span> ,<span class="attr">color</span>:<span class="string">&#x27;black&#x27;</span>&#125;)</span><br><span class="line"></span><br><span class="line">    &#125;.<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>).<span class="title function_">height</span>(<span class="string">&#x27;100%&#x27;</span>).<span class="title function_">margin</span>(<span class="number">0</span>)</span><br><span class="line">    .<span class="title function_">borderColor</span>(<span class="title class_">Color</span>.<span class="property">Black</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// TempPage</span></span><br><span class="line">@<span class="title class_">Entry</span></span><br><span class="line">@<span class="title class_">Component</span></span><br><span class="line">struct <span class="title class_">SecondPage</span> &#123;</span><br><span class="line">  @<span class="title class_">StorageLink</span>(<span class="string">&#x27;varA&#x27;</span>) <span class="attr">aSecondPage</span>: number = <span class="number">1</span> </span><br><span class="line"><span class="comment">// 组件通过使用@StorageLink(key)装饰的状态变量，将与AppStorage建立双向数据绑定</span></span><br><span class="line">  private <span class="attr">label</span>: string = <span class="string">&#x27;count&#x27;</span></span><br><span class="line"></span><br><span class="line">  <span class="title function_">build</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title class_">Column</span>()&#123;</span><br><span class="line">      <span class="title class_">Navigator</span>(&#123; <span class="attr">target</span>: <span class="string">&#x27;pages/firstPage&#x27;</span> ,<span class="attr">type</span>: <span class="title class_">NavigationType</span>.<span class="property">Push</span>&#125;) &#123;</span><br><span class="line">        <span class="title class_">Text</span>(<span class="string">&quot;Now is SecondPage, Click here and go to FirstPage. \n type:Push&quot;</span>)</span><br><span class="line">          .<span class="title function_">fontSize</span>(<span class="number">20</span>)</span><br><span class="line">      &#125;</span><br><span class="line">      .<span class="title function_">margin</span>(&#123; <span class="attr">right</span>: <span class="number">24</span>, <span class="attr">left</span>: <span class="number">32</span> &#125;)</span><br><span class="line">      <span class="title class_">Row</span>(&#123; <span class="attr">space</span>: <span class="number">20</span> &#125;) &#123;</span><br><span class="line">        <span class="title class_">Button</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.label&#125;</span>: <span class="subst">$&#123;<span class="variable language_">this</span>.aSecondPage&#125;</span>`</span>)</span><br><span class="line">          .<span class="title function_">onClick</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">            <span class="title class_">AppStorage</span>.<span class="property">Set</span>&lt;number&gt;(<span class="string">&#x27;varA&#x27;</span>, <span class="title class_">AppStorage</span>.<span class="property">Get</span>&lt;number&gt;(<span class="string">&#x27;varA&#x27;</span>) + <span class="number">1</span>) <span class="comment">//设值</span></span><br><span class="line">          &#125;)</span><br><span class="line">        <span class="title class_">Button</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.label&#125;</span>: <span class="subst">$&#123;AppStorage.Get(<span class="string">&#x27;varB&#x27;</span>)&#125;</span>`</span>) <span class="comment">// 取值</span></span><br><span class="line">          .<span class="title function_">onClick</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">          &#125;).<span class="title function_">backgroundColor</span>(<span class="string">&#x27;red&#x27;</span>)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="五、-Link与-Prop"><a href="#五、-Link与-Prop" class="headerlink" title="五、@Link与@Prop"></a>五、@Link与@Prop</h1><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// third.ets</span></span><br><span class="line">@<span class="title class_">CustomDialog</span></span><br><span class="line">struct <span class="title class_">CustomDialogExample</span> &#123;</span><br><span class="line">  @<span class="title class_">Link</span> <span class="attr">textValue</span>: string <span class="comment">// 双向绑定</span></span><br><span class="line">  @<span class="title class_">Link</span> <span class="attr">inputValue2</span>: string <span class="comment">// 双向绑定</span></span><br><span class="line">  @<span class="title class_">Prop</span> <span class="attr">receiveValue</span>:string <span class="comment">// 单向绑定</span></span><br><span class="line">  <span class="attr">controller</span>: <span class="title class_">CustomDialogController</span></span><br><span class="line">  <span class="attr">cancel</span>: <span class="function">() =&gt;</span> <span class="keyword">void</span></span><br><span class="line">  <span class="attr">confirm</span>: <span class="function">() =&gt;</span> <span class="keyword">void</span></span><br><span class="line"></span><br><span class="line">  <span class="title function_">build</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title class_">Column</span>() &#123;</span><br><span class="line">      <span class="title class_">Text</span>(<span class="string">&#x27;Change text&#x27;</span>).<span class="title function_">fontSize</span>(<span class="number">20</span>).<span class="title function_">margin</span>(&#123; <span class="attr">top</span>: <span class="number">10</span>, <span class="attr">bottom</span>: <span class="number">10</span> &#125;)</span><br><span class="line">      <span class="title class_">TextInput</span>(&#123; <span class="attr">placeholder</span>: <span class="string">&#x27;请输入文字&#x27;</span>, <span class="attr">text</span>: <span class="variable language_">this</span>.<span class="property">textValue</span> &#125;).<span class="title function_">height</span>(<span class="number">60</span>).<span class="title function_">width</span>(<span class="string">&#x27;90%&#x27;</span>)</span><br><span class="line">        .<span class="title function_">onChange</span>(<span class="function">(<span class="params">value: string</span>) =&gt;</span> &#123;</span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">textValue</span> = value</span><br><span class="line">        &#125;)</span><br><span class="line">      <span class="title class_">Text</span>(<span class="variable language_">this</span>.<span class="property">receiveValue</span>).<span class="title function_">fontSize</span>(<span class="number">16</span>).<span class="title function_">margin</span>(&#123; <span class="attr">bottom</span>: <span class="number">10</span> &#125;)</span><br><span class="line">      <span class="title class_">Flex</span>(&#123; <span class="attr">justifyContent</span>: <span class="title class_">FlexAlign</span>.<span class="property">SpaceAround</span> &#125;) &#123;</span><br><span class="line">        <span class="title class_">Button</span>(<span class="string">&#x27;cancel&#x27;</span>)</span><br><span class="line">          .<span class="title function_">onClick</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">controller</span>.<span class="title function_">close</span>()</span><br><span class="line">            <span class="variable language_">this</span>.<span class="title function_">cancel</span>()</span><br><span class="line">          &#125;).<span class="title function_">backgroundColor</span>(<span class="number">0xffffff</span>).<span class="title function_">fontColor</span>(<span class="title class_">Color</span>.<span class="property">Black</span>)</span><br><span class="line">        <span class="title class_">Button</span>(<span class="string">&#x27;confirm&#x27;</span>)</span><br><span class="line">          .<span class="title function_">onClick</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">inputValue2</span> = <span class="variable language_">this</span>.<span class="property">textValue</span></span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">receiveValue</span> = <span class="variable language_">this</span>.<span class="property">textValue</span></span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">controller</span>.<span class="title function_">close</span>()</span><br><span class="line">            <span class="variable language_">this</span>.<span class="title function_">confirm</span>()</span><br><span class="line">          &#125;).<span class="title function_">backgroundColor</span>(<span class="number">0xffffff</span>).<span class="title function_">fontColor</span>(<span class="title class_">Color</span>.<span class="property">Red</span>)</span><br><span class="line">      &#125;.<span class="title function_">margin</span>(&#123; <span class="attr">bottom</span>: <span class="number">10</span> &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@<span class="title class_">Entry</span></span><br><span class="line">@<span class="title class_">Component</span></span><br><span class="line">struct <span class="title class_">CustomDialogUser</span> &#123;</span><br><span class="line">  @<span class="title class_">State</span> <span class="attr">textValue</span>: string = <span class="string">&#x27;&#x27;</span></span><br><span class="line">  @<span class="title class_">State</span> <span class="attr">inputValue</span>: string = <span class="string">&#x27;click me&#x27;</span></span><br><span class="line">  @<span class="title class_">State</span> <span class="attr">receiveValue</span>: string = <span class="string">&#x27;click me&#x27;</span></span><br><span class="line">  <span class="attr">dialogController</span>: <span class="title class_">CustomDialogController</span> = <span class="keyword">new</span> <span class="title class_">CustomDialogController</span>(&#123;</span><br><span class="line">    <span class="attr">builder</span>: <span class="title class_">CustomDialogExample</span>(&#123;</span><br><span class="line">      <span class="attr">cancel</span>: <span class="variable language_">this</span>.<span class="property">onCancel</span>,</span><br><span class="line">      <span class="attr">confirm</span>: <span class="variable language_">this</span>.<span class="property">onAccept</span>,</span><br><span class="line">      <span class="comment">//针对@Link属性的变量，赋值时需要使用$变量名，使用this.变量名会报错。</span></span><br><span class="line">      <span class="attr">textValue</span>: $textValue,</span><br><span class="line">      <span class="attr">inputValue2</span>: $inputValue,</span><br><span class="line">      <span class="comment">//@Prop属性的变量使用this.变量名即可</span></span><br><span class="line">      <span class="attr">receiveValue</span>:<span class="variable language_">this</span>.<span class="property">receiveValue</span></span><br><span class="line">    &#125;),</span><br><span class="line">    <span class="attr">cancel</span>: <span class="variable language_">this</span>.<span class="property">existApp</span>,</span><br><span class="line">    <span class="attr">autoCancel</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">alignment</span>: <span class="title class_">DialogAlignment</span>.<span class="property">Default</span>,</span><br><span class="line">    <span class="attr">offset</span>: &#123; <span class="attr">dx</span>: <span class="number">0</span>, <span class="attr">dy</span>: -<span class="number">20</span> &#125;,</span><br><span class="line">    <span class="attr">gridCount</span>: <span class="number">4</span>,</span><br><span class="line">    <span class="attr">customStyle</span>: <span class="literal">false</span></span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="title function_">onCancel</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">info</span>(<span class="string">&#x27;Callback when the first button is clicked&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">onAccept</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">info</span>(<span class="string">&#x27;Callback when the second button is clicked&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">existApp</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">info</span>(<span class="string">&#x27;Click the callback in the blank area&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">build</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title class_">Column</span>() &#123;</span><br><span class="line">      <span class="title class_">Button</span>(<span class="variable language_">this</span>.<span class="property">inputValue</span>)</span><br><span class="line">        .<span class="title function_">onClick</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">dialogController</span>.<span class="title function_">open</span>()</span><br><span class="line">        &#125;).<span class="title function_">backgroundColor</span>(<span class="number">0x317aff</span>)</span><br><span class="line">    &#125;.<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>).<span class="title function_">margin</span>(&#123; <span class="attr">top</span>: <span class="number">50</span> &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h1 id="六、-Consume和-Provide"><a href="#六、-Consume和-Provide" class="headerlink" title="六、@Consume和@Provide"></a>六、@Consume和@Provide</h1><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Provide作为数据的提供方，可以更新其子孙节点的数据，并触发页面渲染。Consume在感知到Provide数据的更新后，会触发当前view的重新渲染。</span></span><br><span class="line"><span class="comment">//这里的使用类似于state和link。父组件中Provide提供数据，子组件中Consume使用，且是双向绑定，一方改变后，另一方也会改变。</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// provider.ets</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">CompB</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;./consumer&#x27;</span></span><br><span class="line">@<span class="title class_">Entry</span></span><br><span class="line">@<span class="title class_">Component</span></span><br><span class="line">struct <span class="title class_">CompA</span> &#123;</span><br><span class="line">  @<span class="title class_">Provide</span>(<span class="string">&quot;reviewVote&quot;</span>) reviewVotes : number = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">build</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title class_">Column</span>() &#123;</span><br><span class="line">      <span class="title class_">CompB</span>()</span><br><span class="line">      <span class="title class_">Button</span>() &#123;</span><br><span class="line">        <span class="title class_">Text</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.reviewVotes&#125;</span>`</span>)</span><br><span class="line">          .<span class="title function_">fontSize</span>(<span class="number">30</span>)</span><br><span class="line">      &#125;.<span class="title function_">width</span>(<span class="number">100</span>).<span class="title function_">backgroundColor</span>(<span class="title class_">Color</span>.<span class="property">Yellow</span>)</span><br><span class="line">      .<span class="title function_">onClick</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">reviewVotes</span> += <span class="number">1</span>;</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// consumer.ets</span></span><br><span class="line">@<span class="title class_">Component</span></span><br><span class="line"><span class="keyword">export</span> struct <span class="title class_">CompB</span> &#123;</span><br><span class="line">  @<span class="title class_">Consume</span>(<span class="string">&quot;reviewVote&quot;</span>) reviewVotes : number;</span><br><span class="line">  <span class="title function_">build</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title class_">Column</span>() &#123;</span><br><span class="line">      <span class="title class_">Button</span>() &#123;</span><br><span class="line">        <span class="title class_">Text</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.reviewVotes&#125;</span>`</span>)</span><br><span class="line">          .<span class="title function_">fontSize</span>(<span class="number">30</span>)</span><br><span class="line">      &#125;.<span class="title function_">width</span>(<span class="number">100</span>).<span class="title function_">backgroundColor</span>(<span class="string">&#x27;red&#x27;</span>)</span><br><span class="line">      .<span class="title function_">onClick</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">reviewVotes</span> += <span class="number">1</span>;</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="七、-Watch"><a href="#七、-Watch" class="headerlink" title="七、@Watch"></a>七、@Watch</h1><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//应用可以注册回调函数。当一个被@State, @Prop, @Link, @ObjectLink, @Provide, @Consume, @StorageProp, 以及 @StorageLink中任意一个装饰器修饰的变量改变时，均可触发此回调。@Watch中的变量一定要使用（“”）进行包装。</span></span><br><span class="line"><span class="comment">//这个比较简单，通俗点说就相当于给变量绑了个监听函数，每次该变量改变后，都将执行此函数,即回调函数。</span></span><br><span class="line"></span><br><span class="line">@<span class="title class_">Entry</span></span><br><span class="line">@<span class="title class_">Component</span></span><br><span class="line">struct <span class="title class_">CompA</span> &#123;</span><br><span class="line">  @<span class="title class_">State</span> @<span class="title class_">Watch</span>(<span class="string">&quot;onBasketUpdated&quot;</span>) shopBasket : <span class="title class_">Array</span>&lt;number&gt; = [ <span class="number">7</span>, <span class="number">12</span>, <span class="number">47</span>, <span class="number">3</span> ];  <span class="comment">//将onBasketUpdated注册为回调函数，当变量shopBasket发生改变时，将自动触发该回调函数</span></span><br><span class="line">  @<span class="title class_">State</span> totalPurchase : number = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">updateTotal</span>() : number &#123;</span><br><span class="line">    <span class="keyword">const</span> sum=<span class="variable language_">this</span>.<span class="property">shopBasket</span>.<span class="title function_">reduce</span>(<span class="function">(<span class="params">prev,next</span>)=&gt;</span>prev+next,<span class="number">0</span>)</span><br><span class="line">    <span class="comment">// calculate new total shop basket value and apply discount if over 100RMB</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">totalPurchase</span> = sum;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">totalPurchase</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// @Watch cb</span></span><br><span class="line">  <span class="title function_">onBasketUpdated</span>(<span class="attr">propName</span>: string) : <span class="keyword">void</span> &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">updateTotal</span>();</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>[propName])</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">build</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title class_">Column</span>() &#123;</span><br><span class="line">      <span class="title class_">Button</span>(<span class="string">&quot;add to basket&quot;</span>).<span class="title function_">onClick</span>(<span class="function">() =&gt;</span> &#123; <span class="variable language_">this</span>.<span class="property">shopBasket</span>.<span class="title function_">push</span>(<span class="title class_">Math</span>.<span class="title function_">round</span>(<span class="number">100</span> * <span class="title class_">Math</span>.<span class="title function_">random</span>())) &#125;) <span class="comment">//这里shopBasket改变，触发onBasketUpdated函数，从而更新this.totalPurchase的值</span></span><br><span class="line">      <span class="title class_">Text</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.totalPurchase&#125;</span>`</span>)</span><br><span class="line">        .<span class="title function_">fontSize</span>(<span class="number">30</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 鸿蒙 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ets </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>多层级饼图</title>
      <link href="/2022/06/19/%E5%A4%9A%E5%B1%82%E7%BA%A7%E9%A5%BC%E5%9B%BE/"/>
      <url>/2022/06/19/%E5%A4%9A%E5%B1%82%E7%BA%A7%E9%A5%BC%E5%9B%BE/</url>
      
        <content type="html"><![CDATA[<h1 id="多层级饼图"><a href="#多层级饼图" class="headerlink" title="多层级饼图"></a>多层级饼图</h1><h2 id="1-概念"><a href="#1-概念" class="headerlink" title="1.概念"></a>1.概念</h2><p>直观上来说，就是一环环饼图嵌套展示，不过每一层<strong>内环</strong>都与<strong>相邻外环</strong>构成<strong>父子关系</strong>。如同<strong>树</strong>的结构一样，一个父亲节点含有多个孩子节点，每个孩子节点依次含有多个孙子节点，依次类推……</p><p>用多层级的饼图可以很直观判断出，他们相互之间的<strong>占比</strong>及<strong>从属关系</strong>。</p><h2 id="2-准备工作"><a href="#2-准备工作" class="headerlink" title="2.准备工作"></a>2.准备工作</h2><h3 id="2-1）安装echarts"><a href="#2-1）安装echarts" class="headerlink" title="2.1）安装echarts"></a>2.1）安装echarts</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">npm install echarts --save</span><br><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> echarts <span class="keyword">from</span> <span class="string">&#x27;echarts&#x27;</span>;</span><br><span class="line"></span><br><span class="line">或者</span><br><span class="line"></span><br><span class="line">&lt;script type=<span class="string">&quot;text/javascript&quot;</span> src=<span class="string">&quot;https://cdn.jsdelivr.net/npm/echarts@5.3.3/dist/echarts.min.js&quot;</span>&gt;&lt;/script&gt;</span><br></pre></td></tr></table></figure><h3 id="2-2）样例展示"><a href="#2-2）样例展示" class="headerlink" title="2.2）样例展示"></a>2.2）样例展示</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// echarts基础option 可粘贴到官网自行调校</span></span><br><span class="line"><span class="keyword">var</span> option = &#123;</span><br><span class="line">  <span class="attr">tooltip</span>: &#123;</span><br><span class="line">    <span class="attr">trigger</span>: <span class="string">&#x27;item&#x27;</span>,</span><br><span class="line">    <span class="attr">show</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">position</span>: <span class="keyword">function</span> (<span class="params">point, params, dom, rect, size</span>) &#123;</span><br><span class="line">      <span class="comment">// 固定在顶部</span></span><br><span class="line">      <span class="keyword">return</span> [point[<span class="number">0</span>], <span class="string">&#x27;50%&#x27;</span>];</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">formatter</span>: <span class="string">&#x27;&#123;a&#125; &lt;br/&gt;&#123;b&#125;: &#123;c&#125; (&#123;d&#125;%)&#x27;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">series</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">name</span>: <span class="string">&#x27;数据&#x27;</span>,</span><br><span class="line">      <span class="attr">type</span>: <span class="string">&#x27;pie&#x27;</span>,</span><br><span class="line">      <span class="attr">radius</span>: [<span class="string">&#x27;30%&#x27;</span>, <span class="string">&#x27;45%&#x27;</span>],</span><br><span class="line">      <span class="attr">avoidLabelOverlap</span>: <span class="literal">false</span>,</span><br><span class="line">      <span class="attr">label</span>: &#123;</span><br><span class="line">        <span class="attr">position</span>: <span class="string">&#x27;inner&#x27;</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">itemStyle</span>: &#123;</span><br><span class="line">        <span class="attr">borderWidth</span>: <span class="number">1</span> <span class="comment">//设置border宽度</span></span><br><span class="line">        <span class="comment">// borderColor:&#x27;#fff&#x27;,</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">labelLine</span>: &#123;</span><br><span class="line">        <span class="attr">show</span>: <span class="literal">false</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">color</span>: [<span class="string">&#x27;#033bb5&#x27;</span>, <span class="string">&#x27;#1079b4&#x27;</span>, <span class="string">&#x27;#128d6a&#x27;</span>, <span class="string">&#x27;#199747&#x27;</span>, <span class="string">&#x27;#0f4e59&#x27;</span>],</span><br><span class="line">      <span class="attr">data</span>: [</span><br><span class="line">        &#123; <span class="attr">value</span>: <span class="number">50</span>, <span class="attr">name</span>: <span class="string">&#x27;产品&#x27;</span>, <span class="attr">newval</span>: <span class="number">1000</span> &#125;,</span><br><span class="line">        &#123; <span class="attr">value</span>: <span class="number">20</span>, <span class="attr">name</span>: <span class="string">&#x27;价格&#x27;</span>, <span class="attr">newval</span>: <span class="number">200</span> &#125;,</span><br><span class="line">        &#123; <span class="attr">value</span>: <span class="number">15</span>, <span class="attr">name</span>: <span class="string">&#x27;服务&#x27;</span>, <span class="attr">newval</span>: <span class="number">100</span> &#125;,</span><br><span class="line">        &#123; <span class="attr">value</span>: <span class="number">10</span>, <span class="attr">name</span>: <span class="string">&#x27;品牌&#x27;</span>, <span class="attr">newval</span>: <span class="number">10</span> &#125;,</span><br><span class="line">        &#123; <span class="attr">value</span>: <span class="number">5</span>, <span class="attr">name</span>: <span class="string">&#x27;购买意向&#x27;</span>, <span class="attr">newval</span>: <span class="number">5</span> &#125;</span><br><span class="line">      ]</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">name</span>: <span class="string">&#x27;数据&#x27;</span>,</span><br><span class="line">      <span class="attr">type</span>: <span class="string">&#x27;pie&#x27;</span>,</span><br><span class="line">      <span class="attr">radius</span>: [<span class="string">&#x27;45%&#x27;</span>, <span class="string">&#x27;65%&#x27;</span>],</span><br><span class="line">      <span class="attr">avoidLabelOverlap</span>: <span class="literal">false</span>,</span><br><span class="line">      <span class="attr">label</span>: &#123;</span><br><span class="line">        <span class="attr">position</span>: <span class="string">&#x27;inner&#x27;</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">color</span>: [</span><br><span class="line">        <span class="string">&#x27;#033bb5&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;#1079b4&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;#128d6a&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;#199747&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;#0f4e59&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;#10304c&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;#2e0bd3&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;#666&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;#333&#x27;</span></span><br><span class="line">      ],</span><br><span class="line">      <span class="attr">itemStyle</span>: &#123;</span><br><span class="line">        <span class="attr">borderWidth</span>: <span class="number">1</span></span><br><span class="line">        <span class="comment">// borderColor:&#x27;#fff&#x27;,</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">data</span>: [</span><br><span class="line">        &#123; <span class="attr">value</span>: <span class="number">25</span>, <span class="attr">name</span>: <span class="string">&#x27;c1&#x27;</span>, <span class="attr">newval</span>: <span class="number">300</span> &#125;,</span><br><span class="line">        &#123; <span class="attr">value</span>: <span class="number">20</span>, <span class="attr">name</span>: <span class="string">&#x27;c2&#x27;</span>, <span class="attr">newval</span>: <span class="number">200</span> &#125;,</span><br><span class="line">        &#123; <span class="attr">value</span>: <span class="number">5</span>, <span class="attr">name</span>: <span class="string">&#x27;c3&#x27;</span>, <span class="attr">newval</span>: <span class="number">10</span> &#125;,</span><br><span class="line">        &#123; <span class="attr">value</span>: <span class="number">10</span>, <span class="attr">name</span>: <span class="string">&#x27;j1&#x27;</span>, <span class="attr">newval</span>: <span class="number">10</span> &#125;,</span><br><span class="line">        &#123; <span class="attr">value</span>: <span class="number">10</span>, <span class="attr">name</span>: <span class="string">&#x27;j2&#x27;</span>, <span class="attr">newval</span>: <span class="number">10</span> &#125;,</span><br><span class="line">        &#123; <span class="attr">value</span>: <span class="number">10</span>, <span class="attr">name</span>: <span class="string">&#x27;f1&#x27;</span>, <span class="attr">newval</span>: <span class="number">10</span> &#125;,</span><br><span class="line">        &#123; <span class="attr">value</span>: <span class="number">5</span>, <span class="attr">name</span>: <span class="string">&#x27;f2&#x27;</span>, <span class="attr">newval</span>: <span class="number">5</span> &#125;,</span><br><span class="line">        &#123; <span class="attr">value</span>: <span class="number">10</span>, <span class="attr">name</span>: <span class="string">&#x27;pp&#x27;</span>, <span class="attr">newval</span>: <span class="number">10</span> &#125;,</span><br><span class="line">        &#123; <span class="attr">value</span>: <span class="number">5</span>, <span class="attr">name</span>: <span class="string">&#x27;end1&#x27;</span>, <span class="attr">newval</span>: <span class="number">5</span> &#125;</span><br><span class="line">      ]</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">name</span>: <span class="string">&#x27;数据&#x27;</span>,</span><br><span class="line">      <span class="attr">type</span>: <span class="string">&#x27;pie&#x27;</span>,</span><br><span class="line">      <span class="attr">radius</span>: [<span class="string">&#x27;65%&#x27;</span>, <span class="string">&#x27;70%&#x27;</span>],</span><br><span class="line">      <span class="attr">avoidLabelOverlap</span>: <span class="literal">false</span>,</span><br><span class="line">      <span class="attr">label</span>: &#123;</span><br><span class="line">        <span class="comment">// position: &#x27;outsideFill&#x27;</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">color</span>: [</span><br><span class="line">        <span class="string">&#x27;#85a3ad&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;#61a0a9&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;#fff&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;#fff&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;#fff&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;#fff&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;#fff&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;#397c86&#x27;</span></span><br><span class="line">      ],</span><br><span class="line">      <span class="attr">itemStyle</span>: &#123;</span><br><span class="line">        <span class="attr">borderWidth</span>: <span class="number">1</span></span><br><span class="line">        <span class="comment">// borderColor:&#x27;#fff&#x27;,</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">clockWise</span>: <span class="literal">true</span>,</span><br><span class="line">      <span class="attr">data</span>: [</span><br><span class="line">        &#123; <span class="attr">value</span>: <span class="number">25</span>, <span class="attr">name</span>: <span class="string">&#x27;配置1&#x27;</span>, <span class="attr">newval</span>: <span class="number">100</span> &#125;,</span><br><span class="line">        &#123; <span class="attr">value</span>: <span class="number">25</span>, <span class="attr">name</span>: <span class="string">&#x27;b2&#x27;</span>, <span class="attr">newval</span>: <span class="number">100</span> &#125;,</span><br><span class="line">        &#123; <span class="attr">value</span>: <span class="number">12</span>, <span class="attr">name</span>: <span class="string">&#x27;&#x27;</span>, <span class="attr">newval</span>: <span class="number">0</span> &#125;,</span><br><span class="line">        &#123; <span class="attr">value</span>: <span class="number">12</span>, <span class="attr">name</span>: <span class="string">&#x27;&#x27;</span>, <span class="attr">newval</span>: <span class="number">0</span> &#125;,</span><br><span class="line">        &#123; <span class="attr">value</span>: <span class="number">11</span>, <span class="attr">name</span>: <span class="string">&#x27;&#x27;</span>, <span class="attr">newval</span>: <span class="number">0</span> &#125;,</span><br><span class="line">        &#123; <span class="attr">value</span>: <span class="number">5</span>, <span class="attr">name</span>: <span class="string">&#x27;&#x27;</span>, <span class="attr">newval</span>: <span class="number">0</span> &#125;,</span><br><span class="line">        &#123; <span class="attr">value</span>: <span class="number">5</span>, <span class="attr">name</span>: <span class="string">&#x27;&#x27;</span>, <span class="attr">newval</span>: <span class="number">0</span> &#125;,</span><br><span class="line">        &#123; <span class="attr">value</span>: <span class="number">5</span>, <span class="attr">name</span>: <span class="string">&#x27;qita3&#x27;</span>, <span class="attr">newval</span>: <span class="number">30</span> &#125;</span><br><span class="line">      ]</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">name</span>: <span class="string">&#x27;数据&#x27;</span>,</span><br><span class="line">      <span class="attr">type</span>: <span class="string">&#x27;pie&#x27;</span>,</span><br><span class="line">      <span class="attr">radius</span>: [<span class="string">&#x27;30%&#x27;</span>, <span class="string">&#x27;45%&#x27;</span>],</span><br><span class="line">      <span class="attr">avoidLabelOverlap</span>: <span class="literal">false</span>,</span><br><span class="line">      <span class="attr">label</span>: &#123;</span><br><span class="line">        <span class="attr">show</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="attr">position</span>: <span class="string">&#x27;center&#x27;</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">emphasis</span>: &#123;</span><br><span class="line">        <span class="attr">label</span>: &#123;</span><br><span class="line">          <span class="attr">show</span>: <span class="literal">true</span>,</span><br><span class="line">          <span class="attr">fontSize</span>: <span class="string">&#x27;20&#x27;</span>,</span><br><span class="line">          <span class="attr">formatter</span>: <span class="function">(<span class="params">params</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(params);</span><br><span class="line">            <span class="keyword">const</span> newName =</span><br><span class="line">              params.<span class="property">name</span> === <span class="string">&#x27;&#x27;</span></span><br><span class="line">                ? <span class="string">&#x27;&#x27;</span></span><br><span class="line">                : <span class="string">`<span class="subst">$&#123;params.name&#125;</span>\n\n<span class="subst">$&#123;params.data.newval&#125;</span>`</span>;</span><br><span class="line">            <span class="keyword">return</span> newName;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">itemStyle</span>: &#123;</span><br><span class="line">        <span class="attr">borderWidth</span>: <span class="number">1</span> <span class="comment">//设置border宽度</span></span><br><span class="line">        <span class="comment">// borderColor:&#x27;#fff&#x27;,</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">labelLine</span>: &#123;</span><br><span class="line">        <span class="attr">show</span>: <span class="literal">false</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">color</span>: [<span class="string">&#x27;#033bb5&#x27;</span>, <span class="string">&#x27;#1079b4&#x27;</span>, <span class="string">&#x27;#128d6a&#x27;</span>, <span class="string">&#x27;#199747&#x27;</span>, <span class="string">&#x27;#0f4e59&#x27;</span>],</span><br><span class="line">      <span class="attr">data</span>: [</span><br><span class="line">        &#123; <span class="attr">value</span>: <span class="number">50</span>, <span class="attr">name</span>: <span class="string">&#x27;产品&#x27;</span>, <span class="attr">newval</span>: <span class="number">1000</span> &#125;,</span><br><span class="line">        &#123; <span class="attr">value</span>: <span class="number">20</span>, <span class="attr">name</span>: <span class="string">&#x27;价格&#x27;</span>, <span class="attr">newval</span>: <span class="number">200</span> &#125;,</span><br><span class="line">        &#123; <span class="attr">value</span>: <span class="number">15</span>, <span class="attr">name</span>: <span class="string">&#x27;服务&#x27;</span>, <span class="attr">newval</span>: <span class="number">100</span> &#125;,</span><br><span class="line">        &#123; <span class="attr">value</span>: <span class="number">10</span>, <span class="attr">name</span>: <span class="string">&#x27;品牌&#x27;</span>, <span class="attr">newval</span>: <span class="number">10</span> &#125;,</span><br><span class="line">        &#123; <span class="attr">value</span>: <span class="number">5</span>, <span class="attr">name</span>: <span class="string">&#x27;购买意向&#x27;</span>, <span class="attr">newval</span>: <span class="number">5</span> &#125;</span><br><span class="line">      ]</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">name</span>: <span class="string">&#x27;数据&#x27;</span>,</span><br><span class="line">      <span class="attr">type</span>: <span class="string">&#x27;pie&#x27;</span>,</span><br><span class="line">      <span class="attr">radius</span>: [<span class="string">&#x27;45%&#x27;</span>, <span class="string">&#x27;65%&#x27;</span>],</span><br><span class="line">      <span class="attr">color</span>: [</span><br><span class="line">        <span class="string">&#x27;#033bb5&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;#1079b4&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;#128d6a&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;#199747&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;#0f4e59&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;#10304c&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;#2e0bd3&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;#666&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;#333&#x27;</span></span><br><span class="line">      ],</span><br><span class="line">      <span class="attr">avoidLabelOverlap</span>: <span class="literal">false</span>,</span><br><span class="line">      <span class="attr">label</span>: &#123;</span><br><span class="line">        <span class="attr">show</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="attr">position</span>: <span class="string">&#x27;center&#x27;</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">emphasis</span>: &#123;</span><br><span class="line">        <span class="attr">label</span>: &#123;</span><br><span class="line">          <span class="attr">show</span>: <span class="literal">true</span>,</span><br><span class="line">          <span class="attr">fontSize</span>: <span class="string">&#x27;20&#x27;</span>,</span><br><span class="line">          <span class="attr">formatter</span>: <span class="function">(<span class="params">params</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(params);</span><br><span class="line">            <span class="keyword">const</span> newName =</span><br><span class="line">              params.<span class="property">name</span> === <span class="string">&#x27;&#x27;</span></span><br><span class="line">                ? <span class="string">&#x27;&#x27;</span></span><br><span class="line">                : <span class="string">`<span class="subst">$&#123;params.name&#125;</span>\n\n<span class="subst">$&#123;params.data.newval&#125;</span>`</span>;</span><br><span class="line">            <span class="keyword">return</span> newName;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">itemStyle</span>: &#123;</span><br><span class="line">        <span class="attr">borderWidth</span>: <span class="number">1</span></span><br><span class="line">        <span class="comment">// borderColor:&#x27;#fff&#x27;,</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">data</span>: [</span><br><span class="line">        &#123; <span class="attr">value</span>: <span class="number">25</span>, <span class="attr">name</span>: <span class="string">&#x27;c1&#x27;</span>, <span class="attr">newval</span>: <span class="number">300</span> &#125;,</span><br><span class="line">        &#123; <span class="attr">value</span>: <span class="number">20</span>, <span class="attr">name</span>: <span class="string">&#x27;c2&#x27;</span>, <span class="attr">newval</span>: <span class="number">200</span> &#125;,</span><br><span class="line">        &#123; <span class="attr">value</span>: <span class="number">5</span>, <span class="attr">name</span>: <span class="string">&#x27;c3&#x27;</span>, <span class="attr">newval</span>: <span class="number">10</span> &#125;,</span><br><span class="line">        &#123; <span class="attr">value</span>: <span class="number">10</span>, <span class="attr">name</span>: <span class="string">&#x27;j1&#x27;</span>, <span class="attr">newval</span>: <span class="number">10</span> &#125;,</span><br><span class="line">        &#123; <span class="attr">value</span>: <span class="number">10</span>, <span class="attr">name</span>: <span class="string">&#x27;j2&#x27;</span>, <span class="attr">newval</span>: <span class="number">10</span> &#125;,</span><br><span class="line">        &#123; <span class="attr">value</span>: <span class="number">10</span>, <span class="attr">name</span>: <span class="string">&#x27;f1&#x27;</span>, <span class="attr">newval</span>: <span class="number">10</span> &#125;,</span><br><span class="line">        &#123; <span class="attr">value</span>: <span class="number">5</span>, <span class="attr">name</span>: <span class="string">&#x27;f2&#x27;</span>, <span class="attr">newval</span>: <span class="number">5</span> &#125;,</span><br><span class="line">        &#123; <span class="attr">value</span>: <span class="number">10</span>, <span class="attr">name</span>: <span class="string">&#x27;pp&#x27;</span>, <span class="attr">newval</span>: <span class="number">10</span> &#125;,</span><br><span class="line">        &#123; <span class="attr">value</span>: <span class="number">5</span>, <span class="attr">name</span>: <span class="string">&#x27;end1&#x27;</span>, <span class="attr">newval</span>: <span class="number">5</span> &#125;</span><br><span class="line">      ]</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">name</span>: <span class="string">&#x27;数据&#x27;</span>,</span><br><span class="line">      <span class="attr">type</span>: <span class="string">&#x27;pie&#x27;</span>,</span><br><span class="line">      <span class="attr">radius</span>: [<span class="string">&#x27;65%&#x27;</span>, <span class="string">&#x27;70%&#x27;</span>],</span><br><span class="line">      <span class="attr">avoidLabelOverlap</span>: <span class="literal">false</span>,</span><br><span class="line">      <span class="attr">label</span>: &#123;</span><br><span class="line">        <span class="attr">show</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="attr">position</span>: <span class="string">&#x27;center&#x27;</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">emphasis</span>: &#123;</span><br><span class="line">        <span class="attr">label</span>: &#123;</span><br><span class="line">          <span class="attr">show</span>: <span class="literal">true</span>,</span><br><span class="line">          <span class="attr">fontSize</span>: <span class="string">&#x27;20&#x27;</span>,</span><br><span class="line">          <span class="attr">formatter</span>: <span class="function">(<span class="params">params</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(params);</span><br><span class="line">            <span class="keyword">const</span> newName =</span><br><span class="line">              params.<span class="property">name</span> === <span class="string">&#x27;&#x27;</span></span><br><span class="line">                ? <span class="string">&#x27;&#x27;</span></span><br><span class="line">                : <span class="string">`<span class="subst">$&#123;params.name&#125;</span>\n\n<span class="subst">$&#123;params.data.newval&#125;</span>`</span>;</span><br><span class="line">            <span class="keyword">return</span> newName;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">color</span>: [<span class="string">&#x27;&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="string">&#x27;#fff&#x27;</span>, <span class="string">&#x27;#fff&#x27;</span>, <span class="string">&#x27;#fff&#x27;</span>, <span class="string">&#x27;#fff&#x27;</span>, <span class="string">&#x27;#fff&#x27;</span>, <span class="string">&#x27;&#x27;</span>],</span><br><span class="line">      <span class="attr">itemStyle</span>: &#123;</span><br><span class="line">        <span class="attr">borderWidth</span>: <span class="number">1</span></span><br><span class="line">        <span class="comment">// borderColor:&#x27;#fff&#x27;,</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">clockWise</span>: <span class="literal">true</span>,</span><br><span class="line">      <span class="attr">data</span>: [</span><br><span class="line">        &#123; <span class="attr">value</span>: <span class="number">25</span>, <span class="attr">name</span>: <span class="string">&#x27;配置1&#x27;</span>, <span class="attr">newval</span>: <span class="number">100</span> &#125;,</span><br><span class="line">        &#123; <span class="attr">value</span>: <span class="number">25</span>, <span class="attr">name</span>: <span class="string">&#x27;b2&#x27;</span>, <span class="attr">newval</span>: <span class="number">100</span> &#125;,</span><br><span class="line">        &#123; <span class="attr">value</span>: <span class="number">12</span>, <span class="attr">name</span>: <span class="string">&#x27;&#x27;</span>, <span class="attr">newval</span>: <span class="number">0</span> &#125;,</span><br><span class="line">        &#123; <span class="attr">value</span>: <span class="number">12</span>, <span class="attr">name</span>: <span class="string">&#x27;&#x27;</span>, <span class="attr">newval</span>: <span class="number">0</span> &#125;,</span><br><span class="line">        &#123; <span class="attr">value</span>: <span class="number">11</span>, <span class="attr">name</span>: <span class="string">&#x27;&#x27;</span>, <span class="attr">newval</span>: <span class="number">0</span> &#125;,</span><br><span class="line">        &#123; <span class="attr">value</span>: <span class="number">5</span>, <span class="attr">name</span>: <span class="string">&#x27;&#x27;</span>, <span class="attr">newval</span>: <span class="number">0</span> &#125;,</span><br><span class="line">        &#123; <span class="attr">value</span>: <span class="number">5</span>, <span class="attr">name</span>: <span class="string">&#x27;&#x27;</span>, <span class="attr">newval</span>: <span class="number">0</span> &#125;,</span><br><span class="line">        &#123; <span class="attr">value</span>: <span class="number">5</span>, <span class="attr">name</span>: <span class="string">&#x27;qita3&#x27;</span>, <span class="attr">newval</span>: <span class="number">30</span> &#125;</span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/rainlotus97/images/data/2022-06-19/image-20220619131701571.png" alt="example"></p><h3 id="2-3）网页展示链接"><a href="#2-3）网页展示链接" class="headerlink" title="2.3）网页展示链接"></a>2.3）<a href="https://blog.rainlotus.cc/images/multilayer-pie.html">网页展示链接</a></h3><p>​ps:纯原生js方法，可根据代码换成各框架内容版本</p><h2 id="3-相似色"><a href="#3-相似色" class="headerlink" title="3.相似色"></a>3.相似色</h2><h3 id="3-1-问题：为什么要求相似色？"><a href="#3-1-问题：为什么要求相似色？" class="headerlink" title="3.1 问题：为什么要求相似色？"></a>3.1 问题：为什么要求相似色？</h3><p>从里到外依次为，第一层、第二层、第三层……往往第一层的数据都是有限且不多的（产品会限制十个左右，多了影响美观，以及考验后端查询能力）。故而第一层的颜色是可以确定下来的，然而第二层有多少不确定，更别说第三层及以后，而且为了更好的展示图的父子从属关系，求相似色是为了减少不确定且可能有大量颜色的复杂对应赋值操作。</p><h3 id="3-2-问题：如何求相似色？"><a href="#3-2-问题：如何求相似色？" class="headerlink" title="3.2 问题：如何求相似色？"></a>3.2 问题：如何求相似色？</h3><p>以上图例，得知第一层的“产品”数量为1000，第二层与之对应的是“c1”、“c2”、“c3”。在此，我采用的就是，以当前父亲颜色作为基础，根据子孩子个数分配出一组颜色，层层递推下去……</p><h3 id="3-3-代码—统一封装"><a href="#3-3-代码—统一封装" class="headerlink" title="3.3 代码—统一封装"></a>3.3 代码—统一封装</h3><h4 id="3-3-1-十六进制颜色转为RGB"><a href="#3-3-1-十六进制颜色转为RGB" class="headerlink" title="3.3.1 十六进制颜色转为RGB"></a>3.3.1 十六进制颜色转为RGB</h4><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">let</span> <span class="title function_">colorRgb</span> = (<span class="params">sColor</span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">if</span> (sColor) &#123;</span><br><span class="line">        sColor = sColor.<span class="title function_">toLowerCase</span>();</span><br><span class="line">        <span class="comment">// 十六进制颜色值的正则表达式</span></span><br><span class="line">        <span class="keyword">const</span> reg = <span class="regexp">/^#([0-9a-fA-f]&#123;3&#125;|[0-9a-fA-f]&#123;6&#125;)$/</span>;</span><br><span class="line">        <span class="comment">// 如果是16进制颜色</span></span><br><span class="line">        <span class="keyword">if</span> (sColor &amp;&amp; reg.<span class="title function_">test</span>(sColor)) &#123;</span><br><span class="line">            <span class="keyword">if</span> (sColor.<span class="property">length</span> === <span class="number">4</span>) &#123;</span><br><span class="line">                <span class="keyword">let</span> sColorNew = <span class="string">&quot;#&quot;</span>;</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">1</span>; i &lt; <span class="number">4</span>; i += <span class="number">1</span>) &#123;</span><br><span class="line">                    sColorNew += sColor.<span class="title function_">slice</span>(i, i + <span class="number">1</span>).<span class="title function_">concat</span>(sColor.<span class="title function_">slice</span>(i, i + <span class="number">1</span>));</span><br><span class="line">                &#125;</span><br><span class="line">                sColor = sColorNew;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// 处理六位的颜色值</span></span><br><span class="line">            <span class="keyword">const</span> sColorChange = [];</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">1</span>; i &lt; <span class="number">7</span>; i += <span class="number">2</span>) &#123;</span><br><span class="line">                sColorChange.<span class="title function_">push</span>(<span class="built_in">parseInt</span>(<span class="string">&quot;0x&quot;</span> + sColor.<span class="title function_">slice</span>(i, i + <span class="number">2</span>), <span class="number">0</span>));</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;rgba(&quot;</span> + sColorChange.<span class="title function_">join</span>(<span class="string">&quot;,&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> sColor;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h4 id="3-3-2-获取一组相似色"><a href="#3-3-2-获取一组相似色" class="headerlink" title="3.3.2 获取一组相似色"></a>3.3.2 获取一组相似色</h4><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 获取一组相似rgb颜色</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">let</span> <span class="title function_">getShallowRGB</span> = (<span class="params">maxColorObject, R, G, B, len</span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> threshold = <span class="number">30</span>   <span class="comment">// 色阶偏差值</span></span><br><span class="line">    <span class="keyword">const</span> offset = <span class="number">7</span>   <span class="comment">// 色深偏差值</span></span><br><span class="line">    <span class="keyword">const</span> result = []</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">const</span> d <span class="keyword">in</span> maxColorObject) &#123;</span><br><span class="line">        <span class="keyword">if</span> (d === <span class="string">&#x27;R&#x27;</span>) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; len; i++) &#123;</span><br><span class="line">                <span class="keyword">const</span> <span class="title class_">Gdelta</span> = <span class="title class_">Math</span>.<span class="title function_">round</span>((<span class="number">255</span> - (G + threshold)) / len) &gt; <span class="number">7</span> ? <span class="number">7</span> : <span class="title class_">Math</span>.<span class="title function_">round</span>((<span class="number">255</span> - (G + threshold)) / len)</span><br><span class="line">                <span class="keyword">const</span> <span class="title class_">Bdelta</span> = <span class="title class_">Math</span>.<span class="title function_">round</span>((<span class="number">255</span> - (B + threshold)) / len) &gt; <span class="number">7</span> ? <span class="number">7</span> : <span class="title class_">Math</span>.<span class="title function_">round</span>((<span class="number">255</span> - (B + threshold)) / len)</span><br><span class="line">                <span class="keyword">const</span> newRColor = [R - offset, G + threshold + <span class="title class_">Gdelta</span> * i, B + threshold + <span class="title class_">Bdelta</span> * i]</span><br><span class="line">                <span class="keyword">const</span> normalColor = <span class="string">`rgb(<span class="subst">$&#123;newRColor[<span class="number">0</span>]&#125;</span>, <span class="subst">$&#123;newRColor[<span class="number">1</span>]&#125;</span>, <span class="subst">$&#123;newRColor[<span class="number">2</span>]&#125;</span>)`</span></span><br><span class="line">                result.<span class="title function_">push</span>(normalColor)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (d === <span class="string">&#x27;G&#x27;</span>) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; len; i++) &#123;</span><br><span class="line">                <span class="keyword">const</span> <span class="title class_">Rdelta</span> = <span class="title class_">Math</span>.<span class="title function_">round</span>((<span class="number">255</span> - (R + threshold)) / len) &gt; <span class="number">7</span> ? <span class="number">7</span> : <span class="title class_">Math</span>.<span class="title function_">round</span>((<span class="number">255</span> - (R + threshold)) / len)</span><br><span class="line">                <span class="keyword">const</span> <span class="title class_">Bdelta</span> = <span class="title class_">Math</span>.<span class="title function_">round</span>((<span class="number">255</span> - (B + threshold)) / len) &gt; <span class="number">7</span> ? <span class="number">7</span> : <span class="title class_">Math</span>.<span class="title function_">round</span>((<span class="number">255</span> - (B + threshold)) / len)</span><br><span class="line">                <span class="keyword">const</span> newRColor = [R + threshold + <span class="title class_">Rdelta</span> * i, G - offset, B + threshold + <span class="title class_">Bdelta</span> * i]</span><br><span class="line">                <span class="keyword">const</span> normalColor = <span class="string">`rgb(<span class="subst">$&#123;newRColor[<span class="number">0</span>]&#125;</span>, <span class="subst">$&#123;newRColor[<span class="number">1</span>]&#125;</span>, <span class="subst">$&#123;newRColor[<span class="number">2</span>]&#125;</span>)`</span></span><br><span class="line">                result.<span class="title function_">push</span>(normalColor)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (d === <span class="string">&#x27;B&#x27;</span>) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; len; i++) &#123;</span><br><span class="line">                <span class="keyword">const</span> <span class="title class_">Rdelta</span> = <span class="title class_">Math</span>.<span class="title function_">round</span>((<span class="number">255</span> - (R + threshold)) / len) &gt; <span class="number">7</span> ? <span class="number">7</span> : <span class="title class_">Math</span>.<span class="title function_">round</span>((<span class="number">255</span> - (R + threshold)) / len)</span><br><span class="line">                <span class="keyword">const</span> <span class="title class_">Gdelta</span> = <span class="title class_">Math</span>.<span class="title function_">round</span>((<span class="number">255</span> - (B + threshold)) / len) &gt; <span class="number">7</span> ? <span class="number">7</span> : <span class="title class_">Math</span>.<span class="title function_">round</span>((<span class="number">255</span> - (B + threshold)) / len)</span><br><span class="line">                <span class="keyword">const</span> newRColor = [R + threshold + <span class="title class_">Rdelta</span> * i, G + threshold + <span class="title class_">Gdelta</span> * i, B - offset]</span><br><span class="line">                <span class="keyword">const</span> normalColor = <span class="string">`rgb(<span class="subst">$&#123;newRColor[<span class="number">0</span>]&#125;</span>, <span class="subst">$&#123;newRColor[<span class="number">1</span>]&#125;</span>, <span class="subst">$&#123;newRColor[<span class="number">2</span>]&#125;</span>)`</span></span><br><span class="line">                result.<span class="title function_">push</span>(normalColor)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取最大色值</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">let</span> <span class="title function_">findMaxRGB</span> = (<span class="params">R, G, B</span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">let</span> max</span><br><span class="line">    <span class="keyword">let</span> index</span><br><span class="line">    <span class="keyword">if</span> (R &gt;= G &amp;&amp; R &gt;= B) &#123;</span><br><span class="line">        max = R</span><br><span class="line">        index = <span class="string">&#x27;R&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (G &gt;= R &amp;&amp; G &gt;= B) &#123;</span><br><span class="line">        max = G</span><br><span class="line">        index = <span class="string">&#x27;G&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (B &gt;= R &amp;&amp; B &gt;= G) &#123;</span><br><span class="line">        max = B</span><br><span class="line">        index = <span class="string">&#x27;B&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        [index]: max</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取一组相似颜色的数组</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">let</span> <span class="title function_">getSimilarColor</span>=(<span class="params">R, G, B, len</span>) =&gt;&#123;</span><br><span class="line">    <span class="keyword">const</span> maxColorObject = <span class="title function_">findMaxRGB</span>(R, G, B)</span><br><span class="line">    <span class="keyword">const</span> shallowColorArray = <span class="title function_">getShallowRGB</span>(maxColorObject, R, G, B, len)</span><br><span class="line">    <span class="keyword">return</span> shallowColorArray</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-4-bug"><a href="#3-4-bug" class="headerlink" title="3.4 bug"></a>3.4 bug</h3><p>这本质上是人为利用当前颜色所属于R、G、B哪一种，做加减法求得相似色而已，所以颜色不是特别精准。</p><h2 id="4-echarts图结构设计"><a href="#4-echarts图结构设计" class="headerlink" title="4.echarts图结构设计"></a>4.echarts图结构设计</h2><h3 id="4-1-图形设计–思考"><a href="#4-1-图形设计–思考" class="headerlink" title="4.1 图形设计–思考"></a>4.1 图形设计–思考</h3><ol><li><p><strong>根据观察发现，从内到外，除了最外层，内层宽度基本上一致</strong></p><p>方法：for循环除了最后一层，环的宽度固定</p></li><li><p><strong>鼠标悬浮某一块，图表文字不在内部展示，而在中央显示名称与值</strong></p><p>方法：复制一份一模一样的结构，一个使得文字处在图内部，一个利用emphasis属性显示环中央。除了以上区别外，两者大小结构一模一样，非常轻松做到不悬浮鼠标字体在图内部展示，悬浮就会在中央展示</p></li><li><p><strong>echarts图的父子关系结构是人为控制的，即没有实际的层级关系，接受的数组却是树状结构，如何转化</strong></p><p>笨方法：满足实际需求，我们肯定知道他的层级关系，比如当前是四层。我们for循环四层的数据数组，一层层写下去，再根据获得的相似色数组，一个个分配，使得每一层的数值和每一层的颜色一一对应。最后将这些各层级塞进图表option的series数组中。<br>高阶方法：递归+树的遍历。</p></li></ol><h3 id="4-2-具体实现—以angular为例"><a href="#4-2-具体实现—以angular为例" class="headerlink" title="4.2 具体实现—以angular为例"></a>4.2 具体实现—以angular为例</h3><h4 id="4-2-1-html部分"><a href="#4-2-1-html部分" class="headerlink" title="4.2.1 html部分"></a>4.2.1 html部分</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> [<span class="attr">id</span>]=<span class="string">&quot;chartId&quot;</span> <span class="attr">class</span>=<span class="string">&quot;chart-body&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="4-2-2-接受参数"><a href="#4-2-2-接受参数" class="headerlink" title="4.2.2 接受参数"></a>4.2.2 接受参数</h4><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">//  @Input() 代表组件接收参数，类似vue的props </span></span><br><span class="line"> <span class="comment">//  @Output() 子函数传递给父函数的事件</span></span><br><span class="line"> <span class="meta">@Output</span>() <span class="keyword">private</span> allDataChange = <span class="keyword">new</span> <span class="title class_">EventEmitter</span>();</span><br><span class="line"></span><br><span class="line"> <span class="meta">@Input</span>() <span class="attr">chartId</span>: <span class="built_in">string</span> = <span class="string">&#x27;container&#x27;</span>; <span class="comment">// 图表id 必传参数</span></span><br><span class="line"></span><br><span class="line"> <span class="meta">@Input</span>() chartName = <span class="string">&#x27;&#x27;</span>; <span class="comment">// 图表下载名称</span></span><br><span class="line"></span><br><span class="line"> <span class="meta">@Input</span>() showDownLoad = <span class="literal">true</span>; <span class="comment">// 是否显示下载按钮</span></span><br><span class="line"> <span class="attr">echartsIntance</span>: <span class="built_in">any</span>;</span><br><span class="line"> <span class="meta">@Input</span>() colorData = commonColor;</span><br><span class="line"> <span class="meta">@Input</span>() <span class="attr">multiLayerPie</span>: <span class="built_in">any</span>[] = [</span><br><span class="line">   &#123;</span><br><span class="line">     <span class="attr">name</span>: <span class="string">&#x27;产品&#x27;</span>,</span><br><span class="line">     <span class="attr">value</span>: <span class="number">100</span>,</span><br><span class="line">     <span class="attr">children</span>: [</span><br><span class="line">       &#123;</span><br><span class="line">         <span class="attr">name</span>: <span class="string">&#x27;a1&#x27;</span>,</span><br><span class="line">         <span class="attr">value</span>: <span class="number">80</span>,</span><br><span class="line">         <span class="attr">children</span>: [</span><br><span class="line">           &#123;</span><br><span class="line">             <span class="attr">name</span>: <span class="string">&#x27;a11&#x27;</span>,</span><br><span class="line">             <span class="attr">value</span>: <span class="number">60</span>,</span><br><span class="line">             <span class="attr">children</span>: [</span><br><span class="line">               &#123;</span><br><span class="line">                 <span class="attr">name</span>: <span class="string">&#x27;a111&#x27;</span>,</span><br><span class="line">                 <span class="attr">value</span>: <span class="number">40</span>,</span><br><span class="line">               &#125;,</span><br><span class="line">               &#123;</span><br><span class="line">                 <span class="attr">name</span>: <span class="string">&#x27;a112&#x27;</span>,</span><br><span class="line">                 <span class="attr">value</span>: <span class="number">15</span>,</span><br><span class="line">               &#125;,</span><br><span class="line">               &#123;</span><br><span class="line">                 <span class="attr">name</span>: <span class="string">&#x27;a113&#x27;</span>,</span><br><span class="line">                 <span class="attr">value</span>: <span class="number">5</span>,</span><br><span class="line">               &#125;,</span><br><span class="line">             ]</span><br><span class="line">           &#125;,</span><br><span class="line">           &#123;</span><br><span class="line">             <span class="attr">name</span>: <span class="string">&#x27;a12&#x27;</span>,</span><br><span class="line">             <span class="attr">value</span>: <span class="number">20</span>,</span><br><span class="line">             <span class="attr">children</span>: [</span><br><span class="line">               &#123;</span><br><span class="line">                 <span class="attr">name</span>: <span class="string">&#x27;a121&#x27;</span>,</span><br><span class="line">                 <span class="attr">value</span>: <span class="number">18</span>,</span><br><span class="line">               &#125;,</span><br><span class="line">               &#123;</span><br><span class="line">                 <span class="attr">name</span>: <span class="string">&#x27;a122&#x27;</span>,</span><br><span class="line">                 <span class="attr">value</span>: <span class="number">2</span>,</span><br><span class="line">               &#125;,</span><br><span class="line">             ]</span><br><span class="line">           &#125;,</span><br><span class="line">         ]</span><br><span class="line">       &#125;,</span><br><span class="line">       &#123;</span><br><span class="line">         <span class="attr">name</span>: <span class="string">&#x27;a2&#x27;</span>,</span><br><span class="line">         <span class="attr">value</span>: <span class="number">20</span>,</span><br><span class="line">         <span class="attr">children</span>: [</span><br><span class="line">           &#123;</span><br><span class="line">             <span class="attr">name</span>: <span class="string">&#x27;a21&#x27;</span>,</span><br><span class="line">             <span class="attr">value</span>: <span class="number">20</span>,</span><br><span class="line">             <span class="attr">children</span>: [</span><br><span class="line">               &#123;</span><br><span class="line">                 <span class="attr">name</span>: <span class="string">&#x27;a221&#x27;</span>,</span><br><span class="line">                 <span class="attr">value</span>: <span class="number">18</span>,</span><br><span class="line">               &#125;,</span><br><span class="line">               &#123;</span><br><span class="line">                 <span class="attr">name</span>: <span class="string">&#x27;a222&#x27;</span>,</span><br><span class="line">                 <span class="attr">value</span>: <span class="number">2</span>,</span><br><span class="line">               &#125;,</span><br><span class="line">             ]</span><br><span class="line">           &#125;,</span><br><span class="line">         ]</span><br><span class="line">       &#125;</span><br><span class="line">     ]</span><br><span class="line">   &#125;,</span><br><span class="line">   &#123;</span><br><span class="line">     <span class="attr">name</span>: <span class="string">&#x27;价格&#x27;</span>,</span><br><span class="line">     <span class="attr">value</span>: <span class="number">100</span>,</span><br><span class="line">     <span class="attr">children</span>: [</span><br><span class="line">       &#123;</span><br><span class="line">         <span class="attr">name</span>: <span class="string">&#x27;ba1&#x27;</span>,</span><br><span class="line">         <span class="attr">value</span>: <span class="number">80</span>,</span><br><span class="line">         <span class="attr">children</span>: [</span><br><span class="line">           &#123;</span><br><span class="line">             <span class="attr">name</span>: <span class="string">&#x27;ba11&#x27;</span>,</span><br><span class="line">             <span class="attr">value</span>: <span class="number">60</span>,</span><br><span class="line">             <span class="attr">children</span>: [</span><br><span class="line">               &#123;</span><br><span class="line">                 <span class="attr">name</span>: <span class="string">&#x27;ba111&#x27;</span>,</span><br><span class="line">                 <span class="attr">value</span>: <span class="number">40</span>,</span><br><span class="line">               &#125;,</span><br><span class="line">               &#123;</span><br><span class="line">                 <span class="attr">name</span>: <span class="string">&#x27;ba112&#x27;</span>,</span><br><span class="line">                 <span class="attr">value</span>: <span class="number">15</span>,</span><br><span class="line">               &#125;,</span><br><span class="line">               &#123;</span><br><span class="line">                 <span class="attr">name</span>: <span class="string">&#x27;ba113&#x27;</span>,</span><br><span class="line">                 <span class="attr">value</span>: <span class="number">5</span>,</span><br><span class="line">               &#125;,</span><br><span class="line">             ]</span><br><span class="line">           &#125;,</span><br><span class="line">           &#123;</span><br><span class="line">             <span class="attr">name</span>: <span class="string">&#x27;ba12&#x27;</span>,</span><br><span class="line">             <span class="attr">value</span>: <span class="number">20</span>,</span><br><span class="line">             <span class="attr">children</span>: []</span><br><span class="line">           &#125;,</span><br><span class="line">         ]</span><br><span class="line">       &#125;,</span><br><span class="line">       &#123;</span><br><span class="line">         <span class="attr">name</span>: <span class="string">&#x27;ba2&#x27;</span>,</span><br><span class="line">         <span class="attr">value</span>: <span class="number">20</span>,</span><br><span class="line">         <span class="attr">children</span>: [</span><br><span class="line">           &#123;</span><br><span class="line">             <span class="attr">name</span>: <span class="string">&#x27;ba21&#x27;</span>,</span><br><span class="line">             <span class="attr">value</span>: <span class="number">20</span>,</span><br><span class="line">             <span class="comment">// children: [</span></span><br><span class="line">             <span class="comment">//   &#123;</span></span><br><span class="line">             <span class="comment">//     name: &#x27;ba221&#x27;,</span></span><br><span class="line">             <span class="comment">//     value: 18,</span></span><br><span class="line">             <span class="comment">//   &#125;,</span></span><br><span class="line">             <span class="comment">//   &#123;</span></span><br><span class="line">             <span class="comment">//     name: &#x27;ba222&#x27;,</span></span><br><span class="line">             <span class="comment">//     value: 2,</span></span><br><span class="line">             <span class="comment">//   &#125;,</span></span><br><span class="line">             <span class="comment">// ]</span></span><br><span class="line">           &#125;,</span><br><span class="line">         ]</span><br><span class="line">       &#125;</span><br><span class="line">     ]</span><br><span class="line">   &#125;,</span><br><span class="line">   &#123;</span><br><span class="line">     <span class="attr">name</span>: <span class="string">&#x27;美貌&#x27;</span>,</span><br><span class="line">     <span class="attr">value</span>: <span class="number">100</span>,</span><br><span class="line">     <span class="attr">children</span>: [</span><br><span class="line">       &#123;</span><br><span class="line">         <span class="attr">name</span>: <span class="string">&#x27;ca1&#x27;</span>,</span><br><span class="line">         <span class="attr">value</span>: <span class="number">80</span>,</span><br><span class="line">         <span class="attr">children</span>: [</span><br><span class="line">           &#123;</span><br><span class="line">             <span class="attr">name</span>: <span class="string">&#x27;ca11&#x27;</span>,</span><br><span class="line">             <span class="attr">value</span>: <span class="number">60</span>,</span><br><span class="line">             <span class="comment">// children: [</span></span><br><span class="line">             <span class="comment">//   &#123;</span></span><br><span class="line">             <span class="comment">//     name: &#x27;ca111&#x27;,</span></span><br><span class="line">             <span class="comment">//     value: 40,</span></span><br><span class="line">             <span class="comment">//   &#125;,</span></span><br><span class="line">             <span class="comment">//   &#123;</span></span><br><span class="line">             <span class="comment">//     name: &#x27;ca112&#x27;,</span></span><br><span class="line">             <span class="comment">//     value: 10,</span></span><br><span class="line">             <span class="comment">//   &#125;,</span></span><br><span class="line">             <span class="comment">//   &#123;</span></span><br><span class="line">             <span class="comment">//     name: &#x27;ca113&#x27;,</span></span><br><span class="line">             <span class="comment">//     value: 10,</span></span><br><span class="line">             <span class="comment">//   &#125;,</span></span><br><span class="line">             <span class="comment">// ]</span></span><br><span class="line">           &#125;,</span><br><span class="line">           &#123;</span><br><span class="line">             <span class="attr">name</span>: <span class="string">&#x27;ca12&#x27;</span>,</span><br><span class="line">             <span class="attr">value</span>: <span class="number">20</span>,</span><br><span class="line">             <span class="attr">children</span>: [</span><br><span class="line">               <span class="comment">// &#123;</span></span><br><span class="line">               <span class="comment">//   name: &#x27;ca121&#x27;,</span></span><br><span class="line">               <span class="comment">//   value: 14,</span></span><br><span class="line">               <span class="comment">// &#125;,</span></span><br><span class="line">               &#123;</span><br><span class="line">                 <span class="attr">name</span>: <span class="string">&#x27;ca122&#x27;</span>,</span><br><span class="line">                 <span class="attr">value</span>: <span class="number">6</span>,</span><br><span class="line">               &#125;,</span><br><span class="line">             ]</span><br><span class="line">           &#125;,</span><br><span class="line">         ]</span><br><span class="line">       &#125;,</span><br><span class="line">       &#123;</span><br><span class="line">         <span class="attr">name</span>: <span class="string">&#x27;ca2&#x27;</span>,</span><br><span class="line">         <span class="attr">value</span>: <span class="number">20</span>,</span><br><span class="line">         <span class="attr">children</span>: [</span><br><span class="line">           &#123;</span><br><span class="line">             <span class="attr">name</span>: <span class="string">&#x27;ca21&#x27;</span>,</span><br><span class="line">             <span class="attr">value</span>: <span class="number">20</span>,</span><br><span class="line">             <span class="comment">// children: [</span></span><br><span class="line">             <span class="comment">//   &#123;</span></span><br><span class="line">             <span class="comment">//     name: &#x27;ca221&#x27;,</span></span><br><span class="line">             <span class="comment">//     value: 18,</span></span><br><span class="line">             <span class="comment">//   &#125;,</span></span><br><span class="line">             <span class="comment">//   &#123;</span></span><br><span class="line">             <span class="comment">//     name: &#x27;ca222&#x27;,</span></span><br><span class="line">             <span class="comment">//     value: 2,</span></span><br><span class="line">             <span class="comment">//   &#125;,</span></span><br><span class="line">             <span class="comment">// ]</span></span><br><span class="line">           &#125;,</span><br><span class="line">         ]</span><br><span class="line">       &#125;</span><br><span class="line">     ]</span><br><span class="line">   &#125;,</span><br><span class="line">   &#123;</span><br><span class="line">     <span class="attr">name</span>: <span class="string">&#x27;数码&#x27;</span>,</span><br><span class="line">     <span class="attr">value</span>: <span class="number">100</span>,</span><br><span class="line">     <span class="attr">children</span>: [</span><br><span class="line">       &#123;</span><br><span class="line">         <span class="attr">name</span>: <span class="string">&#x27;da1&#x27;</span>,</span><br><span class="line">         <span class="attr">value</span>: <span class="number">80</span>,</span><br><span class="line">         <span class="attr">children</span>: [</span><br><span class="line">           &#123;</span><br><span class="line">             <span class="attr">name</span>: <span class="string">&#x27;da11&#x27;</span>,</span><br><span class="line">             <span class="attr">value</span>: <span class="number">60</span>,</span><br><span class="line">             <span class="comment">// children: [</span></span><br><span class="line">             <span class="comment">//   &#123;</span></span><br><span class="line">             <span class="comment">//     name: &#x27;da111&#x27;,</span></span><br><span class="line">             <span class="comment">//     value: 30,</span></span><br><span class="line">             <span class="comment">//   &#125;,</span></span><br><span class="line">             <span class="comment">//   &#123;</span></span><br><span class="line">             <span class="comment">//     name: &#x27;da112&#x27;,</span></span><br><span class="line">             <span class="comment">//     value: 30,</span></span><br><span class="line">             <span class="comment">//   &#125;,</span></span><br><span class="line">             <span class="comment">// ]</span></span><br><span class="line">           &#125;,</span><br><span class="line">           &#123;</span><br><span class="line">             <span class="attr">name</span>: <span class="string">&#x27;da12&#x27;</span>,</span><br><span class="line">             <span class="attr">value</span>: <span class="number">20</span>,</span><br><span class="line">             <span class="attr">children</span>: []</span><br><span class="line">           &#125;,</span><br><span class="line">         ]</span><br><span class="line">       &#125;,</span><br><span class="line">       &#123;</span><br><span class="line">         <span class="attr">name</span>: <span class="string">&#x27;da2&#x27;</span>,</span><br><span class="line">         <span class="attr">value</span>: <span class="number">20</span>,</span><br><span class="line">         <span class="attr">children</span>: [</span><br><span class="line">           &#123;</span><br><span class="line">             <span class="attr">name</span>: <span class="string">&#x27;da21&#x27;</span>,</span><br><span class="line">             <span class="attr">value</span>: <span class="number">20</span>,</span><br><span class="line">             <span class="comment">// children: [</span></span><br><span class="line">             <span class="comment">//   &#123;</span></span><br><span class="line">             <span class="comment">//     name: &#x27;da221&#x27;,</span></span><br><span class="line">             <span class="comment">//     value: 18,</span></span><br><span class="line">             <span class="comment">//   &#125;,</span></span><br><span class="line">             <span class="comment">//   &#123;</span></span><br><span class="line">             <span class="comment">//     name: &#x27;da222&#x27;,</span></span><br><span class="line">             <span class="comment">//     value: 2,</span></span><br><span class="line">             <span class="comment">//   &#125;,</span></span><br><span class="line">             <span class="comment">// ]</span></span><br><span class="line">           &#125;,</span><br><span class="line">         ]</span><br><span class="line">       &#125;</span><br><span class="line">     ]</span><br><span class="line">   &#125;,</span><br><span class="line">];</span><br><span class="line"><span class="meta">@Input</span>() dataDepth = <span class="number">4</span>; <span class="comment">// 层级 与 multiLayerPie 一致</span></span><br><span class="line"></span><br><span class="line"> pieOption = &#123;</span><br><span class="line">   <span class="attr">title</span>: &#123;</span><br><span class="line">     <span class="attr">text</span>: <span class="variable language_">this</span>.<span class="property">chartName</span>,</span><br><span class="line">     <span class="attr">show</span>:<span class="literal">false</span></span><br><span class="line">   &#125;,</span><br><span class="line">   <span class="attr">tooltip</span>: &#123;</span><br><span class="line">     <span class="attr">trigger</span>: <span class="string">&#x27;item&#x27;</span>,</span><br><span class="line">     <span class="attr">show</span>: <span class="literal">false</span>,</span><br><span class="line">   &#125;,</span><br><span class="line">   <span class="comment">// 引入的toolbox样式，仅仅是下载图片按钮样式设置，网页版中有具体值，不多做赘述</span></span><br><span class="line">   <span class="attr">toolbox</span>: <span class="title class_">JSON</span>.<span class="title function_">parse</span>(<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(toolboxStyle)), </span><br><span class="line">   <span class="attr">series</span>: []</span><br><span class="line"> &#125;;</span><br></pre></td></tr></table></figure><h4 id="4-2-3-初始化图表"><a href="#4-2-3-初始化图表" class="headerlink" title="4.2.3 初始化图表"></a>4.2.3 初始化图表</h4><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 数据发生改变的change事件</span></span><br><span class="line"><span class="title function_">ngOnChanges</span>(<span class="attr">changes</span>: <span class="title class_">SimpleChanges</span>): <span class="built_in">void</span> &#123;</span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> <span class="attr">dom</span>: <span class="built_in">any</span> = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="variable language_">this</span>.<span class="property">chartId</span>);</span><br><span class="line">      <span class="keyword">if</span> (dom &amp;&amp; <span class="variable language_">this</span>.<span class="property">multiLayerPie</span> &amp;&amp; <span class="variable language_">this</span>.<span class="property">multiLayerPie</span>.<span class="property">length</span> &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">getChart</span>(dom);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 初始化函数</span></span><br><span class="line">  <span class="title function_">ngAfterViewInit</span>(): <span class="built_in">void</span> &#123;</span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> <span class="attr">dom</span>: <span class="built_in">any</span> = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="variable language_">this</span>.<span class="property">chartId</span>);</span><br><span class="line">      <span class="keyword">if</span> (dom &amp;&amp; <span class="variable language_">this</span>.<span class="property">multiLayerPie</span> &amp;&amp; <span class="variable language_">this</span>.<span class="property">multiLayerPie</span>.<span class="property">length</span> &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">getChart</span>(dom);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="title function_">getChart</span>(<span class="params">dom</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">echartsIntance</span> = echarts.<span class="title function_">init</span>(dom, <span class="literal">null</span>, &#123;</span><br><span class="line">      <span class="attr">renderer</span>: <span class="string">&#x27;canvas&#x27;</span>,</span><br><span class="line">      <span class="attr">useDirtyRect</span>: <span class="literal">false</span></span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> pieOption = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(<span class="variable language_">this</span>.<span class="property">pieOption</span>));</span><br><span class="line">    pieOption.<span class="property">title</span>.<span class="property">text</span> = <span class="variable language_">this</span>.<span class="property">chartName</span>;</span><br><span class="line">    <span class="comment">// 是否展示下载按钮</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">showDownLoad</span>) &#123;</span><br><span class="line">      pieOption.<span class="property">toolbox</span>.<span class="property">feature</span>.<span class="property">saveAsImage</span>.<span class="property">name</span> = <span class="variable language_">this</span>.<span class="property">chartName</span>;</span><br><span class="line">      pieOption.<span class="property">toolbox</span>.<span class="property">feature</span>.<span class="property">saveAsImage</span>.<span class="property">title</span> = <span class="string">&quot;下载图片&quot;</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      pieOption.<span class="property">toolbox</span> = &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 给series塞内容</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">calcLayerData</span>(pieOption)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 绑定点击事件</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">echartsIntance</span>.<span class="title function_">on</span>(<span class="string">&quot;click&quot;</span>, <span class="function">(<span class="params">params</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="title function_">onChartClick</span>(params)</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (pieOption &amp;&amp; <span class="keyword">typeof</span> pieOption === <span class="string">&#x27;object&#x27;</span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">echartsIntance</span>.<span class="title function_">clear</span>()</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">echartsIntance</span>.<span class="title function_">setOption</span>(pieOption, <span class="literal">true</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="variable language_">window</span>.<span class="title function_">addEventListener</span>(<span class="string">&#x27;resize&#x27;</span>, <span class="variable language_">this</span>.<span class="property">echartsIntance</span>.<span class="property">resize</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 图表点击方法</span></span><br><span class="line">  <span class="title function_">onChartClick</span>(event): <span class="built_in">void</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (event.<span class="property">name</span> !== <span class="string">&#x27;&#x27;</span>) &#123;  <span class="comment">// 名字为空的不允许触发</span></span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(event);</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">allDataChange</span>.<span class="title function_">emit</span>(event)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><h4 id="4-2-4-处理层级数据"><a href="#4-2-4-处理层级数据" class="headerlink" title="4.2.4  处理层级数据"></a>4.2.4  处理层级数据</h4><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br></pre></td><td class="code"><pre><span class="line"> <span class="title function_">calcLayerData</span>(<span class="params">pieOption</span>) &#123;</span><br><span class="line">    <span class="comment">// 设置一个空对象，存储各层级颜色与数据</span></span><br><span class="line">   <span class="keyword">const</span> <span class="attr">colorDataObj</span>: <span class="built_in">any</span> = &#123;&#125;;</span><br><span class="line">   <span class="comment">// 递归处理数据</span></span><br><span class="line">   <span class="variable language_">this</span>.<span class="title function_">depthOrder</span>(colorDataObj, <span class="variable language_">this</span>.<span class="property">multiLayerPie</span>)</span><br><span class="line">   <span class="variable language_">console</span>.<span class="title function_">log</span>(colorDataObj);</span><br><span class="line"></span><br><span class="line">   <span class="keyword">const</span> seriesArr = []</span><br><span class="line">   <span class="comment">// 根据所传层级，for循环</span></span><br><span class="line">   <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="variable language_">this</span>.<span class="property">dataDepth</span>; i++) &#123;</span><br><span class="line">       <span class="comment">// 计算饼图宽度</span></span><br><span class="line">     <span class="keyword">const</span> radius0 = <span class="number">30</span> + i * <span class="number">15</span> + <span class="string">&#x27;%&#x27;</span></span><br><span class="line">     <span class="keyword">const</span> radius1 = i !== <span class="variable language_">this</span>.<span class="property">dataDepth</span> - <span class="number">1</span> ? <span class="number">30</span> + (i + <span class="number">1</span>) * <span class="number">15</span> + <span class="string">&#x27;%&#x27;</span> : <span class="number">30</span> + i * <span class="number">15</span> + <span class="number">5</span> + <span class="string">&#x27;%&#x27;</span></span><br><span class="line">     <span class="keyword">let</span> <span class="attr">seriesObj</span>: <span class="built_in">any</span>;  <span class="comment">// 字在图表内部的series对象</span></span><br><span class="line">     <span class="keyword">let</span> <span class="attr">seriesObj2</span>: <span class="built_in">any</span>; <span class="comment">// 字在图表空白中央的series对象</span></span><br><span class="line">     <span class="keyword">const</span> depth = i + <span class="number">1</span></span><br><span class="line">     <span class="keyword">if</span> (i !== <span class="variable language_">this</span>.<span class="property">dataDepth</span> - <span class="number">1</span>) &#123;</span><br><span class="line">       seriesObj = &#123;</span><br><span class="line">         <span class="attr">name</span>: <span class="string">&#x27;数据&#x27;</span>,</span><br><span class="line">         <span class="attr">type</span>: <span class="string">&#x27;pie&#x27;</span>,</span><br><span class="line">         <span class="attr">radius</span>: [radius0, radius1],</span><br><span class="line">         <span class="attr">avoidLabelOverlap</span>: <span class="literal">false</span>,</span><br><span class="line">         <span class="attr">label</span>: &#123;</span><br><span class="line">           <span class="attr">position</span>: <span class="string">&#x27;inner&#x27;</span>, <span class="comment">// 字展示在内部</span></span><br><span class="line">           <span class="attr">color</span>: <span class="string">&#x27;#fff&#x27;</span></span><br><span class="line">         &#125;,</span><br><span class="line">         <span class="attr">itemStyle</span>: &#123;</span><br><span class="line">           <span class="attr">borderWidth</span>: <span class="number">1</span> <span class="comment">// 设置border宽度</span></span><br><span class="line">           <span class="comment">// borderColor:&#x27;transparent&#x27;,</span></span><br><span class="line">         &#125;,</span><br><span class="line">         <span class="attr">labelLine</span>: &#123;</span><br><span class="line">           <span class="attr">show</span>: <span class="literal">false</span></span><br><span class="line">         &#125;,</span><br><span class="line">         <span class="attr">color</span>: colorDataObj[<span class="string">&#x27;color&#x27;</span> + depth], <span class="comment">// 当前层级颜色</span></span><br><span class="line">         <span class="attr">data</span>: colorDataObj[<span class="string">&#x27;data&#x27;</span> + depth]    <span class="comment">// 当前层级数据</span></span><br><span class="line">       &#125;</span><br><span class="line">       seriesObj2 = &#123;</span><br><span class="line">         <span class="attr">name</span>: <span class="string">&#x27;数据&#x27;</span>,</span><br><span class="line">         <span class="attr">type</span>: <span class="string">&#x27;pie&#x27;</span>,</span><br><span class="line">         <span class="attr">radius</span>: [radius0, radius1],</span><br><span class="line">         <span class="attr">avoidLabelOverlap</span>: <span class="literal">false</span>,</span><br><span class="line">         <span class="attr">label</span>: &#123;</span><br><span class="line">           <span class="attr">show</span>: <span class="literal">false</span>,       <span class="comment">// 默认隐藏</span></span><br><span class="line">           <span class="attr">position</span>: <span class="string">&#x27;center&#x27;</span> <span class="comment">// 显示在中央</span></span><br><span class="line">         &#125;,</span><br><span class="line">         <span class="attr">emphasis</span>: &#123;</span><br><span class="line">           <span class="attr">label</span>: &#123;</span><br><span class="line">             <span class="attr">show</span>: <span class="literal">true</span>,  <span class="comment">// 鼠标悬浮时展示</span></span><br><span class="line">             <span class="attr">fontSize</span>: <span class="string">&#x27;20&#x27;</span>,</span><br><span class="line">             <span class="attr">formatter</span>: <span class="function">(<span class="params">params</span>) =&gt;</span> &#123;</span><br><span class="line">               <span class="variable language_">console</span>.<span class="title function_">log</span>(params);</span><br><span class="line">               <span class="keyword">const</span> newName =</span><br><span class="line">                 params.<span class="property">name</span> === <span class="string">&#x27;&#x27;</span></span><br><span class="line">                   ? <span class="string">&#x27;&#x27;</span></span><br><span class="line">                   : <span class="string">`<span class="subst">$&#123;params.name&#125;</span>\n\n<span class="subst">$&#123;params.data.newval&#125;</span>`</span>;</span><br><span class="line">               <span class="keyword">return</span> newName;</span><br><span class="line">             &#125;</span><br><span class="line">           &#125;</span><br><span class="line">         &#125;,</span><br><span class="line">         <span class="attr">itemStyle</span>: &#123;</span><br><span class="line">           <span class="attr">borderWidth</span>: <span class="number">1</span> <span class="comment">// 设置border宽度</span></span><br><span class="line">         &#125;,</span><br><span class="line">         <span class="attr">labelLine</span>: &#123;</span><br><span class="line">           <span class="attr">show</span>: <span class="literal">false</span></span><br><span class="line">         &#125;,</span><br><span class="line">         <span class="attr">color</span>: colorDataObj[<span class="string">&#x27;color&#x27;</span> + depth],</span><br><span class="line">         <span class="attr">data</span>: colorDataObj[<span class="string">&#x27;data&#x27;</span> + depth]</span><br><span class="line">       &#125;</span><br><span class="line">     &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">       seriesObj = &#123;</span><br><span class="line">         <span class="attr">name</span>: <span class="string">&#x27;数据&#x27;</span>,</span><br><span class="line">         <span class="attr">type</span>: <span class="string">&#x27;pie&#x27;</span>,</span><br><span class="line">         <span class="attr">radius</span>: [radius0, radius1],</span><br><span class="line">         <span class="attr">avoidLabelOverlap</span>: <span class="literal">false</span>,</span><br><span class="line">         <span class="attr">label</span>: &#123;</span><br><span class="line">           <span class="comment">// position: &#x27;outsideFill&#x27;,</span></span><br><span class="line">         &#125;,</span><br><span class="line">         <span class="attr">itemStyle</span>: &#123;</span><br><span class="line">           <span class="attr">borderWidth</span>: <span class="number">1</span> <span class="comment">// 设置border宽度</span></span><br><span class="line">         &#125;,</span><br><span class="line"></span><br><span class="line">         <span class="attr">clockWise</span>: <span class="literal">true</span>,</span><br><span class="line">         <span class="attr">color</span>: colorDataObj[<span class="string">&#x27;color&#x27;</span> + depth],</span><br><span class="line">         <span class="attr">data</span>: colorDataObj[<span class="string">&#x27;data&#x27;</span> + depth]</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">       seriesObj2 = &#123;</span><br><span class="line">         <span class="attr">name</span>: <span class="string">&#x27;数据&#x27;</span>,</span><br><span class="line">         <span class="attr">type</span>: <span class="string">&#x27;pie&#x27;</span>,</span><br><span class="line">         <span class="attr">radius</span>: [radius0, radius1],</span><br><span class="line">         <span class="attr">avoidLabelOverlap</span>: <span class="literal">false</span>,</span><br><span class="line">         <span class="attr">label</span>: &#123;</span><br><span class="line">           <span class="attr">show</span>: <span class="literal">false</span>,</span><br><span class="line">           <span class="attr">position</span>: <span class="string">&#x27;center&#x27;</span></span><br><span class="line">         &#125;,</span><br><span class="line">         <span class="attr">emphasis</span>: &#123;</span><br><span class="line">           <span class="attr">label</span>: &#123;</span><br><span class="line">             <span class="attr">show</span>: <span class="literal">true</span>,</span><br><span class="line">             <span class="attr">fontSize</span>: <span class="string">&#x27;20&#x27;</span>,</span><br><span class="line">             <span class="attr">formatter</span>: <span class="function">(<span class="params">params</span>) =&gt;</span> &#123;</span><br><span class="line">               <span class="variable language_">console</span>.<span class="title function_">log</span>(params);</span><br><span class="line">               <span class="keyword">const</span> newName =</span><br><span class="line">                 params.<span class="property">name</span> === <span class="string">&#x27;&#x27;</span></span><br><span class="line">                   ? <span class="string">&#x27;&#x27;</span></span><br><span class="line">                   : <span class="string">`<span class="subst">$&#123;params.name&#125;</span>\n\n<span class="subst">$&#123;params.data.newval&#125;</span>`</span>;</span><br><span class="line">               <span class="keyword">return</span> newName;</span><br><span class="line">             &#125;</span><br><span class="line">           &#125;</span><br><span class="line">         &#125;,</span><br><span class="line">         <span class="attr">itemStyle</span>: &#123;</span><br><span class="line">           <span class="attr">borderWidth</span>: <span class="number">1</span> <span class="comment">// 设置border宽度</span></span><br><span class="line">         &#125;,</span><br><span class="line">         <span class="attr">clockWise</span>: <span class="literal">true</span>,</span><br><span class="line"></span><br><span class="line">         <span class="attr">color</span>: colorDataObj[<span class="string">&#x27;color&#x27;</span> + depth],</span><br><span class="line">         <span class="attr">data</span>: colorDataObj[<span class="string">&#x27;data&#x27;</span> + depth]</span><br><span class="line">       &#125;</span><br><span class="line">     &#125;</span><br><span class="line">     seriesArr.<span class="title function_">push</span>(seriesObj, seriesObj2)</span><br><span class="line">   &#125;</span><br><span class="line">   pieOption.<span class="property">series</span> = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(seriesArr)) <span class="comment">// 赋值给series</span></span><br><span class="line">    <span class="comment">// emphasis.label.formatter函数需要额外再写一次，要不然echarts不生效</span></span><br><span class="line">   seriesArr.<span class="title function_">forEach</span>(<span class="function">(<span class="params">sav, idx</span>) =&gt;</span> &#123;</span><br><span class="line">     <span class="keyword">const</span> newIdx = idx * <span class="number">2</span> + <span class="number">1</span> <span class="comment">// 奇数项设置formatter即可</span></span><br><span class="line">     <span class="keyword">if</span> (newIdx &lt; seriesArr.<span class="property">length</span>) &#123;</span><br><span class="line">       pieOption.<span class="property">series</span>[newIdx].<span class="property">emphasis</span>.<span class="property">label</span>.<span class="property">formatter</span> = <span class="function">(<span class="params">params</span>) =&gt;</span> &#123;</span><br><span class="line">         <span class="keyword">const</span> newName =</span><br><span class="line">           params.<span class="property">name</span> === <span class="string">&#x27;&#x27;</span></span><br><span class="line">             ? <span class="string">&#x27;&#x27;</span></span><br><span class="line">             : <span class="string">`<span class="subst">$&#123;params.name&#125;</span>\n\n<span class="subst">$&#123;params.data.newval&#125;</span>`</span>;</span><br><span class="line">         <span class="keyword">return</span> newName;</span><br><span class="line">       &#125;</span><br><span class="line">     &#125;</span><br><span class="line">   &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="4-2-5-递归函数"><a href="#4-2-5-递归函数" class="headerlink" title="4.2.5 递归函数"></a>4.2.5 递归函数</h4><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">// 第一个obj是来存储各层级color与data的，orderArr是当前层级的数组，depth为层级默认为1</span></span><br><span class="line"> <span class="comment">// oldPer默认为100，他是指上一次占比为多少，当前图表的占比是需要乘以父亲元素的占比，这样才能保证他们的占比一一对应</span></span><br><span class="line"> <span class="comment">// simiColor数组 是用来存每一层产生的相似数组的，这样最里层循环结束，跳到上一层，simiColor数组 也需要回退保持层级一致</span></span><br><span class="line"><span class="title function_">depthOrder</span>(<span class="params">obj, orderArr, depth = <span class="number">1</span>, oldPer = <span class="number">100</span>, simiColor = []</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> sum = orderArr.<span class="title function_">reduce</span>(<span class="function">(<span class="params">prev, next</span>) =&gt;</span> prev + next.<span class="property">value</span>, <span class="number">0</span>); <span class="comment">// 当前数组的value总和</span></span><br><span class="line">    <span class="comment">// 当前层级的data/color存在就不作处理，否则需要初始化数组</span></span><br><span class="line">    obj[<span class="string">&#x27;data&#x27;</span> + depth] = obj[<span class="string">&#x27;data&#x27;</span> + depth] ? obj[<span class="string">&#x27;data&#x27;</span> + depth] : [] </span><br><span class="line">    obj[<span class="string">&#x27;color&#x27;</span> + depth] = obj[<span class="string">&#x27;color&#x27;</span> + depth] ? obj[<span class="string">&#x27;color&#x27;</span> + depth] : []</span><br><span class="line">    </span><br><span class="line">    orderArr.<span class="title function_">forEach</span>(<span class="function">(<span class="params">item, idx</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">// 计算当前对象的百分比</span></span><br><span class="line">      <span class="keyword">const</span> per = sum !== <span class="number">0</span> ? <span class="title class_">Math</span>.<span class="title function_">round</span>(item.<span class="property">value</span> / sum * (oldPer / <span class="number">100</span>) * <span class="number">10000</span>) / <span class="number">100.00000</span> : <span class="number">0</span>;</span><br><span class="line">     <span class="comment">// 因为echarts是根据value显示的，所以我们需要用百分比来充作value，设置新变量存实际value值</span></span><br><span class="line">        <span class="keyword">const</span> firstObj = &#123;</span><br><span class="line">        <span class="attr">name</span>: item.<span class="property">name</span>,</span><br><span class="line">        <span class="attr">value</span>: per,</span><br><span class="line">        <span class="attr">newval</span>: item.<span class="property">value</span>,</span><br><span class="line">      &#125;</span><br><span class="line"><span class="comment">// 为当前层级push数据</span></span><br><span class="line">      obj[<span class="string">&#x27;data&#x27;</span> + depth].<span class="title function_">push</span>(firstObj)</span><br><span class="line"></span><br><span class="line">      <span class="keyword">let</span> itemColor; <span class="comment">// 当前元素颜色</span></span><br><span class="line">      <span class="keyword">if</span> (depth === <span class="number">1</span>) &#123; <span class="comment">// 如果是第一层，只需要取传参过来的基础色就好</span></span><br><span class="line">        <span class="keyword">const</span> newRgbColor = []</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">colorData</span>.<span class="title function_">forEach</span>(<span class="function"><span class="params">cdv</span> =&gt;</span> &#123;</span><br><span class="line">          <span class="keyword">const</span> nowColor = <span class="title function_">colorRgb</span>(cdv) + <span class="string">&#x27;,1)&#x27;</span> <span class="comment">// 将16进制颜色转化为rgba（这是原先写好的，所以得额外处理）</span></span><br><span class="line">          newRgbColor.<span class="title function_">push</span>(nowColor.<span class="title function_">slice</span>(<span class="number">5</span>, nowColor.<span class="property">length</span> - <span class="number">3</span>))</span><br><span class="line">        &#125;)</span><br><span class="line">        itemColor = <span class="string">&#x27;rgb(&#x27;</span> + newRgbColor[idx] + <span class="string">&#x27;)&#x27;</span> <span class="comment">// 人为变成rgb颜色</span></span><br><span class="line">        obj[<span class="string">&#x27;color&#x27;</span> + depth].<span class="title function_">push</span>(itemColor)</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="comment">// 如果不是第一层，则取simiColor最后一个数组对应的idx值 （取栈顶元素）</span></span><br><span class="line">        itemColor = simiColor[simiColor.<span class="property">length</span> - <span class="number">1</span>][idx] </span><br><span class="line">        obj[<span class="string">&#x27;color&#x27;</span> + depth].<span class="title function_">push</span>(itemColor)</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">// 如果当前idx对应元素是当前数组最后一个时，代表simiColor最后一个数组取完了，需要出栈</span></span><br><span class="line">      <span class="keyword">if</span> (idx === orderArr.<span class="property">length</span> - <span class="number">1</span>) &#123;</span><br><span class="line">        simiColor.<span class="title function_">pop</span>()</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">       <span class="comment">// 如果当前元素孩子存在，递归</span></span><br><span class="line">      <span class="keyword">if</span> (item.<span class="property">children</span> &amp;&amp; <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(item.<span class="property">children</span>) !== <span class="string">&#x27;[]&#x27;</span>) &#123;</span><br><span class="line">         <span class="comment">// 根据当前颜色计算相似色，并push进semicolor中</span></span><br><span class="line">        simiColor.<span class="title function_">push</span>(<span class="variable language_">this</span>.<span class="title function_">randomColor</span>(itemColor, item.<span class="property">children</span>.<span class="property">length</span>))</span><br><span class="line">          <span class="comment">// obj不变, orderArr 变成item.children，层级加一，当前per作为oldper传入,semicolor继续传参</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">depthOrder</span>(obj, item.<span class="property">children</span>, depth + <span class="number">1</span>, per, simiColor)</span><br><span class="line">      &#125; <span class="keyword">else</span> <span class="keyword">if</span> (depth &lt; <span class="variable language_">this</span>.<span class="property">dataDepth</span>) &#123;</span><br><span class="line">          <span class="comment">// 当前循环下层级小于最大层级，且没有孩子时，意味着遍历到了最外层部分没有数据的对象</span></span><br><span class="line">        <span class="keyword">const</span> emptyObj = &#123;</span><br><span class="line">          <span class="attr">name</span>: <span class="string">&#x27;&#x27;</span>, <span class="comment">// 没有名字，让人看不见</span></span><br><span class="line">          <span class="attr">value</span>: per, <span class="comment">// 百分比是用来占位的</span></span><br><span class="line">          <span class="attr">newval</span>: <span class="number">0</span></span><br><span class="line">        &#125;</span><br><span class="line">        obj[<span class="string">&#x27;data&#x27;</span> + <span class="variable language_">this</span>.<span class="property">dataDepth</span>].<span class="title function_">push</span>(emptyObj)</span><br><span class="line">        obj[<span class="string">&#x27;color&#x27;</span> + <span class="variable language_">this</span>.<span class="property">dataDepth</span>].<span class="title function_">push</span>(<span class="string">&#x27;transparent&#x27;</span>) <span class="comment">// 颜色设置为透明色</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="comment">// 随机渐变色</span></span><br><span class="line">  <span class="title function_">randomColor</span>(<span class="params">color, len</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> newRGBColor = color.<span class="title function_">slice</span>(<span class="number">4</span>, color.<span class="property">length</span> - <span class="number">1</span>).<span class="title function_">split</span>(<span class="string">&#x27;,&#x27;</span>)</span><br><span class="line">    <span class="keyword">const</span> shallowColorArray = <span class="title function_">getSimilarColor</span>(<span class="title class_">Number</span>(newRGBColor[<span class="number">0</span>]), <span class="title class_">Number</span>(newRGBColor[<span class="number">1</span>]), <span class="title class_">Number</span>(newRGBColor[<span class="number">2</span>]), len)</span><br><span class="line">    <span class="keyword">return</span> shallowColorArray</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> echarts </category>
          
      </categories>
      
      
        <tags>
            
            <tag> echarts </tag>
            
            <tag> 树的遍历 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>NG-ALAIN</title>
      <link href="/2021/05/02/NG-ALAIN/"/>
      <url>/2021/05/02/NG-ALAIN/</url>
      
        <content type="html"><![CDATA[<h1 id="一、NG-ALAIN安装"><a href="#一、NG-ALAIN安装" class="headerlink" title="一、NG-ALAIN安装"></a>一、NG-ALAIN安装</h1><h2 id="1-介绍"><a href="#1-介绍" class="headerlink" title="1.介绍"></a>1.介绍</h2><p><strong>NG-ALAIN 是一个企业级中后台前端&#x2F;设计解决方案脚手架，秉承 <a href="https://ant.design/">Ant Design</a> 的设计价值观，目标也非常简单，希望在Angular上面开发企业后台更简单、更快速。它内嵌了<a href="https://ng.ant.design/">NG-ZORRO</a>的组件库，用户体验较为完整。</strong></p><h2 id="2-安装"><a href="#2-安装" class="headerlink" title="2.安装"></a>2.安装</h2><ul><li><h3 id="全局-Angular-Cli"><a href="#全局-Angular-Cli" class="headerlink" title="全局 Angular Cli"></a>全局 Angular Cli</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install -g @angular/cli</span><br></pre></td></tr></table></figure></li><li><h3 id="创建Angular项目"><a href="#创建Angular项目" class="headerlink" title="创建Angular项目"></a>创建Angular项目</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ng <span class="keyword">new</span> my-project --style less --routing</span><br></pre></td></tr></table></figure></li><li><h3 id="添加NG-ALAIN"><a href="#添加NG-ALAIN" class="headerlink" title="添加NG-ALAIN"></a>添加NG-ALAIN</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ng add ng-alain@<span class="number">10.</span>x <span class="comment">// 本人的angular/cli脚手架版本是10，ng-alain的安装需要和脚手架版本一致才行</span></span><br></pre></td></tr></table></figure></li></ul><p>以上皆顺利进行后，来到package.json文件下，小做一点点修改：</p><p>1.将<strong>scripts</strong>下的<strong>start</strong>的”ng s -o” 改成 “ng s -o –port 80” (指定端口号是为了避免端口号占用，80端口号的好处，在网页上显示时会省略端口，仅个人喜好。其他端口号亦可，注意避免端口相同即可)</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/rainlotus97/images/data/2024-01-27/%E6%8C%87%E5%AE%9A%E7%AB%AF%E5%8F%A3%E5%8F%B7-5205a6.png"></p><p>2.配置请求的URL环境</p><p>在src&#x2F;environments&#x2F;environment.ts下修改如下，其中<strong>SERVER_URL</strong>为向后端请求的地址，<strong>url</strong>为本地项目启动地址，记得带上端口号。</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/rainlotus97/images/data/2024-01-27/environment-8c092d.png"></p><p>3.创建服务文件</p><p>在src&#x2F;app下创建目录service和文件services.module.ts以便项目整体使用，文件内容如下：</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">NgModule</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@angular/core&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; environment &#125; <span class="keyword">from</span> <span class="string">&#x27;./../environments/environment&#x27;</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@NgModule</span>(&#123;</span><br><span class="line">    <span class="attr">declarations</span>: [],</span><br><span class="line">    <span class="attr">imports</span>: [</span><br><span class="line">    ]</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">ServicesModule</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="title function_">getBackendUrl</span>(): <span class="built_in">string</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> environment.<span class="property">SERVER_URL</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="二、路由拦截与权限管理"><a href="#二、路由拦截与权限管理" class="headerlink" title="二、路由拦截与权限管理"></a>二、路由拦截与权限管理</h1><h2 id="1-准备工作"><a href="#1-准备工作" class="headerlink" title="1.准备工作"></a>1.准备工作</h2><p>一说到登录这块，不可避免的就会涉及到路由拦截、设置token和权限管理等功能。</p><p>首先，为了模拟较为真实的登录环境，我们肯定需要个后台配合，后台仓库地址会在最后奉上，在这里不多做赘述。</p><p>只想提两点，</p><p>(1).我的登录接口的返回例子如下，接下来有用的就是roleCode、token以及permission这三个属性。</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/rainlotus97/images/data/2024-01-27/login-b26a55.png"></p><p>(2).个人原因密码没有做加密操作(懒!)，有兴趣的请自行处理。</p><h2 id="2-登录"><a href="#2-登录" class="headerlink" title="2.登录"></a>2.登录</h2><p>简单改造一下登录页面的逻辑：</p><h3 id="1）html部分"><a href="#1）html部分" class="headerlink" title="1）html部分"></a>1）html部分</h3><h4 id="1-1）文案提示修改"><a href="#1-1）文案提示修改" class="headerlink" title="1.1）文案提示修改"></a>1.1）文案提示修改</h4><p>在src&#x2F;app&#x2F;routes&#x2F;passport&#x2F;login下的login.component.html中，将账号密码的提示文案修改一下</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 第3行到19行 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">nz-tab</span> [<span class="attr">nzTitle</span>]=<span class="string">&quot;&#x27;账户密码登录&#x27;&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">nz-alert</span> *<span class="attr">ngIf</span>=<span class="string">&quot;error&quot;</span> [<span class="attr">nzType</span>]=<span class="string">&quot;&#x27;error&#x27;&quot;</span> [<span class="attr">nzMessage</span>]=<span class="string">&quot;error&quot;</span> [<span class="attr">nzShowIcon</span>]=<span class="string">&quot;true&quot;</span> <span class="attr">class</span>=<span class="string">&quot;mb-lg&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">nz-alert</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">nz-form-item</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">nz-form-control</span> <span class="attr">nzErrorTip</span>=<span class="string">&quot;Please enter mobile number, muse be: admin or user&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">nz-input-group</span> <span class="attr">nzSize</span>=<span class="string">&quot;large&quot;</span> <span class="attr">nzPrefixIcon</span>=<span class="string">&quot;user&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">input</span> <span class="attr">nz-input</span> <span class="attr">formControlName</span>=<span class="string">&quot;userName&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;username: rainlotus | saber &quot;</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">nz-input-group</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">nz-form-control</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">nz-form-item</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">nz-form-item</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">nz-form-control</span> <span class="attr">nzErrorTip</span>=<span class="string">&quot;Please enter password, muse be: ng-alain.com&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">nz-input-group</span> <span class="attr">nzSize</span>=<span class="string">&quot;large&quot;</span> <span class="attr">nzPrefixIcon</span>=<span class="string">&quot;lock&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">input</span> <span class="attr">nz-input</span> <span class="attr">type</span>=<span class="string">&quot;password&quot;</span> <span class="attr">formControlName</span>=<span class="string">&quot;password&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;password: 123456&quot;</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">nz-input-group</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">nz-form-control</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">nz-form-item</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">nz-tab</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="1-2）新建路由"><a href="#1-2）新建路由" class="headerlink" title="1.2）新建路由"></a>1.2）新建路由</h4><ol><li><p>来到src&#x2F;app&#x2F;routes下右键”在集成终端中打开”，新建两个组件example01和example02</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ng g c example01</span><br><span class="line">ng g c example02</span><br></pre></td></tr></table></figure></li><li><p>在routes-routing.module.ts中修改路由配置</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Example01Component</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;./example01/example01.component&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Example02Component</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;./example02/example02.component&#x27;</span>;</span><br><span class="line">&#123;</span><br><span class="line">    <span class="attr">path</span>: <span class="string">&#x27;dashboard&#x27;</span>,</span><br><span class="line">        <span class="attr">component</span>: <span class="title class_">DashboardComponent</span>,</span><br><span class="line">            <span class="attr">data</span>: &#123; <span class="attr">title</span>: <span class="string">&#x27;仪表盘&#x27;</span>, <span class="attr">titleI18n</span>: <span class="string">&#x27;dashboard&#x27;</span> &#125;,</span><br><span class="line">                <span class="attr">children</span>: [</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="attr">path</span>: <span class="string">&#x27;example01&#x27;</span>,</span><br><span class="line">                        <span class="attr">component</span>: <span class="title class_">Example01Component</span>,</span><br><span class="line">                    &#125;,</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="attr">path</span>: <span class="string">&#x27;example02&#x27;</span>,</span><br><span class="line">                        <span class="attr">component</span>: <span class="title class_">Example02Component</span>,</span><br><span class="line">                    &#125;,</span><br><span class="line">                ]</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure></li><li><p>在src&#x2F;app&#x2F;routes&#x2F;dashboard&#x2F;dashboard.component.html简单修改一下</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">page-header</span>&gt;</span><span class="tag">&lt;/<span class="name">page-header</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">nz-button</span> <span class="attr">nzType</span>=<span class="string">&quot;primary&quot;</span> [<span class="attr">routerLink</span>]=<span class="string">&quot;[&#x27;/dashboard/example01&#x27;]&quot;</span>&gt;</span>example01<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">nz-button</span> <span class="attr">nzType</span>=<span class="string">&quot;primary&quot;</span> [<span class="attr">routerLink</span>]=<span class="string">&quot;[&#x27;/dashboard/example02&#x27;]&quot;</span>&gt;</span>example02<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">router-outlet</span>&gt;</span><span class="tag">&lt;/<span class="name">router-outlet</span>&gt;</span></span><br></pre></td></tr></table></figure></li></ol><h3 id="2）ts部分"><a href="#2）ts部分" class="headerlink" title="2）ts部分"></a>2）ts部分</h3><h4 id="2-1）创建一个jwt的泛型接口"><a href="#2-1）创建一个jwt的泛型接口" class="headerlink" title="2.1）创建一个jwt的泛型接口"></a>2.1）创建一个jwt的泛型接口</h4><p>在src&#x2F;app&#x2F;core下创建一个文件夹名为entity，文件名称为myJwtModel.ts，内容如下：</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">JWTTokenModel</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@delon/auth&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">MyJwtModel</span> <span class="keyword">extends</span> <span class="title class_ inherited__">JWTTokenModel</span> &#123;</span><br><span class="line">  <span class="attr">nickname</span>: <span class="built_in">string</span>;   <span class="comment">// 用户昵称</span></span><br><span class="line">  <span class="attr">permissions</span>: <span class="built_in">any</span>;   <span class="comment">// 权限对象</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="2-2）登录请求"><a href="#2-2）登录请求" class="headerlink" title="2.2）登录请求"></a>2.2）登录请求</h4><p>在login.component.ts中的新添及修改内容如下：</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">MyJwtModel</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;src/app/core/entity/myJwtModel&#x27;</span>;  <span class="comment">// 将上面新建的文件引入</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 对constructi中的表单控制条件修改一下</span></span><br><span class="line"><span class="variable language_">this</span>.<span class="property">form</span> = fb.<span class="title function_">group</span>(&#123;</span><br><span class="line">    <span class="attr">userName</span>: [<span class="literal">null</span>, [<span class="title class_">Validators</span>.<span class="property">required</span>, <span class="title class_">Validators</span>.<span class="title function_">pattern</span>(<span class="regexp">/^(rainlotus|saber)$/</span>)]],</span><br><span class="line">    <span class="attr">password</span>: [<span class="literal">null</span>, [<span class="title class_">Validators</span>.<span class="property">required</span>, <span class="title class_">Validators</span>.<span class="title function_">pattern</span>(<span class="regexp">/^(123456)$/</span>)]],</span><br><span class="line">    <span class="attr">mobile</span>: [<span class="literal">null</span>, [<span class="title class_">Validators</span>.<span class="property">required</span>, <span class="title class_">Validators</span>.<span class="title function_">pattern</span>(<span class="regexp">/^1\d&#123;10&#125;$/</span>)]],</span><br><span class="line">    <span class="attr">captcha</span>: [<span class="literal">null</span>, [<span class="title class_">Validators</span>.<span class="property">required</span>]],</span><br><span class="line">    <span class="attr">remember</span>: [<span class="literal">true</span>],</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// submit函数整体代码如下：</span></span><br><span class="line"><span class="title function_">submit</span>(): <span class="built_in">void</span> &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">error</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">type</span> === <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">userName</span>.<span class="title function_">markAsDirty</span>();</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">userName</span>.<span class="title function_">updateValueAndValidity</span>();</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">password</span>.<span class="title function_">markAsDirty</span>();</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">password</span>.<span class="title function_">updateValueAndValidity</span>();</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">userName</span>.<span class="property">invalid</span> || <span class="variable language_">this</span>.<span class="property">password</span>.<span class="property">invalid</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">mobile</span>.<span class="title function_">markAsDirty</span>();</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">mobile</span>.<span class="title function_">updateValueAndValidity</span>();</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">captcha</span>.<span class="title function_">markAsDirty</span>();</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">captcha</span>.<span class="title function_">updateValueAndValidity</span>();</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">mobile</span>.<span class="property">invalid</span> || <span class="variable language_">this</span>.<span class="property">captcha</span>.<span class="property">invalid</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 默认配置中对所有HTTP请求都会强制 [校验](https://ng-alain.com/auth/getting-started) 用户 Token</span></span><br><span class="line">    <span class="comment">// 然一般来说登录请求不需要校验，因此可以在请求URL加上：`/login?_allow_anonymous=true` 表示不触发用户 Token 校验</span></span><br><span class="line">    (<span class="variable language_">this</span>.<span class="property">http</span></span><br><span class="line">     .<span class="title function_">post</span>(<span class="title class_">ServicesModule</span>.<span class="title function_">getBackendUrl</span>() + <span class="string">&#x27;passport/login?_allow_anonymous=true&#x27;</span>, &#123;</span><br><span class="line">        <span class="attr">username</span>: <span class="variable language_">this</span>.<span class="property">userName</span>.<span class="property">value</span>,</span><br><span class="line">        <span class="attr">password</span>: <span class="variable language_">this</span>.<span class="property">password</span>.<span class="property">value</span>,</span><br><span class="line">    &#125;) <span class="keyword">as</span> <span class="built_in">any</span>)     <span class="comment">// 类型推导，否则本地有ts-lint校验标黄，看着难受</span></span><br><span class="line">        .<span class="title function_">subscribe</span>(<span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (res.<span class="property">code</span> !== <span class="string">&#x27;200&#x27;</span>) &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">error</span> = res.<span class="property">msg</span>;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 清空路由复用信息</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">reuseTabService</span>.<span class="title function_">clear</span>();</span><br><span class="line">        <span class="comment">// 设置用户Token信息</span></span><br><span class="line">        <span class="keyword">const</span> myJwtModel = <span class="keyword">new</span> <span class="title class_">MyJwtModel</span>();  <span class="comment">// 引入上面的接口</span></span><br><span class="line">        myJwtModel.<span class="property">nickname</span> = res.<span class="property">user</span>.<span class="property">username</span>;  <span class="comment">// 将名称赋给nickname</span></span><br><span class="line">        myJwtModel.<span class="property">user</span> = res.<span class="property">user</span>;               <span class="comment">// 新添user属性</span></span><br><span class="line">        myJwtModel.<span class="property">token</span> = res.<span class="property">user</span>.<span class="property">token</span>;        <span class="comment">// 拿到token</span></span><br><span class="line">        myJwtModel.<span class="property">permissions</span> = res.<span class="property">user</span>.<span class="property">permission</span>;   <span class="comment">// 获得权限对象</span></span><br><span class="line"></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">tokenService</span>.<span class="title function_">set</span>(myJwtModel);    <span class="comment">// 设置到token服务中</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 重新获取 StartupService 内容，我们始终认为应用信息一般都会受当前用户授权范围而影响</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">startupSrv</span>.<span class="title function_">load</span>().<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(myJwtModel.<span class="property">user</span>.<span class="property">roleCode</span>);</span><br><span class="line">            <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">                <span class="comment">// 代码仅为展示不同权限下配置的不同情况，本人偷懒，将其中内容写成一样而已</span></span><br><span class="line">                <span class="comment">// 这里主要为了演示，不同权限下默认页面跳转的不同</span></span><br><span class="line"></span><br><span class="line">                <span class="comment">// 管理员</span></span><br><span class="line">                <span class="keyword">if</span> (myJwtModel.<span class="property">user</span>.<span class="property">roleCode</span> === <span class="string">&#x27;superAdmin&#x27;</span>) &#123;   </span><br><span class="line">                    <span class="keyword">const</span> permission = myJwtModel.<span class="property">user</span>.<span class="property">permission</span>;</span><br><span class="line">                    <span class="keyword">const</span> roles = [];</span><br><span class="line">                    <span class="keyword">for</span> (<span class="keyword">const</span> i <span class="keyword">in</span> permission) &#123;</span><br><span class="line">                        <span class="keyword">if</span> (i) &#123;</span><br><span class="line">                            roles.<span class="title function_">push</span>(i);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="comment">// 这里menuList的对象与res.user.permission的内容一致，这就是接下来权限控制的重要一环</span></span><br><span class="line">                    <span class="keyword">const</span> menuList = [<span class="string">&#x27;example01&#x27;</span>, <span class="string">&#x27;example02&#x27;</span>];  </span><br><span class="line">                    <span class="keyword">const</span> urlList = [   <span class="comment">// 这里是模拟左侧导航栏有的路由情况（因为偷懒没写在左侧导航里！）</span></span><br><span class="line">                        <span class="string">&#x27;/dashboard/example01&#x27;</span>,</span><br><span class="line">                        <span class="string">&#x27;/dashboard/example02&#x27;</span>,</span><br><span class="line">                    ];</span><br><span class="line">                    <span class="keyword">let</span> url = <span class="string">&#x27;dashboard&#x27;</span>;  <span class="comment">// 默认跳转的页面</span></span><br><span class="line">                    <span class="comment">// 如果permissions中没有index权限，则从urlList中找第一个默认路由跳转，反之则跳过</span></span><br><span class="line">                    <span class="keyword">if</span> (roles.<span class="title function_">indexOf</span>(<span class="string">&#x27;index&#x27;</span>) === -<span class="number">1</span>) &#123;</span><br><span class="line">                        <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; menuList.<span class="property">length</span>; i++) &#123;</span><br><span class="line">                            <span class="keyword">if</span> (roles.<span class="title function_">indexOf</span>(menuList[i]) !== -<span class="number">1</span>) &#123;</span><br><span class="line">                                url = urlList[i];</span><br><span class="line">                                <span class="keyword">break</span>;</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="comment">// 路由跳转</span></span><br><span class="line">                    <span class="variable language_">this</span>.<span class="property">router</span>.<span class="title function_">navigateByUrl</span>(url);</span><br><span class="line">                    <span class="keyword">return</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">// 下方的普通用户其实权限就没有index，但为了可拓展性考虑没有和上面共用(虽然代码一样)</span></span><br><span class="line">                <span class="comment">// 普通用户</span></span><br><span class="line">                <span class="keyword">if</span> (myJwtModel.<span class="property">user</span>.<span class="property">roleCode</span> === <span class="string">&#x27;member&#x27;</span>) &#123;</span><br><span class="line">                    <span class="keyword">const</span> permission = myJwtModel.<span class="property">user</span>.<span class="property">permission</span>;</span><br><span class="line">                    <span class="keyword">const</span> roles = [];</span><br><span class="line">                    <span class="keyword">for</span> (<span class="keyword">const</span> i <span class="keyword">in</span> permission) &#123;</span><br><span class="line">                        <span class="keyword">if</span> (i) &#123;</span><br><span class="line">                            roles.<span class="title function_">push</span>(i);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">const</span> menuList = [<span class="string">&#x27;example01&#x27;</span>, <span class="string">&#x27;example02&#x27;</span>];</span><br><span class="line">                    <span class="keyword">const</span> urlList = [</span><br><span class="line">                        <span class="string">&#x27;/dashboard/example01&#x27;</span>,</span><br><span class="line">                        <span class="string">&#x27;/dashboard/example02&#x27;</span>,</span><br><span class="line">                    ];</span><br><span class="line">                    <span class="keyword">let</span> url = <span class="string">&#x27;dashboard&#x27;</span>;</span><br><span class="line">                    <span class="comment">// 如果没有index权限，则从urlList中找第一个默认，反之则跳过</span></span><br><span class="line">                    <span class="keyword">if</span> (roles.<span class="title function_">indexOf</span>(<span class="string">&#x27;index&#x27;</span>) === -<span class="number">1</span>) &#123;</span><br><span class="line">                        <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; menuList.<span class="property">length</span>; i++) &#123;</span><br><span class="line">                            <span class="keyword">if</span> (roles.<span class="title function_">indexOf</span>(menuList[i]) !== -<span class="number">1</span>) &#123;</span><br><span class="line">                                url = urlList[i];</span><br><span class="line">                                <span class="keyword">break</span>;</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="variable language_">this</span>.<span class="property">router</span>.<span class="title function_">navigateByUrl</span>(url);</span><br><span class="line">                    <span class="keyword">return</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;, <span class="number">300</span>);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;);</span><br></pre></td></tr></table></figure><h3 id="3）退出登录"><a href="#3）退出登录" class="headerlink" title="3）退出登录"></a>3）退出登录</h3><p>这块没有改的，但是一套流程还是要走一遍的！</p><p>在src&#x2F;app&#x2F;layout&#x2F;default&#x2F;header&#x2F;components&#x2F;user.component.ts中，代码如下：</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">ChangeDetectionStrategy</span>, <span class="title class_">Component</span>, <span class="title class_">Inject</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@angular/core&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Router</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@angular/router&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="variable constant_">DA_SERVICE_TOKEN</span>, <span class="title class_">ITokenService</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@delon/auth&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="title function_">constructor</span>(<span class="params"></span></span><br><span class="line"><span class="params">    <span class="keyword">private</span> settings: SettingsService, </span></span><br><span class="line"><span class="params">    <span class="keyword">private</span> router: Router, </span></span><br><span class="line"><span class="params">    <span class="meta">@Inject</span>(DA_SERVICE_TOKEN) <span class="keyword">private</span> tokenService: ITokenService</span></span><br><span class="line"><span class="params"></span>) &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">logout</span>(): <span class="built_in">void</span> &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">tokenService</span>.<span class="title function_">clear</span>();</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">router</span>.<span class="title function_">navigateByUrl</span>(<span class="variable language_">this</span>.<span class="property">tokenService</span>.<span class="property">login_url</span>!);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="4）实际登录效果图"><a href="#4）实际登录效果图" class="headerlink" title="4）实际登录效果图"></a>4）实际登录效果图</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/rainlotus97/images/data/2024-01-27/login-c9d6a9.gif"></p><h2 id="3-权限控制"><a href="#3-权限控制" class="headerlink" title="3.权限控制"></a>3.权限控制</h2><h3 id="1）介绍"><a href="#1）介绍" class="headerlink" title="1）介绍"></a>1）介绍</h3><p>ACL 全称叫访问控制列表（Access Control List），是一种非常简单的基于角色权限控制方式。一个完全独立 <code>@delon/acl</code> 模块。</p><h3 id="2）粒度控制"><a href="#2）粒度控制" class="headerlink" title="2）粒度控制"></a>2）粒度控制</h3><p>来到src&#x2F;app&#x2F;core&#x2F;startup&#x2F;startup.service.ts文件，代码修改如下：</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 以下代码仅为当前需求的必要代码，其余没有展示</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">ACLService</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@delon/acl&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="variable constant_">DA_SERVICE_TOKEN</span>, <span class="title class_">ITokenService</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@delon/auth&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="title function_">constructor</span>(<span class="params"></span></span><br><span class="line"><span class="params">    <span class="keyword">private</span> aclService: ACLService,    </span></span><br><span class="line"><span class="params">    <span class="meta">@Inject</span>(DA_SERVICE_TOKEN) <span class="keyword">private</span> tokenService: ITokenService,</span></span><br><span class="line"><span class="params">    </span>) &#123;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="keyword">private</span> <span class="title function_">viaMock</span>(<span class="attr">resolve</span>: <span class="built_in">any</span>, <span class="attr">reject</span>: <span class="built_in">any</span>): <span class="built_in">any</span> &#123;</span><br><span class="line"><span class="comment">// 因为我用的是jwt所以要使用this.tokenService.get(MyJwtModel)，否则为this.tokenService.get()</span></span><br><span class="line">    <span class="keyword">const</span> <span class="variable constant_">ACLS</span> = <span class="variable language_">this</span>.<span class="property">tokenService</span>.<span class="title function_">get</span>(<span class="title class_">MyJwtModel</span>).<span class="property">user</span>;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable constant_">ACLS</span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> role = <span class="variable constant_">ACLS</span>.<span class="property">roleCode</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">aclService</span>.<span class="title function_">setRole</span>([role]);  <span class="comment">// 设置用户身份</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 下方为mock数据，真实开发中会选择viaHttp方法，所以没有特别必要</span></span><br><span class="line">   <span class="comment">// 必要说明一下，下方this.aclService.setFull(true);需要注释掉或者设为false，否则页面的权限控制肯   // 定会失效</span></span><br><span class="line">    <span class="keyword">const</span> <span class="attr">app</span>: <span class="built_in">any</span> = &#123;</span><br><span class="line">        <span class="attr">name</span>: <span class="string">`ng-alain`</span>,</span><br><span class="line">        <span class="attr">description</span>: <span class="string">`Ng-zorro admin panel front-end framework`</span></span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">const</span> <span class="attr">user</span>: <span class="built_in">any</span> = &#123;</span><br><span class="line">        <span class="attr">name</span>: <span class="string">&#x27;Admin&#x27;</span>,</span><br><span class="line">        <span class="attr">avatar</span>: <span class="string">&#x27;./assets/tmp/img/avatar.jpg&#x27;</span>,</span><br><span class="line">        <span class="attr">email</span>: <span class="string">&#x27;cipchk@qq.com&#x27;</span>,</span><br><span class="line">        <span class="attr">token</span>: <span class="string">&#x27;123456789&#x27;</span></span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="comment">// Application information: including site name, description, year</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">settingService</span>.<span class="title function_">setApp</span>(app);</span><br><span class="line">    <span class="comment">// User information: including name, avatar, email address</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">settingService</span>.<span class="title function_">setUser</span>(user);</span><br><span class="line">    <span class="comment">// ACL: Set the permissions to full, https://ng-alain.com/acl/getting-started</span></span><br><span class="line">    <span class="comment">// this.aclService.setFull(true);</span></span><br><span class="line">    <span class="comment">// Menu data, https://ng-alain.com/theme/menu</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">menuService</span>.<span class="title function_">add</span>([</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">text</span>: <span class="string">&#x27;Main&#x27;</span>,</span><br><span class="line">            <span class="attr">group</span>: <span class="literal">true</span>,</span><br><span class="line">            <span class="attr">children</span>: [</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="attr">text</span>: <span class="string">&#x27;Dashboard&#x27;</span>,</span><br><span class="line">                    <span class="attr">link</span>: <span class="string">&#x27;/dashboard&#x27;</span>,</span><br><span class="line">                    <span class="attr">icon</span>: &#123; <span class="attr">type</span>: <span class="string">&#x27;icon&#x27;</span>, <span class="attr">value</span>: <span class="string">&#x27;appstore&#x27;</span> &#125;</span><br><span class="line">                &#125;,</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="attr">text</span>: <span class="string">&#x27;Quick Menu&#x27;</span>,</span><br><span class="line">                    <span class="attr">icon</span>: &#123; <span class="attr">type</span>: <span class="string">&#x27;icon&#x27;</span>, <span class="attr">value</span>: <span class="string">&#x27;rocket&#x27;</span> &#125;,</span><br><span class="line">                    <span class="attr">shortcutRoot</span>: <span class="literal">true</span></span><br><span class="line">                &#125;</span><br><span class="line">            ]</span><br><span class="line">        &#125;</span><br><span class="line">    ]);</span><br><span class="line">    <span class="comment">// Can be set page suffix title, https://ng-alain.com/theme/title</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">titleService</span>.<span class="property">suffix</span> = app.<span class="property">name</span>;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">resolve</span>(&#123;&#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>在example01.component.ts中代码如下：</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Component</span>, <span class="title class_">Inject</span>, <span class="title class_">Injector</span>, <span class="title class_">OnInit</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@angular/core&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">ACLService</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@delon/acl&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="variable constant_">DA_SERVICE_TOKEN</span>, <span class="title class_">ITokenService</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@delon/auth&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">MyJwtModel</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;src/app/core/entity/myJwtModel&#x27;</span>;</span><br><span class="line"><span class="meta">@Component</span>(&#123;</span><br><span class="line">    <span class="attr">selector</span>: <span class="string">&#x27;app-example01&#x27;</span>,</span><br><span class="line">    <span class="attr">templateUrl</span>: <span class="string">&#x27;./example01.component.html&#x27;</span>,</span><br><span class="line">    <span class="attr">styles</span>: [</span><br><span class="line">    ]</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">Example01Component</span> <span class="keyword">implements</span> <span class="title class_">OnInit</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params"></span></span><br><span class="line"><span class="params">    <span class="keyword">private</span> injector: Injector,</span></span><br><span class="line"><span class="params">     <span class="keyword">private</span> aclservice: ACLService,</span></span><br><span class="line"><span class="params">     <span class="meta">@Inject</span>(DA_SERVICE_TOKEN) <span class="keyword">private</span> tokenService: ITokenService</span></span><br><span class="line"><span class="params">    </span>) &#123; &#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">ngOnInit</span>(): <span class="built_in">void</span> &#123;</span><br><span class="line">    <span class="comment">// 加载权限配置</span></span><br><span class="line">    <span class="comment">// this.tokenService.get(MyJwtModel)获取jwt格式的token</span></span><br><span class="line">    <span class="comment">// this.injector.get(DA_SERVICE_TOKEN) as ITokenService 与上方获取jwt的方法本质是一样的</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">tokenService</span>.<span class="title function_">get</span>(<span class="title class_">MyJwtModel</span>).<span class="property">user</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// const ACLS = (this.injector.get(DA_SERVICE_TOKEN) as ITokenService).get(MyJwtModel).user;</span></span><br><span class="line">    <span class="keyword">const</span> <span class="variable constant_">ACLS</span> = <span class="variable language_">this</span>.<span class="property">tokenService</span>.<span class="title function_">get</span>(<span class="title class_">MyJwtModel</span>).<span class="property">user</span>;</span><br><span class="line">    <span class="keyword">const</span> aclPermission = <span class="variable constant_">ACLS</span>.<span class="property">permission</span>;   <span class="comment">// 权益对象</span></span><br><span class="line">    <span class="keyword">const</span> arr = <span class="title class_">Object</span>.<span class="title function_">keys</span>(aclPermission);  <span class="comment">// 权益对象数组</span></span><br><span class="line">    <span class="comment">// 注意attachRole不会先清除所有，如果我不在startup.service.ts中使用setRole，切换账号后会出现权限     // 没生效的问题，可能得需要刷新页面才会生效</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">aclservice</span>.<span class="title function_">attachRole</span>(arr);         <span class="comment">// 为用户添加权限</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>在example01.component.html中代码如下：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">h1</span> <span class="attr">style</span>=<span class="string">&quot;margin-top: 30px;&quot;</span>&gt;</span>权限管理测试<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h3</span>&gt;</span>以下会有四个按钮分别为：example01、example02、index、xxx<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">nz-button</span> <span class="attr">nzType</span>=<span class="string">&quot;primary&quot;</span>&gt;</span>example01<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">nz-button</span> <span class="attr">nzType</span>=<span class="string">&quot;primary&quot;</span>&gt;</span>example02<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">nz-button</span> <span class="attr">nzType</span>=<span class="string">&quot;primary&quot;</span>&gt;</span>index<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">nz-button</span> <span class="attr">nzType</span>=<span class="string">&quot;primary&quot;</span>&gt;</span>xxx<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h3</span> <span class="attr">style</span>=<span class="string">&quot;margin-top: 10px;&quot;</span>&gt;</span>其中前三个后端返回的permission中实际就有的，index这个权限会根据账号不同显示或者隐藏，而xxx就是随便编的用做衬托<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>以下就是带上权限后的页面<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">nz-button</span> <span class="attr">nzType</span>=<span class="string">&quot;primary&quot;</span> [<span class="attr">acl</span>]=<span class="string">&quot;[&#x27;example01&#x27;,&#x27;superAdmin&#x27;]&quot;</span>&gt;</span>example01<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">nz-button</span> <span class="attr">nzType</span>=<span class="string">&quot;primary&quot;</span> [<span class="attr">acl</span>]=<span class="string">&quot;&#x27;example02&#x27;&quot;</span>&gt;</span>example02<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">nz-button</span> <span class="attr">nzType</span>=<span class="string">&quot;primary&quot;</span> [<span class="attr">acl</span>]=<span class="string">&quot;&#x27;index&#x27;&quot;</span>&gt;</span>index<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">nz-button</span> <span class="attr">nzType</span>=<span class="string">&quot;primary&quot;</span> [<span class="attr">acl</span>]=<span class="string">&quot;&#x27;xxx&#x27;&quot;</span>&gt;</span>xxx<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br></pre></td></tr></table></figure><p>页面效果图如下：</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/rainlotus97/images/data/2024-01-27/%E7%B2%92%E5%BA%A6%E6%8E%A7%E5%88%B6-96fcfd.gif"></p><h3 id="3）路由守卫"><a href="#3）路由守卫" class="headerlink" title="3）路由守卫"></a>3）路由守卫</h3><p>来到路由配置文件，在此以routes-routing.module.ts举例：</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">ACLGuard</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@delon/acl&#x27;</span>;</span><br><span class="line">&#123;</span><br><span class="line">    <span class="attr">path</span>: <span class="string">&#x27;dashboard&#x27;</span>,</span><br><span class="line">        <span class="attr">component</span>: <span class="title class_">DashboardComponent</span>,</span><br><span class="line">            <span class="attr">canActivate</span>: [<span class="title class_">ACLGuard</span>],  <span class="comment">//此处配置路由守卫</span></span><br><span class="line">                <span class="comment">//guard: &#x27;superAdmin&#x27;则是只允许superAdmin身份的账号登录</span></span><br><span class="line">                <span class="attr">data</span>: &#123; <span class="attr">title</span>: <span class="string">&#x27;仪表盘&#x27;</span>, <span class="attr">titleI18n</span>: <span class="string">&#x27;dashboard&#x27;</span>, <span class="attr">guard</span>: <span class="string">&#x27;superAdmin&#x27;</span> &#125;,</span><br><span class="line">                    <span class="attr">children</span>: [</span><br><span class="line">                        &#123;</span><br><span class="line">                            <span class="attr">path</span>: <span class="string">&#x27;example01&#x27;</span>,</span><br><span class="line">                            <span class="attr">component</span>: <span class="title class_">Example01Component</span>,</span><br><span class="line">                        &#125;,</span><br><span class="line">                        &#123;</span><br><span class="line">                            <span class="attr">path</span>: <span class="string">&#x27;example02&#x27;</span>,</span><br><span class="line">                            <span class="attr">component</span>: <span class="title class_">Example02Component</span>,</span><br><span class="line">                        &#125;,</span><br><span class="line">                    ]</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure><p>页面效果图如下：</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/rainlotus97/images/data/2024-01-27/%E8%B7%AF%E7%94%B1%E5%AE%88%E5%8D%AB-39f223.gif"></p><h2 id="4-路由拦截"><a href="#4-路由拦截" class="headerlink" title="4.路由拦截"></a>4.路由拦截</h2><h4 id="1）请求统一配置"><a href="#1）请求统一配置" class="headerlink" title="1）请求统一配置"></a>1）请求统一配置</h4><p>在此只是做了统一的加上服务端前缀，请求头添加token处理。</p><p>在src&#x2F;app&#x2F;core&#x2F;net&#x2F;default.interceptor.ts中修改：</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">constructor</span>(<span class="params"></span></span><br><span class="line"><span class="params">    <span class="keyword">private</span> injector: Injector,</span></span><br><span class="line"><span class="params">    <span class="meta">@Inject</span>(DA_SERVICE_TOKEN) <span class="keyword">private</span> tokenService: ITokenService,</span></span><br><span class="line"><span class="params">    </span>) &#123; &#125;</span><br><span class="line"><span class="title function_">intercept</span>(<span class="attr">req</span>: <span class="title class_">HttpRequest</span>&lt;<span class="built_in">any</span>&gt;, <span class="attr">next</span>: <span class="title class_">HttpHandler</span>): <span class="title class_">Observable</span>&lt;<span class="title class_">HttpEvent</span>&lt;<span class="built_in">any</span>&gt;&gt; &#123;</span><br><span class="line">    <span class="comment">// 统一加上服务端前缀</span></span><br><span class="line">    <span class="keyword">const</span> jwtModel = <span class="variable language_">this</span>.<span class="property">tokenService</span>.<span class="title function_">get</span>(<span class="title class_">JWTTokenModel</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> url = req.<span class="property">url</span>;</span><br><span class="line">    <span class="keyword">if</span> (!url.<span class="title function_">startsWith</span>(<span class="string">&#x27;https://&#x27;</span>) &amp;&amp; !url.<span class="title function_">startsWith</span>(<span class="string">&#x27;http://&#x27;</span>)) &#123;</span><br><span class="line">    url = environment.<span class="property">SERVER_URL</span> + url;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> newReq = req.<span class="title function_">clone</span>(&#123; url &#125;);</span><br><span class="line"><span class="comment">// 当token存在时，为所有请求设置请求头</span></span><br><span class="line"><span class="keyword">if</span> (jwtModel.<span class="property">token</span>) &#123;</span><br><span class="line">    newReq = req.<span class="title function_">clone</span>(&#123;</span><br><span class="line">        url, <span class="attr">setHeaders</span>: &#123;</span><br><span class="line">            <span class="title class_">Authorization</span>: <span class="string">`Bearer <span class="subst">$&#123;jwtModel.token&#125;</span>`</span></span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> next.<span class="title function_">handle</span>(newReq).<span class="title function_">pipe</span>(</span><br><span class="line">    <span class="title function_">mergeMap</span>(<span class="function">(<span class="params">ev</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// 允许统一对请求错误处理</span></span><br><span class="line">        <span class="keyword">if</span> (ev <span class="keyword">instanceof</span> <span class="title class_">HttpResponseBase</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">handleData</span>(ev, newReq, next);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 若一切都正常，则后续操作</span></span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">of</span>(ev);</span><br><span class="line">    &#125;),</span><br><span class="line">    <span class="title function_">catchError</span>(<span class="function">(<span class="params">err: HttpErrorResponse</span>) =&gt;</span> <span class="variable language_">this</span>.<span class="title function_">handleData</span>(err, newReq, next)),</span><br><span class="line">);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ps:官方原生的代码有问题，即NzNotificationService服务说没有引用，所以遇到这样情况，只需来到app.module.ts中引入即可。</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">NzNotificationService</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;ng-zorro-antd/notification&#x27;</span>;</span><br><span class="line"><span class="attr">providers</span>: [</span><br><span class="line">    <span class="title class_">NzNotificationService</span>,</span><br><span class="line">],</span><br></pre></td></tr></table></figure><h4 id="2）路由设置"><a href="#2）路由设置" class="headerlink" title="2）路由设置"></a>2）路由设置</h4><p>将SimpleGuard改为JWTGuard，并引入即可，目的是为了请求时token过期，会自动导向到登录界面</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">JWTGuard</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@delon/auth&#x27;</span>; </span><br><span class="line">&#123;</span><br><span class="line">    <span class="attr">path</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">        <span class="attr">component</span>: <span class="title class_">LayoutDefaultComponent</span>,</span><br><span class="line">            <span class="attr">canActivate</span>: [<span class="title class_">JWTGuard</span>],    <span class="comment">// 这样一旦token过期变会直接退出到登录页面</span></span><br><span class="line">                <span class="attr">children</span>: [</span><br><span class="line">                    &#123; <span class="attr">path</span>: <span class="string">&#x27;&#x27;</span>, <span class="attr">redirectTo</span>: <span class="string">&#x27;dashboard&#x27;</span>, <span class="attr">pathMatch</span>: <span class="string">&#x27;full&#x27;</span> &#125;,</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="attr">path</span>: <span class="string">&#x27;dashboard&#x27;</span>,</span><br><span class="line">                        <span class="attr">component</span>: <span class="title class_">DashboardComponent</span>,</span><br><span class="line">                        <span class="comment">// canActivate: [ACLGuard],</span></span><br><span class="line">                        <span class="attr">data</span>: &#123; <span class="attr">title</span>: <span class="string">&#x27;仪表盘&#x27;</span>, <span class="attr">titleI18n</span>: <span class="string">&#x27;dashboard&#x27;</span>, <span class="attr">guard</span>: <span class="string">&#x27;superAdmin&#x27;</span> &#125;,</span><br><span class="line">                        <span class="attr">children</span>: [</span><br><span class="line">                            &#123;</span><br><span class="line">                                <span class="attr">path</span>: <span class="string">&#x27;example01&#x27;</span>,</span><br><span class="line">                                <span class="attr">component</span>: <span class="title class_">Example01Component</span>,</span><br><span class="line">                            &#125;,</span><br><span class="line">                            &#123;</span><br><span class="line">                                <span class="attr">path</span>: <span class="string">&#x27;example02&#x27;</span>,</span><br><span class="line">                                <span class="attr">component</span>: <span class="title class_">Example02Component</span>,</span><br><span class="line">                            &#125;,</span><br><span class="line">                        ]</span><br><span class="line">                    &#125;,</span><br><span class="line">                ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="3）请求实例演示"><a href="#3）请求实例演示" class="headerlink" title="3）请求实例演示"></a>3）请求实例演示</h4><h5 id="3-1）HTML部分"><a href="#3-1）HTML部分" class="headerlink" title="3.1）HTML部分"></a>3.1）HTML部分</h5><p>在src&#x2F;app&#x2F;routes&#x2F;example02&#x2F;example02.component.html中，修改如下：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">p</span> <span class="attr">style</span>=<span class="string">&quot;margin-top: 30px;&quot;</span>&gt;</span>example02 works!<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">nz-input</span> <span class="attr">style</span>=<span class="string">&quot;width: 300px;margin-right: 20px;&quot;</span> <span class="attr">type</span>=<span class="string">&quot;tel&quot;</span> <span class="attr">name</span>=<span class="string">&quot;&quot;</span> <span class="attr">id</span>=<span class="string">&quot;&quot;</span> [(<span class="attr">ngModel</span>)]=<span class="string">&quot;telNUm&quot;</span></span></span><br><span class="line"><span class="tag"><span class="attr">placeholder</span>=<span class="string">&quot;数字：1&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">nz-input</span> <span class="attr">style</span>=<span class="string">&quot;width: 300px;margin-right: 20px;&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> [(<span class="attr">ngModel</span>)]=<span class="string">&quot;nickName&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;名称：sega&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">nz-button</span> <span class="attr">nzType</span>=<span class="string">&quot;primary&quot;</span> (<span class="attr">click</span>)=<span class="string">&quot;getInfo()&quot;</span>&gt;</span>带token的post请求<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;margin-top: 10px;&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> *<span class="attr">ngIf</span>=<span class="string">&quot;dataList&quot;</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">span</span> <span class="attr">style</span>=<span class="string">&quot;margin-right: 10px;&quot;</span>&gt;</span>name<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">span</span>&gt;</span>address<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> *<span class="attr">ngFor</span>=<span class="string">&quot;let item of dataList&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">span</span> <span class="attr">style</span>=<span class="string">&quot;margin-right: 10px;&quot;</span>&gt;</span>&#123;&#123;item.name&#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">span</span>&gt;</span>&#123;&#123;item.address&#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">style</span>=<span class="string">&quot;margin-top: 20px;&quot;</span> <span class="attr">nz-button</span> <span class="attr">nzType</span>=<span class="string">&quot;primary&quot;</span> (<span class="attr">click</span>)=<span class="string">&quot;getData()&quot;</span>&gt;</span>带token的get请求<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;margin-top: 10px;&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> *<span class="attr">ngIf</span>=<span class="string">&quot;dataList&quot;</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">span</span> <span class="attr">style</span>=<span class="string">&quot;margin-right: 10px;&quot;</span>&gt;</span>name<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">span</span>&gt;</span>address<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> *<span class="attr">ngFor</span>=<span class="string">&quot;let item of orderList&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">span</span> <span class="attr">style</span>=<span class="string">&quot;margin-right: 10px;&quot;</span>&gt;</span>&#123;&#123;item.orderId&#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">span</span>&gt;</span>&#123;&#123;item.address&#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><h5 id="3-2）封装请求服务"><a href="#3-2）封装请求服务" class="headerlink" title="3.2）封装请求服务"></a>3.2）封装请求服务</h5><p>在service文件夹下，创建一个服务，命令为：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ng g s example02</span><br></pre></td></tr></table></figure><p>服务代码内容如下，仅供参考：</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">HttpClient</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@angular/common/http&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Injectable</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@angular/core&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Observable</span>, <span class="title class_">Subject</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;rxjs&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">ServicesModule</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;./services.module&#x27;</span>;</span><br><span class="line"><span class="meta">@Injectable</span>(&#123;</span><br><span class="line"><span class="attr">providedIn</span>: <span class="string">&#x27;root&#x27;</span></span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">Example02Service</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="title function_">constructor</span>(<span class="params"><span class="keyword">private</span> httpClient: HttpClient</span>) &#123; &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="variable constant_">COMB_URL</span> = <span class="title class_">ServicesModule</span>.<span class="title function_">getBackendUrl</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// example02请求 </span></span><br><span class="line"><span class="keyword">private</span> <span class="variable constant_">EXAMPLE_URL</span> = <span class="variable language_">this</span>.<span class="property">COMB_URL</span> + <span class="string">&#x27;passport/address&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="variable constant_">ORDER_URL</span> = <span class="variable language_">this</span>.<span class="property">COMB_URL</span> + <span class="string">&#x27;passport/order&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// example02 post请求方法</span></span><br><span class="line"><span class="title function_">postExample02Data</span>(<span class="attr">param</span>: <span class="built_in">any</span>): <span class="built_in">any</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">httpClient</span>.<span class="title function_">post</span>(<span class="variable language_">this</span>.<span class="property">EXAMPLE_URL</span>, param);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// example02 get请求方法</span></span><br><span class="line"><span class="title function_">getExample02Data</span>(): <span class="built_in">any</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">httpClient</span>.<span class="title function_">get</span>(<span class="variable language_">this</span>.<span class="property">ORDER_URL</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="3-3）ts部分"><a href="#3-3）ts部分" class="headerlink" title="3.3）ts部分"></a>3.3）ts部分</h5><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Component</span>, <span class="title class_">OnInit</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@angular/core&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Example02Service</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;src/app/service/example02.service&#x27;</span>;</span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">DataListType</span> &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="built_in">string</span>;</span><br><span class="line">    <span class="attr">address</span>: <span class="built_in">string</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">OrderDataType</span> &#123;</span><br><span class="line">    <span class="attr">orderId</span>: <span class="built_in">string</span>;</span><br><span class="line">    <span class="attr">address</span>: <span class="built_in">string</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span>(&#123;</span><br><span class="line">    <span class="attr">selector</span>: <span class="string">&#x27;app-example02&#x27;</span>,</span><br><span class="line">    <span class="attr">templateUrl</span>: <span class="string">&#x27;./example02.component.html&#x27;</span>,</span><br><span class="line">    <span class="attr">styles</span>: [</span><br><span class="line">    ]</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">Example02Component</span> <span class="keyword">implements</span> <span class="title class_">OnInit</span> &#123;</span><br><span class="line">    telNUm = <span class="number">1</span>;</span><br><span class="line">    nickName = <span class="string">&#x27;sega&#x27;</span>;</span><br><span class="line">    dataList;</span><br><span class="line">    orderList;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params"></span></span><br><span class="line"><span class="params">    <span class="keyword">private</span> example02: Example02Service</span></span><br><span class="line"><span class="params">    </span>) &#123; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">ngOnInit</span>(): <span class="built_in">void</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">getInfo</span>(): <span class="built_in">void</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> params = &#123;</span><br><span class="line">            <span class="attr">id</span>: <span class="title class_">Number</span>(<span class="variable language_">this</span>.<span class="property">telNUm</span>),</span><br><span class="line">            <span class="attr">name</span>: <span class="variable language_">this</span>.<span class="property">nickName</span></span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">example02</span>.<span class="title function_">postExample02Data</span>(params).<span class="title function_">subscribe</span>(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">dataList</span> = res.<span class="property">data</span> <span class="keyword">as</span> <span class="title class_">DataListType</span>;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">getData</span>(): <span class="built_in">void</span> &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">example02</span>.<span class="title function_">getExample02Data</span>().<span class="title function_">subscribe</span>(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">orderList</span> = res.<span class="property">data</span> <span class="keyword">as</span> <span class="title class_">OrderDataType</span>;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="3-4）效果演示"><a href="#3-4）效果演示" class="headerlink" title="3.4）效果演示"></a>3.4）效果演示</h5><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/rainlotus97/images/data/2024-01-27/%E8%B7%AF%E7%94%B1%E6%8B%A6%E6%88%AA-b0f3e4.gif"></p><h1 id="三、国际化"><a href="#三、国际化" class="headerlink" title="三、国际化"></a>三、国际化</h1><p>Angular 国际化常见有 Angular 内置和基于 @ngx-translate&#x2F;core （请参考<a href="https://github.com/ngx-translate/core">官网</a>了解更多实现细节）两种不同国际化方案。而<a href="https://github.com/ngx-translate/core">@ngx-translate&#x2F;core</a> 是社区版本的 Angular 国际化，相比较 Angular 内置它是动态性，无须针对不同语言构建和部署单独版本，并且大部分情况下可以立即呈现。</p><p>以下便是@ngx-translate&#x2F;core的配置过程：</p><h3 id="1）准备工作"><a href="#1）准备工作" class="headerlink" title="1）准备工作"></a>1）准备工作</h3><h4 id="1-1）安装插件"><a href="#1-1）安装插件" class="headerlink" title="1.1）安装插件"></a>1.1）安装插件</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 安装ngx-translate插件配置国际化</span></span><br><span class="line">npm i @ngx-translate/core --save</span><br><span class="line">npm i @ngx-translate/http-loader --save</span><br><span class="line"></span><br><span class="line"><span class="comment">// 如果其中一个装包失败，请将package-lock.json删除，然后npm i装包，最后将装包失败的命令重新装一下就可以成功了</span></span><br></pre></td></tr></table></figure><h4 id="1-2）创建服务文件"><a href="#1-2）创建服务文件" class="headerlink" title="1.2）创建服务文件"></a>1.2）创建服务文件</h4><p>在src&#x2F;app&#x2F;core文件夹下创建一个名为i18n的文件夹，以及旗下文件i18n.service.ts。</p><p>ps:之所以在这儿配置，其一ng-alian的github源码就是这么配置的；其二也是因为这种文件虽然属于服务一块，但同时它本身就属于项目一启动，全局配置使用的文件，放在这儿显然更好。当然，放在哪里还是你的自由。</p><p>i18n.service.ts的代码内容如下：</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 以下内容基本上是从源码那里复制过来的</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Platform</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@angular/cdk/platform&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; registerLocaleData &#125; <span class="keyword">from</span> <span class="string">&#x27;@angular/common&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> ngEn <span class="keyword">from</span> <span class="string">&#x27;@angular/common/locales/en&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> ngZh <span class="keyword">from</span> <span class="string">&#x27;@angular/common/locales/zh&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> ngZhTw <span class="keyword">from</span> <span class="string">&#x27;@angular/common/locales/zh-Hant&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> ngJa <span class="keyword">from</span> <span class="string">&#x27;@angular/common/locales/ja&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Injectable</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@angular/core&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">    <span class="title class_">AlainI18NService</span>,</span><br><span class="line">    <span class="title class_">DelonLocaleService</span>,</span><br><span class="line">    en_US <span class="keyword">as</span> delonEnUS,</span><br><span class="line">    <span class="title class_">SettingsService</span>,</span><br><span class="line">    zh_CN <span class="keyword">as</span> delonZhCn,</span><br><span class="line">    zh_TW <span class="keyword">as</span> delonZhTw,</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">&#x27;@delon/theme&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">TranslateService</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@ngx-translate/core&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; enUS <span class="keyword">as</span> dfEn, zhCN <span class="keyword">as</span> dfZhCn, zhTW <span class="keyword">as</span> dfZhTw, ja <span class="keyword">as</span> dfJaJp &#125; <span class="keyword">from</span> <span class="string">&#x27;date-fns/locale&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">NzSafeAny</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;ng-zorro-antd/core/types&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; en_US <span class="keyword">as</span> zorroEnUS, ja_JP <span class="keyword">as</span> zorroJaJp, <span class="title class_">NzI18</span>nService, zh_CN <span class="keyword">as</span> zorroZhCN, zh_TW <span class="keyword">as</span> zorroZhTW &#125; <span class="keyword">from</span> <span class="string">&#x27;ng-zorro-antd/i18n&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">BehaviorSubject</span>, <span class="title class_">Observable</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;rxjs&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; filter &#125; <span class="keyword">from</span> <span class="string">&#x27;rxjs/operators&#x27;</span>;</span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">LangData</span> &#123;</span><br><span class="line">    <span class="attr">abbr</span>: <span class="built_in">string</span>;</span><br><span class="line">    <span class="attr">text</span>: <span class="built_in">string</span>;</span><br><span class="line">    <span class="attr">ng</span>: <span class="title class_">NzSafeAny</span>;</span><br><span class="line">    <span class="attr">zorro</span>: <span class="title class_">NzSafeAny</span>;</span><br><span class="line">    <span class="attr">date</span>: <span class="title class_">NzSafeAny</span>;</span><br><span class="line">    <span class="attr">delon</span>: <span class="title class_">NzSafeAny</span>;</span><br><span class="line">    <span class="comment">// 服务端对应的语言值</span></span><br><span class="line">    <span class="comment">// backendKey: string;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">DEFAULT</span> = <span class="string">&#x27;zh-CN&#x27;</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="attr">LANGS</span>: &#123; [<span class="attr">key</span>: <span class="built_in">string</span>]: <span class="title class_">LangData</span> &#125; = &#123;</span><br><span class="line">    <span class="comment">// 每添加一门语言，在这里添加即可，当然与此同时需要添加一份专门的的json文件</span></span><br><span class="line">    <span class="string">&#x27;zh-CN&#x27;</span>: &#123;</span><br><span class="line">        <span class="attr">text</span>: <span class="string">&#x27;简体中文&#x27;</span>,</span><br><span class="line">        <span class="attr">ng</span>: ngZh,</span><br><span class="line">        <span class="attr">zorro</span>: zorroZhCN, <span class="comment">// 重命名</span></span><br><span class="line">        <span class="attr">date</span>: dfZhCn,</span><br><span class="line">        <span class="attr">delon</span>: delonZhCn,</span><br><span class="line">        <span class="attr">abbr</span>: <span class="string">&#x27;🇨🇳&#x27;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">&#x27;zh-TW&#x27;</span>: &#123;</span><br><span class="line">        <span class="attr">text</span>: <span class="string">&#x27;繁体中文&#x27;</span>,</span><br><span class="line">        <span class="attr">ng</span>: ngZhTw,</span><br><span class="line">        <span class="attr">zorro</span>: zorroZhTW, <span class="comment">// 重命名</span></span><br><span class="line">        <span class="attr">date</span>: dfZhTw,</span><br><span class="line">        <span class="attr">delon</span>: delonZhTw,</span><br><span class="line">        <span class="attr">abbr</span>: <span class="string">&#x27;🇭🇰&#x27;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">&#x27;en-US&#x27;</span>: &#123;</span><br><span class="line">        <span class="attr">text</span>: <span class="string">&#x27;English&#x27;</span>,</span><br><span class="line">        <span class="attr">ng</span>: ngEn,</span><br><span class="line">        <span class="attr">zorro</span>: zorroEnUS, <span class="comment">// 重命名</span></span><br><span class="line">        <span class="attr">date</span>: dfEn,</span><br><span class="line">        <span class="attr">delon</span>: delonEnUS,</span><br><span class="line">        <span class="attr">abbr</span>: <span class="string">&#x27;🇺🇸&#x27;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">&#x27;ja-JP&#x27;</span>: &#123;</span><br><span class="line">        <span class="attr">text</span>: <span class="string">&#x27;日本语&#x27;</span>,</span><br><span class="line">        <span class="attr">ng</span>: ngJa,</span><br><span class="line">        <span class="attr">zorro</span>: zorroJaJp, <span class="comment">// 重命名</span></span><br><span class="line">        <span class="attr">date</span>: dfJaJp,</span><br><span class="line">        <span class="attr">delon</span>: delonZhCn,</span><br><span class="line">        <span class="attr">abbr</span>: <span class="string">&#x27;🇯🇵&#x27;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Injectable</span>(&#123; <span class="attr">providedIn</span>: <span class="string">&#x27;root&#x27;</span> &#125;)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">I18NService</span> <span class="keyword">implements</span> <span class="title class_">AlainI18NService</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> _default = <span class="variable constant_">DEFAULT</span>;</span><br><span class="line">    <span class="keyword">private</span> change$ = <span class="keyword">new</span> <span class="title class_">BehaviorSubject</span>&lt;<span class="built_in">string</span> | <span class="literal">null</span>&gt;(<span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> _langs = <span class="title class_">Object</span>.<span class="title function_">keys</span>(<span class="variable constant_">LANGS</span>).<span class="title function_">map</span>(<span class="function">(<span class="params">code</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> item = <span class="variable constant_">LANGS</span>[code];</span><br><span class="line">        <span class="keyword">return</span> &#123; code, <span class="attr">text</span>: item.<span class="property">text</span>, <span class="attr">abbr</span>: item.<span class="property">abbr</span> &#125;;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params"></span></span><br><span class="line"><span class="params">    <span class="keyword">private</span> settings: SettingsService,</span></span><br><span class="line"><span class="params">     <span class="keyword">private</span> nzI18nService: NzI18nService,</span></span><br><span class="line"><span class="params">     <span class="keyword">private</span> delonLocaleService: DelonLocaleService,</span></span><br><span class="line"><span class="params">     <span class="keyword">private</span> translate: TranslateService,</span></span><br><span class="line"><span class="params">     <span class="keyword">private</span> platform: Platform,</span></span><br><span class="line"><span class="params">    </span>) &#123;</span><br><span class="line">        <span class="comment">// `@ngx-translate/core` 预先知道支持哪些语言</span></span><br><span class="line">        <span class="keyword">const</span> lans = <span class="variable language_">this</span>.<span class="property">_langs</span>.<span class="title function_">map</span>(<span class="function">(<span class="params">item</span>) =&gt;</span> item.<span class="property">code</span>);</span><br><span class="line">        translate.<span class="title function_">addLangs</span>(lans);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">const</span> defaultLan = <span class="variable language_">this</span>.<span class="title function_">getDefaultLang</span>();</span><br><span class="line">        <span class="keyword">if</span> (lans.<span class="title function_">includes</span>(defaultLan)) &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">_default</span> = defaultLan;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">updateLangData</span>(<span class="variable language_">this</span>.<span class="property">_default</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">getDefaultLang</span>(): <span class="built_in">string</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (!<span class="variable language_">this</span>.<span class="property">platform</span>.<span class="property">isBrowser</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="variable constant_">DEFAULT</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">settings</span>.<span class="property">layout</span>.<span class="property">lang</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">settings</span>.<span class="property">layout</span>.<span class="property">lang</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> (navigator.<span class="property">languages</span> ? navigator.<span class="property">languages</span>[<span class="number">0</span>] : <span class="literal">null</span>) || navigator.<span class="property">language</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">updateLangData</span>(<span class="attr">lang</span>: <span class="built_in">string</span>): <span class="built_in">void</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> item = <span class="variable constant_">LANGS</span>[lang];</span><br><span class="line">        <span class="title function_">registerLocaleData</span>(item.<span class="property">ng</span>);</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">nzI18nService</span>.<span class="title function_">setLocale</span>(item.<span class="property">zorro</span>);</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">nzI18nService</span>.<span class="title function_">setDateLocale</span>(item.<span class="property">date</span>);</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">delonLocaleService</span>.<span class="title function_">setLocale</span>(item.<span class="property">delon</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">get</span> <span class="title function_">change</span>(): <span class="title class_">Observable</span>&lt;<span class="built_in">string</span>&gt; &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">change$</span>.<span class="title function_">asObservable</span>().<span class="title function_">pipe</span>(<span class="title function_">filter</span>(<span class="function">(<span class="params">w</span>) =&gt;</span> w != <span class="literal">null</span>)) <span class="keyword">as</span> <span class="title class_">Observable</span>&lt;<span class="built_in">string</span>&gt;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">use</span>(<span class="attr">lang</span>: <span class="built_in">string</span>): <span class="built_in">void</span> &#123;</span><br><span class="line">        lang = lang || <span class="variable language_">this</span>.<span class="property">translate</span>.<span class="title function_">getDefaultLang</span>();</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">currentLang</span> === lang) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">updateLangData</span>(lang);</span><br><span class="line">        (<span class="variable language_">this</span>.<span class="property">translate</span>.<span class="title function_">use</span>(lang) <span class="keyword">as</span> <span class="built_in">any</span>).<span class="title function_">subscribe</span>(<span class="function">() =&gt;</span> <span class="variable language_">this</span>.<span class="property">change$</span>.<span class="title function_">next</span>(lang));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/** 获取语言列表 */</span></span><br><span class="line">    <span class="title function_">getLangs</span>(): <span class="title class_">Array</span>&lt;&#123; <span class="attr">code</span>: <span class="built_in">string</span>; <span class="attr">text</span>: <span class="built_in">string</span>; <span class="attr">abbr</span>: <span class="built_in">string</span> &#125;&gt; &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">_langs</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/** 翻译 */</span></span><br><span class="line">    <span class="title function_">fanyi</span>(<span class="attr">key</span>: <span class="built_in">string</span>, interpolateParams?: &#123;&#125;): <span class="built_in">any</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">translate</span>.<span class="title function_">instant</span>(key, interpolateParams);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/** 默认语言 */</span></span><br><span class="line">    <span class="keyword">get</span> <span class="title function_">defaultLang</span>(): <span class="built_in">string</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">_default</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/** 当前语言 */</span></span><br><span class="line">    <span class="keyword">get</span> <span class="title function_">currentLang</span>(): <span class="built_in">string</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">translate</span>.<span class="property">currentLang</span> || <span class="variable language_">this</span>.<span class="property">translate</span>.<span class="title function_">getDefaultLang</span>() || <span class="variable language_">this</span>.<span class="property">_default</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="1-3）语言文件"><a href="#1-3）语言文件" class="headerlink" title="1.3）语言文件"></a>1.3）语言文件</h4><p>在assets文件夹下，添加i18n文件夹，因为上述服务文件共配置了四种语言，因此，这里我们也添加了四个json文件，名称与上述服务文件中<strong>LANGS</strong>变量的属性名一致，即”en-US.json”,”ja-JP.json”,”zh-CN.json”,”zh-TW.json”</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// zh-CN</span></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;GENERAL.I18N.CHINESE&quot;</span><span class="punctuation">:</span> <span class="string">&quot;简体中文&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;GENERAL.I18N.PRO.APPLY&quot;</span><span class="punctuation">:</span> <span class="string">&quot;立即试用&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;GENERAL.I18N.NUM&quot;</span><span class="punctuation">:</span> <span class="string">&quot;数字是&#123;&#123;num&#125;&#125;个&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// zh-TW</span></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;GENERAL.I18N.CHINESE&quot;</span><span class="punctuation">:</span> <span class="string">&quot;簡體中文&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;GENERAL.I18N.PRO.APPLY&quot;</span><span class="punctuation">:</span> <span class="string">&quot;立即試用&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;GENERAL.I18N.NUM&quot;</span><span class="punctuation">:</span> <span class="string">&quot;數字是&#123;&#123;num&#125;&#125;個&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// en-US</span></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;GENERAL.I18N.CHINESE&quot;</span><span class="punctuation">:</span> <span class="string">&quot;English&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;GENERAL.I18N.PRO.APPLY&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Try now&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;GENERAL.I18N.NUM&quot;</span><span class="punctuation">:</span> <span class="string">&quot;The Num is &#123;&#123;num&#125;&#125;&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ja-JP</span></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;GENERAL.I18N.CHINESE&quot;</span><span class="punctuation">:</span> <span class="string">&quot;日本语&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;GENERAL.I18N.PRO.APPLY&quot;</span><span class="punctuation">:</span> <span class="string">&quot;すぐに試用する&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;GENERAL.I18N.NUM&quot;</span><span class="punctuation">:</span> <span class="string">&quot;数字は&#123;&#123;num&#125;&#125;つあります&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="2）国际化配置"><a href="#2）国际化配置" class="headerlink" title="2）国际化配置"></a>2）国际化配置</h3><h4 id="2-1）app-module-ts"><a href="#2-1）app-module-ts" class="headerlink" title="2.1）app.module.ts"></a>2.1）app.module.ts</h4><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 配置国际化翻译文件</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="variable constant_">ALAIN_I18N_TOKEN</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@delon/theme&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">TranslateLoader</span>, <span class="title class_">TranslateModule</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@ngx-translate/core&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">TranslateHttpLoader</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@ngx-translate/http-loader&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; I18NService &#125; <span class="keyword">from</span> <span class="string">&#x27;../app/core/i18n/i18n.service&#x27;</span>;</span><br><span class="line"><span class="comment">// 动态加载i18n语言文件</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">I18nHttpLoaderFactory</span>(<span class="params">http: HttpClient</span>): <span class="built_in">any</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">TranslateHttpLoader</span>(http, <span class="string">`assets/i18n/`</span>, <span class="string">&#x27;.json&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 注入的模块</span></span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">I18NSERVICE_MODULES</span> = [</span><br><span class="line">    <span class="title class_">TranslateModule</span>.<span class="title function_">forRoot</span>(&#123;</span><br><span class="line">        <span class="attr">loader</span>: &#123;</span><br><span class="line">            <span class="attr">provide</span>: <span class="title class_">TranslateLoader</span>, </span><br><span class="line">            <span class="attr">useFactory</span>: I18nHttpLoaderFactory, <span class="comment">// 使用I18nHttpLoaderFactory来加载文件</span></span><br><span class="line">            <span class="attr">deps</span>: [<span class="title class_">HttpClient</span>],</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;),</span><br><span class="line">];</span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">I18NSERVICE_PROVIDES</span> = [&#123; <span class="attr">provide</span>: <span class="variable constant_">ALAIN_I18N_TOKEN</span>, <span class="attr">useClass</span>: I18NService, <span class="attr">multi</span>: <span class="literal">false</span> &#125;];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 以下省略了无关模块的引入</span></span><br><span class="line"><span class="meta">@NgModule</span>(&#123;</span><br><span class="line">    <span class="attr">imports</span>: [</span><br><span class="line">        ...<span class="variable constant_">I18NSERVICE_MODULES</span>,</span><br><span class="line">    ],</span><br><span class="line">    <span class="attr">providers</span>: [</span><br><span class="line">        ...<span class="variable constant_">I18NSERVICE_PROVIDES</span>,</span><br><span class="line">    ],</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>ps:<code>@delon/*</code> 类库有许多带有 <em>i18n</em> 字样的数据接口属性（例如：<code>page-header</code>、<code>st</code> 列描述、<code>Menu</code> 菜单数据等等），当你希望这些组件的数据接口能动态根据 Key 值按当前语言自动切换时，你还需要对 <code>ALAIN_I18N_TOKEN</code> 定义一个自实现服务接口（例如：<a href="https://github.com/ng-alain/ng-alain/blob/master/src/app/core/i18n/i18n.service.ts">I18NService</a>），并在根模块下注册。</p><h4 id="2-2）请求拦截修改"><a href="#2-2）请求拦截修改" class="headerlink" title="2.2）请求拦截修改"></a>2.2）请求拦截修改</h4><p>在src&#x2F;app&#x2F;core&#x2F;net&#x2F;default.interceptor.ts下对<strong>intercept</strong>方法做进一步的拦截修改，完整代码如下：</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">intercept</span>(<span class="attr">req</span>: <span class="title class_">HttpRequest</span>&lt;<span class="built_in">any</span>&gt;, <span class="attr">next</span>: <span class="title class_">HttpHandler</span>): <span class="title class_">Observable</span>&lt;<span class="title class_">HttpEvent</span>&lt;<span class="built_in">any</span>&gt;&gt; &#123;</span><br><span class="line"><span class="comment">// 统一加上服务端前缀</span></span><br><span class="line"><span class="keyword">const</span> jwtModel = <span class="variable language_">this</span>.<span class="property">tokenService</span>.<span class="property">get</span>&lt;<span class="title class_">JWTTokenModel</span>&gt;(<span class="title class_">JWTTokenModel</span>);</span><br><span class="line"><span class="keyword">let</span> url = req.<span class="property">url</span>;</span><br><span class="line"><span class="keyword">if</span> (url.<span class="title function_">indexOf</span>(<span class="string">&#x27;assets&#x27;</span>) !== -<span class="number">1</span>) &#123;   <span class="comment">// 为了国际化调取json文件准备的 </span></span><br><span class="line">url = url;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="keyword">if</span> (!url.<span class="title function_">startsWith</span>(<span class="string">&#x27;https://&#x27;</span>) &amp;&amp; !url.<span class="title function_">startsWith</span>(<span class="string">&#x27;http://&#x27;</span>)) &#123;</span><br><span class="line">url = environment.<span class="property">SERVER_URL</span> + url;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> newReq = req.<span class="title function_">clone</span>(&#123; url &#125;);</span><br><span class="line"><span class="keyword">if</span> (jwtModel.<span class="property">token</span>) &#123;</span><br><span class="line">newReq = req.<span class="title function_">clone</span>(&#123;</span><br><span class="line">url, <span class="attr">setHeaders</span>: &#123;</span><br><span class="line"><span class="title class_">Authorization</span>: <span class="string">`Bearer <span class="subst">$&#123;jwtModel.token&#125;</span>`</span></span><br><span class="line">&#125;,</span><br><span class="line">&#125;);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> next.<span class="title function_">handle</span>(newReq).<span class="title function_">pipe</span>(</span><br><span class="line"><span class="title function_">mergeMap</span>(<span class="function">(<span class="params">ev</span>) =&gt;</span> &#123;</span><br><span class="line"><span class="comment">// 允许统一对请求错误处理</span></span><br><span class="line"><span class="keyword">if</span> (ev <span class="keyword">instanceof</span> <span class="title class_">HttpResponseBase</span>) &#123; <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">handleData</span>(ev, newReq, next); &#125;</span><br><span class="line"><span class="comment">// 若一切都正常，则后续操作</span></span><br><span class="line"><span class="keyword">return</span> <span class="title function_">of</span>(ev);</span><br><span class="line">&#125;),</span><br><span class="line"><span class="title function_">catchError</span>(<span class="function">(<span class="params">err: HttpErrorResponse</span>) =&gt;</span> <span class="variable language_">this</span>.<span class="title function_">handleData</span>(err, newReq, next)),</span><br><span class="line">);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="2-3）startup-service-ts"><a href="#2-3）startup-service-ts" class="headerlink" title="2.3）startup.service.ts"></a>2.3）startup.service.ts</h4><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">HttpClient</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@angular/common/http&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Inject</span>, <span class="title class_">Injectable</span>, <span class="title class_">Injector</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@angular/core&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Router</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@angular/router&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">ACLService</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@delon/acl&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="variable constant_">DA_SERVICE_TOKEN</span>, <span class="title class_">ITokenService</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@delon/auth&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="variable constant_">ALAIN_I18N_TOKEN</span>, <span class="title class_">MenuService</span>, <span class="title class_">SettingsService</span>, <span class="title class_">TitleService</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@delon/theme&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; zip &#125; <span class="keyword">from</span> <span class="string">&#x27;rxjs&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; catchError &#125; <span class="keyword">from</span> <span class="string">&#x27;rxjs/operators&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">TranslateService</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@ngx-translate/core&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">NzIconService</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;ng-zorro-antd/icon&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="variable constant_">ICONS</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;../../../style-icons&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="variable constant_">ICONS_AUTO</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;../../../style-icons-auto&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">MyJwtModel</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;../entity/myJwtModel&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; I18NService &#125; <span class="keyword">from</span> <span class="string">&#x27;../i18n/i18n.service&#x27;</span>;</span><br><span class="line"><span class="title function_">constructor</span>(<span class="params"></span></span><br><span class="line"><span class="params">    iconSrv: NzIconService,</span></span><br><span class="line"><span class="params">    <span class="keyword">private</span> menuService: MenuService,</span></span><br><span class="line"><span class="params">    <span class="keyword">private</span> settingService: SettingsService,</span></span><br><span class="line"><span class="params">    <span class="keyword">private</span> aclService: ACLService,</span></span><br><span class="line"><span class="params">    <span class="keyword">private</span> titleService: TitleService,</span></span><br><span class="line"><span class="params">    <span class="meta">@Inject</span>(DA_SERVICE_TOKEN) <span class="keyword">private</span> tokenService: ITokenService,</span></span><br><span class="line"><span class="params">    <span class="keyword">private</span> httpClient: HttpClient,</span></span><br><span class="line"><span class="params">    <span class="keyword">private</span> injector: Injector,</span></span><br><span class="line"><span class="params">    <span class="keyword">private</span> translate: TranslateService,</span></span><br><span class="line"><span class="params">    <span class="meta">@Inject</span>(ALAIN_I18N_TOKEN) <span class="keyword">private</span> i18n: I18NService,</span></span><br><span class="line"><span class="params">    </span>) &#123;</span><br><span class="line">         iconSrv.<span class="title function_">addIcon</span>(...<span class="variable constant_">ICONS_AUTO</span>, ...<span class="variable constant_">ICONS</span>);</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="title function_">viaMock</span>(<span class="attr">resolve</span>: <span class="built_in">any</span>, <span class="attr">reject</span>: <span class="built_in">any</span>): <span class="built_in">any</span> &#123;</span><br><span class="line">    <span class="comment">// 这是之前配置的用户权限代码</span></span><br><span class="line">    <span class="keyword">const</span> <span class="variable constant_">ACLS</span> = <span class="variable language_">this</span>.<span class="property">tokenService</span>.<span class="title function_">get</span>(<span class="title class_">MyJwtModel</span>).<span class="property">user</span>;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable constant_">ACLS</span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> role = <span class="variable constant_">ACLS</span>.<span class="property">roleCode</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">aclService</span>.<span class="title function_">setRole</span>([role]);  <span class="comment">// 设置用户身份</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 刚启动时，根据当前语言环境请求对应的json文件</span></span><br><span class="line">    <span class="keyword">let</span> language = <span class="string">&#x27;zh-CN&#x27;</span>;</span><br><span class="line">    <span class="keyword">let</span> lang = <span class="string">&#x27;简体中文&#x27;</span>;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="variable language_">this</span>.<span class="property">settingService</span>.<span class="property">layout</span>.<span class="property">lang</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (navigator.<span class="property">language</span>.<span class="title function_">startsWith</span>(<span class="string">&#x27;zh&#x27;</span>)) &#123;</span><br><span class="line">            language = <span class="string">&#x27;zh-CN&#x27;</span>;</span><br><span class="line">            lang = <span class="string">&#x27;简体中文&#x27;</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (navigator.<span class="property">language</span>.<span class="title function_">startsWith</span>(<span class="string">&#x27;en&#x27;</span>)) &#123;</span><br><span class="line">            language = <span class="string">&#x27;en-US&#x27;</span>;</span><br><span class="line">            lang = <span class="string">&#x27;English&#x27;</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            language = <span class="string">&#x27;zh-CN&#x27;</span>;</span><br><span class="line">            lang = <span class="string">&#x27;简体中文&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        language = <span class="variable language_">this</span>.<span class="property">settingService</span>.<span class="property">layout</span>.<span class="property">lang</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    (<span class="variable language_">this</span>.<span class="property">httpClient</span>.<span class="title function_">get</span>(<span class="string">`assets/i18n/<span class="subst">$&#123;language&#125;</span>.json?nocache=<span class="subst">$&#123;<span class="keyword">new</span> <span class="built_in">Date</span>().getTime()&#125;</span>`</span>) <span class="keyword">as</span> <span class="built_in">any</span>) <span class="comment">// 类型推导 要不然subscribe订阅方法会警告</span></span><br><span class="line">        .<span class="title function_">subscribe</span>(<span class="function"><span class="params">langData</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// 只要启动应用, 就无条件加载翻译文件</span></span><br><span class="line">        <span class="comment">// setting language data</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">translate</span>.<span class="title function_">setTranslation</span>(language, langData);</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">translate</span>.<span class="title function_">setDefaultLang</span>(language);</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">i18n</span>.<span class="title function_">use</span>(language);</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">settingService</span>.<span class="title function_">setLayout</span>(<span class="string">&#x27;lang&#x27;</span>, language);</span><br><span class="line">        <span class="title function_">resolve</span>(&#123;&#125;);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 在真实环境下，以下代码没用</span></span><br><span class="line">    <span class="comment">// mock</span></span><br><span class="line">    <span class="keyword">const</span> <span class="attr">app</span>: <span class="built_in">any</span> = &#123;</span><br><span class="line">        <span class="attr">name</span>: <span class="string">`ng-alain`</span>,</span><br><span class="line">        <span class="attr">description</span>: <span class="string">`Ng-zorro admin panel front-end framework`</span></span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">const</span> <span class="attr">user</span>: <span class="built_in">any</span> = &#123;</span><br><span class="line">        <span class="attr">name</span>: <span class="string">&#x27;Admin&#x27;</span>,</span><br><span class="line">        <span class="attr">avatar</span>: <span class="string">&#x27;./assets/tmp/img/avatar.jpg&#x27;</span>,</span><br><span class="line">        <span class="attr">email</span>: <span class="string">&#x27;cipchk@qq.com&#x27;</span>,</span><br><span class="line">        <span class="attr">token</span>: <span class="string">&#x27;123456789&#x27;</span></span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="comment">// Application information: including site name, description, year</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">settingService</span>.<span class="title function_">setApp</span>(app);</span><br><span class="line">    <span class="comment">// User information: including name, avatar, email address</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">settingService</span>.<span class="title function_">setUser</span>(user);</span><br><span class="line">    <span class="comment">// ACL: Set the permissions to full, https://ng-alain.com/acl/getting-started</span></span><br><span class="line">    <span class="comment">// this.aclService.setFull(false);</span></span><br><span class="line">    <span class="comment">// Menu data, https://ng-alain.com/theme/menu</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">menuService</span>.<span class="title function_">add</span>([</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">text</span>: <span class="string">&#x27;Main&#x27;</span>,</span><br><span class="line">            <span class="attr">group</span>: <span class="literal">true</span>,</span><br><span class="line">            <span class="attr">children</span>: [</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="attr">text</span>: <span class="string">&#x27;Dashboard&#x27;</span>,</span><br><span class="line">                    <span class="attr">link</span>: <span class="string">&#x27;/dashboard&#x27;</span>,</span><br><span class="line">                    <span class="attr">icon</span>: &#123; <span class="attr">type</span>: <span class="string">&#x27;icon&#x27;</span>, <span class="attr">value</span>: <span class="string">&#x27;appstore&#x27;</span> &#125;</span><br><span class="line">                &#125;,</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="attr">text</span>: <span class="string">&#x27;Quick Menu&#x27;</span>,</span><br><span class="line">                    <span class="attr">icon</span>: &#123; <span class="attr">type</span>: <span class="string">&#x27;icon&#x27;</span>, <span class="attr">value</span>: <span class="string">&#x27;rocket&#x27;</span> &#125;,</span><br><span class="line">                    <span class="attr">shortcutRoot</span>: <span class="literal">true</span></span><br><span class="line">                &#125;</span><br><span class="line">            ]</span><br><span class="line">        &#125;</span><br><span class="line">    ]);</span><br><span class="line">    <span class="comment">// Can be set page suffix title, https://ng-alain.com/theme/title</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">titleService</span>.<span class="property">suffix</span> = app.<span class="property">name</span>;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">resolve</span>(&#123;&#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="2-4）shared-module-ts"><a href="#2-4）shared-module-ts" class="headerlink" title="2.4）shared.module.ts"></a>2.4）shared.module.ts</h4><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">TranslateModule</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@ngx-translate/core&#x27;</span>;   <span class="comment">// 页面上可以使用translate管道</span></span><br><span class="line"><span class="meta">@NgModule</span>(&#123;</span><br><span class="line">    <span class="attr">exports</span>: [</span><br><span class="line">        <span class="title class_">TranslateModule</span>,</span><br><span class="line">    ]</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h3 id="3）页面引用"><a href="#3）页面引用" class="headerlink" title="3）页面引用"></a>3）页面引用</h3><p>以下为偷懒写法：</p><p>在src&#x2F;app&#x2F;routes&#x2F;example02&#x2F;example02.component.html中添加：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span> *<span class="attr">ngFor</span>=<span class="string">&quot;let item of langs&quot;</span> (<span class="attr">click</span>)=<span class="string">&quot;change(item.code)&quot;</span> <span class="attr">style</span>=<span class="string">&quot;width: 120px;height: 36px;cursor: pointer;&quot;</span>&gt;</span></span><br><span class="line">        &#123;&#123; item.text &#125;&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>&#123;&#123;&#x27;GENERAL.I18N.PRO.APPLY&#x27;|translate&#125;&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h3</span>&gt;</span>当前语言为-------&#123;&#123;&#x27;GENERAL.I18N.CHINESE&#x27;|translate&#125;&#125; <span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br></pre></td></tr></table></figure><p>在login.component.ts中添加代码如下：</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Component</span>, <span class="title class_">Inject</span>, <span class="title class_">OnInit</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@angular/core&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="variable constant_">ALAIN_I18N_TOKEN</span>, <span class="title class_">SettingsService</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@delon/theme&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; I18NService &#125; <span class="keyword">from</span> <span class="string">&#x27;src/app/core/i18n/i18n.service&#x27;</span>; </span><br><span class="line"></span><br><span class="line"><span class="keyword">get</span> <span class="title function_">langs</span>(): <span class="built_in">any</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">i18n</span>.<span class="title function_">getLangs</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">constructor</span>(<span class="params"></span></span><br><span class="line"><span class="params"><span class="meta">@Inject</span>(ALAIN_I18N_TOKEN) <span class="keyword">private</span> i18n: I18NService,</span></span><br><span class="line"><span class="params"><span class="keyword">private</span> settings: SettingsService</span></span><br><span class="line"><span class="params"></span>) &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">change</span>(<span class="attr">lang</span>: <span class="built_in">string</span>): <span class="built_in">void</span> &#123;</span><br><span class="line"><span class="variable language_">this</span>.<span class="property">i18n</span>.<span class="title function_">use</span>(lang);</span><br><span class="line"><span class="variable language_">this</span>.<span class="property">settings</span>.<span class="title function_">setLayout</span>(<span class="string">&#x27;lang&#x27;</span>, lang);</span><br><span class="line"><span class="keyword">const</span> currentLang = <span class="variable language_">this</span>.<span class="property">i18n</span>.<span class="property">currentLang</span>; <span class="comment">// 获取当前语言</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(currentLang);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="4）效果演示"><a href="#4）效果演示" class="headerlink" title="4）效果演示"></a>4）效果演示</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/rainlotus97/images/data/2024-01-27/%E5%9B%BD%E9%99%85%E5%8C%96-3a4fbd.gif"></p>]]></content>
      
      
      <categories>
          
          <category> Angular </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Angular </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>实用js函数</title>
      <link href="/2021/01/13/%E5%AE%9E%E7%94%A8js%E5%87%BD%E6%95%B0/"/>
      <url>/2021/01/13/%E5%AE%9E%E7%94%A8js%E5%87%BD%E6%95%B0/</url>
      
        <content type="html"><![CDATA[<h1 id="一、判断密码强度"><a href="#一、判断密码强度" class="headerlink" title="一、判断密码强度"></a>一、判断密码强度</h1><h2 id="1-纯js部分"><a href="#1-纯js部分" class="headerlink" title="1.纯js部分"></a>1.纯js部分</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"> progStatus = <span class="number">0</span>;             <span class="comment">// 当前包含的种类</span></span><br><span class="line"> correctTypePwd = <span class="literal">false</span>;     <span class="comment">// 当密码种类超过两种时为true，纯数字或者字母则为false</span></span><br><span class="line"> valueLength = <span class="number">0</span>;            <span class="comment">// 当前输入的密码长度</span></span><br><span class="line">---------------------------------------------</span><br><span class="line"></span><br><span class="line"><span class="comment">// 校验密码强度</span></span><br><span class="line">  <span class="title function_">checkPwdStrongth</span>(<span class="params">value</span>) &#123;    </span><br><span class="line">    <span class="keyword">const</span> arr = [];</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">progStatus</span>=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span> (value) &#123;</span><br><span class="line">      <span class="keyword">if</span> (value.<span class="property">length</span> &lt; <span class="number">8</span>) &#123;<span class="comment">// 最初级别 密码小于8位</span></span><br><span class="line">        <span class="keyword">return</span> arr;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> (<span class="regexp">/\d/</span>.<span class="title function_">test</span>(value)) &#123;<span class="comment">// 如果用户输入的密码 包含了数字</span></span><br><span class="line">        arr.<span class="title function_">push</span>(<span class="number">1</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> (<span class="regexp">/[a-z]/</span>.<span class="title function_">test</span>(value)) &#123;<span class="comment">// 如果用户输入的密码 包含了小写的a到z</span></span><br><span class="line">        arr.<span class="title function_">push</span>(<span class="number">2</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> (<span class="regexp">/[A-Z]/</span>.<span class="title function_">test</span>(value)) &#123;<span class="comment">// 如果用户输入的密码 包含了大写的A到Z</span></span><br><span class="line">        arr.<span class="title function_">push</span>(<span class="number">3</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> (<span class="regexp">/\W/</span>.<span class="title function_">test</span>(value)) &#123;<span class="comment">// 如果是非数字 字母 下划线</span></span><br><span class="line">        arr.<span class="title function_">push</span>(<span class="number">4</span>);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">progStatus</span>=arr.<span class="property">length</span>; </span><br><span class="line">    <span class="keyword">if</span> (value) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">valueLength</span>=value.<span class="property">length</span>;   </span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(arr)!==<span class="string">&#x27;[]&#x27;</span> &amp;&amp; arr.<span class="property">length</span>&gt;=<span class="number">2</span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">correctTypePwd</span>=<span class="literal">true</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">correctTypePwd</span>=<span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> arr;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">passwordstrength</span>(<span class="params">value</span>) &#123;</span><br><span class="line">  <span class="comment">// 复合判断密码强弱 根据实际情况修改</span></span><br><span class="line">  <span class="keyword">if</span>(!<span class="variable language_">this</span>.<span class="property">correctTypePwd</span>)&#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;密码不满足要求&#x27;</span>);    <span class="comment">// 当前要求为密码位数大于等于8位，且最少有两种组合</span></span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 判断密码强弱的模板，可据实际情况修改。</span></span><br><span class="line">  <span class="comment">// 当前判断根据是:密码小于8位为不合格，纯数字或字母为1，两种为2，依次类推</span></span><br><span class="line">  <span class="keyword">const</span> flag = <span class="variable language_">this</span>.<span class="title function_">checkPwdStrongth</span>(value);</span><br><span class="line">  <span class="keyword">switch</span> (flag.<span class="property">length</span>) &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;密码太弱&#x27;</span>);</span><br><span class="line">      <span class="keyword">break</span>; <span class="comment">//可选</span></span><br><span class="line">    <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;密码中&#x27;</span>);</span><br><span class="line">      <span class="keyword">break</span>; <span class="comment">//可选</span></span><br><span class="line">    <span class="keyword">case</span> <span class="number">3</span>:</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;密码中上&#x27;</span>);</span><br><span class="line">      <span class="keyword">break</span>; <span class="comment">//可选</span></span><br><span class="line">    <span class="keyword">case</span> <span class="number">4</span>:</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;密码强&#x27;</span>);</span><br><span class="line">      <span class="keyword">break</span>; <span class="comment">//可选</span></span><br><span class="line"></span><br><span class="line">    <span class="attr">default</span>: <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;密码不合格&#x27;</span>);</span><br><span class="line">    <span class="comment">//语句</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="2-在angular中的实例演示"><a href="#2-在angular中的实例演示" class="headerlink" title="2.在angular中的实例演示"></a>2.在angular中的实例演示</h2><h3 id="2-1-html部分"><a href="#2-1-html部分" class="headerlink" title="2.1 html部分"></a>2.1 html部分</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- </span></span><br><span class="line"><span class="comment">代码重点：</span></span><br><span class="line"><span class="comment">1. 使用Popover气泡卡片 nz-popover</span></span><br><span class="line"><span class="comment">2. nzPopoverTrigger=&quot;focus&quot;          // 气泡卡片通过focus触发</span></span><br><span class="line"><span class="comment">3. [nzPopoverContent]=&quot;pwdCdkTpl&quot;    // 气泡卡片的内容是标记为#pwdCdkTpl的元素</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">nz-input-group</span></span></span><br><span class="line"><span class="tag">  <span class="attr">nzSize</span>=<span class="string">&quot;large&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">nz-popover</span></span></span><br><span class="line"><span class="tag">  <span class="attr">nzPopoverTrigger</span>=<span class="string">&quot;focus&quot;</span></span></span><br><span class="line"><span class="tag">  [<span class="attr">nzPopoverContent</span>]=<span class="string">&quot;pwdCdkTpl&quot;</span></span></span><br><span class="line"><span class="tag">&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">input</span> <span class="attr">nz-input</span> <span class="attr">type</span>=<span class="string">&quot;password&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;新密码&quot;</span> </span></span><br><span class="line"><span class="tag">         [<span class="attr">ngClass</span>]=<span class="string">&quot;&#123;&#x27;error-pwd&#x27;: !correctTypePwd&amp;&amp;valueLength&gt;=8&#125;&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">nz-input-group</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">ng-template</span> #<span class="attr">pwdCdkTpl</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;padding: 4px 0;&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ng-container</span> [<span class="attr">ngSwitch</span>]=<span class="string">&quot;status&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> *<span class="attr">ngSwitchCase</span>=<span class="string">&quot;&#x27;ok&#x27;&quot;</span> <span class="attr">class</span>=<span class="string">&quot;success&quot;</span>&gt;</span>强度：强<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> *<span class="attr">ngSwitchCase</span>=<span class="string">&quot;&#x27;pass&#x27;&quot;</span> <span class="attr">class</span>=<span class="string">&quot;warning&quot;</span>&gt;</span>强度：中<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> *<span class="attr">ngSwitchCase</span>=<span class="string">&quot;&#x27;pooler&#x27;&quot;</span> <span class="attr">class</span>=<span class="string">&quot;error&quot;</span>&gt;</span>强度：弱<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> *<span class="attr">ngSwitchDefault</span> <span class="attr">class</span>=<span class="string">&quot;error&quot;</span>&gt;</span>强度：太短<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">ng-container</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ul</span> <span class="attr">class</span>=<span class="string">&quot;progress-status&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">li</span> [<span class="attr">ngClass</span>]=<span class="string">&quot;&#123;&#x27;errorColor&#x27;: progStatus===0||progStatus===1,&#x27;passColor&#x27;:progStatus===2,&#x27;okColor&#x27;:progStatus&gt;2&amp;&amp;progStatus&lt;5&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">li</span> *<span class="attr">ngFor</span>=<span class="string">&quot;let item of perfectStatus;let key=index&quot;</span>  [<span class="attr">ngClass</span>]=<span class="string">&quot;&#123;&#x27;grayColor&#x27;:progStatus===0,&#x27;errorColor&#x27;: key&lt;1&amp;&amp;progStatus===1,&#x27;passColor&#x27;:key&lt;2&amp;&amp;progStatus===2,&#x27;okColorS&#x27;:key&lt;3&amp;&amp;progStatus===3,&#x27;okColor&#x27;:key&lt;4&amp;&amp;progStatus===4&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;pTip&quot;</span>&gt;</span>请至少输入 8 个字符,同时包含字母和数字<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ng-template</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="2-2-ts部分"><a href="#2-2-ts部分" class="headerlink" title="2.2 ts部分"></a>2.2 ts部分</h3><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br></pre></td><td class="code"><pre><span class="line">status = <span class="string">&#x27;pool&#x27;</span>;</span><br><span class="line">perfectStatus = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>];  <span class="comment">// 强度种类数组</span></span><br><span class="line">progStatus = <span class="number">0</span>;             <span class="comment">// 当前包含的种类</span></span><br><span class="line">correctTypePwd = <span class="literal">false</span>;     <span class="comment">// 当密码种类超过两种时为true，纯数字或者字母则为false</span></span><br><span class="line">valueLength = <span class="number">0</span>;            <span class="comment">// 当前输入的密码长度</span></span><br><span class="line"></span><br><span class="line"> <span class="comment">//  不能直接复制使用 仅供了解</span></span><br><span class="line">  <span class="keyword">static</span> <span class="title function_">checkPassword</span>(<span class="params">control: FormControl</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (!control) <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">const</span> <span class="attr">self</span>: <span class="built_in">any</span> = <span class="variable language_">this</span>;</span><br><span class="line">    self.<span class="property">visible</span> = !!control.<span class="property">value</span>;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">const</span> num = self.<span class="title function_">checkPwdStrongth</span>(control.<span class="property">value</span>);    </span><br><span class="line">    <span class="keyword">switch</span> (num.<span class="property">length</span>) &#123;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">        self.<span class="property">status</span> = <span class="string">&#x27;pooler&#x27;</span>;</span><br><span class="line">        <span class="keyword">break</span>; </span><br><span class="line">      <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">        self.<span class="property">status</span> = <span class="string">&#x27;pass&#x27;</span>;</span><br><span class="line">        <span class="keyword">break</span>; </span><br><span class="line">      <span class="keyword">case</span> <span class="number">3</span>:</span><br><span class="line">        self.<span class="property">status</span> = <span class="string">&#x27;ok&#x27;</span>;</span><br><span class="line">        <span class="keyword">break</span>; </span><br><span class="line">      <span class="keyword">case</span> <span class="number">4</span>:</span><br><span class="line">        self.<span class="property">status</span> = <span class="string">&#x27;ok&#x27;</span>;</span><br><span class="line">        <span class="keyword">break</span>; </span><br><span class="line">      <span class="attr">default</span>:</span><br><span class="line">        self.<span class="property">status</span> = <span class="string">&#x27;pool&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"> <span class="comment">// 校验密码强度---沒有匹配到以下級別就提示</span></span><br><span class="line">  <span class="title function_">checkPwdStrongth</span>(<span class="params">value</span>) &#123;    </span><br><span class="line">    <span class="keyword">const</span> arr = [];</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">progStatus</span>=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span> (value) &#123;</span><br><span class="line">      <span class="keyword">if</span> (value.<span class="property">length</span> &lt; <span class="number">8</span>) &#123;<span class="comment">// 最初级别</span></span><br><span class="line">        <span class="keyword">return</span> arr;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> (<span class="regexp">/\d/</span>.<span class="title function_">test</span>(value)) &#123;<span class="comment">// 如果用户输入的密码 包含了数字</span></span><br><span class="line">        arr.<span class="title function_">push</span>(<span class="number">1</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> (<span class="regexp">/[a-z]/</span>.<span class="title function_">test</span>(value)) &#123;<span class="comment">// 如果用户输入的密码 包含了小写的a到z</span></span><br><span class="line">        arr.<span class="title function_">push</span>(<span class="number">2</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> (<span class="regexp">/[A-Z]/</span>.<span class="title function_">test</span>(value)) &#123;<span class="comment">// 如果用户输入的密码 包含了大写的A到Z</span></span><br><span class="line">        arr.<span class="title function_">push</span>(<span class="number">3</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> (<span class="regexp">/\W/</span>.<span class="title function_">test</span>(value)) &#123;<span class="comment">// 如果是非数字 字母 下划线</span></span><br><span class="line">        arr.<span class="title function_">push</span>(<span class="number">4</span>);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">progStatus</span>=arr.<span class="property">length</span>; </span><br><span class="line">    <span class="keyword">if</span> (value) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">valueLength</span>=value.<span class="property">length</span>;   </span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(arr)!==<span class="string">&#x27;[]&#x27;</span> &amp;&amp; arr.<span class="property">length</span>&gt;=<span class="number">2</span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">correctTypePwd</span>=<span class="literal">true</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">correctTypePwd</span>=<span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> arr;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 仅为展示逻辑贴出代码，重点只有涉及到this.correctTypePwd部分</span></span><br><span class="line">  <span class="title function_">submit</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">saveLoading</span> = <span class="literal">true</span>; <span class="comment">// 保存的 Loading</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">error</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    <span class="title class_">Object</span>.<span class="title function_">keys</span>(<span class="variable language_">this</span>.<span class="property">form</span>.<span class="property">controls</span>).<span class="title function_">forEach</span>(<span class="function"><span class="params">key</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">form</span>.<span class="property">controls</span>[key].<span class="title function_">markAsDirty</span>();</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">form</span>.<span class="property">controls</span>[key].<span class="title function_">updateValueAndValidity</span>();</span><br><span class="line">    &#125;);</span><br><span class="line">      </span><br><span class="line">    <span class="comment">// 当表单不正确的时候，或者正确了但是密码不符合要求时，return结束</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">form</span>.<span class="property">invalid</span> || !<span class="variable language_">this</span>.<span class="property">correctTypePwd</span>) &#123;  </span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">saveLoading</span> = <span class="literal">false</span>; <span class="comment">// 保存的 Loading</span></span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="keyword">const</span> data = <span class="variable language_">this</span>.<span class="property">form</span>.<span class="property">value</span>;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">http</span>.<span class="title function_">post</span>(<span class="title class_">ServicesModule</span>.<span class="title function_">getBackendUrl</span>() + <span class="string">&#x27;/password?_allow_anonymous=true&#x27;</span>, &#123;</span><br><span class="line">      <span class="comment">// type: this.type,</span></span><br><span class="line">      <span class="attr">email</span>: <span class="variable language_">this</span>.<span class="property">mail</span>.<span class="property">value</span>,</span><br><span class="line">      <span class="attr">password</span>: <span class="title class_">Md5</span>.<span class="title function_">hashStr</span>(<span class="variable language_">this</span>.<span class="property">password</span>.<span class="property">value</span>),</span><br><span class="line">      <span class="comment">// password: this.password.value,</span></span><br><span class="line">      <span class="attr">verifyCode</span>: <span class="variable language_">this</span>.<span class="property">verifyCode</span>.<span class="property">value</span></span><br><span class="line">    &#125;).<span class="title function_">subscribe</span>(<span class="function">(<span class="params">res: <span class="built_in">any</span></span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">saveLoading</span> = <span class="literal">false</span>; <span class="comment">// 保存的 Loading</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="title function_">delCookie</span>(<span class="string">&quot;ModifycodeTime&quot;</span>)</span><br><span class="line">      <span class="keyword">if</span> (res.<span class="property">code</span> !== <span class="string">&#x27;0000&#x27;</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">error</span> = res.<span class="property">message</span>;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">msg</span>.<span class="title function_">create</span>(<span class="string">&#x27;success&#x27;</span>, <span class="string">`保存成功！`</span>);</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">delCookie</span>(<span class="string">&quot;ModifycodeTime&quot;</span>)</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">count</span> = <span class="number">0</span>;</span><br><span class="line">        <span class="comment">// routerLink=&quot;/passport/login&quot;</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">router</span>.<span class="title function_">navigate</span>([<span class="string">&#x27;/passport/login&#x27;</span>], &#123;</span><br><span class="line">          <span class="attr">queryParams</span>: &#123;</span><br><span class="line">            <span class="comment">// wordName: &#x27;&#x27;,</span></span><br><span class="line">            <span class="comment">// keyword: this.inputValue,</span></span><br><span class="line">            <span class="comment">// filterKeyword: &#x27;&#x27;,</span></span><br><span class="line">          &#125;,</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;保存成功！&#x27;</span>);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><h3 id="2-3-less部分"><a href="#2-3-less部分" class="headerlink" title="2.3 less部分"></a>2.3 less部分</h3><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.progress-status</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">  <span class="attribute">margin-top</span>: <span class="number">6px</span>;</span><br><span class="line">  <span class="selector-tag">li</span> &#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">35px</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">4px</span>;</span><br><span class="line">    <span class="attribute">border-radius</span>: <span class="number">1px</span>;</span><br><span class="line">    <span class="attribute">background</span>: <span class="number">#ebedf0</span>;</span><br><span class="line">    <span class="attribute">margin-right</span>: <span class="number">5px</span>;</span><br><span class="line">    <span class="selector-tag">&amp;</span><span class="selector-pseudo">:nth-of-type</span>(<span class="number">1</span>)&#123;</span><br><span class="line">      <span class="attribute">background</span>: <span class="number">#f5222d</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.errorColor</span>&#123;</span><br><span class="line">  <span class="attribute">background</span>: <span class="number">#f5222d</span> <span class="meta">!important</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.passColor</span>&#123;</span><br><span class="line">  <span class="attribute">background</span>: <span class="number">#faad14</span> <span class="meta">!important</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.okColor</span>&#123;</span><br><span class="line">  <span class="attribute">background</span>: <span class="number">#52c41a</span> <span class="meta">!important</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.grayColor</span>&#123;</span><br><span class="line">  <span class="attribute">background</span>: <span class="number">#ebedf0</span> <span class="meta">!important</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.okColorS</span> &#123;</span><br><span class="line">  <span class="attribute">background</span>: <span class="number">#52c41a</span> <span class="meta">!important</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.error-pwd</span>&#123;</span><br><span class="line">  <span class="attribute">border-color</span>: <span class="number">#f5222d</span> <span class="meta">!important</span>;</span><br><span class="line">  <span class="attribute">outline</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">box-shadow</span>: <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">2px</span> <span class="built_in">rgba</span>(<span class="number">245</span>, <span class="number">34</span>, <span class="number">45</span>, <span class="number">0.2</span>) <span class="meta">!important</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.pTip</span>&#123;</span><br><span class="line">  <span class="attribute">margin</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">margin-top</span>: <span class="number">13px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-4-实际演示效果"><a href="#2-4-实际演示效果" class="headerlink" title="2.4 实际演示效果"></a>2.4 实际演示效果</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/rainlotus97/images/data/2024-01-27/%E5%AF%86%E7%A0%81%E5%BC%BA%E5%BA%A6-9e3486.gif"></p><h1 id="二、保留小数点后两位（强制）"><a href="#二、保留小数点后两位（强制）" class="headerlink" title="二、保留小数点后两位（强制）"></a>二、保留小数点后两位（强制）</h1><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">accuracyPoint</span>(<span class="params">data</span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> <span class="attr">value</span>:<span class="built_in">any</span> = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">let</span> pointNum;</span><br><span class="line">  <span class="keyword">const</span> <span class="built_in">number</span> = <span class="title class_">Math</span>.<span class="title function_">round</span>(data * <span class="number">100</span>) / <span class="number">100.00000</span> + <span class="string">&#x27;&#x27;</span>;  <span class="comment">// 第一次数据处理，保留两位小数</span></span><br><span class="line">  <span class="keyword">const</span> num2 = <span class="built_in">number</span>.<span class="title function_">split</span>(<span class="string">&#x27;.&#x27;</span>);         <span class="comment">//  将数值以 . 隔开</span></span><br><span class="line">  <span class="keyword">if</span> (num2[<span class="number">1</span>] &amp;&amp; num2[<span class="number">1</span>] &gt; <span class="string">&#x27;10&#x27;</span>) &#123;        <span class="comment">//  小数点后数值存在，且字符串大小在10~99之间</span></span><br><span class="line">    <span class="keyword">const</span> pointNum2 = <span class="built_in">parseInt</span>(num2[<span class="number">1</span>], <span class="number">10</span>);</span><br><span class="line">    <span class="keyword">if</span> (pointNum2 &gt; <span class="number">10</span>) &#123;                    <span class="comment">//  小数点后数值在10~99之间</span></span><br><span class="line">      <span class="keyword">if</span> (pointNum2 % <span class="number">10</span> === <span class="number">0</span>) &#123;            <span class="comment">//  10~99能被整除</span></span><br><span class="line">        pointNum = pointNum2 + <span class="string">&#x27;0&#x27;</span>;</span><br><span class="line">        value = num2[<span class="number">0</span>] + <span class="string">&#x27;.&#x27;</span> + pointNum</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;                            <span class="comment">//  10~99不能被整除</span></span><br><span class="line">        value = num2[<span class="number">0</span>] + <span class="string">&#x27;.&#x27;</span> + pointNum2</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;                              <span class="comment">//  小数点后数值在1~9之间,个数为1</span></span><br><span class="line">      pointNum = pointNum2 + <span class="string">&#x27;0&#x27;</span>;</span><br><span class="line">      value = num2[<span class="number">0</span>] + <span class="string">&#x27;.&#x27;</span> + pointNum</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (!num2[<span class="number">1</span>]) &#123;                     <span class="comment">//  数值为整数时,个数为0</span></span><br><span class="line">      value = num2[<span class="number">0</span>] + <span class="string">&#x27;.00&#x27;</span></span><br><span class="line">  &#125;<span class="keyword">else</span> <span class="keyword">if</span> (num2[<span class="number">1</span>] &amp;&amp; num2[<span class="number">1</span>] === <span class="string">&#x27;1&#x27;</span>) &#123; </span><br><span class="line">      value = <span class="built_in">number</span>+<span class="string">&#x27;0&#x27;</span></span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;                                  <span class="comment">//  小数点后字符串数值为01~09之间</span></span><br><span class="line">      value = num2[<span class="number">0</span>] + <span class="string">&#x27;.&#x27;</span> + num2[<span class="number">1</span>];</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> value;</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure><h1 id="三、保留三位数字（逢千进位）"><a href="#三、保留三位数字（逢千进位）" class="headerlink" title="三、保留三位数字（逢千进位）"></a>三、保留三位数字（逢千进位）</h1><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 对数字处理 小于1k不作处理，大于999B则取整处理</span></span><br><span class="line"><span class="title function_">checkDataType</span>(<span class="params"><span class="built_in">number</span></span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> result;</span><br><span class="line">  <span class="keyword">if</span> (<span class="built_in">number</span> &lt; <span class="number">1000</span>) &#123;</span><br><span class="line">    result = <span class="built_in">number</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (<span class="built_in">number</span> &gt;= <span class="number">1000</span> &amp;&amp; <span class="built_in">number</span> &lt; <span class="number">1000000</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> numDelFlag = <span class="number">1000</span>;</span><br><span class="line">    result = <span class="variable language_">this</span>.<span class="title function_">getTypeInfo</span>(<span class="built_in">number</span>, numDelFlag) + <span class="string">&#x27;K&#x27;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (<span class="built_in">number</span> &gt;= <span class="number">1000000</span> &amp;&amp; <span class="built_in">number</span> &lt; <span class="number">1000000000</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> numDelFlag = <span class="number">1000000</span>;</span><br><span class="line">    result = <span class="variable language_">this</span>.<span class="title function_">getTypeInfo</span>(<span class="built_in">number</span>, numDelFlag) + <span class="string">&#x27;M&#x27;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (<span class="built_in">number</span> &gt;= <span class="number">1000000000</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> numDelFlag = <span class="number">1000000000</span>;</span><br><span class="line">    result = <span class="variable language_">this</span>.<span class="title function_">getTypeInfo</span>(<span class="built_in">number</span>, numDelFlag) + <span class="string">&#x27;B&#x27;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 规范数字只有三位数，不足补0</span></span><br><span class="line"><span class="title function_">getTypeInfo</span>(<span class="params"><span class="built_in">number</span>, numDelFlag</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> numK = <span class="title class_">Math</span>.<span class="title function_">round</span>(<span class="built_in">number</span> / numDelFlag * <span class="number">100</span>) / <span class="number">100</span> + <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">  <span class="keyword">const</span> temp = numK.<span class="title function_">split</span>(<span class="string">&#x27;.&#x27;</span>)</span><br><span class="line">  <span class="keyword">const</span> numInt = <span class="built_in">parseInt</span>(temp[<span class="number">0</span>], <span class="number">10</span>);</span><br><span class="line">  <span class="keyword">const</span> numPoint = temp[<span class="number">1</span>];</span><br><span class="line">  <span class="keyword">let</span> numTemp;</span><br><span class="line">  <span class="keyword">let</span> allNum;</span><br><span class="line">  <span class="keyword">if</span> (numInt &lt; <span class="number">10</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (numPoint &amp;&amp; numPoint &gt; <span class="string">&#x27;10&#x27;</span>) &#123;</span><br><span class="line">      <span class="keyword">const</span> numPoint2 = <span class="built_in">parseInt</span>(numPoint, <span class="number">10</span>);</span><br><span class="line">      <span class="keyword">if</span> (numPoint2 &gt; <span class="number">10</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (numPoint2 % <span class="number">10</span> === <span class="number">0</span>) &#123;</span><br><span class="line">          numTemp = numPoint2 + <span class="string">&#x27;0&#x27;</span>;</span><br><span class="line">          allNum = numInt + <span class="string">&#x27;.&#x27;</span> + numTemp;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          allNum = numInt + <span class="string">&#x27;.&#x27;</span> + numPoint;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        numTemp = numPoint2 + <span class="string">&#x27;0&#x27;</span>;</span><br><span class="line">        allNum = numInt + <span class="string">&#x27;.&#x27;</span> + numTemp;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (!numPoint) &#123;</span><br><span class="line">        allNum = numInt + <span class="string">&#x27;.00&#x27;</span></span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (numPoint &amp;&amp; numPoint === <span class="string">&#x27;1&#x27;</span>) &#123;</span><br><span class="line">        numTemp = numPoint + <span class="string">&#x27;0&#x27;</span>;</span><br><span class="line">        allNum = numInt + <span class="string">&#x27;.&#x27;</span> + numTemp;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        allNum = numInt + <span class="string">&#x27;.&#x27;</span> + numPoint</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (numInt &lt; <span class="number">100</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> numberTemp = <span class="title class_">Math</span>.<span class="title function_">round</span>(<span class="built_in">number</span> / numDelFlag * <span class="number">10</span>) / <span class="number">10</span> + <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    <span class="keyword">const</span> pointTemp = numberTemp.<span class="title function_">split</span>(<span class="string">&#x27;.&#x27;</span>)[<span class="number">1</span>];</span><br><span class="line">    <span class="keyword">if</span> (pointTemp &amp;&amp; pointTemp &lt; <span class="string">&#x27;05&#x27;</span>) &#123;</span><br><span class="line">      allNum = numberTemp + <span class="string">&#x27;.0&#x27;</span></span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (!pointTemp) &#123;</span><br><span class="line">      allNum = numberTemp + <span class="string">&#x27;.0&#x27;</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      allNum = numberTemp;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> numTempo = <span class="title class_">Math</span>.<span class="title function_">round</span>(<span class="built_in">number</span> / numDelFlag);</span><br><span class="line">    allNum = numTempo;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> allNum;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>实例图演示:</strong></p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/rainlotus97/images/data/2024-01-27/%E9%80%A2%E5%8D%83%E8%BF%9B%E4%BD%8D-73d495.gif"></p><h1 id="四、常见正则表达式"><a href="#四、常见正则表达式" class="headerlink" title="四、常见正则表达式"></a>四、常见正则表达式</h1><h2 id="1-去除首尾换行符"><a href="#1-去除首尾换行符" class="headerlink" title="1.去除首尾换行符"></a>1.去除首尾换行符</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> str=str.<span class="title function_">replace</span>(<span class="regexp">/^\s+|\s+$/g</span>,<span class="string">&#x27;&#x27;</span>);</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> js </category>
          
      </categories>
      
      
        <tags>
            
            <tag> js </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>邂逅Angular</title>
      <link href="/2020/12/31/%E9%82%82%E9%80%85Angular/"/>
      <url>/2020/12/31/%E9%82%82%E9%80%85Angular/</url>
      
        <content type="html"><![CDATA[<h1 id="一、Angular配置与安装"><a href="#一、Angular配置与安装" class="headerlink" title="一、Angular配置与安装"></a>一、Angular配置与安装</h1><h2 id="1、Angular介绍"><a href="#1、Angular介绍" class="headerlink" title="1、Angular介绍"></a>1、Angular介绍</h2><p>Angular是谷歌开发的一款开源的web前端框架，诞生于2009年，由<strong>Misko Hevery</strong> 等人创建，后为Google所收购。是一款优秀的前端JS框架，已经被用于Google的多款产品当中。</p><p><strong>根据项目数统计angular（1.x 、2.x 、4.x、5.x、6.x、7.x 、8.x、9.x）是现在网上使用量最大的框架。</strong></p><p>Angular基于TypeScript和react、vue相比 Angular更适合中大型企业级项目。</p><p>目前2019年12月25日<strong>angular</strong>最新版本angular9.x。根据官方介绍，Angular每过几个月就会更新一个版本。Angular2.x以后所有的Angular版本用法都是一样的，此教程同样适用于Angular7.x 、Angular8.x、Angular9.x 以及未来的其它版本….</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/rainlotus97/images/data/2024-01-27/angular%E5%85%B3%E7%B3%BB%E5%9B%BE-e91ce6.png"></p><h2 id="2、学习Angular必备基础"><a href="#2、学习Angular必备基础" class="headerlink" title="2、学习Angular必备基础"></a>2、学习Angular必备基础</h2><p><strong>必备基础：</strong>html  、css 、js、es6</p><p>如果有Typescript基础更容易理解，没有Typescript基础也可以学此教程。此教程中用到的Typescript语法会详细讲解。</p><p><strong>Typescript基础入门教程:</strong> <a href="https://www.itying.com/goods-905.html">https://www.itying.com/goods-905.html</a></p><h2 id="3、Angular环境搭建"><a href="#3、Angular环境搭建" class="headerlink" title="3、Angular环境搭建"></a>3、Angular环境搭建</h2><p><strong>1、安装前准备工作：</strong></p><ol><li><p>1安装nodejs</p><p>安装angular的计算机上面必须安装最新的nodejs–注意安装nodejs稳定版本</p></li><li><p>2安装cnpm</p><p>npm可能安装失败建议先用npm安装一下cnpm用淘宝镜像安装</p><p><a href="https://npm.taobao.org/">https://npm.taobao.org/</a></p></li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install -g cnpm --registry=<span class="attr">https</span>:<span class="comment">//registry.npm.taobao.org</span></span><br></pre></td></tr></table></figure><p><strong>2、使用 npm&#x2F;cnpm 命令安装angular&#x2F;cli  （只需要安装一次）</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install -g @angular/cli     或者    cnpm install -g @angular/cli</span><br></pre></td></tr></table></figure><h2 id="4、Angular创建项目"><a href="#4、Angular创建项目" class="headerlink" title="4、Angular创建项目"></a>4、Angular创建项目</h2><ol><li><p><strong>打开命令行工具找到你要创建项目的目录</strong></p></li><li><p><strong>创建项目</strong></p><p>ng new 项目名称  </p><p><strong>直接安装</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ng <span class="keyword">new</span> angulardemo</span><br></pre></td></tr></table></figure><p><strong>如果要跳过npm i安装</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ng <span class="keyword">new</span> angulardemo --skip-install</span><br></pre></td></tr></table></figure><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/rainlotus97/images/data/2024-01-27/angular%E5%AE%89%E8%A3%85-11ec84.png"></p></li><li><p><strong>运行项目</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd angulardemo</span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ng serve --open</span><br></pre></td></tr></table></figure></li></ol><h2 id="5、Angular环境搭建以及创建项目的时候可能遇到的错误"><a href="#5、Angular环境搭建以及创建项目的时候可能遇到的错误" class="headerlink" title="5、Angular环境搭建以及创建项目的时候可能遇到的错误"></a>5、Angular环境搭建以及创建项目的时候可能遇到的错误</h2><ol><li><p><strong>npm安装angular&#x2F;cli失败</strong></p><p>解决方案：用 cnpm 安装</p><p> . <strong>创建项目npm i的时候失败</strong></p><p>解决方案1：ctrl+c结束项目，cd到项目里面，用 cnpm i 安装依赖</p><p>解决方案2：创建项目的时候  –skip-install </p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ng <span class="keyword">new</span> my-app --skip-install </span><br><span class="line"></span><br><span class="line">cd my-app</span><br><span class="line"></span><br><span class="line">cnpm install   /   yarn</span><br></pre></td></tr></table></figure></li><li><p><strong>创建项目后用npm i 或者 cnpm i后项目没法运行</strong></p><p>解决方案：用yarn 替代 cnpm和npm</p><p>​1.cnpm instal @angular&#x2F;cli (我的npm会报错)；</p><p>​2.ng new 的时候阻止自动安装ng包，只创建ng目录     </p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ng <span class="keyword">new</span> my-app --skip-install </span><br></pre></td></tr></table></figure><p>​3.安装yarn      npm install -g yarn  或者   cnpm install -g yarn </p><p>​4.进入目录my-app 使用yarn 安装ng所依赖的包     yarn</p><p>​<strong>注意：</strong>yarn命令等同于npm install &#x2F; cnpm install    使用yarn前提是先安装yarn,安装使用cnpm install -g yarn就可以安装</p></li></ol><h1 id="二、Angular目录与结构"><a href="#二、Angular目录与结构" class="headerlink" title="二、Angular目录与结构"></a>二、Angular目录与结构</h1><h2 id="1、目录结构分析"><a href="#1、目录结构分析" class="headerlink" title="1、目录结构分析"></a>1、目录结构分析</h2><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/rainlotus97/images/data/2024-01-27/angular%E7%9B%AE%E5%BD%95%E7%BB%93%E6%9E%84-e2fc74.png"></p><h2 id="2、app-module-ts、组件分析"><a href="#2、app-module-ts、组件分析" class="headerlink" title="2、app.module.ts、组件分析"></a>2、app.module.ts、组件分析</h2><h3 id="2-1-app-module-ts"><a href="#2-1-app-module-ts" class="headerlink" title="2.1 app.module.ts"></a>2.1 app.module.ts</h3><p>定义 AppModule，这个根模块会告诉 Angular 如何组装该应用。 目前，它只声明了 AppComponent。 稍后它还会声明更多组件。 </p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/rainlotus97/images/data/2024-01-27/app.module.ts-38a765.png"></p><h3 id="2-2-自定义组件"><a href="#2-2-自定义组件" class="headerlink" title="2.2 自定义组件"></a>2.2 自定义组件</h3><ul><li><p><strong>创建组件：</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ng g component components/header</span><br></pre></td></tr></table></figure></li><li><p><strong>组件内容详解：</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Component</span>, <span class="title class_">OnInit</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@angular/core&#x27;</span>; <span class="comment">/*引入 angular 核心*/</span></span><br><span class="line"></span><br><span class="line">@<span class="title class_">Component</span>(&#123; </span><br><span class="line"><span class="attr">selector</span>: <span class="string">&#x27;app-header&#x27;</span>, <span class="comment">/*使用这个组件的名称*/</span> </span><br><span class="line"><span class="attr">templateUrl</span>: <span class="string">&#x27;./header.component.html&#x27;</span>, <span class="comment">/*html 模板*/</span> </span><br><span class="line"><span class="attr">styleUrls</span>: [<span class="string">&#x27;./header.component.css&#x27;</span>] <span class="comment">/*css 样式*/</span> </span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">HeaderComponent</span> implements <span class="title class_">OnInit</span> &#123; <span class="comment">/*实现接口*/</span> </span><br><span class="line"><span class="title function_">constructor</span>(<span class="params"></span>) &#123; <span class="comment">/*构造函数*/</span> </span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">ngOnInit</span>(<span class="params"></span>) &#123; <span class="comment">/*初始化加载的生命周期函数*/</span> </span><br><span class="line"></span><br><span class="line">&#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><h3 id="2-3-绑定数据"><a href="#2-3-绑定数据" class="headerlink" title="2.3 绑定数据"></a>2.3 绑定数据</h3><p>Angular 中使用{ {} }绑定业务逻辑里面定义的数据</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>&#123; &#123;title&#125; &#125; <span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> [<span class="attr">innerHTML</span>]=<span class="string">&quot;h&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">title</span>:string=<span class="string">&#x27;home works&#x27;</span></span><br><span class="line"><span class="attr">h</span>:string=<span class="string">&quot;&lt;h2&gt;这是一个 h2 用[innerHTML]来解析&lt;/h2&gt;&quot;</span></span><br><span class="line"><span class="attr">id</span>:number=<span class="number">123</span></span><br><span class="line"><span class="attr">msg</span>:string=<span class="string">&#x27;你好angularjs4.0&#x27;</span></span><br></pre></td></tr></table></figure><h3 id="2-4-绑定数据"><a href="#2-4-绑定数据" class="headerlink" title="2.4 绑定数据"></a>2.4 绑定数据</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> [<span class="attr">id</span>]=<span class="string">&quot;id&quot;</span> [<span class="attr">title</span>]=<span class="string">&quot;msg&quot;</span>&gt;</span>调试工具看看我的属性<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/rainlotus97/images/data/2024-01-27/%E7%BB%91%E5%AE%9A%E5%B1%9E%E6%80%A7-cbe98e.png"></p><h2 id="3、数据循环-ngFor"><a href="#3、数据循环-ngFor" class="headerlink" title="3、数据循环 *ngFor"></a>3、数据循环 *ngFor</h2><ol><li><p>*ngFor  普通循环 </p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span> *<span class="attr">ngFor</span>=<span class="string">&quot;let item of list&quot;</span>&gt;</span> &#123; &#123;item&#125; &#125; <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>循环的时候设置 key</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span> *<span class="attr">ngFor</span>=<span class="string">&quot;let item of list;let i = index;&quot;</span>&gt;</span> &#123; &#123;item&#125; &#125; --&#123; &#123;i&#125; &#125; <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br></pre></td></tr></table></figure></li></ol><h2 id="4、条件判断-ngIf"><a href="#4、条件判断-ngIf" class="headerlink" title="4、条件判断 *ngIf"></a>4、条件判断 *ngIf</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">p</span> *<span class="attr">ngIf</span>=<span class="string">&quot;list.length&gt;3&quot;</span>&gt;</span>这是 ngIF 判断是否显示<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="5、-ngSwitch"><a href="#5、-ngSwitch" class="headerlink" title="5、*ngSwitch"></a>5、*ngSwitch</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">ul</span> [<span class="attr">ngSwitch</span>]=<span class="string">&quot;score&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span> *<span class="attr">ngSwitchCase</span>=<span class="string">&quot;1&quot;</span>&gt;</span>已支付<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span> *<span class="attr">ngSwitchCase</span>=<span class="string">&quot;2&quot;</span>&gt;</span>订单已经确认<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span> *<span class="attr">ngSwitchCase</span>=<span class="string">&quot;3&quot;</span>&gt;</span>已发货<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span> *<span class="attr">ngSwitchDefault</span>&gt;</span>无效<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="6、执行事件-click-”getData-”"><a href="#6、执行事件-click-”getData-”" class="headerlink" title="6、执行事件 (click)&#x3D;”getData()”"></a>6、执行事件 (click)&#x3D;”getData()”</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">&quot;button&quot;</span> (<span class="attr">click</span>)=<span class="string">&quot;getData()&quot;</span>&gt;</span> 点击按钮触发事件 <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">&quot;button&quot;</span> (<span class="attr">click</span>)=<span class="string">&quot;setData()&quot;</span>&gt;</span> 点击按钮设置数据 <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">getData</span>(<span class="params"></span>) &#123;</span><br><span class="line">   <span class="comment">/*自定义方法获取数据*/</span></span><br><span class="line">   <span class="comment">//获取 alert(this.msg); </span></span><br><span class="line"> &#125;</span><br><span class="line"> <span class="title function_">setData</span>(<span class="params"></span>) &#123;</span><br><span class="line">   <span class="comment">//设置值 this.msg=&#x27;这是设置的值&#x27;; </span></span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><h2 id="7、表单事件"><a href="#7、表单事件" class="headerlink" title="7、表单事件"></a>7、表单事件</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">//1.传统写法</span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> (<span class="attr">keyup</span>)=<span class="string">&quot;keyUpFn($event)&quot;</span>/&gt;</span></span><br><span class="line">2.angular推荐写法</span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> #<span class="attr">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> (<span class="attr">keyup</span>)=<span class="string">&quot;keyUpFn(input.value)&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">keyUpFn</span>(<span class="params">e</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(e)</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><h2 id="8、双向数据绑定"><a href="#8、双向数据绑定" class="headerlink" title="8、双向数据绑定"></a>8、双向数据绑定</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">input</span> [(<span class="attr">ngModel</span>)]=<span class="string">&quot;inputValue&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong>Tips</strong>:<strong>需要单独引入FormsModule</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">FormsModule</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@angular/forms&#x27;</span>;</span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">@<span class="title class_">NgModule</span>(&#123;</span><br><span class="line">  <span class="attr">declarations</span>: [</span><br><span class="line">    <span class="title class_">AppComponent</span>,</span><br><span class="line">    <span class="title class_">HomeComponent</span>,    </span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">imports</span>: [</span><br><span class="line">    <span class="title class_">BrowserModule</span>,</span><br><span class="line">    <span class="title class_">FormsModule</span></span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">providers</span>: [<span class="title class_">RequestService</span>],</span><br><span class="line">  <span class="attr">bootstrap</span>: [<span class="title class_">AppComponent</span>]</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h2 id="9、-ngClass-、-ngStyle"><a href="#9、-ngClass-、-ngStyle" class="headerlink" title="9、[ngClass]、[ngStyle]"></a>9、[ngClass]、[ngStyle]</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">1.ngClass</span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> [<span class="attr">ngClass</span>]=<span class="string">&quot;&#123;&#x27;red&#x27;: true, &#x27;blue&#x27;: false&#125;&quot;</span>&gt;</span> 这是一个 div <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">li</span> *<span class="attr">ngFor</span>=<span class="string">&quot;let item of arr, let i = index&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">span</span> [<span class="attr">ngClass</span>]=<span class="string">&quot;&#123;&#x27;red&#x27;: i==0&#125;&quot;</span>&gt;</span>&#123; &#123;item&#125; &#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line"></span><br><span class="line">2.ngStyle</span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> [<span class="attr">ngStyle</span>]=<span class="string">&quot;&#123;&#x27;background-color&#x27;:&#x27;green&#x27;&#125;&quot;</span>&gt;</span>你好 ngStyle</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> [<span class="attr">ngStyle</span>]=<span class="string">&quot;&#123;&#x27;background-color&#x27;:attr&#125;&quot;</span>&gt;</span>你好 ngStyle<span class="tag">&lt;/<span class="name">div</span>&gt;</span> //attr是个变量 public attr=red</span><br></pre></td></tr></table></figure><h2 id="10、管道"><a href="#10、管道" class="headerlink" title="10、管道"></a>10、管道</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123; &#123;today | date:&#x27;yyyy-MM-dd HH:mm:ss&#x27; &#125; &#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">public today=<span class="keyword">new</span> <span class="title class_">Date</span>();</span><br></pre></td></tr></table></figure><p><a href="http://bbs.itying.com/topic/5bf519657e9f5911d41f2a34">其他管道</a></p><h1 id="三、Angular通信"><a href="#三、Angular通信" class="headerlink" title="三、Angular通信"></a>三、Angular通信</h1><h2 id="1、angular服务"><a href="#1、angular服务" class="headerlink" title="1、angular服务"></a>1、angular服务</h2><h3 id="1-1-组件与服务关系图"><a href="#1-1-组件与服务关系图" class="headerlink" title="1.1 组件与服务关系图"></a>1.1 组件与服务关系图</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/rainlotus97/images/data/2024-01-27/%E7%BB%84%E4%BB%B6%E4%B8%8E%E6%9C%8D%E5%8A%A1-b3ac1f.png"></p><h3 id="1-2-创建服务命令"><a href="#1-2-创建服务命令" class="headerlink" title="1.2 创建服务命令"></a>1.2 创建服务命令</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ng g service my-<span class="keyword">new</span>-service</span><br><span class="line"></span><br><span class="line"><span class="comment">//创建到指定目录下面</span></span><br><span class="line">ng g service services/storage</span><br></pre></td></tr></table></figure><h3 id="1-3-app-module-ts-里面引入创建的服务"><a href="#1-3-app-module-ts-里面引入创建的服务" class="headerlink" title="1.3  app.module.ts 里面引入创建的服务"></a>1.3  app.module.ts 里面引入创建的服务</h3><ol><li><p>app.module.ts 里面引入创建的服务</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">StorageService</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;./services/storage.service&#x27;</span>;</span><br></pre></td></tr></table></figure></li><li><p>NgModule 里面的 providers 里面依赖注入服务</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">@<span class="title class_">NgModule</span>(&#123;</span><br><span class="line">  <span class="attr">declarations</span>: [</span><br><span class="line">    <span class="title class_">AppComponent</span>,</span><br><span class="line">    <span class="title class_">HomeComponent</span>,</span><br><span class="line">    <span class="title class_">HighlightDirective</span>,</span><br><span class="line">    <span class="title class_">MsgformatPipe</span></span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">imports</span>: [</span><br><span class="line">    <span class="title class_">BrowserModule</span>,</span><br><span class="line">    <span class="title class_">FormsModule</span>,</span><br><span class="line">    <span class="title class_">HttpClientModule</span></span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">providers</span>: [<span class="title class_">StorageService</span>],</span><br><span class="line">  <span class="attr">bootstrap</span>: [<span class="title class_">AppComponent</span>]</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">AppModule</span> &#123; &#125;</span><br></pre></td></tr></table></figure></li></ol><h3 id="1-4-使用的页面引入服务，注册服务"><a href="#1-4-使用的页面引入服务，注册服务" class="headerlink" title="1.4 使用的页面引入服务，注册服务"></a>1.4 使用的页面引入服务，注册服务</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">StorageService</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;../../services/storage.service&#x27;</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="title function_">constructor</span>(<span class="params">private storage: StorageService</span>) &#123; &#125;</span><br></pre></td></tr></table></figure><p>调用服务中的(属性&#x2F;方法)使用即可，例如：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">addData</span>(<span class="params"></span>)&#123;</span><br><span class="line"><span class="variable language_">this</span>.<span class="property">list</span>.<span class="title function_">push</span>(<span class="variable language_">this</span>.<span class="property">username</span>);</span><br><span class="line"><span class="variable language_">this</span>.<span class="property">storage</span>.<span class="title function_">set</span>(<span class="string">&#x27;todolist&#x27;</span>,<span class="variable language_">this</span>.<span class="property">list</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">removerData</span>(<span class="params">key</span>)&#123;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(key);</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">list</span>.<span class="title function_">splice</span>(key,<span class="number">1</span>);</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">storage</span>.<span class="title function_">set</span>(<span class="string">&#x27;todolist&#x27;</span>,<span class="variable language_">this</span>.<span class="property">list</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="四、页面监听"><a href="#四、页面监听" class="headerlink" title="四、页面监听"></a>四、页面监听</h1><p><strong>第一步：引入模块</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//  1.ElementRef需要引入</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Component</span>, <span class="title class_">OnInit</span>, <span class="title class_">ElementRef</span>, <span class="title class_">AfterViewInit</span>&#125; <span class="keyword">from</span> <span class="string">&#x27;@angular/core&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//  2.fromEvent需要引入</span></span><br><span class="line"><span class="keyword">import</span> &#123; fromEvent &#125; <span class="keyword">from</span> <span class="string">&#x27;rxjs&#x27;</span></span><br></pre></td></tr></table></figure><p><strong>第二步：注册ElementRef</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">constructor</span>(<span class="params"></span></span><br><span class="line"><span class="params">    private elementRef: ElementRef,</span></span><br><span class="line"><span class="params"></span>) &#123; &#125;</span><br></pre></td></tr></table></figure><p><strong>第三步：获取dom元素</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> dom = <span class="variable language_">this</span>.<span class="property">elementRef</span>.<span class="property">nativeElement</span>.<span class="title function_">querySelector</span>(<span class="string">&#x27;#&#123;id&#125;&#x27;</span>);</span><br></pre></td></tr></table></figure><p><strong>第四步：在ngAfterViewInit中监听元素</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">ngAfterViewInit</span>(): <span class="keyword">void</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> dom = <span class="variable language_">this</span>.<span class="title function_">getGuideElement</span>(<span class="string">&#x27;inforContent&#x27;</span>);</span><br><span class="line">    <span class="comment">// 1.监听dom元素滚动</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">subscribeScoll</span> = <span class="title function_">fromEvent</span>(dom, <span class="string">&#x27;scroll&#x27;</span>)</span><br><span class="line">      .<span class="title function_">subscribe</span>(<span class="function">(<span class="params">event</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">onWindowScroll</span>();<span class="comment">// 调用</span></span><br><span class="line">      &#125;);</span><br><span class="line">    <span class="comment">// 2.监听页面尺寸变化</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">listenWinWidth</span>=<span class="title function_">fromEvent</span>(<span class="variable language_">window</span>,<span class="string">&#x27;resize&#x27;</span>)</span><br><span class="line">    .<span class="title function_">subscribe</span>(<span class="function"><span class="params">e</span>=&gt;</span>&#123;</span><br><span class="line">      <span class="keyword">const</span> brightBlock = <span class="variable language_">this</span>.<span class="title function_">getGuideElement</span>(<span class="string">&#x27;bright&#x27;</span>)</span><br><span class="line">      <span class="keyword">const</span> introdueList = <span class="variable language_">this</span>.<span class="title function_">getGuideElement</span>(<span class="string">&#x27;introdueList&#x27;</span>)</span><br><span class="line">      <span class="keyword">const</span> triangleUp = <span class="variable language_">this</span>.<span class="title function_">getGuideElement</span>(<span class="string">&#x27;triangleUp&#x27;</span>)</span><br><span class="line">      <span class="variable language_">this</span>.<span class="title function_">getAllelementInfo</span>();</span><br><span class="line">      <span class="variable language_">this</span>.<span class="title function_">getGuidePos</span>(brightBlock, introdueList, triangleUp, <span class="variable language_">this</span>.<span class="property">introNum</span>)</span><br><span class="line">&#125;)</span><br><span class="line">    </span><br><span class="line"> <span class="comment">// 获取元素节点</span></span><br><span class="line"><span class="title function_">getGuideElement</span>(<span class="params">data</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="attr">value</span>: any = <span class="variable language_">this</span>.<span class="property">elementRef</span>.<span class="property">nativeElement</span>.<span class="title function_">querySelector</span>(<span class="string">`#<span class="subst">$&#123;data&#125;</span>`</span>);</span><br><span class="line">    <span class="keyword">return</span> value</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Angular </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Angular </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>对象数组去重</title>
      <link href="/2020/12/25/%E5%AF%B9%E8%B1%A1%E6%95%B0%E7%BB%84%E5%8E%BB%E9%87%8D/"/>
      <url>/2020/12/25/%E5%AF%B9%E8%B1%A1%E6%95%B0%E7%BB%84%E5%8E%BB%E9%87%8D/</url>
      
        <content type="html"><![CDATA[<h1 id="一、数组去重"><a href="#一、数组去重" class="headerlink" title="一、数组去重"></a>一、数组去重</h1><h2 id="1-利用ES6-Set去重（ES6中最常用）"><a href="#1-利用ES6-Set去重（ES6中最常用）" class="headerlink" title="1.利用ES6 Set去重（ES6中最常用）"></a>1.利用ES6 Set去重（ES6中最常用）</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> arr = [<span class="number">1</span>,<span class="number">1</span>,<span class="string">&#x27;true&#x27;</span>,<span class="string">&#x27;true&#x27;</span>,<span class="literal">true</span>,<span class="literal">true</span>,<span class="number">15</span>,<span class="number">15</span>,<span class="literal">false</span>,<span class="literal">false</span>, <span class="literal">undefined</span>,<span class="literal">undefined</span>, <span class="literal">null</span>,<span class="literal">null</span>, <span class="title class_">NaN</span>, <span class="title class_">NaN</span>,<span class="string">&#x27;NaN&#x27;</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;a&#x27;</span>,&#123;&#125;,&#123;&#125;];</span><br><span class="line"><span class="keyword">const</span> arr2=[...<span class="keyword">new</span> <span class="title class_">Set</span>(arr)]</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(arr2)</span><br><span class="line"> <span class="comment">//[1, &quot;true&quot;, true, 15, false, undefined, null, NaN, &quot;NaN&quot;, 0, &quot;a&quot;, &#123;&#125;, &#123;&#125;]</span></span><br></pre></td></tr></table></figure><p><strong>ps:不考虑兼容性，这种去重的方法代码最少。这种方法还无法去掉“{}”空对象，后面的高阶方法会添加去掉重复“{}”的方法。</strong></p><p><strong>动图如下：</strong></p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/rainlotus97/images/data/2024-01-27/set%E5%8E%BB%E9%87%8D-82604a.gif"></p><h2 id="2-利用for嵌套for，然后splice去重（ES5中最常用）"><a href="#2-利用for嵌套for，然后splice去重（ES5中最常用）" class="headerlink" title="2.利用for嵌套for，然后splice去重（ES5中最常用）"></a>2.利用for嵌套for，然后splice去重（ES5中最常用）</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">unique</span>(<span class="params">arr</span>)&#123;            </span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">let</span> i=<span class="number">0</span>; i&lt;arr.<span class="property">length</span>; i++)&#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">let</span> j=i+<span class="number">1</span>; j&lt;arr.<span class="property">length</span>; j++)&#123;</span><br><span class="line">                <span class="keyword">if</span>(arr[i]==arr[j])&#123;         <span class="comment">//第一个等同于第二个，splice方法删除第二个</span></span><br><span class="line">                    arr.<span class="title function_">splice</span>(j,<span class="number">1</span>);</span><br><span class="line">                    j--;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"><span class="keyword">return</span> arr;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> arr = [<span class="number">1</span>,<span class="number">1</span>,<span class="string">&#x27;true&#x27;</span>,<span class="string">&#x27;true&#x27;</span>,<span class="literal">true</span>,<span class="literal">true</span>,<span class="number">15</span>,<span class="number">15</span>,<span class="literal">false</span>,<span class="literal">false</span>, <span class="literal">undefined</span>,<span class="literal">undefined</span>, <span class="literal">null</span>,<span class="literal">null</span>, <span class="title class_">NaN</span>, <span class="title class_">NaN</span>,<span class="string">&#x27;NaN&#x27;</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;a&#x27;</span>,&#123;&#125;,&#123;&#125;];</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">unique</span>(arr))</span><br><span class="line">    <span class="comment">//[1, &quot;true&quot;, 15, false, undefined, NaN, NaN, &quot;NaN&quot;, &quot;a&quot;, &#123;…&#125;, &#123;…&#125;]     //NaN和&#123;&#125;没有去重，两个null直接消失了</span></span><br></pre></td></tr></table></figure><p><strong>ps:双层循环，外层循环元素，内层循环时比较值。值相同时，则删去这个值。</strong></p><p><strong>动图如下：</strong></p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/rainlotus97/images/data/2024-01-27/for%E5%BE%AA%E7%8E%AF-splice-91db9c.gif"></p><h2 id="3-利用indexOf去重"><a href="#3-利用indexOf去重" class="headerlink" title="3.利用indexOf去重"></a>3.利用indexOf去重</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">unique</span>(<span class="params">arr</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="title class_">Array</span>.<span class="title function_">isArray</span>(arr)) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;type error!&#x27;</span>)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">const</span> array = [];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; arr.<span class="property">length</span>; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (array .<span class="title function_">indexOf</span>(arr[i]) === -<span class="number">1</span>) &#123;</span><br><span class="line">            array .<span class="title function_">push</span>(arr[i])</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> array;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> arr = [<span class="number">1</span>,<span class="number">1</span>,<span class="string">&#x27;true&#x27;</span>,<span class="string">&#x27;true&#x27;</span>,<span class="literal">true</span>,<span class="literal">true</span>,<span class="number">15</span>,<span class="number">15</span>,<span class="literal">false</span>,<span class="literal">false</span>, <span class="literal">undefined</span>,<span class="literal">undefined</span>, <span class="literal">null</span>,<span class="literal">null</span>, <span class="title class_">NaN</span>, <span class="title class_">NaN</span>,<span class="string">&#x27;NaN&#x27;</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;a&#x27;</span>,&#123;&#125;,&#123;&#125;];</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">unique</span>(arr)) </span><br><span class="line"> <span class="comment">// [1, &quot;true&quot;, true, 15, false, undefined, null, NaN, NaN, &quot;NaN&quot;, 0, &quot;a&quot;, &#123;…&#125;, &#123;…&#125;]  //NaN、&#123;&#125;没有去重</span></span><br></pre></td></tr></table></figure><p><strong>ps:新建一个空的结果数组，for 循环原数组，判断结果数组是否存在当前元素，如果有相同的值则跳过，不相同则push进数组。</strong></p><p><strong>动图如下：</strong></p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/rainlotus97/images/data/2024-01-27/%E5%88%A9%E7%94%A8indexof%E5%8E%BB%E9%87%8D-08cddb.gif"></p><h2 id="4-利用Map数据结构去重"><a href="#4-利用Map数据结构去重" class="headerlink" title="4.利用Map数据结构去重"></a>4.利用Map数据结构去重</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">function arrayNonRepeatfy(arr) &#123;</span><br><span class="line">  let map = new Map();</span><br><span class="line">  let array = new Array();  // 数组用于返回结果</span><br><span class="line">  for (let i = 0; i &lt; arr.length; i++) &#123;</span><br><span class="line">    if(map .has(arr[i])) &#123;  // 如果有该key值</span><br><span class="line">      map .set(arr[i], true); </span><br><span class="line">    &#125; else &#123; </span><br><span class="line">      map .set(arr[i], false);   // 如果没有该key值</span><br><span class="line">      array .push(arr[i]);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; </span><br><span class="line">  return array ;</span><br><span class="line">&#125;</span><br><span class="line"> const arr = [1,1,&#x27;true&#x27;,&#x27;true&#x27;,true,true,15,15,false,false, undefined,undefined, null,null, NaN, NaN,&#x27;NaN&#x27;, 0, 0, &#x27;a&#x27;, &#x27;a&#x27;,&#123;&#125;,&#123;&#125;];</span><br><span class="line">    console.log(unique(arr))</span><br><span class="line">//[1, &quot;a&quot;, &quot;true&quot;, true, 15, false, 1, &#123;…&#125;, null, NaN, NaN, &quot;NaN&quot;, 0, &quot;a&quot;, &#123;…&#125;, undefined]</span><br></pre></td></tr></table></figure><p><strong>ps:创建一个空Map数据结构，遍历需要去重的数组，把数组的每一个元素作为key存到Map中。由于Map中不会出现相同的key值，所以最终得到的就是去重后的结果。</strong></p><p><strong>动图如下：</strong></p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/rainlotus97/images/data/2024-01-27/%E5%88%A9%E7%94%A8map%E5%8E%BB%E9%87%8D-42cb70.gif"></p><h2 id="5-利用reduce-includes"><a href="#5-利用reduce-includes" class="headerlink" title="5.利用reduce+includes"></a>5.利用reduce+includes</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">unique</span>(<span class="params">arr</span>)&#123;</span><br><span class="line">    <span class="keyword">return</span> arr.<span class="title function_">reduce</span>(<span class="function">(<span class="params">prev,cur</span>) =&gt;</span> prev.<span class="title function_">includes</span>(cur) ? prev : [...prev,cur],[]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> arr = [<span class="number">1</span>,<span class="number">1</span>,<span class="string">&#x27;true&#x27;</span>,<span class="string">&#x27;true&#x27;</span>,<span class="literal">true</span>,<span class="literal">true</span>,<span class="number">15</span>,<span class="number">15</span>,<span class="literal">false</span>,<span class="literal">false</span>, <span class="literal">undefined</span>,<span class="literal">undefined</span>, <span class="literal">null</span>,<span class="literal">null</span>, <span class="title class_">NaN</span>, <span class="title class_">NaN</span>,<span class="string">&#x27;NaN&#x27;</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;a&#x27;</span>,&#123;&#125;,&#123;&#125;];</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">unique</span>(arr));</span><br><span class="line"><span class="comment">// [1, &quot;true&quot;, true, 15, false, undefined, null, NaN, &quot;NaN&quot;, 0, &quot;a&quot;, &#123;…&#125;, &#123;…&#125;]</span></span><br></pre></td></tr></table></figure><p><strong>动图如下：</strong></p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/rainlotus97/images/data/2024-01-27/%E5%88%A9%E7%94%A8reduce%E5%92%8Cincludes%E5%8E%BB%E9%87%8D-aebc4c.gif"></p><h2 id="二、对象数组去重"><a href="#二、对象数组去重" class="headerlink" title="二、对象数组去重"></a>二、对象数组去重</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> arr = [&#123;</span><br><span class="line">  <span class="attr">key</span>: <span class="string">&#x27;01&#x27;</span>,</span><br><span class="line">  <span class="attr">value</span>: <span class="string">&#x27;乐乐&#x27;</span></span><br><span class="line">&#125;, &#123;</span><br><span class="line">  <span class="attr">key</span>: <span class="string">&#x27;02&#x27;</span>,</span><br><span class="line">  <span class="attr">value</span>: <span class="string">&#x27;博博&#x27;</span></span><br><span class="line">&#125;, &#123;</span><br><span class="line">  <span class="attr">key</span>: <span class="string">&#x27;03&#x27;</span>,</span><br><span class="line">  <span class="attr">value</span>: <span class="string">&#x27;淘淘&#x27;</span></span><br><span class="line">&#125;, &#123;</span><br><span class="line">  <span class="attr">key</span>: <span class="string">&#x27;04&#x27;</span>,</span><br><span class="line">  <span class="attr">value</span>: <span class="string">&#x27;哈哈&#x27;</span></span><br><span class="line">&#125;, &#123;</span><br><span class="line">  <span class="attr">key</span>: <span class="string">&#x27;01&#x27;</span>,</span><br><span class="line">  <span class="attr">value</span>: <span class="string">&#x27;乐乐&#x27;</span></span><br><span class="line">&#125;];</span><br></pre></td></tr></table></figure><h2 id="1-采用对象访问属性的方法"><a href="#1-采用对象访问属性的方法" class="headerlink" title="1.采用对象访问属性的方法"></a>1.采用对象访问属性的方法</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//  方法1：利用对象访问属性的方法，判断对象中是否存在key</span></span><br><span class="line">    <span class="keyword">const</span> result = [];</span><br><span class="line">    <span class="keyword">const</span> obj = &#123;&#125;;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">const</span> item <span class="keyword">of</span> arr) &#123;</span><br><span class="line">      <span class="keyword">if</span> (!obj[item.<span class="property">key</span>]) &#123;</span><br><span class="line">        result.<span class="title function_">push</span>(item);</span><br><span class="line">        obj[item.<span class="property">key</span>] = <span class="literal">true</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(result); <span class="comment">// [&#123;key: &quot;01&quot;, value: &quot;乐乐&quot;&#125;,&#123;key: &quot;02&quot;, value: &quot;博博&quot;&#125;,&#123;key: &quot;03&quot;, value: &quot;淘淘&quot;&#125;,&#123;key: &quot;04&quot;, value: &quot;哈哈&quot;&#125;]</span></span><br></pre></td></tr></table></figure><p><strong>演示原理图：</strong></p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/rainlotus97/images/data/2024-01-27/%E5%AF%B9%E8%B1%A1%E6%95%B0%E7%BB%84%E5%8E%BB%E9%87%8D--%E5%88%A9%E7%94%A8%E5%AF%B9%E8%B1%A1%E5%B1%9E%E6%80%A7%E5%90%8D%E5%94%AF%E4%B8%80%E7%89%B9%E6%80%A7-712d4c.gif"></p><h2 id="2-采用数组中的reduce方法"><a href="#2-采用数组中的reduce方法" class="headerlink" title="2.采用数组中的reduce方法"></a>2.采用数组中的reduce方法</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//  方法2：利用reduce方法遍历数组,reduce第一个参数是遍历需要执行的函数，第二个参数是item的初始值</span></span><br><span class="line">   <span class="keyword">let</span> obj = &#123;&#125;;</span><br><span class="line">   <span class="keyword">const</span> arr2 = arr.<span class="title function_">reduce</span>(<span class="function">(<span class="params">item, next</span>) =&gt;</span> &#123;</span><br><span class="line">     obj[next.<span class="property">key</span>] ? <span class="string">&#x27;&#x27;</span> : obj[next.<span class="property">key</span>] = <span class="literal">true</span> &amp;&amp; item.<span class="title function_">push</span>(next);</span><br><span class="line">     <span class="variable language_">console</span>.<span class="title function_">log</span>(item, next, obj);</span><br><span class="line">     <span class="keyword">return</span> item;</span><br><span class="line">   &#125;, []);</span><br><span class="line">   <span class="variable language_">console</span>.<span class="title function_">log</span>(arr2); <span class="comment">// [&#123;key: &quot;01&quot;, value: &quot;乐乐&quot;&#125;,&#123;key: &quot;02&quot;, value: &quot;博博&quot;&#125;,&#123;key: &quot;03&quot;, value: &quot;淘淘&quot;&#125;,&#123;key: &quot;04&quot;, value: &quot;哈哈&quot;&#125;]</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p><strong>演示原理图：</strong></p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/rainlotus97/images/data/2024-01-27/%E5%AF%B9%E8%B1%A1%E6%95%B0%E7%BB%84%E5%8E%BB%E9%87%8D--%E5%88%A9%E7%94%A8reduce%E5%92%8C%E5%AF%B9%E8%B1%A1%E5%B1%9E%E6%80%A7%E5%90%8D%E5%94%AF%E4%B8%80%E7%9A%84%E7%89%B9%E6%80%A7-d051d2.gif"></p><p><strong>ps:其中obj对象应该是{01:true,02:true,03:true,04:true}才对，页面上显示的可能有误</strong></p>]]></content>
      
      
      <categories>
          
          <category> js </category>
          
      </categories>
      
      
        <tags>
            
            <tag> js </tag>
            
            <tag> 去重 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>umi&amp;dva</title>
      <link href="/2020/10/07/umi&amp;dva/"/>
      <url>/2020/10/07/umi&amp;dva/</url>
      
        <content type="html"><![CDATA[<h1 id="1-Umi介绍"><a href="#1-Umi介绍" class="headerlink" title="1. Umi介绍"></a>1. Umi介绍</h1><h2 id="1-1-Umi是什么"><a href="#1-1-Umi是什么" class="headerlink" title="1.1 Umi是什么"></a>1.1 Umi是什么</h2><p><a href="https://umijs.org/zh-CN/docs">https://umijs.org/zh-CN/docs</a>   </p><p>一套可插拔的企业级 react 应用框架，由dva作者 sorrycc 完成，它既是一个框架也是一个工具。</p><p>Umi 以路由为基础的，同时支持配置式路由和约定式路由，保证路由的功能完备，并以此进行功能扩展。然后配以生命周期完善的插件体系，覆盖从源码到构建产物的每个生命周期，支持各种功能扩展和业务需求。</p><p>他在Umi中引入了 UI 工具 antd，打包工具 roadhog，路由 react-router和状态管理器 dva，做到了可插拔机制。通过约定、自动生成和解析代码等方式来辅助开发，减少开发者要写的代码量。</p><blockquote><p><strong>它主要具备以下功能：</strong></p></blockquote><ul><li><strong>可扩展</strong>，Umi 实现了完整的生命周期，并使其插件化，Umi 内部功能也全由插件完成。此外还支持插件和插件集，以满足功能和垂直域的分层需求。</li><li><strong>开箱即用</strong>，Umi 内置了路由、构建、部署、测试等，仅需一个依赖即可上手开发。并且还提供针对 React 的集成插件集，内涵丰富的功能，可满足日常 80% 的开发需求。</li><li><strong>企业级</strong>，经蚂蚁内部 3000+ 项目以及阿里、优酷、网易、飞猪、口碑等公司项目的验证，值得信赖。</li><li><strong>大量自研</strong>，包含微前端、组件打包、文档工具、请求库、hooks 库、数据流等，满足日常项目的周边需求。</li><li><strong>完备路由</strong>，同时支持配置式路由和约定式路由，同时保持功能的完备性，比如动态路由、嵌套路由、权限路由等等。</li><li><strong>面向未来</strong>，在满足需求的同时，我们也不会停止对新技术的探索。比如 dll 提速、modern mode、webpack@5、自动化 external、bundler less 等等。</li></ul><blockquote><p><strong>为什么不是？<a href="https://github.com/facebook/create-react-app">create-react-app</a></strong></p></blockquote><p>create-react-app 是基于 webpack 的打包层方案，包含 build、dev、lint 等，他在打包层把体验做到了极致，但是不包含路由，不是框架，也不支持配置。所以，如果大家想基于他修改部分配置，或者希望在打包层之外也做技术收敛时，就会遇到困难。</p><blockquote><p><strong>什么时候不用 umi？</strong></p></blockquote><p>如果你，</p><ul><li>需要支持 IE 8 或更低版本的浏览器</li><li>需要支持 React 16.8.0 以下的 React</li><li>需要跑在 Node 10 以下的环境中</li><li>有很强的 webpack 自定义需求和主观意愿</li><li>需要选择不同的路由方案</li></ul><p>Umi 可能不适合你。</p><h2 id="1-2-Umi-如何工作"><a href="#1-2-Umi-如何工作" class="headerlink" title="1.2 Umi 如何工作"></a>1.2 Umi 如何工作</h2><p>写写 Umi 背后的思考和重要概念。</p><h3 id="1-2-1-技术收敛"><a href="#1-2-1-技术收敛" class="headerlink" title="1.2.1 技术收敛"></a>1.2.1 技术收敛</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/rainlotus97/images/data/2024-01-27/B7RONxakU4Zny2L-df85fa.png" alt="1601014995473"></p><p>这张图是给内部框架 Bigfish 画的，套到 Umi 上同样合适。他把大家常用的技术栈进行整理，收敛到一起，让大家只用 Umi 就可以完成 80% 的日常工作。</p><h3 id="1-2-2-插件和插件集"><a href="#1-2-2-插件和插件集" class="headerlink" title="1.2.2 插件和插件集"></a>1.2.2 插件和插件集</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/rainlotus97/images/data/2024-01-27/AsTaIDd92cBoxMw-f93dca.png" alt="1601015019180"></p><p>Umi 支持插件和插件集，通过这张图应该很好理解到他们的关系，通过插件集我们把插件收敛依赖然后支持不同的业务类型。</p><p>比如@umijs&#x2F;preset-react就是一个Umi的插件集，里面整合了一些常用功能。</p><ul><li><a href="https://umijs.org/zh-CN/plugins/plugin-access">plugin-access</a>，权限管理</li><li><a href="https://umijs.org/zh-CN/plugins/plugin-analytics">plugin-analytics</a>，统计管理</li><li><a href="https://umijs.org/zh-CN/plugins/plugin-antd">plugin-antd</a>，整合 antd UI 组件</li><li><a href="https://umijs.org/zh-CN/plugins/plugin-crossorigin">plugin-crossorigin</a>，通常用于 JS 出错统计</li><li><a href="https://umijs.org/zh-CN/plugins/plugin-dva">plugin-dva</a>，整合 dva</li><li><a href="https://umijs.org/zh-CN/plugins/plugin-helmet">plugin-helmet</a>，整合 <a href="https://github.com/nfl/react-helmet">react-helmet</a>，管理 HTML 文档标签（如标题、描述等）</li><li><a href="https://umijs.org/zh-CN/plugins/plugin-initial-state">plugin-initial-state</a>，初始化数据管理</li><li><a href="https://umijs.org/zh-CN/plugins/plugin-layout">plugin-layout</a>，配置启用 ant-design-pro 的布局</li><li><a href="https://umijs.org/zh-CN/plugins/plugin-locale">plugin-locale</a>，国际化能力</li><li><a href="https://umijs.org/zh-CN/plugins/plugin-model">plugin-model</a>，基于 hooks 的简易数据流</li><li><a href="https://umijs.org/zh-CN/plugins/plugin-request">plugin-request</a>，基于 umi-request 和 umi-hooks 的请求方案</li></ul><h3 id="1-2-3-配置式路由和约定式路由"><a href="#1-2-3-配置式路由和约定式路由" class="headerlink" title="1.2.3 配置式路由和约定式路由"></a>1.2.3 配置式路由和约定式路由</h3><p>Umi 的路由既支持配置式，又支持约定式。配置式是对于现实的低头，也是大部分用户在用的，因为他功能强大；约定式是我们希望走去的方向，因为他简洁优雅。</p><h3 id="1-2-4-umi-临时文件"><a href="#1-2-4-umi-临时文件" class="headerlink" title="1.2.4 .umi 临时文件"></a>1.2.4 .umi 临时文件</h3><p>.umi 临时目录是整个 Umi 项目的发动机，你的入口文件、路由等等都在这里，这些是由 umi 内部插件及三方插件生成的。</p><p>你通常会在 .umi 下看到以下目录，</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">+ .umi</span><br><span class="line">  + core     # 内部插件生成</span><br><span class="line">  + pluginA  # 外部插件生成</span><br><span class="line">  + presetB  # 外部插件生成</span><br><span class="line">  + umi.ts   # 入口文件</span><br></pre></td></tr></table></figure><p>临时文件是 Umi 框架中非常重要的一部分，框架或插件会根据你的代码生成临时文件，这些原来需要放在项目里的脏乱差的部分都被藏在了这里。</p><p>你可以在这里调试代码，但不要在 .git 仓库里提交他，因为他的临时性，每次启动 umi 时都会被删除并重新生成。</p><h1 id="2-Umi3的使用"><a href="#2-Umi3的使用" class="headerlink" title="2. Umi3的使用"></a>2. Umi3的使用</h1><h2 id="2-1-安装Umi创建项目"><a href="#2-1-安装Umi创建项目" class="headerlink" title="2.1  安装Umi创建项目"></a>2.1  安装Umi创建项目</h2><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ yarn <span class="variable language_">global</span> add umi@<span class="number">3.2</span><span class="number">.23</span></span><br><span class="line">$ umi -v</span><br><span class="line"><span class="number">3.2</span><span class="number">.23</span></span><br></pre></td></tr></table></figure><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ mkdir myapp &amp;&amp; cd myapp</span><br><span class="line">$ yarn create umi</span><br></pre></td></tr></table></figure><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://i.loli.net/2020/11/03/3C7eyf5ipj2rVUZ.png" alt="1573453772780"></p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://i.loli.net/2020/11/03/RTlk5Cxa1t4smph.png" alt="1573453795170"></p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://i.loli.net/2020/11/03/vbmaTHMpRI3DtL7.png" alt="1601014079199"></p><h2 id="2-2-升级到Umi3"><a href="#2-2-升级到Umi3" class="headerlink" title="2.2 升级到Umi3"></a>2.2 升级到Umi3</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span> 删除package.<span class="property">json</span>中 dva 和 antd 的依赖 (<span class="title class_">Umi3</span>中已经包含这两个依赖)</span><br><span class="line"></span><br><span class="line"><span class="number">2.</span> 修改package.<span class="property">json</span>中umi的包的版本号</span><br><span class="line">   <span class="string">&quot;umi&quot;</span>: <span class="string">&quot;^3.0.0&quot;</span>,</span><br><span class="line"></span><br><span class="line"><span class="number">3.</span> 删除package.<span class="property">json</span>中 umi-plugin-react 依赖，新增umijs/preset-react 依赖</span><br><span class="line">   <span class="string">&quot;@umijs/preset-react&quot;</span>: <span class="string">&quot;^1&quot;</span>,</span><br><span class="line">       </span><br><span class="line"><span class="number">4.</span> 修改package.<span class="property">json</span>中的node环境要求</span><br><span class="line">   <span class="string">&quot;node&quot;</span>: <span class="string">&quot;&gt;=10.13.0&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="number">5.</span> tsconfig.<span class="property">json</span>中的paths新增如下：</span><br><span class="line">   <span class="string">&quot;@@/*&quot;</span>: [<span class="string">&quot;src/.umi/*&quot;</span>]</span><br><span class="line"></span><br><span class="line"><span class="number">6.</span> 修改 .<span class="property">umirc</span>.<span class="property">ts</span>文件</span><br><span class="line">    <span class="comment">//引入umi中的配置文件的类型 ts中要用</span></span><br><span class="line">    <span class="keyword">import</span> &#123; defineConfig &#125; <span class="keyword">from</span> <span class="string">&#x27;umi&#x27;</span>;</span><br><span class="line"><span class="keyword">let</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ref: https://umijs.org/config/</span></span><br><span class="line">    <span class="keyword">export</span> <span class="keyword">default</span> <span class="title function_">defineConfig</span>(&#123;</span><br><span class="line">      <span class="comment">//路由配置</span></span><br><span class="line">      <span class="attr">routes</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">path</span>: <span class="string">&#x27;/&#x27;</span>,</span><br><span class="line">          <span class="comment">//注意：这边文件的路径是相对于src/.mui中来确定的</span></span><br><span class="line">          <span class="attr">component</span>: <span class="string">&#x27;../layouts/index&#x27;</span>,</span><br><span class="line">          <span class="attr">routes</span>: [</span><br><span class="line">            &#123; </span><br><span class="line">              <span class="attr">path</span>: <span class="string">&#x27;/&#x27;</span>, </span><br><span class="line">              <span class="attr">component</span>: <span class="string">&#x27;../pages/index&#x27;</span> </span><br><span class="line">            &#125;</span><br><span class="line">          ]</span><br><span class="line">        &#125;</span><br><span class="line">      ],</span><br><span class="line">      <span class="comment">//启用antd插件</span></span><br><span class="line">      <span class="comment">//每个插件都会对应一个 id 和一个 key，id 是路径的简写，key 是进一步简化后用于配置的唯一值。</span></span><br><span class="line">      <span class="comment">//比如插件 /node_modules/@umijs/plugin-antd ,id 为 @umijs/plugin-antd，key 为 antd。</span></span><br><span class="line">      <span class="attr">antd</span>: &#123; &#125;,</span><br><span class="line">      <span class="comment">//启用dva插件</span></span><br><span class="line">      <span class="attr">dva</span>: &#123;</span><br><span class="line">        <span class="attr">hmr</span>: <span class="literal">true</span>,  <span class="comment">//启用dva model的热更新</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="comment">//启用loacle插件  配置之后才可以使用useIntl </span></span><br><span class="line">      <span class="attr">locale</span>: &#123;</span><br><span class="line">        <span class="comment">//默认的语言环境</span></span><br><span class="line">        <span class="attr">default</span>: <span class="string">&#x27;zh-CN&#x27;</span>,</span><br><span class="line">        <span class="comment">//antd开启国际化</span></span><br><span class="line">        <span class="attr">antd</span>: <span class="literal">true</span>, </span><br><span class="line">        <span class="comment">// default true, when it is true, will use `navigator.language` overwrite default</span></span><br><span class="line">        <span class="attr">baseNavigator</span>: <span class="literal">false</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="comment">// 浏览器兼容</span></span><br><span class="line">      <span class="attr">targets</span>: &#123;</span><br><span class="line">        <span class="attr">ie</span>: <span class="number">11</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="comment">// 开启文件hash后缀</span></span><br><span class="line">      <span class="attr">hash</span>: <span class="literal">true</span>,</span><br><span class="line">      <span class="comment">// 启用 Hash 路由</span></span><br><span class="line">      <span class="attr">history</span>: &#123;</span><br><span class="line">        <span class="attr">type</span>: <span class="string">&#x27;hash&#x27;</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="comment">// Theme for antd: https://ant.design/docs/react/customize-theme-cn</span></span><br><span class="line">      <span class="attr">theme</span>: &#123;</span><br><span class="line">        <span class="comment">// ...darkTheme,</span></span><br><span class="line">        <span class="comment">// 主要颜色,</span></span><br><span class="line">        <span class="string">&#x27;font-size-base&#x27;</span>: <span class="string">&#x27;34px&#x27;</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="comment">//配置按需加载   即是否把构建产物进行拆分，在需要的时候下载额外的 JS 再执行。</span></span><br><span class="line">      <span class="attr">dynamicImport</span>: &#123;&#125;,</span><br><span class="line">      <span class="comment">// 指定react-router的base，部署到根目录时需要配置</span></span><br><span class="line">      <span class="attr">base</span>:<span class="string">&#x27;/&#x27;</span>,</span><br><span class="line">      <span class="comment">// 指定webpack的publicPath，指向静态资源文件所在的路径</span></span><br><span class="line">      <span class="attr">publicPath</span>:<span class="string">&#x27;./&#x27;</span>,</span><br><span class="line">      <span class="comment">// DefinePlugin 全局常量定义</span></span><br><span class="line">      <span class="attr">define</span>: &#123; &#125;,</span><br><span class="line">      <span class="comment">// 代理配置</span></span><br><span class="line">      <span class="attr">proxy</span>: &#123;</span><br><span class="line">        <span class="comment">// &#x27;/api&#x27;: &#123;</span></span><br><span class="line">        <span class="comment">//   target: &#x27;http://127.0.0.1:10000/&#x27;,</span></span><br><span class="line">        <span class="comment">//   changeOrigin: true,</span></span><br><span class="line">        <span class="comment">//   pathRewrite: &#123; &#x27;^/api&#x27;: &#x27;&#x27; &#125;</span></span><br><span class="line">        <span class="comment">// &#125;</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="comment">// 别名</span></span><br><span class="line">      <span class="attr">alias</span>: &#123;</span><br><span class="line">        <span class="string">&#x27;@&#x27;</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&#x27;src&#x27;</span>)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line"><span class="number">7.</span> 注释掉 app.<span class="property">ts</span>中的<span class="keyword">const</span> dva 代码</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    export const dva = &#123;</span></span><br><span class="line"><span class="comment">      config: &#123;</span></span><br><span class="line"><span class="comment">        onError(err: ErrorEvent) &#123;</span></span><br><span class="line"><span class="comment">          err.preventDefault();</span></span><br><span class="line"><span class="comment">          console.error(err.message);</span></span><br><span class="line"><span class="comment">        &#125;,</span></span><br><span class="line"><span class="comment">      &#125;,</span></span><br><span class="line"><span class="comment">    &#125;;</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line"></span><br><span class="line"><span class="number">8.</span> 修改pages/index.<span class="property">tsx</span></span><br><span class="line">    <span class="comment">//useIntl 国际化的api</span></span><br><span class="line">    <span class="keyword">import</span> &#123; useIntl &#125; <span class="keyword">from</span> <span class="string">&#x27;umi&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;https://umijs.org/guide/getting-started.html&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        &#123;useIntl().formatMessage(&#123; id: &#x27;index.start&#x27; &#125;)&#125;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">a</span>&gt;</span></span></span><br></pre></td></tr></table></figure><h2 id="2-3-运行项目"><a href="#2-3-运行项目" class="headerlink" title="2.3 运行项目"></a>2.3 运行项目</h2><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//然后安装依赖</span></span><br><span class="line">$ yarn</span><br><span class="line"></span><br><span class="line"><span class="comment">//然后启动应用</span></span><br><span class="line">$ yarn start</span><br></pre></td></tr></table></figure><p>几秒钟后，你会看到以下输出，</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable constant_">DONE</span>  <span class="title class_">Compiled</span> successfully <span class="keyword">in</span> 212ms</span><br><span class="line"></span><br><span class="line"> <span class="title class_">App</span> running <span class="attr">at</span>:</span><br><span class="line"> - <span class="title class_">Local</span>:   <span class="attr">http</span>:<span class="comment">//localhost:8000/</span></span><br><span class="line"> - <span class="title class_">Network</span>: <span class="attr">http</span>:<span class="comment">//&#123;&#123; YourIP &#125;&#125;:8000/</span></span><br></pre></td></tr></table></figure><p>在浏览器里打开 <a href="http://localhost:8000/">http://localhost:8000</a>，你会看到 umi 的欢迎界面。</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://i.loli.net/2020/11/03/2kvGAwIRglafLX9.png" alt="img"></p><h2 id="2-4-目录结构介绍"><a href="#2-4-目录结构介绍" class="headerlink" title="2.4 目录结构介绍"></a>2.4 目录结构介绍</h2><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://i.loli.net/2020/11/03/3wlgZrYOmbpd9tB.png" alt="1601020141915"></p><h2 id="2-5-配置文件介绍"><a href="#2-5-配置文件介绍" class="headerlink" title="2.5 配置文件介绍"></a>2.5 配置文件介绍</h2><h3 id="2-5-1-editorconfig"><a href="#2-5-1-editorconfig" class="headerlink" title="2.5.1 .editorconfig"></a>2.5.1 .editorconfig</h3><p>该文件是配置编辑器的一些设置，这里我修改了一个缩进，indent_size &#x3D; 4。因为个人比较喜欢4个缩进，看着舒服。</p><h3 id="2-5-2-env"><a href="#2-5-2-env" class="headerlink" title="2.5.2 .env"></a>2.5.2 .env</h3><p>该文件是项目环境配置文件，默认的是BROWSER&#x3D;none，这时候项目启动后，浏览器不会自动打开。</p><h3 id="2-5-3-eslintrc"><a href="#2-5-3-eslintrc" class="headerlink" title="2.5.3 .eslintrc"></a>2.5.3 .eslintrc</h3><p>多人开发时候，一套良好的代码规范是非常必要的。这里配置了一份基础eslint文件，供参考。</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;env&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;es6&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="string">&quot;node&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="string">&quot;browser&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="string">&quot;mocha&quot;</span>: <span class="literal">true</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;extends&quot;</span>: [</span><br><span class="line">    <span class="string">&quot;eslint:recommended&quot;</span>,</span><br><span class="line">    <span class="string">&quot;react-app&quot;</span></span><br><span class="line">  ],</span><br><span class="line">  <span class="string">&quot;rules&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;strict&quot;</span>: <span class="string">&quot;error&quot;</span>,</span><br><span class="line">    <span class="comment">//&quot;indent&quot;: [&quot;error&quot;, 4, &#123; &quot;SwitchCase&quot;: 1 &#125;],</span></span><br><span class="line">    <span class="string">&quot;eqeqeq&quot;</span>: <span class="string">&quot;error&quot;</span>,</span><br><span class="line">    <span class="string">&quot;no-lone-blocks&quot;</span>: <span class="string">&quot;error&quot;</span>,</span><br><span class="line">    <span class="string">&quot;no-lonely-if&quot;</span>: <span class="string">&quot;error&quot;</span>,</span><br><span class="line">    <span class="string">&quot;no-multi-spaces&quot;</span>: <span class="string">&quot;error&quot;</span>,</span><br><span class="line">    <span class="string">&quot;no-multiple-empty-lines&quot;</span>: [</span><br><span class="line">      <span class="string">&quot;error&quot;</span>,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="string">&quot;max&quot;</span>: <span class="number">2</span></span><br><span class="line">      &#125;</span><br><span class="line">    ],</span><br><span class="line">    <span class="string">&quot;no-param-reassign&quot;</span>: <span class="string">&quot;error&quot;</span>,</span><br><span class="line">    <span class="string">&quot;no-spaced-func&quot;</span>: <span class="string">&quot;error&quot;</span>,</span><br><span class="line">    <span class="string">&quot;no-use-before-define&quot;</span>: <span class="string">&quot;warn&quot;</span>,</span><br><span class="line">    <span class="string">&quot;no-unused-vars&quot;</span>: <span class="string">&quot;warn&quot;</span>,</span><br><span class="line">    <span class="string">&quot;no-with&quot;</span>: <span class="string">&quot;error&quot;</span>,</span><br><span class="line">    <span class="string">&quot;default-case&quot;</span>: <span class="string">&quot;error&quot;</span>,</span><br><span class="line">    <span class="string">&quot;key-spacing&quot;</span>: [</span><br><span class="line">      <span class="string">&quot;error&quot;</span>,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="string">&quot;beforeColon&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="string">&quot;afterColon&quot;</span>: <span class="literal">true</span></span><br><span class="line">      &#125;</span><br><span class="line">    ],</span><br><span class="line">    <span class="string">&quot;comma-spacing&quot;</span>: [</span><br><span class="line">      <span class="string">&quot;error&quot;</span>,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="string">&quot;before&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="string">&quot;after&quot;</span>: <span class="literal">true</span></span><br><span class="line">      &#125;</span><br><span class="line">    ],</span><br><span class="line">    <span class="string">&quot;generator-star-spacing&quot;</span>: [</span><br><span class="line">      <span class="string">&quot;error&quot;</span>,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="string">&quot;before&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="string">&quot;after&quot;</span>: <span class="literal">false</span></span><br><span class="line">      &#125;</span><br><span class="line">    ],</span><br><span class="line">    <span class="string">&quot;semi&quot;</span>: [</span><br><span class="line">      <span class="string">&quot;warn&quot;</span>,</span><br><span class="line">      <span class="string">&quot;always&quot;</span>,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="string">&quot;omitLastInOneLineBlock&quot;</span>: <span class="literal">true</span></span><br><span class="line">      &#125;</span><br><span class="line">    ],</span><br><span class="line">    <span class="string">&quot;no-restricted-globals&quot;</span>: <span class="string">&quot;off&quot;</span>,</span><br><span class="line">    <span class="string">&quot;array-callback-return&quot;</span>: <span class="string">&quot;off&quot;</span>,</span><br><span class="line">    <span class="string">&quot;no-console&quot;</span>: [</span><br><span class="line">      <span class="string">&quot;warn&quot;</span>,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="string">&quot;allow&quot;</span>: [</span><br><span class="line">          <span class="string">&quot;info&quot;</span>,</span><br><span class="line">          <span class="string">&quot;warn&quot;</span>,</span><br><span class="line">          <span class="string">&quot;error&quot;</span>,</span><br><span class="line">          <span class="string">&quot;time&quot;</span>,</span><br><span class="line">          <span class="string">&quot;timeEnd&quot;</span></span><br><span class="line">        ]</span><br><span class="line">      &#125;</span><br><span class="line">    ],</span><br><span class="line">    <span class="string">&quot;react/react-in-jsx-scope&quot;</span>: <span class="string">&quot;warn&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-5-3-umirc"><a href="#2-5-3-umirc" class="headerlink" title="2.5.3 .umirc"></a>2.5.3 .umirc</h3><p>.umirc为Umi项目的配置文件，.umirc.js 和 config&#x2F;config.js二选一</p><h3 id="2-5-4-tsconfig-json"><a href="#2-5-4-tsconfig-json" class="headerlink" title="2.5.4 tsconfig.json"></a>2.5.4 tsconfig.json</h3><p>typescript的配置文件，可以配置ts编译的一些特征</p><p><a href="https://www.jianshu.com/p/78dcb09dac2c">https://www.jianshu.com/p/78dcb09dac2c</a></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//tsconfig.json 对象类型的索引签名隐式具有&quot;any&quot;类型 报错</span></span><br><span class="line"><span class="string">&quot;suppressImplicitAnyIndexErrors&quot;</span>:<span class="literal">true</span>,</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;compilerOptions&quot;</span>: &#123;</span><br><span class="line">    <span class="comment">/* Basic Options */</span></span><br><span class="line">    <span class="string">&quot;target&quot;</span>: <span class="string">&quot;es5&quot;</span> <span class="comment">/* target用于指定编译之后的版本目标: &#x27;ES3&#x27; (default), &#x27;ES5&#x27;, &#x27;ES2015&#x27;, &#x27;ES2016&#x27;, &#x27;ES2017&#x27;, &#x27;ES2018&#x27;, &#x27;ES2019&#x27; or &#x27;ESNEXT&#x27;. */</span>,</span><br><span class="line">    <span class="string">&quot;module&quot;</span>: <span class="string">&quot;commonjs&quot;</span> <span class="comment">/* 用来指定要使用的模块标准: &#x27;none&#x27;, &#x27;commonjs&#x27;, &#x27;amd&#x27;, &#x27;system&#x27;, &#x27;umd&#x27;, &#x27;es2015&#x27;, or &#x27;ESNext&#x27;. */</span>,</span><br><span class="line">    <span class="string">&quot;lib&quot;</span>: [<span class="string">&quot;es6&quot;</span>, <span class="string">&quot;dom&quot;</span>] <span class="comment">/* lib用于指定要包含在编译中的库文件 */</span>,</span><br><span class="line">    <span class="string">&quot;allowJs&quot;</span>: <span class="literal">true</span>,                       <span class="comment">/* allowJs设置的值为true或false，用来指定是否允许编译js文件，默认是false，即不编译js文件 */</span></span><br><span class="line">    <span class="string">&quot;checkJs&quot;</span>: <span class="literal">true</span>,                       <span class="comment">/* checkJs的值为true或false，用来指定是否检查和报告js文件中的错误，默认是false */</span></span><br><span class="line">    <span class="string">&quot;jsx&quot;</span>: <span class="string">&quot;preserve&quot;</span>,                     <span class="comment">/* 指定jsx代码用于的开发环境: &#x27;preserve&#x27;, &#x27;react-native&#x27;, or &#x27;react&#x27;. */</span></span><br><span class="line">    <span class="string">&quot;declaration&quot;</span>: <span class="literal">true</span>,                   <span class="comment">/* declaration的值为true或false，用来指定是否在编译的时候生成相应的&quot;.d.ts&quot;声明文件。如果设为true，编译每个ts文件之后会生成一个js文件和一个声明文件。但是declaration和allowJs不能同时设为true */</span></span><br><span class="line">    <span class="string">&quot;declarationMap&quot;</span>: <span class="literal">true</span>,                <span class="comment">/* 值为true或false，指定是否为声明文件.d.ts生成map文件 */</span></span><br><span class="line">    <span class="string">&quot;sourceMap&quot;</span>: <span class="literal">true</span>,                     <span class="comment">/* sourceMap的值为true或false，用来指定编译时是否生成.map文件 */</span></span><br><span class="line">    <span class="string">&quot;outFile&quot;</span>: <span class="string">&quot;./&quot;</span>,                       <span class="comment">/* outFile用于指定将输出文件合并为一个文件，它的值为一个文件路径名。比如设置为&quot;./dist/main.js&quot;，则输出的文件为一个main.js文件。但是要注意，只有设置module的值为amd和system模块时才支持这个配置 */</span></span><br><span class="line">    <span class="string">&quot;outDir&quot;</span>: <span class="string">&quot;./&quot;</span>,                        <span class="comment">/* outDir用来指定输出文件夹，值为一个文件夹路径字符串，输出的文件都将放置在这个文件夹 */</span></span><br><span class="line">    <span class="string">&quot;rootDir&quot;</span>: <span class="string">&quot;./&quot;</span>,                       <span class="comment">/* 用来指定编译文件的根目录，编译器会在根目录查找入口文件，如果编译器发现以rootDir的值作为根目录查找入口文件并不会把所有文件加载进去的话会报错，但是不会停止编译 */</span></span><br><span class="line">    <span class="string">&quot;composite&quot;</span>: <span class="literal">true</span>,                     <span class="comment">/* 是否编译构建引用项目  */</span></span><br><span class="line">    <span class="string">&quot;incremental&quot;</span>: <span class="literal">true</span>,                   <span class="comment">/* Enable incremental compilation */</span></span><br><span class="line">    <span class="string">&quot;tsBuildInfoFile&quot;</span>: <span class="string">&quot;./&quot;</span>,               <span class="comment">/* Specify file to store incremental compilation information */</span></span><br><span class="line">    <span class="string">&quot;removeComments&quot;</span>: <span class="literal">true</span>,                <span class="comment">/* removeComments的值为true或false，用于指定是否将编译后的文件中的注释删掉，设为true的话即删掉注释，默认为false */</span></span><br><span class="line">    <span class="string">&quot;noEmit&quot;</span>: <span class="literal">true</span>,                        <span class="comment">/* 不生成编译文件，这个一般比较少用 */</span></span><br><span class="line">    <span class="string">&quot;importHelpers&quot;</span>: <span class="literal">true</span>,                 <span class="comment">/* importHelpers的值为true或false，指定是否引入tslib里的辅助工具函数，默认为false */</span></span><br><span class="line">    <span class="string">&quot;downlevelIteration&quot;</span>: <span class="literal">true</span>,            <span class="comment">/* 当target为&#x27;ES5&#x27; or &#x27;ES3&#x27;时，为&#x27;for-of&#x27;, spread, and destructuring&#x27;中的迭代器提供完全支持 */</span></span><br><span class="line">    <span class="string">&quot;isolatedModules&quot;</span>: <span class="literal">true</span>,               <span class="comment">/* isolatedModules的值为true或false，指定是否将每个文件作为单独的模块，默认为true，它不可以和declaration同时设定 */</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/* Strict Type-Checking Options */</span></span><br><span class="line">    <span class="string">&quot;strict&quot;</span>: <span class="literal">true</span> <span class="comment">/* strict的值为true或false，用于指定是否启动所有类型检查，如果设为true则会同时开启下面这几个严格类型检查，默认为false */</span>,</span><br><span class="line">    <span class="string">&quot;noImplicitAny&quot;</span>: <span class="literal">true</span>,                 <span class="comment">/* noImplicitAny的值为true或false，如果我们没有为一些值设置明确的类型，编译器会默认认为这个值为any，如果noImplicitAny的值为true的话。则没有明确的类型会报错。默认值为false */</span></span><br><span class="line">    <span class="string">&quot;strictNullChecks&quot;</span>: <span class="literal">true</span>,              <span class="comment">/* strictNullChecks为true时，null和undefined值不能赋给非这两种类型的值，别的类型也不能赋给他们，除了any类型。还有个例外就是undefined可以赋值给void类型 */</span></span><br><span class="line">    <span class="string">&quot;strictFunctionTypes&quot;</span>: <span class="literal">true</span>,           <span class="comment">/* strictFunctionTypes的值为true或false，用于指定是否使用函数参数双向协变检查 */</span></span><br><span class="line">    <span class="string">&quot;strictBindCallApply&quot;</span>: <span class="literal">true</span>,           <span class="comment">/* 设为true后会对bind、call和apply绑定的方法的参数的检测是严格检测的 */</span></span><br><span class="line">    <span class="string">&quot;strictPropertyInitialization&quot;</span>: <span class="literal">true</span>,  <span class="comment">/* 设为true后会检查类的非undefined属性是否已经在构造函数里初始化，如果要开启这项，需要同时开启strictNullChecks，默认为false */</span></span><br><span class="line">   <span class="string">&quot;noImplicitThis&quot;</span>: <span class="literal">true</span>,                <span class="comment">/* 当this表达式的值为any类型的时候，生成一个错误 */</span></span><br><span class="line">    <span class="string">&quot;alwaysStrict&quot;</span>: <span class="literal">true</span>,                  <span class="comment">/* alwaysStrict的值为true或false，指定始终以严格模式检查每个模块，并且在编译之后的js文件中加入&quot;use strict&quot;字符串，用来告诉浏览器该js为严格模式 */</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/* Additional Checks */</span></span><br><span class="line">    <span class="string">&quot;noUnusedLocals&quot;</span>: <span class="literal">true</span>,                <span class="comment">/* 用于检查是否有定义了但是没有使用的变量，对于这一点的检测，使用eslint可以在你书写代码的时候做提示，你可以配合使用。它的默认值为false */</span></span><br><span class="line">    <span class="string">&quot;noUnusedParameters&quot;</span>: <span class="literal">true</span>,            <span class="comment">/* 用于检查是否有在函数体中没有使用的参数，这个也可以配合eslint来做检查，默认为false */</span></span><br><span class="line">    <span class="string">&quot;noImplicitReturns&quot;</span>: <span class="literal">true</span>,             <span class="comment">/* 用于检查函数是否有返回值，设为true后，如果函数没有返回值则会提示，默认为false */</span></span><br><span class="line">    <span class="string">&quot;noFallthroughCasesInSwitch&quot;</span>: <span class="literal">true</span>,    <span class="comment">/* 用于检查switch中是否有case没有使用break跳出switch，默认为false */</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/* Module Resolution Options */</span></span><br><span class="line">    <span class="string">&quot;moduleResolution&quot;</span>: <span class="string">&quot;node&quot;</span>,            <span class="comment">/* 用于选择模块解析策略，有&#x27;node&#x27;和&#x27;classic&#x27;两种类型&#x27; */</span></span><br><span class="line">    <span class="string">&quot;baseUrl&quot;</span>: <span class="string">&quot;./&quot;</span>,                       <span class="comment">/* baseUrl用于设置解析非相对模块名称的基本目录，相对模块不会受baseUrl的影响 */</span></span><br><span class="line">    <span class="string">&quot;paths&quot;</span>: &#123;&#125;,                           <span class="comment">/* 用于设置模块名称到基于baseUrl的路径映射 */</span></span><br><span class="line">    <span class="string">&quot;rootDirs&quot;</span>: [],                        <span class="comment">/* rootDirs可以指定一个路径列表，在构建时编译器会将这个路径列表中的路径的内容都放到一个文件夹中 */</span></span><br><span class="line">    <span class="string">&quot;typeRoots&quot;</span>: [],                       <span class="comment">/* typeRoots用来指定声明文件或文件夹的路径列表，如果指定了此项，则只有在这里列出的声明文件才会被加载 */</span></span><br><span class="line">    <span class="string">&quot;types&quot;</span>: [],                           <span class="comment">/* types用来指定需要包含的模块，只有在这里列出的模块的声明文件才会被加载进来 */</span></span><br><span class="line">    <span class="string">&quot;allowSyntheticDefaultImports&quot;</span>: <span class="literal">true</span>,  <span class="comment">/* 用来指定允许从没有默认导出的模块中默认导入 */</span></span><br><span class="line">    <span class="string">&quot;esModuleInterop&quot;</span>: <span class="literal">true</span> <span class="comment">/* 通过为导入内容创建命名空间，实现CommonJS和ES模块之间的互操作性 */</span>,</span><br><span class="line">    <span class="string">&quot;preserveSymlinks&quot;</span>: <span class="literal">true</span>,              <span class="comment">/* 不把符号链接解析为其真实路径，具体可以了解下webpack和nodejs的symlink相关知识 */</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/* Source Map Options */</span></span><br><span class="line">    <span class="string">&quot;sourceRoot&quot;</span>: <span class="string">&quot;&quot;</span>,                      <span class="comment">/* sourceRoot用于指定调试器应该找到TypeScript文件而不是源文件位置，这个值会被写进.map文件里 */</span></span><br><span class="line">    <span class="string">&quot;mapRoot&quot;</span>: <span class="string">&quot;&quot;</span>,                         <span class="comment">/* mapRoot用于指定调试器找到映射文件而非生成文件的位置，指定map文件的根路径，该选项会影响.map文件中的sources属性 */</span></span><br><span class="line">    <span class="string">&quot;inlineSourceMap&quot;</span>: <span class="literal">true</span>,               <span class="comment">/* 指定是否将map文件的内容和js文件编译在同一个js文件中，如果设为true，则map的内容会以//# sourceMappingURL=然后拼接base64字符串的形式插入在js文件底部 */</span></span><br><span class="line">    <span class="string">&quot;inlineSources&quot;</span>: <span class="literal">true</span>,                 <span class="comment">/* 用于指定是否进一步将.ts文件的内容也包含到输入文件中 */</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/* Experimental Options */</span></span><br><span class="line">    <span class="string">&quot;experimentalDecorators&quot;</span>: <span class="literal">true</span> <span class="comment">/* 用于指定是否启用实验性的装饰器特性 */</span></span><br><span class="line">    <span class="string">&quot;emitDecoratorMetadata&quot;</span>: <span class="literal">true</span>,         <span class="comment">/* 用于指定是否为装饰器提供元数据支持，关于元数据，也是ES6的新标准，可以通过Reflect提供的静态方法获取元数据，如果需要使用Reflect的一些方法，需要引入ES2015.Reflect这个库 */</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="string">&quot;files&quot;</span>: [], <span class="comment">// files可以配置一个数组列表，里面包含指定文件的相对或绝对路径，编译器在编译的时候只会编译包含在files中列出的文件，如果不指定，则取决于有没有设置include选项，如果没有include选项，则默认会编译根目录以及所有子目录中的文件。这里列出的路径必须是指定文件，而不是某个文件夹，而且不能使用* ? **/ 等通配符</span></span><br><span class="line">  <span class="string">&quot;include&quot;</span>: [],  <span class="comment">// include也可以指定要编译的路径列表，但是和files的区别在于，这里的路径可以是文件夹，也可以是文件，可以使用相对和绝对路径，而且可以使用通配符，比如&quot;./src&quot;即表示要编译src文件夹下的所有文件以及子文件夹的文件</span></span><br><span class="line">  <span class="string">&quot;exclude&quot;</span>: [],  <span class="comment">// exclude表示要排除的、不编译的文件，它也可以指定一个列表，规则和include一样，可以是文件或文件夹，可以是相对路径或绝对路径，可以使用通配符</span></span><br><span class="line">  <span class="string">&quot;extends&quot;</span>: <span class="string">&quot;&quot;</span>,   <span class="comment">// extends可以通过指定一个其他的tsconfig.json文件路径，来继承这个配置文件里的配置，继承来的文件的配置会覆盖当前文件定义的配置。TS在3.2版本开始，支持继承一个来自Node.js包的tsconfig.json配置文件</span></span><br><span class="line">  <span class="string">&quot;compileOnSave&quot;</span>: <span class="literal">true</span>,  <span class="comment">// compileOnSave的值是true或false，如果设为true，在我们编辑了项目中的文件保存的时候，编辑器会根据tsconfig.json中的配置重新生成文件，不过这个要编辑器支持</span></span><br><span class="line">  <span class="string">&quot;references&quot;</span>: [],  <span class="comment">// 一个对象数组，指定要引用的项目</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="2-6-路由和页面跳转"><a href="#2-6-路由和页面跳转" class="headerlink" title="2.6 路由和页面跳转"></a>2.6 路由和页面跳转</h2><h3 id="2-6-1-新建路由"><a href="#2-6-1-新建路由" class="headerlink" title="2.6.1 新建路由"></a>2.6.1 新建路由</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//1.敲入命令如下</span></span><br><span class="line">$   umi g page product/index --typescript --less</span><br><span class="line"></span><br><span class="line">   create src/pages/product/index.<span class="property">js</span></span><br><span class="line">   create src/pages/product/index.<span class="property">less</span></span><br><span class="line">✔  success</span><br><span class="line"></span><br><span class="line"><span class="comment">//2.修改 .umirc.ts文件中路由配置</span></span><br><span class="line">  <span class="attr">routes</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">path</span>: <span class="string">&#x27;/&#x27;</span>,</span><br><span class="line">      <span class="comment">//注意：路径如果是相对路径，会从 src/pages 开始找起。如果指向 src 目录的文件，可以用 @，也可以用 ../。比如 component: &#x27;@/layouts/basic&#x27;</span></span><br><span class="line">      <span class="comment">//注意：这里不会生成exact:true的配置</span></span><br><span class="line">      <span class="attr">component</span>: <span class="string">&#x27;../layouts/index&#x27;</span>,</span><br><span class="line">      <span class="attr">routes</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">path</span>: <span class="string">&#x27;/product/index&#x27;</span>,</span><br><span class="line">          <span class="attr">component</span>: <span class="string">&#x27;../pages/product/index&#x27;</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123; </span><br><span class="line">          <span class="attr">path</span>: <span class="string">&#x27;/&#x27;</span>, </span><br><span class="line">          <span class="attr">component</span>: <span class="string">&#x27;../pages/index&#x27;</span> </span><br><span class="line">        &#125;</span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line">  ],</span><br><span class="line"></span><br><span class="line"><span class="comment">//3.在src目录下创建typings.d.ts 文件 </span></span><br><span class="line"><span class="comment">//模块声明文件：不写在引入less的时候ts会警告</span></span><br><span class="line">declare <span class="variable language_">module</span> <span class="string">&#x27;slash2&#x27;</span>;</span><br><span class="line">declare <span class="variable language_">module</span> <span class="string">&#x27;*.css&#x27;</span>;</span><br><span class="line">declare <span class="variable language_">module</span> <span class="string">&#x27;*.less&#x27;</span>;</span><br><span class="line">declare <span class="variable language_">module</span> <span class="string">&#x27;*.scss&#x27;</span>;</span><br><span class="line">declare <span class="variable language_">module</span> <span class="string">&#x27;*.sass&#x27;</span>;</span><br><span class="line">declare <span class="variable language_">module</span> <span class="string">&#x27;*.svg&#x27;</span>;</span><br><span class="line">declare <span class="variable language_">module</span> <span class="string">&#x27;*.png&#x27;</span>;</span><br><span class="line">declare <span class="variable language_">module</span> <span class="string">&#x27;*.jpg&#x27;</span>;</span><br><span class="line">declare <span class="variable language_">module</span> <span class="string">&#x27;*.jpeg&#x27;</span>;</span><br><span class="line">declare <span class="variable language_">module</span> <span class="string">&#x27;*.gif&#x27;</span>;</span><br><span class="line">declare <span class="variable language_">module</span> <span class="string">&#x27;*.bmp&#x27;</span>;</span><br><span class="line">declare <span class="variable language_">module</span> <span class="string">&#x27;*.tiff&#x27;</span>;</span><br><span class="line">declare <span class="variable language_">module</span> <span class="string">&#x27;omit.js&#x27;</span>;</span><br></pre></td></tr></table></figure><h3 id="2-6-2-约定式路由"><a href="#2-6-2-约定式路由" class="headerlink" title="2.6.2 约定式路由"></a>2.6.2 约定式路由</h3><p>除配置式路由外，Umi 也支持约定式路由。约定式路由也叫文件路由，就是不需要手写配置，文件系统即路由，通过目录和文件及其命名分析出路由配置。</p><p><strong>如果没有 routes 配置，Umi 会进入约定式路由模式</strong>，然后分析 <code>src/pages</code> 目录拿到路由配置。</p><p>比如以下文件结构：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">  └── pages</span><br><span class="line">    ├── index.tsx</span><br><span class="line">    └── users.tsx</span><br></pre></td></tr></table></figure><p>会得到以下路由配置，</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">  &#123; exact: true, path: &#x27;/&#x27;, component: &#x27;@/pages/index&#x27; &#125;,</span><br><span class="line">  &#123; exact: true, path: &#x27;/users&#x27;, component: &#x27;@/pages/users&#x27; &#125;,</span><br><span class="line">]</span><br></pre></td></tr></table></figure><p>需要注意的是，满足以下任意规则的文件不会被注册为路由，</p><ul><li>以 <code>.</code> 或 <code>_</code> 开头的文件或目录</li><li>以 <code>d.ts</code> 结尾的类型定义文件</li><li>以 <code>test.ts</code>、<code>spec.ts</code>、<code>e2e.ts</code> 结尾的测试文件（适用于 <code>.js</code>、<code>.jsx</code> 和 <code>.tsx</code> 文件）</li><li><code>components</code> 和 <code>component</code> 目录</li><li><code>utils</code> 和 <code>util</code> 目录</li><li>不是 <code>.js</code>、<code>.jsx</code>、<code>.ts</code> 或 <code>.tsx</code> 文件</li><li>文件内容不包含 JSX 元素</li></ul><p><strong>所以当我们把.umirc.js中的routes配置注释掉的时候，访问路径<a href="http://localhost:8000/#/product">http://localhost:8000/#/product</a>能够正常展示页面。</strong></p><h3 id="2-6-3-路由配置"><a href="#2-6-3-路由配置" class="headerlink" title="2.6.3 路由配置"></a>2.6.3 路由配置</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">component</span>: <span class="string">&#x27;@/layouts/index&#x27;</span>         <span class="comment">//配置页面模板，不同的路由可以配置不同的layout</span></span><br><span class="line">&#123; <span class="attr">path</span>: <span class="string">&#x27;/one&#x27;</span>, <span class="attr">exact</span>: <span class="literal">true</span> &#125;        <span class="comment">//严格匹配，location 是否和 path 完全对应上</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//配置子路由</span></span><br><span class="line"><span class="attr">routes</span>: [</span><br><span class="line">        &#123; <span class="attr">path</span>: <span class="string">&#x27;/list&#x27;</span>, <span class="attr">component</span>: <span class="string">&#x27;list&#x27;</span> &#125;,</span><br><span class="line">        &#123; <span class="attr">path</span>: <span class="string">&#x27;/admin&#x27;</span>, <span class="attr">component</span>: <span class="string">&#x27;admin&#x27;</span> &#125;,</span><br><span class="line">],</span><br><span class="line"></span><br><span class="line"><span class="comment">//重定向</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="attr">path</span>: <span class="string">&#x27;*&#x27;</span>,</span><br><span class="line">    <span class="attr">redirect</span>: <span class="string">&#x27;/&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 路由配置注意点：</span></span><br><span class="line"><span class="comment">   * 1.&#123;path:&quot;&quot;,component:&quot;&quot;,routes:[&#123;path:&quot;&quot;,component:&quot;&quot;&#125;]&#125;</span></span><br><span class="line"><span class="comment">   *   第一层的配置一般用来配置页面布局文件，我们不需要给它加exact:true，否则会导致routes里面的规则不能够被加载</span></span><br><span class="line"><span class="comment">   *   routes里面的规则用来配置具体路由,我们也不需要给它加exact:true，因为会默认生成</span></span><br><span class="line"><span class="comment">   * 2.一般我们不会这样写 &#123;path:&quot;/product&quot;,component:&quot;@/pages/index&quot;&#125;，还是会在每一个页面的上层套一个布局文件。</span></span><br><span class="line"><span class="comment">   *   如果我们这样写，那么会和第一种写法冲突，因为我们在访问localhost:8000/product的时候也会匹配localhost:8000/，从而导致/product路径不能匹配</span></span><br><span class="line"><span class="comment">   * 3.使用路径的时候，如果是相对路径，则参照pages目录来的。如果想要引用layout文件的中的组件，可以使用@符号，@ 符号表示src目录</span></span><br><span class="line"><span class="comment">   *</span></span><br><span class="line"><span class="comment">   * */</span></span><br></pre></td></tr></table></figure><h3 id="2-6-4-路由跳转和传参"><a href="#2-6-4-路由跳转和传参" class="headerlink" title="2.6.4 路由跳转和传参"></a>2.6.4 路由跳转和传参</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Link</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;umi&#x27;</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> () =&gt; (</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">Link</span> <span class="attr">to</span>=<span class="string">&quot;/users&quot;</span>&gt;</span>Users Page<span class="tag">&lt;/<span class="name">Link</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">);</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; history &#125; <span class="keyword">from</span> <span class="string">&#x27;umi&#x27;</span>;</span><br><span class="line"><span class="comment">// 跳转到指定路由</span></span><br><span class="line">history.<span class="title function_">push</span>(<span class="string">&#x27;/list&#x27;</span>);</span><br><span class="line"><span class="comment">// 带参数跳转到指定路由</span></span><br><span class="line">history.<span class="title function_">push</span>(<span class="string">&#x27;/list?a=b&#x27;</span>);</span><br><span class="line">history.<span class="title function_">push</span>(&#123;</span><br><span class="line">  <span class="attr">pathname</span>: <span class="string">&#x27;/list&#x27;</span>,</span><br><span class="line">  <span class="attr">state</span>: &#123;</span><br><span class="line">    <span class="attr">a</span>: <span class="string">&#x27;b&#x27;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// 跳转到上一个路由</span></span><br><span class="line">history.<span class="title function_">goBack</span>();</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//路由组件可通过 props 获取到以下属性，</span></span><br><span class="line"></span><br><span class="line">match，当前路由和 url match 后的对象，包含 params、path、url 和 isExact 属性</span><br><span class="line">location，表示应用当前出于哪个位置，包含 pathname、search、query 等属性</span><br><span class="line">history，同 api history 接口</span><br><span class="line">route，当前路由配置，包含 path、exact、component、routes 等</span><br><span class="line">routes，全部路由信息</span><br></pre></td></tr></table></figure><h3 id="2-6-5-动态路由参数"><a href="#2-6-5-动态路由参数" class="headerlink" title="2.6.5 动态路由参数"></a>2.6.5 动态路由参数</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//1.新建productDetail/index/[id].tsx</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> styles <span class="keyword">from</span> <span class="string">&#x27;./productDetail.less&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//要从props中获取location history match等参数，需要引入RouteComponentProps类型</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">RouteComponentProps</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;react-router-dom&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">RouterInfo</span> &#123;</span><br><span class="line">  <span class="attr">id</span>: <span class="built_in">string</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> (<span class="attr">props</span>: <span class="title class_">RouteComponentProps</span>&lt;<span class="title class_">RouterInfo</span>&gt;) =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">h1</span> <span class="attr">className</span>=<span class="string">&#123;styles.title&#125;</span>&gt;</span>Page productDetail/index ---&#123;props.match.params.id&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//2.修改.umirc.ts</span></span><br><span class="line"><span class="attr">routes</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">path</span>: <span class="string">&#x27;/&#x27;</span>,</span><br><span class="line">      <span class="comment">//注意：这边文件的路径是相对于src/.mui中来确定的</span></span><br><span class="line">      <span class="attr">component</span>: <span class="string">&#x27;../layouts/index&#x27;</span>,</span><br><span class="line">      <span class="attr">routes</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">path</span>: <span class="string">&#x27;/product/index&#x27;</span>,</span><br><span class="line">          <span class="attr">component</span>: <span class="string">&#x27;../pages/product/index&#x27;</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123; </span><br><span class="line">          <span class="attr">path</span>: <span class="string">&#x27;/productDetail/:id&#x27;</span>, </span><br><span class="line">          <span class="attr">component</span>: <span class="string">&#x27;../pages/productDetail/index/[id]&#x27;</span> </span><br><span class="line">        &#125;,</span><br><span class="line">        &#123; </span><br><span class="line">          <span class="attr">path</span>: <span class="string">&#x27;/&#x27;</span>, </span><br><span class="line">          <span class="attr">component</span>: <span class="string">&#x27;../pages/index&#x27;</span> </span><br><span class="line">        &#125;</span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br></pre></td></tr></table></figure><h2 id="2-7-样式和资源文件"><a href="#2-7-样式和资源文件" class="headerlink" title="2.7 样式和资源文件"></a>2.7 样式和资源文件</h2><h3 id="2-7-1-全局样式"><a href="#2-7-1-全局样式" class="headerlink" title="2.7.1 全局样式"></a>2.7.1 全局样式</h3><p>Umi 中约定 <code>src/global.css</code> 为全局样式，如果存在此文件，会被自动引入到入口文件最前面。</p><p>比如用于覆盖样式，</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.ant-select-selection</span> &#123;</span><br><span class="line">  <span class="attribute">max-height</span>: <span class="number">51px</span>;</span><br><span class="line">  <span class="attribute">overflow</span>: auto;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-7-2-CSS-Modules"><a href="#2-7-2-CSS-Modules" class="headerlink" title="2.7.2 CSS Modules"></a>2.7.2 CSS Modules</h3><p>Umi 会自动识别 CSS Modules 的使用，你把他当做 CSS Modules 用时才是 CSS Modules。</p><p>比如：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// CSS Modules</span></span><br><span class="line"><span class="keyword">import</span> styles <span class="keyword">from</span> <span class="string">&#x27;./foo.css&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 非 CSS Modules</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;./foo.css&#x27;</span>;</span><br></pre></td></tr></table></figure><h3 id="2-7-3-CSS-预处理器"><a href="#2-7-3-CSS-预处理器" class="headerlink" title="2.7.3 CSS 预处理器"></a>2.7.3 CSS 预处理器</h3><p>Umi 内置支持 less，不支持 sass 和 stylus，但如果有需求，可以通过 chainWebpack 配置或者 Umi 插件的形式支持。</p><h3 id="2-7-4-ts中使用图片"><a href="#2-7-4-ts中使用图片" class="headerlink" title="2.7.4 ts中使用图片"></a>2.7.4 ts中使用图片</h3><p>通过 require 引用相对路径的图片。</p><p>比如：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> () =&gt; <span class="language-xml"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&#123;require(</span>&#x27;<span class="attr">.</span>/<span class="attr">foo.png</span>&#x27;)&#125; /&gt;</span></span></span><br></pre></td></tr></table></figure><p>支持别名，比如通过 <code>@</code> 指向 src 目录：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> () =&gt; <span class="language-xml"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&#123;require(</span>&#x27;@/<span class="attr">foo.png</span>&#x27;)&#125; /&gt;</span></span></span><br></pre></td></tr></table></figure><h3 id="2-7-5-CSS-里使用图片"><a href="#2-7-5-CSS-里使用图片" class="headerlink" title="2.7.5 CSS 里使用图片"></a>2.7.5 CSS 里使用图片</h3><p>通过相对路径引用。</p><p>比如，</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">.<span class="property">logo</span> &#123;</span><br><span class="line">  <span class="attr">background</span>: <span class="title function_">url</span>(./foo.<span class="property">png</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>CSS 里也支持别名，但需要在前面加 <code>~</code> 前缀，</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">.<span class="property">logo</span> &#123;</span><br><span class="line">  <span class="attr">background</span>: <span class="title function_">url</span>(~@/foo.<span class="property">png</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>注意：</p><ol><li>这是 webpack 的规则，如果切到其他打包工具，可能会有变化</li><li>less 中同样适用</li></ol><h3 id="2-7-6-Base64-编译"><a href="#2-7-6-Base64-编译" class="headerlink" title="2.7.6 Base64 编译"></a>2.7.6 Base64 编译</h3><p>通过相对路径引入图片的时候，如果图片小于 10K，会被编译为 Base64，否则会被构建为独立的图片文件。</p><p>10K 这个阈值可以通过 <a href="https://umijs.org/zh-CN/config#inlinelimit">inlineLimit 配置</a>修改。</p><h2 id="2-8-国际化"><a href="#2-8-国际化" class="headerlink" title="2.8 国际化"></a>2.8 国际化</h2><p>@umijs&#x2F;plugin-locale是umi中的一个国际化插件，用于解决 i18n 问题。</p><h3 id="2-8-1-开启国际化"><a href="#2-8-1-开启国际化" class="headerlink" title="2.8.1 开启国际化"></a>2.8.1 开启国际化</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//在.umirc.ts中配置locale之后即开启该插件</span></span><br><span class="line">  <span class="attr">locale</span>: &#123;</span><br><span class="line">    <span class="comment">//默认的语言环境</span></span><br><span class="line">    <span class="attr">default</span>: <span class="string">&#x27;zh-CN&#x27;</span>,</span><br><span class="line">    <span class="comment">//antd开启国际化</span></span><br><span class="line">    <span class="attr">antd</span>: <span class="literal">true</span>, </span><br><span class="line">    <span class="comment">// default true, when it is true, will use `navigator.language` overwrite default</span></span><br><span class="line">    <span class="attr">baseNavigator</span>: <span class="literal">false</span>,</span><br><span class="line">  &#125;,</span><br></pre></td></tr></table></figure><h3 id="2-8-2-约定式多语言支持"><a href="#2-8-2-约定式多语言支持" class="headerlink" title="2.8.2 约定式多语言支持"></a>2.8.2 约定式多语言支持</h3><p>比如以下目录，项目就拥有了 <code>zh-CN</code> 与 <code>en-US</code> 国际化语言切换(文件名必须要符合规范)：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">+ src</span><br><span class="line">  + locales</span><br><span class="line">    - zh-CN.ts</span><br><span class="line">    - en-US.ts</span><br><span class="line">  + pages</span><br></pre></td></tr></table></figure><h3 id="2-8-3-主要API"><a href="#2-8-3-主要API" class="headerlink" title="2.8.3 主要API"></a>2.8.3 主要API</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"># getAllLocales 获取当前获得所有国际化文件的列表，默认会在 locales 文件夹下寻找类似 en-<span class="variable constant_">US</span>.(js|json|ts) 文件。</span><br><span class="line"><span class="keyword">import</span> &#123; getAllLocales &#125; <span class="keyword">from</span> <span class="string">&#x27;umi&#x27;</span>;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">getAllLocales</span>()); <span class="comment">// [en-US,zh-CN,...]</span></span><br><span class="line"></span><br><span class="line"># getLocale 将获得当前选择的语言。</span><br><span class="line"><span class="keyword">import</span> &#123; getLocale &#125; <span class="keyword">from</span> <span class="string">&#x27;umi&#x27;</span>;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">getLocale</span>()); <span class="comment">// en-US | zh-CN</span></span><br><span class="line"></span><br><span class="line"># useIntl 是最常用的 api,它可以获得 formatMessage 等 api 来进行具体的值绑定。</span><br><span class="line"><span class="keyword">import</span> &#123; useIntl &#125; <span class="keyword">from</span> <span class="string">&#x27;umi&#x27;</span>;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">a</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">&#123;useIntl().formatMessage(&#123; id: &#x27;index.start&#x27; &#125;)&#125;</span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"># setLocale 设置切换语言，默认会刷新页面，可以通过设置第二个参数为 <span class="literal">false</span> ，来实现无刷新动态切换。</span><br><span class="line"><span class="keyword">import</span> &#123; setLocale &#125; <span class="keyword">from</span> <span class="string">&#x27;umi&#x27;</span>;</span><br><span class="line"><span class="comment">// 刷新页面</span></span><br><span class="line"><span class="title function_">setLocale</span>(<span class="string">&#x27;zh-TW&#x27;</span>, <span class="literal">true</span>);</span><br><span class="line"><span class="comment">// 不刷新页面</span></span><br><span class="line"><span class="title function_">setLocale</span>(<span class="string">&#x27;zh-TW&#x27;</span>, <span class="literal">false</span>);</span><br></pre></td></tr></table></figure><h1 id="3-flux和redux"><a href="#3-flux和redux" class="headerlink" title="3.flux和redux"></a>3.flux和redux</h1><h2 id="3-1-Flux"><a href="#3-1-Flux" class="headerlink" title="3.1 Flux"></a>3.1 Flux</h2><p>Flux 是一种架构思想，专门解决软件的结构问题。它跟<a href="http://www.ruanyifeng.com/blog/2007/11/mvc.html">MVC 架构</a>是同一类东西，但是更加<a href="http://www.infoq.com/news/2014/05/facebook-mvc-flux">简单和清晰</a>。</p><p>首先，Flux将一个应用分成四个部分。</p><blockquote><ul><li><strong>View</strong>： 视图层</li><li><strong>Action</strong>（动作）：表示数据从应用程序发送到store的有效信息负载。它是 store 数据的<strong>唯一</strong>来源。一般来说你会通过 Dispatcher派发器将 action 传到 store。</li><li><strong>Dispatcher</strong>（派发器）：用来接收Actions、执行回调函数</li><li><strong>Store</strong>（数据层）：用来存放应用的状态，一旦发生变动，就提醒Views要更新页面</li></ul></blockquote><p><strong>Flux 的最大特点，就是数据的”单向流动”。</strong></p><blockquote><ol><li>用户访问 View</li><li>用户在View中Dispatcher一个Action，要求 Store 进行相应的更新</li><li>Store 更新后，发出一个”change”事件</li><li>View 收到”change”事件后，更新页面</li></ol></blockquote><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://i.loli.net/2020/11/03/9EjkK1pgADicL3e.png" alt="1553222968163"></p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://i.loli.net/2020/11/03/mC1Oh5XYtkM3uLi.png" alt="1553223019430"></p><h2 id="3-2-Redux"><a href="#3-2-Redux" class="headerlink" title="3.2 Redux"></a>3.2 Redux</h2><p><a href="http://cn.redux.js.org/">http://cn.redux.js.org/</a></p><p>我们把Flux看做一个框架的理念的话，Redux是Flux的一种实现。Redux是SPA单页面应用程序中多个组件之间共享数据的一种方式。</p><p>Flux的基本原则是“单向数据流”，Redux在此基础上强调三个基本原则：</p><blockquote><p>1.唯一数据源 ：唯一数据源指的是应用的状态数据应该只存储在唯一的一个Store上。<br>2.保持状态只读 ： 保持状态只读，就是说不能去直接修改状态，要修改Store的状态，必须要通过派发一个action对象完成。<br>3.数据改变只能通过纯函数完成 ：这里所说的纯函数就是把Reducer，Reducer描述了state状态如何修改。Redux这个名字的前三个字母Red代表的就是Reducer，其实Redux名字的含义就是Reducer+Flux。</p></blockquote><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://i.loli.net/2020/11/03/tbZQaYjVL4PmpC3.png"></p><h2 id="3-3-dva"><a href="#3-3-dva" class="headerlink" title="3.3 dva"></a>3.3 dva</h2><h3 id="3-3-1-dva介绍"><a href="#3-3-1-dva介绍" class="headerlink" title="3.3.1 dva介绍"></a>3.3.1 dva介绍</h3><p>dva由阿里架构师 sorrycc 带领 team 完成的一套前端框架，dva 是一个基于 <a href="https://github.com/reduxjs/redux">redux</a> 和 <a href="https://github.com/redux-saga/redux-saga">redux-saga</a> (异步处理)的数据流方案，然后为了简化开发体验，dva 还额外内置了 <a href="https://github.com/ReactTraining/react-router">react-router</a> 和 <a href="https://github.com/github/fetch">fetch</a>，所以也可以理解为一个轻量级的应用框架。</p><blockquote><p><strong>特性</strong></p></blockquote><ul><li><strong>易学易用</strong>，仅有 6 个 api，对 redux 用户尤其友好，<a href="https://umijs.org/guide/with-dva.html">配合 umi 使用</a>后更是降低为 0 API</li><li><strong>elm 概念</strong>，通过 reducers, effects 和 subscriptions 组织 model。elm是专注web前端的纯函数式语言。</li><li><strong>插件机制</strong>，比如 <a href="https://github.com/dvajs/dva/tree/master/packages/dva-loading">dva-loading</a> 可以自动处理 loading 状态，不用一遍遍地写 showLoading 和 hideLoading</li><li><strong>支持 HMR</strong>，基于 <a href="https://github.com/dvajs/babel-plugin-dva-hmr">babel-plugin-dva-hmr</a> 实现 components、routes 和 models 的 HMR</li></ul><h3 id="3-3-2-dva的数据流"><a href="#3-3-2-dva的数据流" class="headerlink" title="3.3.2 dva的数据流"></a>3.3.2 dva的数据流</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://i.loli.net/2020/11/03/Y7vxJKX52LFrBSV.png" alt="1601034916207"></p><p>用户在 <strong>视图层</strong> 会触发(dispatch)一些动作(action)，这些动作会传递到我们的Model.js 这个文件当中，根据action的名字，找到对用的方法(effect 或者 reducer) ，然后更新state，视图重新渲染。</p><h3 id="3-3-3-dva核心概念"><a href="#3-3-3-dva核心概念" class="headerlink" title="3.3.3 dva核心概念"></a>3.3.3 dva核心概念</h3><h4 id="a-model"><a href="#a-model" class="headerlink" title="a) model"></a>a) model</h4><p>其中，model 是 DVA 中最重要的概念，基本的属性如下：</p><ul><li>namespace：model 的命名空间，只能用字符串。一个大型应用可能包含多个 model，通过namespace区分。</li><li>state：当前 model 状态的初始值，表示当前状态。</li><li>reducers：用于处理同步操作，可以修改 state，由 action 触发。</li><li>effects：用于处理异步操作（例如：与服务端交互）和业务逻辑，也是由 action 触发。但是，它不可以修改 state，要通过触发 action 调用 reducer 实现对 state 的间接操作。</li></ul><h4 id="b-connect"><a href="#b-connect" class="headerlink" title="b) connect"></a>b) connect</h4><p>连接dva model和react组件，目的是为了让组件获取model中的数据和驱动model改变的方法。</p><h4 id="c-dispatch"><a href="#c-dispatch" class="headerlink" title="c) dispatch"></a>c) dispatch</h4><p>dispatch 函数就是和 dva model 打交道的唯一途径， dispatch 函数接受一个 action对象 作为入参。action对象需要有type字段</p><h4 id="d-action"><a href="#d-action" class="headerlink" title="d) action"></a>d) action</h4><p>action：一个对象，是 reducers 及 effects 的触发器，通过dispatch来触发，action对象需要有type字段</p><h2 id="3-4-dva实战"><a href="#3-4-dva实战" class="headerlink" title="3.4 dva实战"></a>3.4 dva实战</h2><h3 id="3-4-1-改造项目结构"><a href="#3-4-1-改造项目结构" class="headerlink" title="3.4.1 改造项目结构"></a>3.4.1 改造项目结构</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://i.loli.net/2020/11/03/lXVsRnyqxHe4iIa.png" alt="1601195437274"></p><h3 id="3-4-2-mock"><a href="#3-4-2-mock" class="headerlink" title="3.4.2 mock"></a>3.4.2 mock</h3><h4 id="a-mock介绍"><a href="#a-mock介绍" class="headerlink" title="a) mock介绍"></a>a) mock介绍</h4><p>Mock 是高效、易用、功能强大的 api 管理平台,旨在为开发、产品、测试人员提供更优雅的接口管理服务。可以帮助开发者轻松创建、发布、维护 API。主要用于项目的开发测试阶段。</p><p><a href="https://github.com/nuysoft/Mock/wiki">https://github.com/nuysoft/Mock/wiki</a></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">#<span class="number">1.</span> 安装mockjs</span><br><span class="line">yarn add mockjs --dev</span><br><span class="line"></span><br><span class="line">#<span class="number">2.</span> 修改.<span class="property">umirc</span>.<span class="property">ts</span>  开启mock</span><br><span class="line">  <span class="attr">mock</span>: &#123;&#125;</span><br><span class="line"></span><br><span class="line">#<span class="number">3.</span> mock基本使用  </span><br><span class="line"><span class="comment">// 在项目mock文件夹下新建user.ts  代码如下</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Request</span>, <span class="title class_">Response</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;express&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Mock</span> <span class="keyword">from</span> <span class="string">&#x27;mockjs&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="comment">//测试mock   mock语法介绍 todos.....</span></span><br><span class="line">  <span class="string">&#x27;/api/test&#x27;</span>: &#123; <span class="attr">id</span>: <span class="number">1</span>, <span class="attr">username</span>: <span class="string">&#x27;kenny&#x27;</span>, <span class="attr">sex</span>: <span class="number">6</span> &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="string">&#x27;GET /api/hi&#x27;</span>: <span class="function">(<span class="params">req: Request, res: Response</span>) =&gt;</span> &#123;</span><br><span class="line">    res.<span class="title function_">json</span>(&#123;</span><br><span class="line">      <span class="attr">id</span>: <span class="number">1</span>,</span><br><span class="line">      <span class="attr">username</span>: <span class="string">&#x27;jaja&#x27;</span>,</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;,</span><br><span class="line">    </span><br><span class="line">  <span class="string">&#x27;GET /api/mock&#x27;</span>: <span class="title class_">Mock</span>.<span class="title function_">mock</span>(&#123;</span><br><span class="line">    <span class="attr">success</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="comment">//随机生成一段中文</span></span><br><span class="line">    <span class="attr">message</span>: <span class="string">&#x27;@cparagraph&#x27;</span>,</span><br><span class="line">    <span class="comment">// 属性 list 的值是一个数组，其中含有 1 到 5 个元素</span></span><br><span class="line">    <span class="string">&#x27;list|1-5&#x27;</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="comment">// 属性 sid 是一个自增数，起始值为 1，每次增 1</span></span><br><span class="line">        <span class="string">&#x27;sid|+1&#x27;</span>: <span class="number">1</span>,</span><br><span class="line">        <span class="comment">// 属性 userId 是一个5位的随机码</span></span><br><span class="line">        <span class="string">&#x27;userId|5&#x27;</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">    ],</span><br><span class="line">  &#125;),</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h4 id="b-mock-user-js使用mock提供接口数据"><a href="#b-mock-user-js使用mock提供接口数据" class="headerlink" title="b) mock&#x2F;user.js使用mock提供接口数据"></a>b) mock&#x2F;user.js使用mock提供接口数据</h4><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Request</span>, <span class="title class_">Response</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;express&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Mock</span> <span class="keyword">from</span> <span class="string">&#x27;mockjs&#x27;</span>;</span><br><span class="line"></span><br><span class="line">interface <span class="title class_">UserType</span> &#123;</span><br><span class="line">  <span class="attr">id</span>: number;</span><br><span class="line">  <span class="attr">name</span>: string;</span><br><span class="line">  <span class="attr">email</span>: string;</span><br><span class="line">  <span class="attr">website</span>: string;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="attr">users</span>: <span class="title class_">UserType</span>[] = [</span><br><span class="line">  &#123; <span class="attr">id</span>: <span class="number">1</span>, <span class="attr">name</span>: <span class="string">&#x27;zhangsan&#x27;</span>, <span class="attr">email</span>: <span class="string">&#x27;zhangsan@qq.com&#x27;</span>, <span class="attr">website</span>: <span class="string">&#x27;xx.com&#x27;</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">id</span>: <span class="number">2</span>, <span class="attr">name</span>: <span class="string">&#x27;lisi&#x27;</span>, <span class="attr">email</span>: <span class="string">&#x27;lisi@qq.com&#x27;</span>, <span class="attr">website</span>: <span class="string">&#x27;ll.com&#x27;</span> &#125;,</span><br><span class="line">];</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="comment">//查询所有用户</span></span><br><span class="line">  <span class="string">&#x27;GET /api/users&#x27;</span>: <span class="function">(<span class="params">req: Request, res: Response</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 获取参数信息</span></span><br><span class="line">    <span class="keyword">var</span> page = req.<span class="property">query</span>.<span class="property">page</span>;</span><br><span class="line">    <span class="keyword">var</span> data = &#123; <span class="attr">list</span>: users, <span class="attr">total</span>: <span class="number">105</span>, <span class="attr">page</span>: page &#125;;</span><br><span class="line">    res.<span class="title function_">json</span>(data);</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// GET POST 可省略</span></span><br><span class="line">  <span class="string">&#x27;/api/users/:id&#x27;</span>: <span class="function">(<span class="params">req: Request, res: Response</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> id = <span class="built_in">parseInt</span>(req.<span class="property">params</span>.<span class="property">id</span>);</span><br><span class="line">    <span class="keyword">const</span> u = users.<span class="title function_">find</span>(<span class="function">(<span class="params">item</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (item.<span class="property">id</span> === id) &#123;</span><br><span class="line">        <span class="keyword">return</span> item;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    res.<span class="title function_">json</span>(u);</span><br><span class="line">  &#125;,</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//根据id删除用户</span></span><br><span class="line">  <span class="string">&#x27;/api/users/delete/:id&#x27;</span>: <span class="function">(<span class="params">req: Request, res: Response</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> id = <span class="built_in">parseInt</span>(req.<span class="property">params</span>.<span class="property">id</span>);</span><br><span class="line">    <span class="keyword">const</span> index = users.<span class="title function_">findIndex</span>(<span class="function">(<span class="params">item</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (item.<span class="property">id</span> == id) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    users.<span class="title function_">splice</span>(index, <span class="number">1</span>);</span><br><span class="line">    res.<span class="title function_">json</span>(&#123;</span><br><span class="line">      <span class="attr">status</span>: <span class="number">200</span>,</span><br><span class="line">      <span class="attr">message</span>: <span class="string">&#x27;删除成功&#x27;</span>,</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 支持自定义函数，API 参考 express@4</span></span><br><span class="line">  <span class="string">&#x27;POST /api/users/create&#x27;</span>: <span class="function">(<span class="params">req: Request, res: Response</span>) =&gt;</span> &#123;</span><br><span class="line">    res.<span class="title function_">end</span>(<span class="string">&#x27;OK&#x27;</span>);</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h3 id="3-4-3-请求的封装"><a href="#3-4-3-请求的封装" class="headerlink" title="3.4.3 请求的封装"></a>3.4.3 请求的封装</h3><h4 id="a-fetch和umi-request"><a href="#a-fetch和umi-request" class="headerlink" title="a) fetch和umi-request"></a>a) fetch和umi-request</h4><p><strong>fetch</strong>是es6中推出的一种可替代ajax获取&#x2F;提交数据的技术，有些高级浏览器已经可以使用window.fecth使用了。相比于使用jQuery.ajax更轻量，而且它支持Promise，更加符合现在的编程习惯。但是，一定记住fetch不是ajax的进一步封装，而是原生js，没有使用XMLHttpRequest对象。</p><p><strong><a href="https://link.zhihu.com/?target=https://github.com/umijs/umi-request">umi-request</a></strong> 是基于 fetch 封装的开源 http 请求库，旨在为开发者提供一个统一的 API 调用方式，同时简化使用方式，提供了请求层常用的功能：</p><ul><li>URL 参数自动序列化</li><li>POST 数据提交方式简化</li><li>Response 返回处理简化</li><li>请求超时处理</li><li>请求缓存支持</li><li>GBK 编码处理</li><li>统一的错误处理方式</li><li>请求取消支持</li><li>Node 环境 http 请求</li><li>拦截器机制</li><li>洋葱中间件机制</li></ul><p><strong>umi-request和fetch和axios区别</strong></p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://i.loli.net/2020/11/03/8LAOuYdHnJVBwzb.png"></p><h4 id="b-app-ts运行时配置"><a href="#b-app-ts运行时配置" class="headerlink" title="b) app.ts运行时配置"></a>b) app.ts运行时配置</h4><p>运行时配置文件，可以在这里扩展运行时的能力，比如修改路由、修改 render 方法等。</p><p>Umi约定 <code>src/app.tsx</code> 为运行时配置。比如我们可以再在 <code>src/app.ts</code> 中配置一些运行时的配置项来实现部分自定义需求。示例配置如下：</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//通知组件</span></span><br><span class="line"><span class="keyword">import</span> &#123; notification &#125; <span class="keyword">from</span> <span class="string">&#x27;antd&#x27;</span>;</span><br><span class="line"><span class="comment">//RequestConfig 请求的配置类型</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">RequestConfig</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;umi&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">ResponseError</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;umi-request&#x27;</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 请求出错后的异常处理程序</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">errorHandler</span> = (<span class="params">error: ResponseError</span>) =&gt; &#123;</span><br><span class="line">  notification.<span class="title function_">error</span>(&#123;</span><br><span class="line">    <span class="attr">description</span>: <span class="string">&#x27;您的网络发生异常，无法连接服务器&#x27;</span>,</span><br><span class="line">    <span class="attr">message</span>: <span class="string">&#x27;网络异常&#x27;</span>,</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="keyword">throw</span> error;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//导出请求对象</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="attr">request</span>: <span class="title class_">RequestConfig</span> = &#123;</span><br><span class="line">  errorHandler,</span><br><span class="line">  <span class="attr">requestInterceptors</span>: [</span><br><span class="line">    <span class="function">(<span class="params">url, options</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;请求拦截器&#x27;</span>);</span><br><span class="line">      <span class="keyword">return</span> &#123;</span><br><span class="line">        url,</span><br><span class="line">        options,</span><br><span class="line">      &#125;;</span><br><span class="line">    &#125;,</span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">responseInterceptors</span>: [</span><br><span class="line">    <span class="function">(<span class="params">response, options</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;响应拦截器&#x27;</span>)</span><br><span class="line">      <span class="keyword">return</span> response;</span><br><span class="line">    &#125;,</span><br><span class="line">  ],</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h4 id="c-封装service"><a href="#c-封装service" class="headerlink" title="c) 封装service"></a>c) 封装service</h4><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//pages/user/services/index.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; request &#125; <span class="keyword">from</span> <span class="string">&#x27;umi&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">queryUserList</span>(<span class="params">&#123; page = <span class="number">1</span> &#125;</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">request</span>(<span class="string">`/api/users?page=<span class="subst">$&#123;page&#125;</span>`</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-4-4-新建页面-发送请求"><a href="#3-4-4-新建页面-发送请求" class="headerlink" title="3.4.4 新建页面 发送请求"></a>3.4.4 新建页面 发送请求</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//1.创建页面</span></span><br><span class="line">umi g page user/index --typescript --less</span><br><span class="line"></span><br><span class="line"><span class="comment">//2.配置路由  .umirc.ts</span></span><br><span class="line"><span class="attr">routes</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">path</span>: <span class="string">&#x27;/&#x27;</span>,</span><br><span class="line">        <span class="comment">//注意：这边文件的路径是相对于src/.mui中来确定的</span></span><br><span class="line">        <span class="attr">component</span>: <span class="string">&#x27;../layouts/index&#x27;</span>,</span><br><span class="line">        <span class="attr">routes</span>: [</span><br><span class="line">            &#123; </span><br><span class="line">                <span class="attr">path</span>: <span class="string">&#x27;/&#x27;</span>, </span><br><span class="line">                <span class="attr">component</span>: <span class="string">&#x27;../pages/index&#x27;</span> </span><br><span class="line">            &#125;,</span><br><span class="line">            &#123; </span><br><span class="line">                <span class="attr">path</span>: <span class="string">&#x27;/user&#x27;</span>, </span><br><span class="line">                <span class="attr">component</span>: <span class="string">&#x27;../pages/user/index&#x27;</span> </span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;</span><br><span class="line">],</span><br><span class="line"></span><br><span class="line"><span class="comment">//3.pages/user/index.tsx</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">React</span>, &#123; useEffect &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> styles <span class="keyword">from</span> <span class="string">&#x27;./index.less&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; queryUserList &#125; <span class="keyword">from</span> <span class="string">&#x27;./services&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> () =&gt; &#123;</span><br><span class="line">  <span class="comment">//componentDidMount</span></span><br><span class="line">  <span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">getUsers</span>();</span><br><span class="line">  &#125;, []);</span><br><span class="line"></span><br><span class="line">  <span class="comment">//发送请求获取数据</span></span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">getUsers</span> = <span class="keyword">async</span> (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">let</span> result = <span class="keyword">await</span> <span class="title function_">queryUserList</span>(&#123; <span class="attr">page</span>: <span class="number">1</span> &#125;);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(result);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">h1</span> <span class="attr">className</span>=<span class="string">&#123;styles.title&#125;</span>&gt;</span>Page user/index<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h3 id="3-4-5-编写dva-model"><a href="#3-4-5-编写dva-model" class="headerlink" title="3.4.5 编写dva model"></a>3.4.5 编写dva model</h3><p>dva 通过 <code>model</code> 的概念把一个领域的模型管理起来，包含同步更新 state 的 reducers，处理异步逻辑的 effects，订阅数据源的 subscriptions 。</p><p>好处在于可以统一管理模型数据和把模型数据共享到组件中。</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// user/models/index.ts</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//Effect 异步操作     Reducer  纯函数      Subscription 订阅更新</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Effect</span>, <span class="title class_">Reducer</span>, <span class="title class_">Subscription</span>, <span class="title class_">Action</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;umi&#x27;</span>;</span><br><span class="line"><span class="comment">//查询用户的接口</span></span><br><span class="line"><span class="keyword">import</span> &#123; queryUserList &#125; <span class="keyword">from</span> <span class="string">&#x27;../services&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> interface <span class="title class_">UserItem</span> &#123;</span><br><span class="line">  <span class="attr">id</span>: number;</span><br><span class="line">  <span class="attr">name</span>: string;</span><br><span class="line">  <span class="attr">email</span>: string;</span><br><span class="line">  <span class="attr">website</span>: string;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//声明用户模块state的数据类型  ?表示可有可无</span></span><br><span class="line"><span class="keyword">export</span> interface <span class="title class_">UserModelState</span> &#123;</span><br><span class="line">  list?: <span class="title class_">UserItem</span>[];</span><br><span class="line">  total?: number;</span><br><span class="line">  page?: number;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//声明用户model的数据类型</span></span><br><span class="line"><span class="keyword">export</span> interface <span class="title class_">UserModelType</span> &#123;</span><br><span class="line">  <span class="comment">//名称空间</span></span><br><span class="line">  <span class="attr">namespace</span>: <span class="string">&#x27;user&#x27;</span>;</span><br><span class="line">  <span class="comment">//state数据</span></span><br><span class="line">  <span class="attr">state</span>: <span class="title class_">UserModelState</span>;</span><br><span class="line">  <span class="comment">//异步方法</span></span><br><span class="line">  <span class="attr">effects</span>: &#123;</span><br><span class="line">    <span class="attr">fetchUserList</span>: <span class="title class_">Effect</span>;</span><br><span class="line">    removeUserById?: <span class="title class_">Effect</span>;</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="comment">//纯函数</span></span><br><span class="line">  <span class="attr">reducers</span>: &#123;</span><br><span class="line">    <span class="attr">save</span>: <span class="title class_">Reducer</span>&lt;<span class="title class_">UserModelState</span>&gt;;</span><br><span class="line">    removeById?: <span class="title class_">Reducer</span>&lt;<span class="title class_">UserModelState</span>&gt;;</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="comment">//订阅更新</span></span><br><span class="line">  subscriptions?: &#123; <span class="attr">setup</span>: <span class="title class_">Subscription</span> &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//声明UserModel</span></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">UserModel</span>: <span class="title class_">UserModelType</span> = &#123;</span><br><span class="line">  <span class="attr">namespace</span>: <span class="string">&#x27;user&#x27;</span>,</span><br><span class="line">  <span class="attr">state</span>: &#123;</span><br><span class="line">    <span class="attr">list</span>: [], <span class="comment">//所有用户信息的数组</span></span><br><span class="line">    <span class="attr">total</span>: <span class="number">0</span>, <span class="comment">//总用户个数</span></span><br><span class="line">    <span class="attr">page</span>: <span class="number">0</span>, <span class="comment">//当前页码</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">//纯函数  操作state</span></span><br><span class="line">  <span class="attr">reducers</span>: &#123;</span><br><span class="line">    <span class="title function_">save</span>(<span class="params">state, &#123; payload &#125;</span>) &#123;</span><br><span class="line">      <span class="keyword">const</span> &#123; list, total, page &#125; = payload;</span><br><span class="line">      <span class="comment">// 复制数组，将list, total, page内容放到到state</span></span><br><span class="line">      <span class="keyword">return</span> &#123; ...state, list, total, page &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">//用于处理异步操作和业务逻辑，不直接修改 state，简单的来说，就是获取从服务端获取数据，并且发起一个 action 交给 reducer。其中它用到了redux-saga，里面有几个常用的函数</span></span><br><span class="line">  <span class="attr">effects</span>: &#123;</span><br><span class="line">    <span class="comment">// * 表示生成器函数，该函数会返回一个迭代器</span></span><br><span class="line">    <span class="comment">// 参数 payload 表示有效负载的数据，在外部通过dispatch传递</span></span><br><span class="line">    <span class="comment">// put:  用于触发action  yield put(&#123; type: &#x27;todos/add&#x27;, payload: &#x27;Learn Dva&#x27;&#125;);</span></span><br><span class="line">    <span class="comment">// call:用于调用异步逻辑，支持Promise，第一个参数是你要调用的函数，第二个参数开始是你要传递的参。const result = yield call(fetch, &#x27;/todos&#x27;);</span></span><br><span class="line">    <span class="comment">// select:用于从state里获取数据。const todos = yield select(state =&gt; state.todos);</span></span><br><span class="line">    *<span class="title function_">fetchUserList</span>(<span class="params">&#123; payload: &#123; page = <span class="number">1</span> &#125; &#125;, &#123; call, put &#125;</span>) &#123;</span><br><span class="line">      <span class="keyword">const</span> &#123; list, total &#125; = <span class="keyword">yield</span> <span class="title function_">call</span>(queryUserList, &#123; page &#125;);</span><br><span class="line">      <span class="keyword">yield</span> <span class="title function_">put</span>(&#123;</span><br><span class="line">        <span class="attr">type</span>: <span class="string">&#x27;save&#x27;</span>,</span><br><span class="line">        <span class="attr">payload</span>: &#123;</span><br><span class="line">          <span class="attr">list</span>: list,</span><br><span class="line">          <span class="attr">total</span>: <span class="built_in">parseInt</span>(total, <span class="number">10</span>),</span><br><span class="line">          <span class="attr">page</span>: <span class="built_in">parseInt</span>(page, <span class="number">10</span>),</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">UserModel</span>;</span><br></pre></td></tr></table></figure><h3 id="3-4-6-编写页面"><a href="#3-4-6-编写页面" class="headerlink" title="3.4.6 编写页面"></a>3.4.6 编写页面</h3><p>到这里，我们已经单独完成了 model 和 页面，那么他们如何串联起来呢?</p><p>dva 提供了 <code>connect</code> 方法。如果你熟悉 redux，这个 connect 来自 react-redux。</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//pages/user/index.tsx</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">React</span>, &#123; <span class="variable constant_">FC</span>, useEffect &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//ConnectProps connect高阶函数的属性类型</span></span><br><span class="line"><span class="comment">//Loading 数据加载状态类型</span></span><br><span class="line"><span class="comment">//connect 高阶函数，主要作用将model和当前组件连接起来</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">ConnectProps</span>, <span class="title class_">Loading</span>, connect &#125; <span class="keyword">from</span> <span class="string">&#x27;umi&#x27;</span>;</span><br><span class="line"><span class="comment">//users这个namespace的数据类型</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">UserModelState</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;./models&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//声明当前页面的属性类型</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">PageProps</span> <span class="keyword">extends</span> <span class="title class_">ConnectProps</span> &#123;</span><br><span class="line">  <span class="attr">user</span>: <span class="title class_">UserModelState</span>;</span><br><span class="line">  <span class="attr">loading</span>: <span class="built_in">boolean</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//当前组件对象</span></span><br><span class="line"><span class="comment">//参数users表示模型层数据</span></span><br><span class="line"><span class="comment">//参数dispatch表示redux派发器</span></span><br><span class="line"><span class="comment">//参数loading表示数据加载状态</span></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">UserPage</span>: <span class="variable constant_">FC</span>&lt;<span class="title class_">PageProps</span>&gt; = <span class="function">(<span class="params">&#123; user, dispatch, loading &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; list,total &#125; = user;</span><br><span class="line">  <span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">//dispatch一个action来触发对应的reducer</span></span><br><span class="line">    dispatch &amp;&amp;</span><br><span class="line">      <span class="title function_">dispatch</span>(&#123;</span><br><span class="line">        <span class="attr">type</span>: <span class="string">&#x27;user/fetchUserList&#x27;</span>,</span><br><span class="line">        <span class="comment">//payload 有效负载 ，dispatch传递参数的时候</span></span><br><span class="line">        <span class="attr">payload</span>: &#123;</span><br><span class="line">          <span class="attr">page</span>: <span class="number">1</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;);</span><br><span class="line">  &#125;, []);</span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>Hello &#123;JSON.stringify(list)&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//connect 作用：将model和当前组件连接起来</span></span><br><span class="line"><span class="comment">//参数 users 表示users这个namespace中的数据</span></span><br><span class="line"><span class="comment">//参数 loading 表示users namespace中的数据是否加载完毕</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title function_">connect</span>(<span class="function">(<span class="params">&#123; user, loading &#125;: &#123; user: UserModelState; loading: Loading &#125;</span>) =&gt;</span> (&#123;</span><br><span class="line">  user,</span><br><span class="line">  <span class="attr">loading</span>: loading.<span class="property">models</span>.<span class="property">user</span>, <span class="comment">//表示users这个namespace的数据是否已经加载完毕</span></span><br><span class="line">&#125;))(<span class="title class_">UserPage</span>);</span><br></pre></td></tr></table></figure><h3 id="3-4-7-使用订阅更新设置dva数据"><a href="#3-4-7-使用订阅更新设置dva数据" class="headerlink" title="3.4.7 使用订阅更新设置dva数据"></a>3.4.7 使用订阅更新设置dva数据</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//pages/user/models/index.ts</span></span><br><span class="line"></span><br><span class="line">.........</span><br><span class="line"><span class="comment">//订阅更新</span></span><br><span class="line"><span class="attr">subscriptions</span>: &#123;</span><br><span class="line">    <span class="title function_">setup</span>(<span class="params">&#123; dispatch, history &#125;</span>) &#123;</span><br><span class="line">        <span class="comment">//监听url的变化，当访问路径是/user的时候触发fetchUserList这个effects</span></span><br><span class="line">        <span class="keyword">return</span> history.<span class="title function_">listen</span>(<span class="function">(<span class="params">&#123; pathname &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (pathname === <span class="string">&#x27;/user&#x27;</span>) &#123;</span><br><span class="line">                <span class="title function_">dispatch</span>(&#123;</span><br><span class="line">                    <span class="attr">type</span>: <span class="string">&#x27;fetchUserList&#x27;</span>,</span><br><span class="line">                    <span class="attr">payload</span>: &#123;</span><br><span class="line">                        <span class="attr">page</span>: <span class="number">1</span>,</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//注释掉pages/user/index.tsx    发送请求的代码</span></span><br></pre></td></tr></table></figure><h3 id="3-4-8-使用ant-design编写页面"><a href="#3-4-8-使用ant-design编写页面" class="headerlink" title="3.4.8 使用ant design编写页面"></a>3.4.8 使用ant design编写页面</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span>, &#123; <span class="variable constant_">FC</span>,useEffect,useState &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Table</span>, <span class="title class_">Pagination</span>, <span class="title class_">Popconfirm</span>, <span class="title class_">Button</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;antd&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">ConnectProps</span>, <span class="title class_">Loading</span>, connect &#125; <span class="keyword">from</span> <span class="string">&#x27;umi&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">UserModelState</span>,<span class="title class_">UserItem</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;./models&#x27;</span>;</span><br><span class="line"></span><br><span class="line">interface <span class="title class_">PageProps</span> <span class="keyword">extends</span> <span class="title class_">ConnectProps</span> &#123;</span><br><span class="line">  <span class="attr">user</span>: <span class="title class_">UserModelState</span>;</span><br><span class="line">  <span class="attr">loading</span>: boolean;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">UserPage</span>: <span class="variable constant_">FC</span>&lt;<span class="title class_">PageProps</span>&gt; = <span class="function">(<span class="params">&#123; user, dispatch, loading &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; list, total, page &#125; = user;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">onChangeUserPagination</span>(<span class="params">page: number</span>) &#123;</span><br><span class="line">    dispatch &amp;&amp;</span><br><span class="line">      <span class="title function_">dispatch</span>(&#123;</span><br><span class="line">        <span class="attr">type</span>: <span class="string">&#x27;user/fetchUserList&#x27;</span>,</span><br><span class="line">        <span class="attr">payload</span>: &#123;</span><br><span class="line">          <span class="attr">page</span>: page,</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">//dispatch一个action来触发对应的reducer</span></span><br><span class="line">    dispatch &amp;&amp;</span><br><span class="line">      <span class="title function_">dispatch</span>(&#123;</span><br><span class="line">        <span class="attr">type</span>: <span class="string">&#x27;user/fetchUserList&#x27;</span>,</span><br><span class="line">        <span class="comment">//payload 有效负载 ，dispatch传递参数的时候</span></span><br><span class="line">        <span class="attr">payload</span>: &#123;</span><br><span class="line">          <span class="attr">page</span>: <span class="number">1</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;);</span><br><span class="line">  &#125;, []);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">toggle</span> = (<span class="params"></span>)=&gt;&#123;</span><br><span class="line">    <span class="title function_">setPopShow</span>(<span class="literal">true</span>)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> columns = [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">title</span>: <span class="string">&#x27;用户名&#x27;</span>,</span><br><span class="line">      <span class="attr">dataIndex</span>: <span class="string">&#x27;name&#x27;</span>,</span><br><span class="line">      <span class="attr">key</span>: <span class="string">&#x27;name&#x27;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">title</span>: <span class="string">&#x27;电子邮件&#x27;</span>,</span><br><span class="line">      <span class="attr">dataIndex</span>: <span class="string">&#x27;email&#x27;</span>,</span><br><span class="line">      <span class="attr">key</span>: <span class="string">&#x27;email&#x27;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">title</span>: <span class="string">&#x27;个人网站&#x27;</span>,</span><br><span class="line">      <span class="attr">dataIndex</span>: <span class="string">&#x27;website&#x27;</span>,</span><br><span class="line">      <span class="attr">key</span>: <span class="string">&#x27;website&#x27;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">title</span>: <span class="string">&#x27;操作&#x27;</span>,</span><br><span class="line">      <span class="attr">key</span>: <span class="string">&#x27;operation&#x27;</span>,</span><br><span class="line">      <span class="attr">render</span>: <span class="function">(<span class="params">item: UserItem</span>) =&gt;</span> (</span><br><span class="line">        <span class="language-xml"><span class="tag">&lt;<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">Button</span>&gt;</span>编辑<span class="tag">&lt;/<span class="name">Button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">Popconfirm</span> <span class="attr">visible</span>=<span class="string">&#123;popShow&#125;</span> <span class="attr">title</span>=<span class="string">&quot;Confirm to delete?&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">Button</span>&gt;</span>删除<span class="tag">&lt;/<span class="name">Button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;/<span class="name">Popconfirm</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line">      ),</span><br><span class="line">    &#125;,</span><br><span class="line">  ];</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">Table</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">loading</span>=<span class="string">&#123;loading&#125;</span>  //<span class="attr">表格的加载状态</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">columns</span>=<span class="string">&#123;columns&#125;</span>  //<span class="attr">表格列信息</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">dataSource</span>=<span class="string">&#123;list&#125;</span>  //<span class="attr">表格数据源</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">rowKey</span>=<span class="string">&#123;(record:UserItem)</span> =&gt;</span> record.id&#125;  //表格每一行数据的key</span></span><br><span class="line"><span class="language-xml">          pagination=&#123;false&#125;   //不显示表格默认的分页器</span></span><br><span class="line"><span class="language-xml">        /&gt;</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">Pagination</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">className</span>=<span class="string">&quot;ant-table-pagination&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">total</span>=<span class="string">&#123;total&#125;</span> // <span class="attr">数据总数</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">current</span>=<span class="string">&#123;page&#125;</span> // <span class="attr">当前页数</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">onChange</span>=<span class="string">&#123;onChangeUserPagination&#125;</span>  //<span class="attr">改变页码的点击事件</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">pageSize</span>=<span class="string">&#123;10&#125;</span>   //<span class="attr">每一页的数量</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title function_">connect</span>(<span class="function">(<span class="params">&#123; user, loading &#125;: &#123; user: UserModelState; loading: Loading &#125;</span>) =&gt;</span> (&#123;</span><br><span class="line">  user,</span><br><span class="line">  <span class="attr">loading</span>: loading.<span class="property">models</span>.<span class="property">user</span>,</span><br><span class="line">&#125;))(<span class="title class_">UserPage</span>);</span><br></pre></td></tr></table></figure><h3 id="3-4-9-完成删除功能"><a href="#3-4-9-完成删除功能" class="headerlink" title="3.4.9 完成删除功能"></a>3.4.9 完成删除功能</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//pages/user/services/index.tsx 新增请求</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">deleteUserById</span>(<span class="params">id: <span class="built_in">number</span></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">request</span>(<span class="string">`/api/users/delete/<span class="subst">$&#123;id&#125;</span>`</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//pages/user/models/index.tsx reducer和effect</span></span><br><span class="line"><span class="keyword">import</span> &#123; queryUserList, deleteUserById &#125; <span class="keyword">from</span> <span class="string">&#x27;../services&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//reducer中新增下面方法</span></span><br><span class="line"><span class="comment">//state的list可能是undefined，造成类型不匹配，所以这里要 state = &#123;list:[]&#125; 给list一个默认值</span></span><br><span class="line"><span class="title function_">removeById</span>(<span class="params">state, &#123; payload &#125;</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; id &#125; = payload;</span><br><span class="line">    <span class="keyword">var</span> filterList =</span><br><span class="line">        state &amp;&amp;</span><br><span class="line">        state.<span class="property">list</span> &amp;&amp;</span><br><span class="line">        state.<span class="property">list</span>.<span class="title function_">filter</span>(<span class="function">(<span class="params">item</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (item.<span class="property">id</span> !== id) &#123;</span><br><span class="line">                <span class="keyword">return</span> item;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    <span class="keyword">return</span> &#123; ...state, ...&#123; <span class="attr">list</span>: filterList &#125; &#125;;</span><br><span class="line">&#125;,</span><br><span class="line">    </span><br><span class="line"><span class="comment">//action中新增下面方法</span></span><br><span class="line"><span class="comment">//根据id删除指定用户  发送请求</span></span><br><span class="line">*<span class="title function_">removeUserById</span>(<span class="params">&#123; payload: &#123; id &#125; &#125;, &#123; call, put &#125;</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> result = <span class="keyword">yield</span> <span class="title function_">call</span>(deleteUserById, id);</span><br><span class="line">    <span class="keyword">yield</span> <span class="title function_">put</span>(&#123;</span><br><span class="line">        <span class="attr">type</span>: <span class="string">&#x27;removeById&#x27;</span>,</span><br><span class="line">        <span class="attr">payload</span>: &#123;</span><br><span class="line">            <span class="attr">id</span>: id,</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;,</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line"># 页面新增删除事件</span><br><span class="line">&lt;<span class="title class_">Popconfirm</span> visible=&#123;popShow&#125; title=<span class="string">&quot;Confirm to delete?&quot;</span> onConfirm=&#123;<span class="function">()=&gt;</span><span class="title function_">deleteHandler</span>(item.<span class="property">id</span>)&#125;&gt;</span><br><span class="line">       <span class="language-xml"><span class="tag">&lt;<span class="name">Button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span>=&gt;</span>&#123;toggle()&#125;&#125;&gt;删除<span class="tag">&lt;/<span class="name">Button</span>&gt;</span></span></span><br><span class="line">&lt;/<span class="title class_">Popconfirm</span>&gt;</span><br><span class="line">                 </span><br><span class="line"><span class="comment">//控制pop弹框是否显示</span></span><br><span class="line"><span class="keyword">const</span> [popShow,setPopShow] = <span class="title function_">useState</span>(<span class="literal">false</span>)</span><br><span class="line">   </span><br><span class="line"><span class="comment">//这边点击删除按钮后一定要将pop关闭，否则会报内存泄漏</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">deleteHandler</span> = (<span class="params">id:<span class="built_in">number</span></span>)=&gt;&#123;   </span><br><span class="line">    <span class="title function_">setPopShow</span>(<span class="literal">false</span>)</span><br><span class="line">    dispatch &amp;&amp;</span><br><span class="line">        <span class="title function_">dispatch</span>(&#123;</span><br><span class="line">        <span class="attr">type</span>: <span class="string">&#x27;user/removeUserById&#x27;</span>,</span><br><span class="line">        <span class="attr">payload</span>: &#123;</span><br><span class="line">            id,</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">toggle</span> = (<span class="params"></span>)=&gt;&#123;</span><br><span class="line">    <span class="title function_">setPopShow</span>(<span class="literal">true</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> React </category>
          
      </categories>
      
      
        <tags>
            
            <tag> umi </tag>
            
            <tag> dva </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>TypeScript</title>
      <link href="/2020/09/24/TypeScript/"/>
      <url>/2020/09/24/TypeScript/</url>
      
        <content type="html"><![CDATA[<h1 id="TypeScript"><a href="#TypeScript" class="headerlink" title="TypeScript"></a>TypeScript</h1><h2 id="1-1-TS简介"><a href="#1-1-TS简介" class="headerlink" title="1.1 TS简介"></a>1.1 TS简介</h2><p>TypeScript 是 JavaScript 的强类型版本。然后在编译期去掉类型和特有语法，生成纯粹的 JavaScript 代码。由于最终在浏览器中运行的仍然是 JavaScript，所以 TypeScript 并不依赖于浏览器的支持，也并不会带来兼容性问题。</p><p>TypeScript 是 JavaScript 的超集，这意味着他支持所有的 JavaScript 语法。并在此之上对 JavaScript 添加了一些扩展，如 class &#x2F; interface &#x2F; module 等。这样会大大提升代码的可阅读性。</p><p>和 JavaScript 弱类型不同，TypeScript 这种强类型语言最大的优势在于静态类型检查，可以在代码开发阶段就预知一些低级错误的发生。</p><ul><li>一种类似于 JavaScript 的语言，在 JavaScript 的基础之上增加了类型，同时增强了 JavaScript 部分语法功能</li><li>遵循 EcmaScript 6 标准规范</li><li>由微软开发</li><li>Angular 2 框架采用 TypeScript 编写</li><li>背后有微软和谷歌两大公司的支持</li><li>TypeScript 可以编译成 JavaScript 从而在支持 JavaScript 的环境中运行</li><li>TypeScript 和 JavaScript 的关系就好比 less 和 css 的关系</li></ul><p>TypeScript 中文网     <a href="https://www.tslang.cn/">https://www.tslang.cn/</a></p><p>在线编译环境              <a href="https://www.typescriptlang.org/play/index.html">https://www.typescriptlang.org/play/index.html</a></p><h2 id="1-2-TS环境搭建"><a href="#1-2-TS环境搭建" class="headerlink" title="1.2 TS环境搭建"></a>1.2 TS环境搭建</h2><ol><li>打开命令行，键入<code>npm i -g typescript</code> 全局安装TS</li><li>继续在命令行环境下键入 <code>tsc -init</code> 进行初始化，<br>你会发现根目录下多了 tsconfig.json 的文件，记录了编译成JS的选项</li><li>创建ts文件</li><li>打开VSCode进入该目录，按下 Ctrl+shift+B 快捷键会进行编译，初次编译会选择编译模式</li><li>输入node命令运行js代码</li></ol><h2 id="1-3-变量声明"><a href="#1-3-变量声明" class="headerlink" title="1.3 变量声明"></a>1.3 变量声明</h2><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span></span><br><span class="line">- 作用域 : 全局作用域、函数作用域</span><br><span class="line">- 重复声明</span><br><span class="line">- 变量提升</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span></span><br><span class="line">- 块级作用域</span><br><span class="line">- 在同一个块中不能重复声明</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span></span><br><span class="line">- 声明同时必须赋值</span><br><span class="line">- 一旦声明不可改变（对象可以修改）</span><br><span class="line">- 块级作用域</span><br></pre></td></tr></table></figure><h2 id="1-4-基本数据类型"><a href="#1-4-基本数据类型" class="headerlink" title="1.4 基本数据类型"></a>1.4 基本数据类型</h2><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//字符串</span></span><br><span class="line"><span class="keyword">var</span> <span class="attr">uname</span>:<span class="built_in">string</span> = <span class="string">&quot;zhangsan&quot;</span>;</span><br><span class="line"><span class="keyword">let</span> <span class="attr">nickname</span>: <span class="built_in">string</span> = <span class="string">&#x27;张三&#x27;</span>;</span><br><span class="line"><span class="keyword">let</span> <span class="attr">isDone</span>: <span class="built_in">boolean</span> = <span class="literal">false</span>;</span><br><span class="line"><span class="keyword">let</span> <span class="attr">age</span>: <span class="built_in">number</span> = <span class="number">37</span>;</span><br><span class="line"><span class="keyword">let</span> <span class="attr">sentence</span>: <span class="built_in">string</span> = <span class="string">`Hello, my nickname is <span class="subst">$&#123; nickname &#125;</span>.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">I&#x27;ll be <span class="subst">$&#123; age + <span class="number">1</span> &#125;</span> years old next month.`</span></span><br></pre></td></tr></table></figure><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//数组</span></span><br><span class="line"><span class="comment">//TypeScript像JavaScript一样可以操作数组元素。 有两种方式可以定义数组。 第一种，可以在元素类型后面接上[]，表示由此类型元素组成的一个数组：</span></span><br><span class="line"><span class="keyword">let</span> <span class="attr">list</span>: <span class="built_in">number</span>[] = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">//第二种方式是使用数组泛型，Array&lt;元素类型&gt;：</span></span><br><span class="line"><span class="keyword">let</span> <span class="attr">list</span>: <span class="title class_">Array</span>&lt;<span class="built_in">number</span>&gt; = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>];</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ts的数组只能存放单一数据类型的元素，元组则可以很好的解决此问题。</span></span><br><span class="line"><span class="comment">//元组类型允许表示一个已知元素数量和类型的数组，各元素的类型不必相同。 比如，你可以定义一对值分别为string和number类型的元组。</span></span><br><span class="line"><span class="comment">// Declare a tuple type</span></span><br><span class="line"><span class="keyword">let</span> <span class="attr">x</span>: [string, number];</span><br><span class="line"><span class="comment">// Initialize it</span></span><br><span class="line">x = [<span class="string">&#x27;hello&#x27;</span>, <span class="number">10</span>]; <span class="comment">// OK</span></span><br><span class="line"><span class="comment">// Initialize it incorrectly</span></span><br><span class="line">x = [<span class="number">10</span>, <span class="string">&#x27;hello&#x27;</span>]; <span class="comment">// Error</span></span><br></pre></td></tr></table></figure><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//object类型</span></span><br><span class="line">- 允许赋任意值</span><br><span class="line">- 但是不能调用任意方法，即便它真的有</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="attr">foo</span>: <span class="built_in">object</span> = &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;Jack&#x27;</span>,</span><br><span class="line">  <span class="attr">age</span>: <span class="number">18</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//知道即可，用的很少，没有类型校验和语法提示</span></span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Any</span></span><br><span class="line"><span class="comment">//有时候，我们会想要为那些在编程阶段还不清楚类型的变量指定一个类型。 这些值可能来自于动态的内容，比如来自用户输入或第三方代码库。 这种情况下，我们不希望类型检查器对这些值进行检查而是直接让它们通过编译阶段的检查。 那么我们可以使用 any类型来标记这些变量：</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="attr">notSure</span>: any = <span class="number">4</span>;</span><br><span class="line">notSure = <span class="string">&quot;maybe a string instead&quot;</span>;</span><br><span class="line">notSure = <span class="literal">false</span>; <span class="comment">// okay, definitely a boolean</span></span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Void 类型</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//void类型像是与any类型相反，它表示没有任何类型。 当一个函数没有返回值时，你通常会见到其返回值类型是 void：</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">warnUser</span>(<span class="params"></span>): <span class="keyword">void</span> &#123;</span><br><span class="line">  <span class="title function_">alert</span>(<span class="string">&quot;This is my warning message&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//声明一个void类型的变量没有什么大用，因为你只能为它赋予undefined：</span></span><br><span class="line"><span class="keyword">let</span> <span class="attr">unusable</span>: <span class="keyword">void</span> = <span class="literal">undefined</span>;</span><br></pre></td></tr></table></figure><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Null 和 Undefined</span></span><br><span class="line"><span class="comment">// Not much else we can assign to these variables!</span></span><br><span class="line"><span class="keyword">let</span> <span class="attr">u</span>: <span class="literal">undefined</span> = <span class="literal">undefined</span>;</span><br><span class="line"><span class="keyword">let</span> <span class="attr">n</span>: <span class="literal">null</span> = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//never</span></span><br><span class="line"><span class="built_in">never</span> 是其它类型（包括 <span class="literal">null</span> 和 <span class="literal">undefined</span>）的子类型，代表从不会出现的值。</span><br><span class="line"><span class="keyword">let</span> <span class="attr">x</span>: <span class="built_in">never</span>;</span><br><span class="line"><span class="keyword">let</span> <span class="attr">y</span>: <span class="built_in">number</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 运行错误，数字类型不能转为 never 类型</span></span><br><span class="line">x = <span class="number">123</span>;</span><br><span class="line"><span class="comment">// 运行正确，never 类型可以赋值给 never类型</span></span><br><span class="line">x = (<span class="function">()=&gt;</span>&#123; <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;exception&#x27;</span>)&#125;)();</span><br><span class="line"><span class="comment">// 运行正确，never 类型可以赋值给 数字类型</span></span><br><span class="line">y = (<span class="function">()=&gt;</span>&#123; <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;exception&#x27;</span>)&#125;)();</span><br><span class="line"><span class="comment">// 返回值为 never 的函数可以是抛出异常的情况</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">error</span>(<span class="params">message: <span class="built_in">string</span></span>): <span class="built_in">never</span> &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(message);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 返回值为 never 的函数可以是无法被执行到的终止点的情况</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">loop</span>(<span class="params"></span>): <span class="built_in">never</span> &#123;</span><br><span class="line">    <span class="keyword">while</span> (<span class="literal">true</span>) &#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//类型推断</span></span><br><span class="line"><span class="comment">// 有时候你会遇到这样的情况，你会比TypeScript更了解某个值的详细信息。 通常这会发生在你清楚地知道一个实体具有比它现有类型更确切的类型。</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 通过类型断言这种方式可以告诉编译器，“相信我，我知道自己在干什么”。 类型断言好比其它语言里的类型转换，但是不进行特殊的数据检查和解构。 它没有运行时的影响，只是在编译阶段起作用。 TypeScript会假设你，程序员，已经进行了必须的检查。</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 类型断言有两种形式。 其一是“尖括号”语法：</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="attr">someValue</span>: <span class="built_in">any</span> = <span class="literal">true</span>;</span><br><span class="line"><span class="keyword">let</span> <span class="attr">strLength</span>: <span class="built_in">number</span> = (&lt;<span class="built_in">string</span>&gt;someValue).<span class="property">length</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//另一个为as语法：</span></span><br><span class="line"><span class="keyword">let</span> <span class="attr">someValue</span>: <span class="built_in">any</span> = <span class="string">&quot;this is a string&quot;</span>;</span><br><span class="line"><span class="keyword">let</span> <span class="attr">strLength</span>: <span class="built_in">number</span> = (someValue <span class="keyword">as</span> <span class="built_in">string</span>).<span class="property">length</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//两种形式是等价的。 至于使用哪个大多数情况下是凭个人喜好；然而，当你在TypeScript里使用JSX时，只有 as语法断言是被允许的。</span></span><br></pre></td></tr></table></figure><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//枚举类型</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">enum</span> <span class="title class_">Color</span> &#123;<span class="title class_">Red</span>, <span class="title class_">Green</span>, <span class="title class_">Blue</span>&#125;;</span><br><span class="line"><span class="keyword">let</span> <span class="attr">c</span>: <span class="title class_">Color</span> = <span class="title class_">Color</span>.<span class="property">Blue</span>;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(c);    <span class="comment">// 输出 2</span></span><br></pre></td></tr></table></figure><h2 id="1-5-解构赋值"><a href="#1-5-解构赋值" class="headerlink" title="1.5 解构赋值"></a>1.5 解构赋值</h2><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//数组解构</span></span><br><span class="line"><span class="keyword">let</span> input = [<span class="number">1</span>, <span class="number">2</span>];</span><br><span class="line"><span class="keyword">let</span> [first, second] = input;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(first); <span class="comment">// outputs 1</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(second); <span class="comment">// outputs 2</span></span><br></pre></td></tr></table></figure><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//上面的写法等价于：</span></span><br><span class="line">first = input[<span class="number">0</span>];</span><br><span class="line">second = input[<span class="number">1</span>];</span><br></pre></td></tr></table></figure><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//利用解构赋值交换变量：</span></span><br><span class="line">[first, second] = [second, first];</span><br></pre></td></tr></table></figure><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//函数参数解构：</span></span><br><span class="line"><span class="comment">//函数参数解构：</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">ff</span>(<span class="params">[first, second]: [<span class="built_in">number</span>, <span class="built_in">number</span>]</span>) &#123; </span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(first)</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(second)</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">ff</span>([<span class="number">1</span>,<span class="number">2</span>])</span><br></pre></td></tr></table></figure><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//解构剩余参数：</span></span><br><span class="line"><span class="keyword">let</span> [first, ...rest] = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>]</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(first) <span class="comment">// 1</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(rest) <span class="comment">// [2, 3, 4]</span></span><br></pre></td></tr></table></figure><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//也可以忽略其它参数：</span></span><br><span class="line"><span class="keyword">let</span> [first] = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>];</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(first); <span class="comment">// outputs 1</span></span><br></pre></td></tr></table></figure><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//或者跳过解构：</span></span><br><span class="line"><span class="keyword">let</span> [, second, , fourth] = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>]</span><br></pre></td></tr></table></figure><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//对象解构</span></span><br><span class="line"><span class="keyword">let</span> o = &#123;</span><br><span class="line">    <span class="attr">a</span>: <span class="string">&quot;foo&quot;</span>,</span><br><span class="line">    <span class="attr">b</span>: <span class="number">12</span>,</span><br><span class="line">    <span class="attr">c</span>: <span class="string">&quot;bar&quot;</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">//let &#123; a, b &#125; = o;</span></span><br><span class="line"><span class="comment">//let &#123;a, b&#125;: &#123;a: string, b: number&#125; = o;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//你可以在对象里使用 ... 语法创建剩余变量：</span></span><br><span class="line"><span class="keyword">let</span> &#123; a, ...passthrough &#125; = o;</span><br><span class="line"><span class="keyword">let</span> total = passthrough.<span class="property">b</span> + passthrough.<span class="property">c</span>.<span class="property">length</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//属性解构重命名</span></span><br><span class="line"><span class="comment">//你也可以给属性以不同的名字：</span></span><br><span class="line"><span class="keyword">let</span> &#123; <span class="attr">a</span>: newName1, <span class="attr">b</span>: newName2 &#125; = o;</span><br></pre></td></tr></table></figure><h2 id="1-6-展开操作符-…"><a href="#1-6-展开操作符-…" class="headerlink" title="1.6 展开操作符 (…)"></a>1.6 展开操作符 (…)</h2><ul><li>展开数组</li><li>展开对象</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> arr1 = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>];</span><br><span class="line"><span class="keyword">let</span> arr2 = [<span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>];</span><br><span class="line"><span class="keyword">let</span> arr3 = [...arr1, ...arr2];</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> obj1 = &#123; <span class="attr">a</span>: <span class="number">1</span>, <span class="attr">b</span>: <span class="number">2</span> &#125;;</span><br><span class="line"><span class="keyword">let</span> obj2 = &#123; <span class="attr">c</span>: <span class="number">3</span> &#125;</span><br><span class="line"><span class="keyword">let</span> obj3 = &#123; ...obj1, ...obj2 &#125;;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(arr3,obj3)</span><br></pre></td></tr></table></figure><h2 id="1-7-函数"><a href="#1-7-函数" class="headerlink" title="1.7 函数"></a>1.7 函数</h2><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//函数参数</span></span><br><span class="line"><span class="comment">//参数及返回值类型</span></span><br><span class="line"><span class="comment">//function 函数名字(参数1,参数2,参数3):函数返回值&#123;函数体&#125;</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">add</span>(<span class="params">x: <span class="built_in">number</span>, y: <span class="built_in">number</span></span>): <span class="built_in">number</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> x + y</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//可选参数</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">add</span>(<span class="params">x: <span class="built_in">number</span>, y?: <span class="built_in">number</span></span>): <span class="built_in">number</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> x + <span class="number">10</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//默认参数</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">add</span>(<span class="params">x: <span class="built_in">number</span>, y: <span class="built_in">number</span> = <span class="number">20</span></span>): <span class="built_in">number</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> x + y</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//剩余参数</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">sum</span>(<span class="params">...args: <span class="built_in">number</span>[]</span>): <span class="built_in">number</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="attr">ret</span>: <span class="built_in">number</span> = <span class="number">0</span></span><br><span class="line">    args.<span class="title function_">forEach</span>((<span class="attr">item</span>: <span class="built_in">number</span>): <span class="function"><span class="params">void</span> =&gt;</span> &#123;</span><br><span class="line">        ret += item</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">return</span> ret</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">sum</span>(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>)</span><br></pre></td></tr></table></figure><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//箭头函数</span></span><br><span class="line"><span class="keyword">let</span> add = (<span class="attr">x</span>: <span class="built_in">number</span>, <span class="attr">y</span>: <span class="built_in">number</span>): <span class="function"><span class="params">number</span> =&gt;</span> x + y</span><br></pre></td></tr></table></figure><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//函数重载：重载是方法名字相同，而参数不同，返回类型可以相同也可以不同。</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//每个重载的方法（或者构造函数）都必须有一个独一无二的参数类型列表。</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//参数类型不同：</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">disp</span>(<span class="params"><span class="built_in">string</span></span>):<span class="built_in">void</span>; </span><br><span class="line"><span class="keyword">function</span> <span class="title function_">disp</span>(<span class="params"><span class="built_in">number</span></span>):<span class="built_in">void</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//参数数量不同：</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">disp</span>(<span class="params">n1:<span class="built_in">number</span></span>):<span class="built_in">void</span>; </span><br><span class="line"><span class="keyword">function</span> <span class="title function_">disp</span>(<span class="params">x:<span class="built_in">number</span>,y:<span class="built_in">number</span></span>):<span class="built_in">void</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//参数类型顺序不同：</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">disp</span>(<span class="params">n1:<span class="built_in">number</span>,s1:<span class="built_in">string</span></span>):<span class="built_in">void</span>; </span><br><span class="line"><span class="keyword">function</span> <span class="title function_">disp</span>(<span class="params">s:<span class="built_in">string</span>,n:<span class="built_in">number</span></span>):<span class="built_in">void</span>;</span><br></pre></td></tr></table></figure><h2 id="1-8-联合类型"><a href="#1-8-联合类型" class="headerlink" title="1.8 联合类型"></a>1.8 联合类型</h2><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//联合类型（Union Types）可以通过管道(|)将变量设置多种类型，赋值时可以根据设置的类型来赋值。</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> <span class="attr">val</span>:<span class="built_in">string</span>|<span class="built_in">number</span> </span><br><span class="line">val = <span class="number">12</span> </span><br><span class="line">val = <span class="string">&quot;Runoob&quot;</span> </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> <span class="attr">arr</span>:<span class="built_in">number</span>[]|<span class="built_in">string</span>[]; </span><br><span class="line"><span class="keyword">var</span> <span class="attr">i</span>:<span class="built_in">number</span>; </span><br><span class="line">arr = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">4</span>] </span><br><span class="line">arr = [<span class="string">&quot;Runoob&quot;</span>,<span class="string">&quot;Google&quot;</span>,<span class="string">&quot;Taobao&quot;</span>] </span><br></pre></td></tr></table></figure><h2 id="1-9-类"><a href="#1-9-类" class="headerlink" title="1.9 类"></a>1.9 类</h2><h3 id="1-9-1-类的基本使用"><a href="#1-9-1-类的基本使用" class="headerlink" title="1.9.1 类的基本使用"></a>1.9.1 类的基本使用</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//基本示例</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="built_in">string</span>;</span><br><span class="line">    <span class="attr">age</span>: <span class="built_in">number</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//构造函数</span></span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params">name: <span class="built_in">string</span>, age: <span class="built_in">number</span></span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">name</span> = name;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">age</span> = age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">sayHello</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">name</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="attr">zs</span>: <span class="title class_">Person</span> = <span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&#x27;张三&#x27;</span>, <span class="number">18</span>);</span><br></pre></td></tr></table></figure><h3 id="1-8-2-super关键字的使用"><a href="#1-8-2-super关键字的使用" class="headerlink" title="1.8.2 super关键字的使用"></a>1.8.2 super关键字的使用</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//继承</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Animal</span> &#123;</span><br><span class="line">    <span class="title function_">move</span>(<span class="params">distanceInMeters: <span class="built_in">number</span> = <span class="number">0</span></span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`Animal moved <span class="subst">$&#123;distanceInMeters&#125;</span>m.`</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Dog</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Animal</span> &#123;</span><br><span class="line">    <span class="title function_">bark</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Woof! Woof!&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> dog = <span class="keyword">new</span> <span class="title class_">Dog</span>();</span><br><span class="line">dog.<span class="title function_">bark</span>();</span><br><span class="line">dog.<span class="title function_">move</span>(<span class="number">10</span>);</span><br><span class="line">dog.<span class="title function_">bark</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">//这个例子展示了最基本的继承：类从基类中继承了属性和方法。 这里， Dog是一个 派生类，它派生自 Animal 基类，通过 extends关键字。 派生类通常被称作 子类，基类通常被称作 超类。</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//因为 Dog继承了 Animal的功能，因此我们可以创建一个 Dog的实例，它能够 bark()和 move()。</span></span><br></pre></td></tr></table></figure><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//下面是一个更复杂的例子：</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Animal</span> &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="built_in">string</span>;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params">theName: <span class="built_in">string</span></span>) &#123; </span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">name</span> = theName; </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">move</span>(<span class="params">distanceInMeters: <span class="built_in">number</span> = <span class="number">0</span></span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.name&#125;</span> moved <span class="subst">$&#123;distanceInMeters&#125;</span>m.`</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Snake</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Animal</span> &#123;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params">name: <span class="built_in">string</span></span>) &#123; </span><br><span class="line">        <span class="variable language_">super</span>(name); </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">move</span>(<span class="params">distanceInMeters = <span class="number">5</span></span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Slithering...&quot;</span>);</span><br><span class="line">        <span class="variable language_">super</span>.<span class="title function_">move</span>(distanceInMeters);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Horse</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Animal</span> &#123;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params">name: <span class="built_in">string</span></span>) &#123; </span><br><span class="line">        <span class="variable language_">super</span>(name); </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">move</span>(<span class="params">distanceInMeters = <span class="number">45</span></span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Galloping...&quot;</span>);</span><br><span class="line">        <span class="variable language_">super</span>.<span class="title function_">move</span>(distanceInMeters);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> sam = <span class="keyword">new</span> <span class="title class_">Snake</span>(<span class="string">&quot;Sammy the Python&quot;</span>);</span><br><span class="line"><span class="keyword">let</span> <span class="attr">tom</span>: <span class="title class_">Animal</span> = <span class="keyword">new</span> <span class="title class_">Horse</span>(<span class="string">&quot;Tommy the Palomino&quot;</span>);</span><br><span class="line"></span><br><span class="line">sam.<span class="title function_">move</span>();</span><br><span class="line">tom.<span class="title function_">move</span>(<span class="number">34</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//与前一个例子的不同点是，派生类包含了一个构造函数，它 必须调用 super()，它会执行基类的构造函数。 而且，在构造函数里访问 this的属性之前，我们 一定要调用 super()。 这个是TypeScript强制执行的一条重要规则。</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//这个例子演示了如何在子类里可以重写父类的方法。 Snake类和 Horse类都创建了 move方法，它们重写了从Animal继承来的 move方法，使得 move方法根据不同的类而具有不同的功能。 注意，即使 tom被声明为Animal类型，但因为它的值是 Horse，调用 tom.move(34)时，它会调用 Horse里重写的方法：</span></span><br><span class="line"></span><br><span class="line"><span class="title class_">Slithering</span>...</span><br><span class="line"><span class="title class_">Sammy</span> the <span class="title class_">Python</span> moved 5m.</span><br><span class="line"><span class="title class_">Galloping</span>...</span><br><span class="line"><span class="title class_">Tommy</span> the <span class="title class_">Palomino</span> moved 34m.</span><br></pre></td></tr></table></figure><h3 id="1-9-3-成员修饰符"><a href="#1-9-3-成员修饰符" class="headerlink" title="1.9.3 成员修饰符"></a>1.9.3 成员修饰符</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//public 公共的</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Animal</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="attr">name</span>: <span class="built_in">string</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">constructor</span>(<span class="params">theName: <span class="built_in">string</span></span>) &#123; </span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">name</span> = theName; </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">move</span>(<span class="params">distanceInMeters: <span class="built_in">number</span></span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.name&#125;</span> moved <span class="subst">$&#123;distanceInMeters&#125;</span>m.`</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//private 私有的</span></span><br><span class="line">- 不能被外部访问，只能在类的内部访问使用</span><br><span class="line">- 私有成员不会被继承</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="attr">name</span>: <span class="built_in">string</span>;</span><br><span class="line">  <span class="keyword">public</span> <span class="attr">age</span>: <span class="built_in">number</span> = <span class="number">18</span>;</span><br><span class="line">  <span class="keyword">private</span> <span class="attr">type</span>: <span class="built_in">string</span> = <span class="string">&#x27;human&#x27;</span></span><br><span class="line">  <span class="keyword">public</span> <span class="title function_">constructor</span> (<span class="attr">name</span>:<span class="built_in">string</span>, <span class="attr">age</span>:<span class="built_in">number</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">name</span> = name</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">age</span> = age</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//protected 受保护的</span></span><br><span class="line">- 和 <span class="keyword">private</span> 类似，但是可以被继承</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">    <span class="keyword">protected</span> <span class="attr">name</span>: <span class="built_in">string</span>;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params">name: <span class="built_in">string</span></span>) &#123; </span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">name</span> = name; </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Employee</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Person</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="attr">department</span>: <span class="built_in">string</span>;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params">name: <span class="built_in">string</span>, department: <span class="built_in">string</span></span>) &#123;</span><br><span class="line">        <span class="variable language_">super</span>(name)</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">department</span> = department;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">getElevatorPitch</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">`Hello, my name is <span class="subst">$&#123;<span class="variable language_">this</span>.name&#125;</span> and I work in <span class="subst">$&#123;<span class="variable language_">this</span>.department&#125;</span>.`</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> howard = <span class="keyword">new</span> <span class="title class_">Employee</span>(<span class="string">&quot;Howard&quot;</span>, <span class="string">&quot;Sales&quot;</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(howard.<span class="title function_">getElevatorPitch</span>());</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(howard.<span class="property">name</span>); <span class="comment">// 错误</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//注意，我们不能在 Person类外使用 name，但是我们仍然可以通过 Employee类的实例方法访问，因为Employee是由 Person派生而来的。</span></span><br></pre></td></tr></table></figure><h3 id="1-9-4-getter和setter"><a href="#1-9-4-getter和setter" class="headerlink" title="1.9.4 getter和setter"></a>1.9.4 getter和setter</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span></span><br><span class="line">&#123;</span><br><span class="line">    private <span class="attr">_name</span>:string;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params">name: string</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">_name</span> = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">set</span> <span class="title function_">name</span>(<span class="params">value:string</span>) &#123;<span class="variable language_">this</span>.<span class="property">_name</span> = value;&#125;</span><br><span class="line">    <span class="keyword">get</span> <span class="title function_">name</span>() &#123;<span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">_name</span>;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">talk</span>(<span class="params"></span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="title function_">alert</span>(<span class="string">&quot;Hi, my name is &quot;</span> + <span class="variable language_">this</span>.<span class="property">name</span> + <span class="string">&quot;!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="1-9-5-静态成员"><a href="#1-9-5-静态成员" class="headerlink" title="1.9.5 静态成员"></a>1.9.5 静态成员</h3><ul><li>不需要实例化访问的成员称之为静态成员，即只能被类访问的成员</li><li><code>static</code> 关键字</li></ul><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">    <span class="comment">//静态变量</span></span><br><span class="line">    <span class="keyword">static</span> country = <span class="string">&quot;中国&quot;</span>;</span><br><span class="line">    <span class="comment">//京塔方法</span></span><br><span class="line">    <span class="keyword">static</span> <span class="title function_">sayhello</span>(<span class="params"></span>) &#123; </span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;hello&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">constructor</span> () &#123; &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> p1 = <span class="keyword">new</span> <span class="title class_">Person</span>();  </span><br><span class="line"><span class="keyword">let</span> p2 = <span class="keyword">new</span> <span class="title class_">Person</span>(); </span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Person</span>.<span class="property">country</span>)  <span class="comment">//静态变量，直接通过类型来访问</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(p1.<span class="property">country</span>) <span class="comment">//错误</span></span><br></pre></td></tr></table></figure><h2 id="1-10-接口"><a href="#1-10-接口" class="headerlink" title="1.10 接口"></a>1.10 接口</h2><p>在面向对象编程中，接口是一种规范的定义，它定义了行为和动作规范，起到一种限制和规范的作用。<br>接口不关心状态数据，也不关心方法的实现细节，它只规定了一些属性和方法，而实现接口的类必须提供具体的信息。</p><h3 id="1-10-1-接口对类的规范"><a href="#1-10-1-接口对类的规范" class="headerlink" title="1.10.1 接口对类的规范"></a>1.10.1 接口对类的规范</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//定义一个人的接口</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">Human</span> &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="built_in">string</span>;</span><br><span class="line">    <span class="attr">age</span>: <span class="built_in">number</span>;</span><br><span class="line">    <span class="title function_">say</span>(<span class="attr">word</span>: <span class="built_in">string</span>): <span class="built_in">void</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//让老师类实现Human接口，老师类实现接口的时候必须提供接口的具体信息</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Teacher</span> <span class="keyword">implements</span> <span class="title class_">Human</span>&#123;</span><br><span class="line">    name = <span class="string">&quot;老师&quot;</span>;</span><br><span class="line">    age = <span class="number">38</span>;</span><br><span class="line">    <span class="title function_">say</span>(<span class="attr">word</span>: <span class="built_in">string</span>): <span class="built_in">void</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;老师说&quot;</span>+word)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//让学生类实现Human接口，学生类实现接口的时候必须提供接口的具体信息</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Student</span> <span class="keyword">implements</span> <span class="title class_">Human</span>&#123;</span><br><span class="line">    name = <span class="string">&quot;学生&quot;</span>;</span><br><span class="line">    age = <span class="number">18</span>;</span><br><span class="line">    <span class="title function_">say</span>(<span class="attr">word</span>: <span class="built_in">string</span>): <span class="built_in">void</span> &#123;</span><br><span class="line">         <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;学生说&quot;</span>+word)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="1-10-2-接口对对象的规范"><a href="#1-10-2-接口对对象的规范" class="headerlink" title="1.10.2 接口对对象的规范"></a>1.10.2 接口对对象的规范</h3><p>TypeScript 中的接口除了可用于对类的一部分行为进行抽象以外，也常用于对对象的形状（Shape）进行描述</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">interface <span class="title class_">Shape</span> &#123;</span><br><span class="line">    <span class="attr">head</span>: string;</span><br><span class="line">    <span class="attr">arm</span>: string;</span><br><span class="line">&#125;</span><br><span class="line">interface <span class="title class_">Person</span> &#123;</span><br><span class="line">    <span class="attr">name</span>: string;</span><br><span class="line">    <span class="attr">age</span>: number;</span><br><span class="line">    <span class="attr">shape</span>: <span class="title class_">Shape</span>;</span><br><span class="line">    <span class="title function_">say</span>(<span class="attr">word</span>: string): <span class="keyword">void</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="attr">jack</span>: <span class="title class_">Person</span> = &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;Jack&#x27;</span>,</span><br><span class="line">    <span class="attr">age</span>: <span class="number">18</span>,</span><br><span class="line">    <span class="attr">shape</span>: &#123;</span><br><span class="line">        <span class="attr">head</span>: <span class="string">&#x27;head&#x27;</span>,</span><br><span class="line">        <span class="attr">arm</span>: <span class="string">&#x27;arm&#x27;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="title function_">say</span>(<span class="params">word: string</span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(word)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">jack.<span class="title function_">say</span>(<span class="string">&#x27;hi&#x27;</span>)</span><br></pre></td></tr></table></figure><h3 id="1-10-3-接口可选属性"><a href="#1-10-3-接口可选属性" class="headerlink" title="1.10.3 接口可选属性"></a>1.10.3 接口可选属性</h3><p>接口里的属性不全都是必需的。 有些是只在某些条件下存在，或者根本不存在。 可选属性在应用“option bags”模式时很常用，即给函数传入的参数对象中只有部分属性赋值了。</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">    <span class="attr">gender</span>: <span class="built_in">string</span>,</span><br><span class="line">    age?: <span class="built_in">number</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="attr">jack</span>: <span class="title class_">Person</span> = &#123;</span><br><span class="line">    <span class="attr">gender</span>: <span class="string">&#x27;Male&#x27;</span></span><br><span class="line">    <span class="comment">// 可以不赋值 age 属性，因为是可选的</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="1-10-4-接口只读属性"><a href="#1-10-4-接口只读属性" class="headerlink" title="1.10.4 接口只读属性"></a>1.10.4 接口只读属性</h3><p>一些对象属性只能在对象刚刚创建的时候修改其值。 你可以在属性名前用 <code>readonly</code>来指定只读属性:</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">    <span class="keyword">readonly</span> <span class="attr">name</span>: <span class="built_in">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="attr">jack</span>: <span class="title class_">Person</span> = &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;Jack&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">jack.<span class="property">name</span> = <span class="string">&#x27;Ivan&#x27;</span> <span class="comment">// 报错: name 是只读的</span></span><br></pre></td></tr></table></figure><p><code>readonly</code> vs <code>const</code></p><ul><li>常量使用 const</li><li>对象属性使用 readonly</li></ul><h3 id="1-10-5-函数接口"><a href="#1-10-5-函数接口" class="headerlink" title="1.10.5 函数接口"></a>1.10.5 函数接口</h3><p>因为函数也是对象，所以我们也可以通过接口来对函数做“规定”。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">interface <span class="title class_">Fn</span> &#123;</span><br><span class="line">    (<span class="attr">a</span>: number, <span class="attr">b</span>: number): number;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="attr">add</span>: <span class="title class_">Fn</span> = <span class="keyword">function</span>(<span class="params">a: number, b: number</span>): number &#123;</span><br><span class="line">    <span class="keyword">return</span> a + b</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">add</span>(<span class="number">1</span>, <span class="number">2</span>))</span><br></pre></td></tr></table></figure><h3 id="1-10-6-接口继承"><a href="#1-10-6-接口继承" class="headerlink" title="1.10.6 接口继承"></a>1.10.6 接口继承</h3><p>就像 ES6 的 class 一样，接口也可以做继承操作，效果就是会继承父接口的“规定”。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">interface <span class="title class_">Animal</span> &#123;</span><br><span class="line">    <span class="title function_">move</span>(): <span class="keyword">void</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">interface <span class="title class_">Human</span> <span class="keyword">extends</span> <span class="title class_">Animal</span> &#123;</span><br><span class="line">    <span class="attr">name</span>: string;</span><br><span class="line">    <span class="attr">age</span>: number;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="attr">jack</span>: <span class="title class_">Human</span> = &#123;</span><br><span class="line">    <span class="attr">age</span>: <span class="number">18</span>,</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;Jack&#x27;</span>,</span><br><span class="line">    <span class="title function_">move</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;move&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="1-11-命名空间"><a href="#1-11-命名空间" class="headerlink" title="1.11 命名空间"></a>1.11 命名空间</h2><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//命名空间就是内部模块，目的就是解决重名问题。</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//a.ts  声明命名空间</span></span><br><span class="line"><span class="comment">//TypeScript 的命名空间只对外暴露需要在外部访问的对象，命名空间内的对象通过 export 关键字对外暴露</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">Utils</span> &#123;</span><br><span class="line">  <span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">IPerson</span> &#123;</span><br><span class="line">      <span class="attr">name</span>: <span class="built_in">string</span>;</span><br><span class="line">      <span class="attr">age</span>: <span class="built_in">number</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//my.ts  使用命名空间</span></span><br><span class="line"><span class="comment">// reference 引用命名空间(可以加也可以不加)</span></span><br><span class="line"><span class="comment">/// &lt;reference path=&quot;a.ts&quot; /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="attr">me</span>: <span class="title class_">Utils</span>.<span class="property">IPerson</span> = &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;funlee&#x27;</span>,</span><br><span class="line">  <span class="attr">age</span>: <span class="number">18</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(me); <span class="comment">// &#123;name: &#x27;funlee&#x27;, age: 18&#125;</span></span><br></pre></td></tr></table></figure><h2 id="1-12-模块"><a href="#1-12-模块" class="headerlink" title="1.12 模块"></a>1.12 模块</h2><p>模块是在其自身的作用域里执行，并不是在全局作用域，这意味着定义在模块里面的变量、函数和类等在模块外部是不可见的，除非明确地使用 export 导出它们。类似地，我们必须通过 import 导入其他模块导出的变量、函数、类等。</p><p>两个模块之间的关系是通过在文件级别上使用 import 和 export 建立的(其实就是ES6的模块化语法)</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//导出模块</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">var</span> num = <span class="number">123</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">var</span> str = <span class="string">&quot;你好&quot;</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">say</span>(<span class="params"></span>)&#123;&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> title = <span class="string">&quot;标题&quot;</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> title;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//引入模块</span></span><br><span class="line"><span class="keyword">import</span> title,&#123;num,str,say&#125; <span class="keyword">from</span> <span class="string">&#x27;./a&#x27;</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(title,str,say)</span><br></pre></td></tr></table></figure><h2 id="1-13-声明文件"><a href="#1-13-声明文件" class="headerlink" title="1.13 声明文件"></a>1.13 声明文件</h2><blockquote><p>d.ts为声明文件  主要用作类型的声明</p></blockquote><ul><li>在d.ts使用了declare，表示全局声明类型，需要结合tsconfig.json一起使用才能<br>有效果。 (使用方式：类似于命名空间)</li><li>或者使用export的方式，在普通ts中将d.ts导入(使用方式：类似于模块)</li></ul><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//data.d.ts    注意：只有声明没有实现</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//声明一个类型</span></span><br><span class="line"><span class="keyword">declare</span> <span class="keyword">type</span> <span class="title class_">StringFunc</span> = <span class="function">() =&gt;</span> <span class="built_in">string</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//声明一个命名空间</span></span><br><span class="line"><span class="keyword">declare</span> <span class="keyword">namespace</span> API &#123;</span><br><span class="line">  <span class="comment">//导出CurrentUser接口类型</span></span><br><span class="line">  <span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">CurrentUser</span> &#123;</span><br><span class="line">    avatar?: <span class="built_in">string</span>;</span><br><span class="line">    name?: <span class="built_in">string</span>;</span><br><span class="line">    title?: <span class="built_in">string</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="1-14-例子"><a href="#1-14-例子" class="headerlink" title="1.14 例子"></a>1.14 例子</h2><p>写出下列ts代码的含义：</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//导出一个函数 函数名字是defineConfig，函数参数是config，参数类型是IConfigFromPlugins或者IConfig，返回值是IConfigFromPlugins或者IConfig</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">declare</span> <span class="keyword">function</span> <span class="title function_">defineConfig</span>(<span class="params">config: IConfigFromPlugins | IConfig</span>): <span class="title class_">IConfigFromPlugins</span> | <span class="title class_">IConfig</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//声明一个类型叫OverlayFunc，该类型是一个函数，该函数的返回值是ReactNode</span></span><br><span class="line"><span class="keyword">declare</span> <span class="keyword">type</span> <span class="title class_">OverlayFunc</span> = <span class="function">() =&gt;</span> <span class="title class_">React</span>.<span class="property">ReactNode</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//导出一个类型，该类型叫SiderTheme，他的值是light或者dark</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">type</span> <span class="title class_">SiderTheme</span> = <span class="string">&#x27;light&#x27;</span> | <span class="string">&#x27;dark&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//声明一个常量，名字叫columns，他的类型是ProColumns的数组，数组中的元素是TableListItem</span></span><br><span class="line"><span class="keyword">const</span> <span class="attr">columns</span>: <span class="title class_">ProColumns</span>&lt;<span class="title class_">TableListItem</span>&gt;[] = []</span><br><span class="line"></span><br><span class="line"><span class="comment">//声明一个常量，名字叫LoginMessage，他的类型是React.FC，React.FC中接收&#123;content: string&#125;类型的数据。LoginMessage的值是一个箭头函数，该函数通过解构赋值或者content作为函数的入参，函数没有返回值</span></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">LoginMessage</span>: <span class="title class_">React</span>.<span class="property">FC</span>&lt;&#123;</span><br><span class="line">  <span class="attr">content</span>: <span class="built_in">string</span>;</span><br><span class="line">&#125;&gt; = <span class="function">(<span class="params">&#123; content &#125;</span>) =&gt;</span> ()</span><br><span class="line"></span><br><span class="line"><span class="comment">//type的 | 和 &amp;</span></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">Env1</span> = <span class="string">&#x27;prod&#x27;</span> | <span class="string">&#x27;test&#x27;</span> | <span class="string">&#x27;dev&#x27;</span>;</span><br><span class="line"><span class="keyword">type</span> <span class="title class_">Env2</span> = <span class="string">&#x27;prod&#x27;</span> | <span class="string">&#x27;boe&#x27;</span> | <span class="string">&#x27;ppe&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">EnvUnion</span> = <span class="title class_">Env1</span> | <span class="title class_">Env2</span>; <span class="comment">// &#x27;prod&#x27; | &#x27;test&#x27; | &#x27;dev&#x27; | &#x27;boe&#x27; | &#x27;ppe&#x27;  取并集</span></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">EnvInter</span> = <span class="title class_">Env1</span> &amp; <span class="title class_">Env2</span>; <span class="comment">// &#x27;prod&#x27;   取交集</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//声明一个类型叫Partial，主要作用就是将T中的每一个键可选</span></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">Partial</span>&lt;T&gt; = &#123;</span><br><span class="line">  [P <span class="keyword">in</span> keyof T]?: T[P];</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//声明一个类型叫Pick 主要作用选择T中的符合条件的属性</span></span><br><span class="line"><span class="comment">//https://blog.csdn.net/weixin_34376986/article/details/93167453</span></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">Pick</span>&lt;T, K <span class="keyword">extends</span> keyof T&gt; = &#123;</span><br><span class="line">    [P <span class="keyword">in</span> K]: T[P];</span><br><span class="line">&#125;;</span><br><span class="line">                 </span><br><span class="line"><span class="comment">//判断T是不是继承U，如果是则取never类型，否则取T类型本身</span></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">Exclude</span>&lt;T, U&gt; = T <span class="keyword">extends</span> U ? <span class="built_in">never</span> : T;</span><br><span class="line"></span><br><span class="line"><span class="comment">//判断T是不是继承U，如果是则取T类型，否则取never类型</span></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">Extract</span>&lt;T, U&gt; = T <span class="keyword">extends</span> U ? T : <span class="built_in">never</span>;</span><br><span class="line">          </span><br><span class="line"><span class="comment">//Omit 主要作用 选择T中除了K之外的其他属性          </span></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">Omit</span>&lt;T, K <span class="keyword">extends</span> keyof <span class="built_in">any</span>&gt; = <span class="title class_">Pick</span>&lt;T, <span class="title class_">Exclude</span>&lt;keyof T, K&gt;&gt;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//声明一个常量REACT_APP_ENV，他的值是test  dev  pre 或者false中的任意一个</span></span><br><span class="line"><span class="keyword">declare</span> <span class="keyword">const</span> <span class="attr">REACT_APP_ENV</span>: <span class="string">&#x27;test&#x27;</span> | <span class="string">&#x27;dev&#x27;</span> | <span class="string">&#x27;pre&#x27;</span> | <span class="literal">false</span>;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> TypeScript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> TypeScript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Vue3.0</title>
      <link href="/2020/09/12/Vue3.0/"/>
      <url>/2020/09/12/Vue3.0/</url>
      
        <content type="html"><![CDATA[<h1 id="1-Vue-cli脚手架介绍"><a href="#1-Vue-cli脚手架介绍" class="headerlink" title="1. Vue&#x2F;cli脚手架介绍"></a>1. Vue&#x2F;cli脚手架介绍</h1><p>vue-cli是vue官网提供的一个脚手架，这个构建工具大大降低了webpack的使用难度，支持热更新，有<strong>webpack-dev-server</strong>的支持，相当于启动了一个请求服务器，给你搭建了一个测试环境，只关注开发就OK</p><h2 id="1-1-安装vue-cli创建Vue2-x项目"><a href="#1-1-安装vue-cli创建Vue2-x项目" class="headerlink" title="1.1 安装vue-cli创建Vue2.x项目"></a>1.1 安装vue-cli创建Vue2.x项目</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//1.之前安装过vue的2.0版本，你需要把2.0相关的删除  npm uni -g vue-cli</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//2.安装vue/cli脚架  npm i -g @vue/cli@4.5.8</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//3.将配置环境变量  C:\dev\nodejs</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//4.检查版本号,目前安装vuecli 4.5.8    vue -V</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//5.创建项目  vue create project-name</span></span><br><span class="line">    选择vue2x</span><br></pre></td></tr></table></figure><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/rainlotus97/images/data/2024-01-27/1548217691062-6e6242.png"></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//查看最终生效的 webpack 配置信息</span></span><br><span class="line">vue inspect &gt; output.<span class="property">js</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//配置文件参考文档</span></span><br><span class="line"><span class="attr">https</span>:<span class="comment">//cli.vuejs.org/zh/config/#devserver-proxy</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//运行App</span></span><br><span class="line">npm run serve</span><br><span class="line"></span><br><span class="line"><span class="comment">//编译App</span></span><br><span class="line">npm run build</span><br></pre></td></tr></table></figure><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/rainlotus97/images/data/2024-01-27/1548290537572-18b001.png"></p><h2 id="1-2-windows-32位-npm装不上vue-cli的问题"><a href="#1-2-windows-32位-npm装不上vue-cli的问题" class="headerlink" title="1.2 windows(32位) npm装不上vue&#x2F;cli的问题"></a>1.2 windows(32位) npm装不上vue&#x2F;cli的问题</h2><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/rainlotus97/images/data/2024-01-27/1562661036910-a859ca.png"></p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/rainlotus97/images/data/2024-01-27/1562661053769-d205f2.png"></p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/rainlotus97/images/data/2024-01-27/1562661089819-659c7b.png"></p><h2 id="1-3-vue-config-js配置"><a href="#1-3-vue-config-js配置" class="headerlink" title="1.3 vue.config.js配置"></a>1.3 vue.config.js配置</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//官网配置： https://cli.vuejs.org/zh/config/#filenamehashing</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> debug = process.<span class="property">env</span>.<span class="property">NODE_ENV</span> !== <span class="string">&#x27;production&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="comment">//部署应用包时的基本URL，如果是生产环境，部署到 /cli-study/dist 路径；如果是开发环境，部署到根路径</span></span><br><span class="line">  <span class="attr">publicPath</span>: !debug</span><br><span class="line">      ? <span class="string">&#x27;/cli-study/dist&#x27;</span></span><br><span class="line">      : <span class="string">&#x27;/&#x27;</span>,</span><br><span class="line">  <span class="comment">//输出文件路径</span></span><br><span class="line">  <span class="attr">outputDir</span>: <span class="string">&#x27;dist&#x27;</span>,</span><br><span class="line">  <span class="comment">//放置生成的静态资源 (js、css、img、fonts) 的 (相对于 outputDir 的) 目录。</span></span><br><span class="line">  <span class="attr">assetsDir</span>: <span class="string">&#x27;static&#x27;</span>,</span><br><span class="line">  <span class="comment">//默认情况下，生成的静态资源在它们的文件名中包含了 hash 以便更好的控制缓存</span></span><br><span class="line">  <span class="attr">filenameHashing</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="comment">// eslint-loader 是否在保存的时候检查</span></span><br><span class="line">  <span class="attr">lintOnSave</span>: <span class="literal">false</span>,</span><br><span class="line">  <span class="comment">// 是否使用包含运行时编译器的Vue构建版本，设置为 true 后你就可以在 Vue 组件中使用 template 选项了，但是这会让你的应用额外增加 10kb 左右。</span></span><br><span class="line">  <span class="attr">runtimeCompiler</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="comment">// 默认情况下 babel-loader 会忽略所有 node_modules 中的文件。如果你想要通过 Babel 显式转译一个依赖，可以在这个选项中列出来。</span></span><br><span class="line">  <span class="attr">transpileDependencies</span>: [],</span><br><span class="line">  <span class="comment">// 生产环境不需要sourceMap</span></span><br><span class="line">  <span class="attr">productionSourceMap</span>: <span class="literal">false</span>,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 官网：https://cli.vuejs.org/zh/guide/webpack.html#%E7%AE%80%E5%8D%95%E7%9A%84%E9%85%8D%E7%BD%AE%E6%96%B9%E5%BC%8F</span></span><br><span class="line">  <span class="comment">// 更多配置参考：https://www.jb51.net/article/150844.htm</span></span><br><span class="line">  <span class="attr">configureWebpack</span>: <span class="function"><span class="params">config</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="title class_">Object</span>.<span class="title function_">assign</span>(config, &#123; <span class="comment">// 开发生产共同配置</span></span><br><span class="line">      <span class="attr">resolve</span>: &#123;</span><br><span class="line">        <span class="attr">alias</span>: &#123;</span><br><span class="line">          <span class="string">&#x27;@&#x27;</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&#x27;./src&#x27;</span>),</span><br><span class="line">          <span class="string">&#x27;vue$&#x27;</span>: <span class="string">&#x27;vue/dist/vue.esm.js&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// webpack的链式操作，允许对内部的 webpack 配置进行更细粒度的修改</span></span><br><span class="line">  <span class="comment">// 参考： https://cli.vuejs.org/zh/guide/webpack.html#%E9%93%BE%E5%BC%8F%E6%93%8D%E4%BD%9C-%E9%AB%98%E7%BA%A7</span></span><br><span class="line">  <span class="attr">chainWebpack</span>: <span class="function">(<span class="params">config</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (debug) &#123;</span><br><span class="line">      <span class="comment">// 本地开发配置</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">// 生产开发配置</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// css的相关配置</span></span><br><span class="line">  <span class="attr">css</span>: &#123;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">//所有 webpack-dev-server 的选项都支持</span></span><br><span class="line">  <span class="attr">devServer</span>: &#123;</span><br><span class="line">    <span class="attr">open</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">host</span>: <span class="string">&#x27;127.0.0.1&#x27;</span>,</span><br><span class="line">    <span class="attr">port</span>: <span class="number">3000</span>,</span><br><span class="line">    <span class="attr">https</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">hotOnly</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">proxy</span>: <span class="literal">null</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 第三方插件配置</span></span><br><span class="line">  <span class="attr">pluginOptions</span>: &#123;&#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h2 id="1-4-Eslint格式化-vue文件"><a href="#1-4-Eslint格式化-vue文件" class="headerlink" title="1.4 Eslint格式化.vue文件"></a>1.4 Eslint格式化.vue文件</h2><p>ESLint是一个用来识别 ECMAScript 并且按照规则给出报告的代码检测工具，使用它可以避免低级错误和统一代码的风格。</p><p>你可能有疑问，在.vue 文件中你怎么检验你的代码，因为它不是 JavaScript。我们假设你使用 <a href="https://eslint.org/">ESLint</a> (如果你没有使用话，你应该去使用！)。</p><p>你还需要官方的 <a href="https://github.com/vuejs/eslint-plugin-vue">eslint-plugin-vue</a>，它支持同时检查你.vue文件中的模板和脚本。</p><p><a href="https://vue-loader-v14.vuejs.org/zh-cn/workflow/linting.html">https://vue-loader-v14.vuejs.org/zh-cn/workflow/linting.html</a></p><h3 id="eslint配置-rules规则"><a href="#eslint配置-rules规则" class="headerlink" title="eslint配置(rules规则)"></a>eslint配置(rules规则)</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 关闭必须使用单引号</span></span><br><span class="line"><span class="string">&quot;quotes&quot;</span>: [<span class="number">0</span>, <span class="string">&quot;single&quot;</span>],</span><br><span class="line"><span class="comment">// 允许多余的换行</span></span><br><span class="line"><span class="string">&quot;no-multi-spaces&quot;</span>: <span class="number">0</span>,</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;no-console&#x27;</span>: process.<span class="property">env</span>.<span class="property">NODE_ENV</span> === <span class="string">&#x27;production&#x27;</span> ? <span class="string">&#x27;error&#x27;</span> : <span class="string">&#x27;off&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;no-debugger&#x27;</span>: process.<span class="property">env</span>.<span class="property">NODE_ENV</span> === <span class="string">&#x27;production&#x27;</span> ? <span class="string">&#x27;error&#x27;</span> : <span class="string">&#x27;off&#x27;</span>,</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;prefer-promise-reject-errors&#x27;</span>: <span class="number">0</span>,</span><br><span class="line"><span class="string">&#x27;space-unary-ops&#x27;</span>: <span class="number">0</span>,</span><br><span class="line"><span class="string">&#x27;no-unused-expressions&#x27;</span>: <span class="number">0</span>,</span><br><span class="line"><span class="string">&#x27;no-useless-return&#x27;</span>: <span class="number">0</span>,</span><br><span class="line"><span class="string">&#x27;standard/no-callback-literal&#x27;</span>: <span class="number">0</span>,</span><br><span class="line"><span class="string">&#x27;import/first&#x27;</span>: <span class="number">0</span>,</span><br><span class="line"><span class="string">&#x27;import/export&#x27;</span>: <span class="number">0</span>,</span><br><span class="line"><span class="string">&#x27;no-mixed-operators&#x27;</span>: <span class="number">0</span>,</span><br><span class="line"><span class="string">&#x27;no-use-before-define&#x27;</span>: <span class="number">0</span>,</span><br><span class="line"></span><br><span class="line"><span class="comment">// 不允许使用分号</span></span><br><span class="line"><span class="string">&#x27;semi&#x27;</span>: [<span class="number">2</span>, <span class="string">&#x27;never&#x27;</span>],</span><br><span class="line"></span><br><span class="line"><span class="comment">// 允许使用==</span></span><br><span class="line"><span class="string">&#x27;eqeqeq&#x27;</span>: <span class="number">0</span>,</span><br><span class="line"></span><br><span class="line"><span class="comment">// 缩进使用不做限制</span></span><br><span class="line"><span class="string">&#x27;indent&#x27;</span>: <span class="number">2</span>,</span><br><span class="line"></span><br><span class="line"><span class="comment">// 允许使用tab</span></span><br><span class="line"><span class="string">&#x27;no-tabs&#x27;</span>: <span class="number">0</span>,</span><br><span class="line"></span><br><span class="line"><span class="comment">// 函数圆括号之前没有空格</span></span><br><span class="line"><span class="string">&#x27;space-before-function-paren&#x27;</span>: [<span class="number">2</span>, <span class="string">&#x27;never&#x27;</span>],</span><br><span class="line"></span><br><span class="line"><span class="comment">// 不要求块内空格填充格式</span></span><br><span class="line"><span class="string">&#x27;padded-blocks&#x27;</span>: <span class="number">0</span>,</span><br><span class="line"></span><br><span class="line"><span class="comment">// 不限制变量一起声明</span></span><br><span class="line"><span class="string">&#x27;one-var&#x27;</span>: <span class="number">0</span>,</span><br><span class="line"></span><br><span class="line"><span class="comment">// 条件语句中复制操作符需要用圆括号括起来</span></span><br><span class="line"><span class="string">&#x27;no-cond-assign&#x27;</span>: [<span class="number">2</span>, <span class="string">&#x27;except-parens&#x27;</span>],</span><br><span class="line"></span><br><span class="line"><span class="comment">// 允许使用条件表达式使用常量</span></span><br><span class="line"><span class="string">&#x27;no-constant-condition&#x27;</span>: <span class="number">2</span>,</span><br><span class="line"></span><br><span class="line"><span class="comment">// 单行可忽略大括号，多行不可忽略</span></span><br><span class="line"><span class="string">&#x27;curly&#x27;</span>: [<span class="number">2</span>, <span class="string">&#x27;multi-line&#x27;</span>],</span><br><span class="line"></span><br><span class="line"><span class="comment">// 不允许使用var变量</span></span><br><span class="line"><span class="string">&#x27;no-var&#x27;</span>: <span class="number">2</span>,</span><br><span class="line"></span><br><span class="line"><span class="comment">// 不允许出现多个空格</span></span><br><span class="line"><span class="string">&#x27;no-multi-spaces&#x27;</span>: [<span class="string">&#x27;error&#x27;</span>, &#123; <span class="attr">ignoreEOLComments</span>: <span class="literal">true</span> &#125;],</span><br><span class="line"><span class="string">&#x27;camelcase&#x27;</span>: <span class="number">0</span>,</span><br><span class="line"></span><br><span class="line"><span class="comment">// 对象字面量的键值空格风格</span></span><br><span class="line"><span class="string">&#x27;key-spacing&#x27;</span>: <span class="number">2</span>,</span><br><span class="line"></span><br><span class="line"><span class="comment">// if语句包含一个return语句， else就多余</span></span><br><span class="line"><span class="string">&#x27;no-else-return&#x27;</span>: <span class="number">2</span>,</span><br><span class="line"></span><br><span class="line"><span class="comment">// 建议将经常出现的数字提取为变量</span></span><br><span class="line"><span class="string">&#x27;no-magic-numbers&#x27;</span>: [<span class="number">0</span>, &#123; <span class="attr">ignoreArrayIndexes</span>: <span class="literal">true</span> &#125;],</span><br><span class="line"></span><br><span class="line"><span class="comment">// 不允许重复声明变量</span></span><br><span class="line"><span class="string">&#x27;no-redeclare&#x27;</span>: [<span class="number">2</span>, &#123; <span class="attr">builtinGlobals</span>: <span class="literal">true</span> &#125;],</span><br><span class="line"></span><br><span class="line"><span class="comment">// 立即执行函数风格</span></span><br><span class="line"><span class="string">&#x27;wrap-iife&#x27;</span>: [<span class="number">2</span>, <span class="string">&#x27;inside&#x27;</span>],</span><br><span class="line"></span><br><span class="line"><span class="comment">// 不允许圆括号中出现空格</span></span><br><span class="line"><span class="string">&#x27;space-in-parens&#x27;</span>: [<span class="number">2</span>, <span class="string">&#x27;never&#x27;</span>],</span><br><span class="line"></span><br><span class="line"><span class="comment">// 确保运算符周围有空格</span></span><br><span class="line"><span class="string">&#x27;space-infix-ops&#x27;</span>: <span class="number">2</span>,</span><br><span class="line"></span><br><span class="line"><span class="comment">// 强制点号与属性同一行</span></span><br><span class="line"><span class="string">&#x27;dot-location&#x27;</span>: [<span class="number">2</span>, <span class="string">&#x27;property&#x27;</span>],</span><br><span class="line"></span><br><span class="line"><span class="comment">// 强制单行代码使用空格</span></span><br><span class="line"><span class="string">&#x27;block-spacing&#x27;</span>: [<span class="number">2</span>, <span class="string">&#x27;always&#x27;</span>],</span><br><span class="line"></span><br><span class="line"><span class="comment">// 约束for-in使用hasOwnProperty判断</span></span><br><span class="line"><span class="string">&#x27;guard-for-in&#x27;</span>: <span class="number">0</span>,</span><br><span class="line"></span><br><span class="line"><span class="comment">// 采用one true brace style大括号风格</span></span><br><span class="line"><span class="string">&#x27;brace-style&#x27;</span>: [<span class="number">2</span>, <span class="string">&#x27;1tbs&#x27;</span>, &#123; <span class="string">&#x27;allowSingleLine&#x27;</span>: <span class="literal">true</span> &#125;],</span><br><span class="line"></span><br><span class="line"><span class="comment">// 统一逗号周围空格风格</span></span><br><span class="line"><span class="string">&#x27;comma-spacing&#x27;</span>: [<span class="number">2</span>, &#123; <span class="string">&#x27;before&#x27;</span>: <span class="literal">false</span>, <span class="string">&#x27;after&#x27;</span>: <span class="literal">true</span> &#125;],</span><br><span class="line"></span><br><span class="line"><span class="comment">// 禁止出现多个空行</span></span><br><span class="line"><span class="string">&#x27;no-multiple-empty-lines&#x27;</span>: [<span class="number">2</span>, &#123; <span class="string">&#x27;max&#x27;</span>: <span class="number">1</span>, <span class="string">&#x27;maxEOF&#x27;</span>: <span class="number">2</span> &#125;],</span><br><span class="line"></span><br><span class="line"><span class="comment">// 允许箭头函数不使用圆括号</span></span><br><span class="line"><span class="string">&#x27;arrow-parens&#x27;</span>: <span class="number">0</span>,</span><br><span class="line"></span><br><span class="line"><span class="comment">// 规范generator函数的使用</span></span><br><span class="line"><span class="string">&#x27;generator-star-spacing&#x27;</span>: [<span class="number">2</span>, &#123; <span class="string">&#x27;before&#x27;</span>: <span class="literal">false</span>, <span class="string">&#x27;after&#x27;</span>: <span class="literal">true</span> &#125;],</span><br><span class="line"></span><br><span class="line"><span class="comment">// 要求在块级</span></span><br><span class="line"><span class="string">&#x27;lines-around-comment&#x27;</span>: [<span class="number">2</span>, &#123; <span class="string">&#x27;beforeBlockComment&#x27;</span>: <span class="literal">true</span>, <span class="string">&#x27;afterBlockComment&#x27;</span>: <span class="literal">false</span>, <span class="string">&#x27;beforeLineComment&#x27;</span>: <span class="literal">true</span>, <span class="string">&#x27;afterLineComment&#x27;</span>: <span class="literal">false</span> &#125;]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="string">&quot;off&quot;</span>或者<span class="number">0</span>，不启用这个规则</span><br><span class="line"><span class="string">&quot;warn&quot;</span>或者<span class="number">1</span>，出现问题会有警告</span><br><span class="line"><span class="string">&quot;error&quot;</span>或者<span class="number">2</span>，出现问题会报错</span><br></pre></td></tr></table></figure><p><a href="https://github.com/vuejs/eslint-plugin-vue/blob/master/docs/rules/README.md">https://github.com/vuejs/eslint-plugin-vue/blob/master/docs/rules/README.md</a></p><blockquote><p>注意：”extends”: “plugin:vue&#x2F;recommended” 会同时检查js和模板的语法错误</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">vscode中通过  npm run lint会自动进行eslint的校验和修正</span><br><span class="line">npm run lint --fix</span><br></pre></td></tr></table></figure><h1 id="2-Vue3-0介绍"><a href="#2-Vue3-0介绍" class="headerlink" title="2. Vue3.0介绍"></a>2. Vue3.0介绍</h1><p>官方文档：<a href="https://vue-docs-next-zh-cn.netlify.app/guide/installation.html">https://vue-docs-next-zh-cn.netlify.app/guide/installation.html</a></p><h2 id="2-1-Vue3-0-项目创建"><a href="#2-1-Vue3-0-项目创建" class="headerlink" title="2.1 Vue3.0 项目创建"></a>2.1 Vue3.0 项目创建</h2><p>创建:在命令窗口输入指令</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">vue create 项目名称    </span><br><span class="line"><span class="comment">//选择vue3.x</span></span><br></pre></td></tr></table></figure><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/rainlotus97/images/data/2024-01-27/1603679141042-ab66ca.png"></p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/rainlotus97/images/data/2024-01-27/1603679160411-d22e5f.png"></p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/rainlotus97/images/data/2024-01-27/1603679497767-3eed9b.png"></p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/rainlotus97/images/data/2024-01-27/1603679546832-ffc393.png"></p><h2 id="2-2-Vue-composition-API-函数式api"><a href="#2-2-Vue-composition-API-函数式api" class="headerlink" title="2.2  Vue composition API (函数式api)"></a>2.2  Vue composition API (函数式api)</h2><p>vue 3.0 的 Composition API 带来的最大的特性，就是函数组件。通过函数组件，我们可以体会到类似 react 编程的愉悦。</p><p>使用传统的option配置方法写组件的时候问题，随着业务复杂度越来越高，代码量会不断的加大；由于相关业务的代码需要遵循option的配置写到特定的区域(data、methods、computed)，导致后续维护非常的复杂，同时代码可复用性不高，而composition-api就是为了解决这个问题而生的</p><p>vue3.0 侧重于解决代码组织与逻辑复用问题</p><h3 id="2-2-1-defineComponent"><a href="#2-2-1-defineComponent" class="headerlink" title="2.2.1 defineComponent"></a>2.2.1 defineComponent</h3><p>在结合了 TypeScript 的情况下，传统的 Vue.extend 等定义方法无法对组件给出正确的参数类型推断，这就需要引入 defineComponent() 组件包装函数</p><h3 id="2-2-2-setup"><a href="#2-2-2-setup" class="headerlink" title="2.2.2 setup"></a>2.2.2 setup</h3><p>vue3.0将组件的逻辑都写在了函数内部，setup()会取代vue2.x的data()函数，返回一个对象暴露给模板。</p><p><strong>setup函数的特性：</strong></p><ul><li>使用Composition API 的入口</li><li>在beforeCreate之前调用</li><li>在setup中没有this (函数组件)</li><li>可以返回一个对象，这个对象的属性被合并到渲染上下文，并可以在模板中直接使用；</li><li>接收props对象作为第一个参数，接收来的props对象，可以通过watch监视其变化。</li><li>接受context对象作为第二个参数，这个对象包含attrs，slots，emit三个属性。</li></ul><p>setup 函数是个新的入口函数，相当于 vue2.x 中 beforeCreate 和 created，在 beforeCreate 之后 created 之前执行。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">setup</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> msg = <span class="string">&quot;张晓明&quot;</span>;</span><br><span class="line">    <span class="keyword">let</span> age = <span class="number">18</span>;</span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">add</span>(<span class="params"></span>) &#123;</span><br><span class="line">        age += <span class="number">1</span>;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(age)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> &#123; msg, age, add &#125;;</span><br><span class="line">&#125;,</span><br><span class="line">  </span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;home&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    姓名:&#123;&#123;msg&#125;&#125;</span></span><br><span class="line"><span class="language-xml">    年龄:&#123;&#123;age&#125;&#125;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;add&quot;</span>&gt;</span>点我年龄加1<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">//数据绑定的用法和之前vue语法一致</span></span><br></pre></td></tr></table></figure><h3 id="2-2-3-ref"><a href="#2-2-3-ref" class="headerlink" title="2.2.3 ref"></a>2.2.3 ref</h3><p>ref可以让某一个变量具备响应式的能力</p><p><strong>ref 注意点:</strong></p><ul><li><p>在 VUE 的模板中使用 ref 的值不需要通过 value 获取 （Vue 会通过自动给 ref 的值加上 .value）</p></li><li><p>在 js 中使用 ref 的值必须使用 .value 获取</p></li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; defineComponent, ref &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span><br><span class="line"><span class="title function_">setup</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> msg = <span class="title function_">ref</span>(<span class="string">&quot;张晓明&quot;</span>);</span><br><span class="line">    <span class="keyword">let</span> age = <span class="title function_">ref</span>(<span class="number">18</span>);</span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">add</span>(<span class="params"></span>) &#123;</span><br><span class="line">      age.<span class="property">value</span> += <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> &#123; msg, age, add &#125;;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure><h3 id="2-2-4-reactive"><a href="#2-2-4-reactive" class="headerlink" title="2.2.4 reactive"></a>2.2.4 reactive</h3><p>经过reactive函数处理后的对象能变成响应式的对象，类似于option api里面的data属性的值，它主要是处理你的对象让它经过 <code>Proxy</code> 的加工变为一个响应式的对象。</p><p>注意点：</p><ul><li><p>如果想要保持对象内容的响应式能力，在 return 的时候必须把整个 <code>reactive()</code> 对象返回出去</p></li><li><p>在引用的时候也必须对整个对象进行引用而无法解构，否则这个对象内容的响应式能力将会丢失。</p></li><li><p>Vue2.x版本中 Vue 使用了 <code>Object.defineProperty()</code> 来劫持数据变化，Vue3.0中使用 <code>Proxy</code> 来劫持数据变化</p></li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;home&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    名字:&#123;&#123; state.name &#125;&#125; 价格:&#123;&#123; state.price &#125;&#125;</span></span><br><span class="line"><span class="language-xml">    购买数量:&#123;&#123;state.count&#125;&#125;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;add&quot;</span>&gt;</span>点我加1<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span> <span class="attr">lang</span>=<span class="string">&quot;ts&quot;</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">import</span> &#123; defineComponent, ref, reactive &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title function_">defineComponent</span>(&#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="attr">name</span>: <span class="string">&quot;Home&quot;</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="attr">components</span>: &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="title function_">setup</span>(<span class="params"></span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">//响应式对象</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">const</span> state = <span class="title function_">reactive</span>(&#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="attr">count</span>: <span class="number">0</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="attr">name</span>:<span class="string">&quot;商品1&quot;</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="attr">price</span>:<span class="number">100</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">//修改响应式对象</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">function</span> <span class="title function_">add</span>(<span class="params"></span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      state.<span class="property">count</span> += <span class="number">1</span>;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">return</span> &#123; state, add &#125;;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">&#125;);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br></pre></td></tr></table></figure><h3 id="2-2-5-toRefs"><a href="#2-2-5-toRefs" class="headerlink" title="2.2.5 toRefs"></a>2.2.5 toRefs</h3><p>但是在具体的业务中，如果无法使用解构取出 <code>reactive()</code> 对象的值，每次都需要通过 <code>state.</code> 操作符访问它里面的属性会是非常麻烦的，所以官方提供了 <code>toRefs()</code> 函数来为我们填好这个坑。只要使用 <code>toRefs()</code> 把 <code>reactive()</code> 对象包装一下，就能够通过解构单独使用它里面的内容了，而此时的内容也依然维持着响应式的特性。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;home&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    名字:&#123;&#123; name &#125;&#125; 价格:&#123;&#123; price &#125;&#125;</span></span><br><span class="line"><span class="language-xml">    购买数量:&#123;&#123;count&#125;&#125;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;add&quot;</span>&gt;</span>点我加1<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span> <span class="attr">lang</span>=<span class="string">&quot;ts&quot;</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">import</span> &#123; defineComponent, ref, reactive,toRefs &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title function_">defineComponent</span>(&#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="attr">name</span>: <span class="string">&quot;Home&quot;</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="attr">components</span>: &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="title function_">setup</span>(<span class="params"></span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">//响应式对象</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">const</span> state = <span class="title function_">reactive</span>(&#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="attr">count</span>: <span class="number">0</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="attr">name</span>:<span class="string">&quot;商品1&quot;</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="attr">price</span>:<span class="number">100</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">//修改响应式对象</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">function</span> <span class="title function_">add</span>(<span class="params"></span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      state.<span class="property">count</span> += <span class="number">1</span>;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">return</span> &#123; ...<span class="title function_">toRefs</span>(state), add &#125;;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">&#125;);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br></pre></td></tr></table></figure><h3 id="2-2-6-watch和computed"><a href="#2-2-6-watch和computed" class="headerlink" title="2.2.6 watch和computed"></a><strong>2.2.6 watch和computed</strong></h3><p><strong>computed</strong>：该函数用来创造计算属性，和过去一样，它返回的值是一个ref对象。里面可以传方法，或者一个对象，对象中包含set()、get()方法</p><p><strong>watch</strong>：属性监听，支持传三个参数</p><ul><li>想监听的数据，可以是数组形势，传入多个</li><li>监听数据的回调函数，该回调的参数有两个，前一个是newValue，后一个是oldValue，每一个都可以是一个数组，与之前的多个监听对应</li><li>监听的配置参数 是一个对象，如{ immediate: true }，这样可以让初次挂在时执行watch的回调</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;home&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    名字:&#123;&#123; name &#125;&#125; 价格:&#123;&#123; price &#125;&#125;</span></span><br><span class="line"><span class="language-xml">    购买数量:&#123;&#123;count&#125;&#125;</span></span><br><span class="line"><span class="language-xml">    双倍数量:&#123;&#123;double&#125;&#125;</span></span><br><span class="line"><span class="language-xml">    Title:&#123;&#123;title&#125;&#125;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;add&quot;</span>&gt;</span>点我加1<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;title = &#x27;123&#x27;&quot;</span>&gt;</span>修改title<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span> <span class="attr">lang</span>=<span class="string">&quot;ts&quot;</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">import</span> &#123; defineComponent, ref, reactive,toRefs,computed,watch &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title function_">defineComponent</span>(&#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="attr">name</span>: <span class="string">&quot;Home&quot;</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="attr">components</span>: &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="title function_">setup</span>(<span class="params"></span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">//响应式对象</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">const</span> state = <span class="title function_">reactive</span>(&#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="attr">count</span>: <span class="number">0</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="attr">name</span>:<span class="string">&quot;商品1&quot;</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="attr">price</span>:<span class="number">100</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">const</span> title = <span class="title function_">ref</span>(<span class="string">&quot;标题&quot;</span>)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">//计算属性</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">const</span> double = <span class="title function_">computed</span>(<span class="function">() =&gt;</span> state.<span class="property">count</span> * <span class="number">2</span>)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">//watch监听reactive数据</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="title function_">watch</span>(<span class="function">()=&gt;</span>state.<span class="property">count</span>,<span class="function">(<span class="params">newCount,oldCount</span>)=&gt;</span>&#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="variable language_">console</span>.<span class="title function_">log</span>(newCount,oldCount)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;,&#123; <span class="attr">immediate</span>: <span class="literal">true</span> &#125;)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">//watch监听ref数据</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="title function_">watch</span>(title,<span class="function">()=&gt;</span>&#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">//watch监听一组数据变化</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="title function_">watch</span>([title,<span class="function">()=&gt;</span>state.<span class="property">count</span>],<span class="function">(<span class="params">[newTitle,newCount],[oldTitle,oldCount]</span>)=&gt;</span>&#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="variable language_">console</span>.<span class="title function_">log</span>(newTitle,newCount)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">//修改响应式对象</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">function</span> <span class="title function_">add</span>(<span class="params"></span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      state.<span class="property">count</span> += <span class="number">1</span>;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">return</span> &#123; ...<span class="title function_">toRefs</span>(state),double, add,title &#125;;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">&#125;);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br></pre></td></tr></table></figure><h3 id="2-2-7-props-和-context"><a href="#2-2-7-props-和-context" class="headerlink" title="2.2.7 props 和 context"></a>2.2.7 props 和 context</h3><p>在 <code>Vue2.0</code> 中我们可以使用 <code>props</code> 属性值完成父子通信，在这里我们需要定义 <code>props</code> 属性去定义接受值的类型，然后我们可以利用 <code>setup</code> 的第一个参数获取 <code>props</code> 使用。</p><h4 id="a-父传子"><a href="#a-父传子" class="headerlink" title="a) 父传子"></a>a) 父传子</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//父组件</span></span><br><span class="line">&lt;template&gt;</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;home&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">HelloWorld</span> <span class="attr">:msg</span>=<span class="string">&quot;title&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">HelloWorld</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;title = &#x27;123&#x27;&quot;</span>&gt;</span>修改title<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span> <span class="attr">lang</span>=<span class="string">&quot;ts&quot;</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">import</span> &#123; defineComponent, ref, reactive, toRefs, computed, watch, onMounted &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">import</span> <span class="title class_">HelloWorld</span> <span class="keyword">from</span> <span class="string">&#x27;@/components/HelloWorld.vue&#x27;</span>;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title function_">defineComponent</span>(&#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="attr">name</span>: <span class="string">&quot;Home&quot;</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="attr">components</span>: &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="title class_">HelloWorld</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="title function_">setup</span>(<span class="params"></span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">const</span> title = <span class="title function_">ref</span>(<span class="string">&quot;标题&quot;</span>);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">return</span> &#123;  title &#125;;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">&#125;);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//子组件</span></span><br><span class="line">&lt;template&gt;</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;hello&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>&#123;&#123; msg &#125;&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span> <span class="attr">lang</span>=<span class="string">&quot;ts&quot;</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">import</span> &#123; defineComponent, ref,watch &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title function_">defineComponent</span>(&#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="attr">name</span>: <span class="string">&quot;HelloWorld&quot;</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="attr">props</span>: &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="attr">msg</span>: <span class="title class_">String</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="title function_">setup</span>(<span class="params">props</span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">//监听props中的msg变化</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="title function_">watch</span>(<span class="function">()=&gt;</span>props.<span class="property">msg</span>,<span class="function">(<span class="params">newVal</span>)=&gt;</span>&#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="variable language_">console</span>.<span class="title function_">log</span>(newVal)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">&#125;);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br></pre></td></tr></table></figure><h4 id="b-子传父"><a href="#b-子传父" class="headerlink" title="b) 子传父"></a>b) 子传父</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//父组件</span></span><br><span class="line"><span class="title function_">setup</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> title = <span class="title function_">ref</span>(<span class="string">&quot;标题&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">receiveFromChild</span> = (<span class="params">msg: any</span>) =&gt; &#123;</span><br><span class="line">        title.<span class="property">value</span> = msg;</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">return</span> &#123; title, receiveFromChild &#125;;</span><br><span class="line">&#125;,</span><br><span class="line">  </span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">HelloWorld</span> <span class="attr">:msg</span>=<span class="string">&quot;title&quot;</span> @<span class="attr">func</span>=<span class="string">&quot;receiveFromChild&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">HelloWorld</span>&gt;</span></span></span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//子组件</span></span><br><span class="line">&lt;button @click=<span class="string">&quot;send&quot;</span>&gt;向父亲传递数据&lt;/button&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//setup 函数的第二个参数是一个上下文对象，这个上下文对象中包含了一些有用的属性(slot attrs emit)，这些属性在 Vue2.0 中需要通过 this 才能访问到，在 vue3.0中需要通过context来访问：</span></span><br><span class="line"><span class="comment">//注意 vue3.0中没有组件对象，不能通过this来访问组件对象</span></span><br><span class="line"><span class="title function_">setup</span>(<span class="params">props,context</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">send</span> = (<span class="params"></span>)=&gt;&#123;</span><br><span class="line">        context.<span class="title function_">emit</span>(<span class="string">&quot;func&quot;</span>,<span class="string">&quot;孩子的数据&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> &#123;send&#125;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure><h4 id="c-provide和inject"><a href="#c-provide和inject" class="headerlink" title="c) provide和inject"></a>c) provide和inject</h4><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/rainlotus97/images/data/2024-01-27/1603696657842-8d612a.png"></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//父组件</span></span><br><span class="line"><span class="keyword">import</span> &#123; defineComponent,provide &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span><br><span class="line"><span class="title function_">setup</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title function_">provide</span>(<span class="string">&quot;list&quot;</span>,[<span class="string">&#x27;张三&#x27;</span>,<span class="string">&#x27;李四&#x27;</span>,<span class="string">&#x27;王五&#x27;</span>])</span><br><span class="line">    <span class="keyword">return</span> &#123; &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//子组件</span></span><br><span class="line"><span class="keyword">import</span> &#123; defineComponent, inject &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span><br><span class="line"><span class="title function_">setup</span>(<span class="params">props, context</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> list = <span class="title function_">inject</span>(<span class="string">&quot;list&quot;</span>);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(list);</span><br><span class="line">    <span class="keyword">return</span> &#123; &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//注意：provide和inject只能在setup()函数中使用</span></span><br></pre></td></tr></table></figure><h3 id="2-2-8-过滤器、自定义指令"><a href="#2-2-8-过滤器、自定义指令" class="headerlink" title="2.2.8 过滤器、自定义指令"></a>2.2.8 过滤器、自定义指令</h3><h4 id="a-过滤器"><a href="#a-过滤器" class="headerlink" title="a) 过滤器"></a>a) 过滤器</h4><p>vue3.0不再支持过滤器，官方建议我们用methods、computed来替换他们</p><h4 id="b-自定义指令"><a href="#b-自定义指令" class="headerlink" title="b) 自定义指令"></a>b) 自定义指令</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//自定义全局指令</span></span><br><span class="line"><span class="keyword">const</span> app = <span class="title class_">Vue</span>.<span class="title function_">createApp</span>(&#123;&#125;)</span><br><span class="line">app.<span class="title function_">directive</span>(<span class="string">&#x27;focus&#x27;</span>, &#123;</span><br><span class="line">  <span class="comment">// 当被绑定的元素插入到 DOM 中时……</span></span><br><span class="line">  <span class="title function_">mounted</span>(<span class="params">el</span>) &#123;</span><br><span class="line">    el.<span class="title function_">focus</span>()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//自定义局部指令</span></span><br><span class="line"><span class="attr">directives</span>: &#123;</span><br><span class="line">  <span class="attr">focus</span>: &#123;</span><br><span class="line">    <span class="comment">// 指令的定义</span></span><br><span class="line">    <span class="title function_">mounted</span>(<span class="params">el</span>) &#123;</span><br><span class="line">      el.<span class="title function_">focus</span>()</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-2-9-ref引用页面元素"><a href="#2-2-9-ref引用页面元素" class="headerlink" title="2.2.9 ref引用页面元素"></a>2.2.9 ref引用页面元素</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;home&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;inputRef&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;showRef&quot;</span>&gt;</span>点我显示input内容<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span> <span class="attr">lang</span>=<span class="string">&quot;ts&quot;</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">import</span> &#123; defineComponent, ref &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">import</span> <span class="title class_">HelloWorld</span> <span class="keyword">from</span> <span class="string">&quot;@/components/HelloWorld.vue&quot;</span>;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title function_">defineComponent</span>(&#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="attr">name</span>: <span class="string">&quot;Home&quot;</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="attr">components</span>: &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="title class_">HelloWorld</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="title function_">setup</span>(<span class="params"></span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">const</span> inputRef = <span class="title function_">ref</span>();</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">const</span> <span class="title function_">showRef</span> = (<span class="params"></span>) =&gt; &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="variable language_">console</span>.<span class="title function_">log</span>(inputRef.<span class="property">value</span> &amp;&amp; inputRef.<span class="property">value</span>.<span class="property">value</span>);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">return</span> &#123; inputRef, showRef &#125;;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">&#125;);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br></pre></td></tr></table></figure><h3 id="2-2-10-vue3-0生命周期钩子"><a href="#2-2-10-vue3-0生命周期钩子" class="headerlink" title="2.2.10 vue3.0生命周期钩子"></a>2.2.10 vue3.0生命周期钩子</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/rainlotus97/images/data/2024-01-27/1603697386395-197c45.png"></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">onMounted</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;onMounted&quot;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h2 id="2-3-vue-router的使用"><a href="#2-3-vue-router的使用" class="headerlink" title="2.3 vue-router的使用"></a>2.3 vue-router的使用</h2><h3 id="2-3-1-基本使用"><a href="#2-3-1-基本使用" class="headerlink" title="2.3.1 基本使用"></a>2.3.1 基本使用</h3><p><a href="https://router.vuejs.org/zh/guide/essentials/passing-props.html">https://router.vuejs.org/zh/guide/essentials/passing-props.html</a></p><p>router&#x2F;index.ts</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//createRouter创建路由对象</span></span><br><span class="line"><span class="comment">//createWebHashHistory hash模式</span></span><br><span class="line"><span class="comment">//RouteRecordRaw每一条路由规则的类型文件</span></span><br><span class="line"><span class="keyword">import</span> &#123; createRouter, createWebHashHistory, <span class="title class_">RouteRecordRaw</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;vue-router&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Home</span> <span class="keyword">from</span> <span class="string">&#x27;../views/Home.vue&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//路由规则</span></span><br><span class="line"><span class="keyword">const</span> <span class="attr">routes</span>: <span class="title class_">Array</span>&lt;<span class="title class_">RouteRecordRaw</span>&gt; = [</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">path</span>: <span class="string">&#x27;/&#x27;</span>,</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;Home&#x27;</span>,</span><br><span class="line">    <span class="attr">component</span>: <span class="title class_">Home</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">path</span>: <span class="string">&#x27;/about&#x27;</span>,</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;About&#x27;</span>,</span><br><span class="line">    <span class="attr">component</span>: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="comment">/* webpackChunkName: &quot;about&quot; */</span> <span class="string">&#x27;../views/About.vue&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="comment">//创建一个路由对象</span></span><br><span class="line"><span class="keyword">const</span> router = <span class="title function_">createRouter</span>(&#123;</span><br><span class="line">  <span class="attr">history</span>: <span class="title function_">createWebHashHistory</span>(),</span><br><span class="line">  routes</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> router</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//main.ts挂载路由</span></span><br><span class="line"><span class="title function_">createApp</span>(<span class="title class_">App</span>).<span class="title function_">use</span>(store).<span class="title function_">use</span>(router).<span class="title function_">mount</span>(<span class="string">&#x27;#app&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">//App.vue中使用 router-link和router-view</span></span><br><span class="line">&lt;template&gt;</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;nav&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">router-link</span> <span class="attr">to</span>=<span class="string">&quot;/&quot;</span>&gt;</span>Home<span class="tag">&lt;/<span class="name">router-link</span>&gt;</span> |</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">router-link</span> <span class="attr">to</span>=<span class="string">&quot;/about&quot;</span>&gt;</span>About<span class="tag">&lt;/<span class="name">router-link</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">router-view</span>/&gt;</span></span></span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure><h3 id="2-3-2-动态路由参数"><a href="#2-3-2-动态路由参数" class="headerlink" title="2.3.2 动态路由参数"></a>2.3.2 动态路由参数</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//1.修改路由配置</span></span><br><span class="line"><span class="keyword">const</span> <span class="attr">routes</span>: <span class="title class_">Array</span>&lt;<span class="title class_">RouteRecordRaw</span>&gt; = [</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">path</span>: <span class="string">&#x27;/&#x27;</span>,</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;Home&#x27;</span>,</span><br><span class="line">    <span class="attr">component</span>: <span class="title class_">Home</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">path</span>: <span class="string">&#x27;/about/:id&#x27;</span>,</span><br><span class="line">    <span class="attr">props</span>: <span class="literal">true</span>,             <span class="comment">//如果 props 被设置为 true，route.params 将会被设置为组件属性</span></span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;About&#x27;</span>,</span><br><span class="line">    <span class="attr">component</span>: <span class="function">() =&gt;</span> <span class="title class_">About</span></span><br><span class="line">  &#125;</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//2.App.vue跳转路由传参</span></span><br><span class="line">&lt;template&gt;</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;nav&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">router-link</span> <span class="attr">to</span>=<span class="string">&quot;/&quot;</span>&gt;</span>Home<span class="tag">&lt;/<span class="name">router-link</span>&gt;</span> |</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">router-link</span> <span class="attr">to</span>=<span class="string">&quot;/about/123&quot;</span>&gt;</span>About<span class="tag">&lt;/<span class="name">router-link</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">router-view</span>/&gt;</span></span></span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//3.About.vue中使用动态路由参数</span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;about&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>This is an about page &#123;&#123;$route.params.id&#125;&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="attr">props</span>:[<span class="string">&#x27;id&#x27;</span>],</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="title function_">created</span>(<span class="params"></span>)&#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">id</span>)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">&#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br></pre></td></tr></table></figure><h3 id="2-3-3-路由传参"><a href="#2-3-3-路由传参" class="headerlink" title="2.3.3 路由传参"></a>2.3.3 路由传参</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//1.修改路由配置</span></span><br><span class="line"><span class="keyword">const</span> <span class="attr">routes</span>: <span class="title class_">Array</span>&lt;<span class="title class_">RouteRecordRaw</span>&gt; = [</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">path</span>: <span class="string">&quot;/&quot;</span>,</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&quot;Home&quot;</span>,</span><br><span class="line">    <span class="attr">component</span>: <span class="title class_">Home</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">path</span>: <span class="string">&quot;/about&quot;</span>,</span><br><span class="line">    <span class="comment">///search?q=vue 会将 &#123;query: &#x27;vue&#x27;&#125; 作为属性传递给 SearchUser 组件。</span></span><br><span class="line">    <span class="attr">props</span>: <span class="function"><span class="params">route</span> =&gt;</span> (&#123; <span class="attr">query</span>: route.<span class="property">query</span>.<span class="property">q</span>, <span class="attr">query2</span>: route.<span class="property">query</span>.<span class="property">m</span> &#125;),</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&quot;About&quot;</span>,</span><br><span class="line">    <span class="attr">component</span>: <span class="function">() =&gt;</span> <span class="title class_">About</span></span><br><span class="line">  &#125;</span><br><span class="line">];</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//App.vue</span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;nav&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">router-link</span> <span class="attr">to</span>=<span class="string">&quot;/&quot;</span>&gt;</span>Home<span class="tag">&lt;/<span class="name">router-link</span>&gt;</span> |</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">router-link</span> <span class="attr">to</span>=<span class="string">&quot;/about?q=vue&amp;m=123&quot;</span>&gt;</span>About<span class="tag">&lt;/<span class="name">router-link</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;<span class="name">router-view</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//About.vue</span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="attr">props</span>:[<span class="string">&#x27;query&#x27;</span>,<span class="string">&#x27;query2&#x27;</span>],</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="title function_">created</span>(<span class="params"></span>)&#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">query</span>,<span class="variable language_">this</span>.<span class="property">query2</span>)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">&#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br></pre></td></tr></table></figure><h3 id="2-3-4-编程式导航"><a href="#2-3-4-编程式导航" class="headerlink" title="2.3.4 编程式导航"></a>2.3.4 编程式导航</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;about&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>This is an about page<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;goHome&quot;</span>&gt;</span>点我跳转页面<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">import</span> &#123; defineComponent, ref &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">import</span> &#123; useRouter &#125; <span class="keyword">from</span> <span class="string">&quot;vue-router&quot;</span>;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="title function_">setup</span>(<span class="params"></span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">const</span> router = <span class="title function_">useRouter</span>();</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">const</span> <span class="title function_">goHome</span> = (<span class="params"></span>) =&gt; &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      router.<span class="title function_">push</span>(<span class="string">&quot;/&quot;</span>);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">return</span> &#123; goHome &#125;;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">&#125;;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br></pre></td></tr></table></figure><h3 id="2-3-5-导航钩子函数"><a href="#2-3-5-导航钩子函数" class="headerlink" title="2.3.5 导航钩子函数"></a>2.3.5 导航钩子函数</h3><h4 id="a-路由级的导航钩子"><a href="#a-路由级的导航钩子" class="headerlink" title="a) 路由级的导航钩子"></a>a) 路由级的导航钩子</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="attr">routes</span>: <span class="title class_">Array</span>&lt;<span class="title class_">RouteRecordRaw</span>&gt; = [</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">path</span>: <span class="string">&quot;/&quot;</span>,</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&quot;Home&quot;</span>,</span><br><span class="line">    <span class="attr">component</span>: <span class="title class_">Home</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">path</span>: <span class="string">&quot;/about&quot;</span>,</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&quot;About&quot;</span>,</span><br><span class="line">    <span class="attr">component</span>: <span class="function">() =&gt;</span> <span class="title class_">About</span>,</span><br><span class="line">    <span class="comment">//路由级的导航钩子</span></span><br><span class="line">    <span class="attr">beforeEnter</span>:<span class="function">(<span class="params">to,<span class="keyword">from</span>,next</span>)=&gt;</span>&#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;beforeEnter&quot;</span>,to,<span class="keyword">from</span>,next)</span><br><span class="line">      <span class="title function_">next</span>();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">];</span><br></pre></td></tr></table></figure><h4 id="b-全局的导航钩子"><a href="#b-全局的导航钩子" class="headerlink" title="b) 全局的导航钩子"></a>b) 全局的导航钩子</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> router = <span class="title function_">createRouter</span>(&#123;</span><br><span class="line">  <span class="attr">history</span>: <span class="title function_">createWebHashHistory</span>(),</span><br><span class="line">  routes</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//全局导航钩子</span></span><br><span class="line">router.<span class="title function_">beforeEach</span>(<span class="function">(<span class="params">to, <span class="keyword">from</span>, next</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;全局前置 beforeEach&quot;</span>);</span><br><span class="line">  <span class="title function_">next</span>();</span><br><span class="line">&#125;)</span><br><span class="line">router.<span class="title function_">afterEach</span>( <span class="function"><span class="params">route</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;全局后置 afterEach&quot;</span>);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h4 id="c-组件级的导航钩子"><a href="#c-组件级的导航钩子" class="headerlink" title="c) 组件级的导航钩子"></a>c) 组件级的导航钩子</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line"><span class="keyword">import</span> &#123; defineComponent, onMounted, ref &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; onBeforeRouteLeave, onBeforeRouteUpdate, useRouter &#125; <span class="keyword">from</span> <span class="string">&quot;vue-router&quot;</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="title function_">setup</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> router = <span class="title function_">useRouter</span>();</span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">goHome</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">      router.<span class="title function_">push</span>(<span class="string">&quot;/&quot;</span>);</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//组件级的导航钩子</span></span><br><span class="line">    <span class="title function_">onBeforeRouteLeave</span>(<span class="function">(<span class="params">to,<span class="keyword">from</span>,next</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;onBeforeRouteLeave&quot;</span>,to,<span class="keyword">from</span>,next);</span><br><span class="line">      <span class="title function_">next</span>();</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="title function_">onBeforeRouteUpdate</span>(<span class="function">(<span class="params">to,<span class="keyword">from</span>,next</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;onBeforeRouteUpdate&quot;</span>,next);</span><br><span class="line">      <span class="title function_">next</span>();</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> &#123; goHome &#125;;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><h2 id="2-4-vuex的使用"><a href="#2-4-vuex的使用" class="headerlink" title="2.4 vuex的使用"></a>2.4 vuex的使用</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//store/index.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; createStore &#125; <span class="keyword">from</span> <span class="string">&#x27;vuex&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title function_">createStore</span>(&#123;</span><br><span class="line">  <span class="attr">state</span>: &#123;</span><br><span class="line">    <span class="attr">count</span>: <span class="number">0</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">mutations</span>: &#123;</span><br><span class="line">      <span class="title function_">increment</span>(<span class="params">state</span>) &#123;</span><br><span class="line">          state.<span class="property">count</span>++</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="title function_">subtract</span>(<span class="params">state, obj</span>) &#123;</span><br><span class="line">          <span class="variable language_">console</span>.<span class="title function_">log</span>(obj)</span><br><span class="line">          state.<span class="property">count</span> -= obj.<span class="property">step</span>;</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">getters</span>: &#123;</span><br><span class="line">      <span class="attr">optCount</span>: <span class="keyword">function</span> (<span class="params">state</span>) &#123;</span><br><span class="line">          <span class="keyword">return</span> <span class="string">&#x27;当前最新的count值是：&#x27;</span> + state.<span class="property">count</span></span><br><span class="line">      &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">actions</span>: &#123;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">modules</span>: &#123;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//main.ts</span></span><br><span class="line"><span class="title function_">createApp</span>(<span class="title class_">App</span>).<span class="title function_">use</span>(store).<span class="title function_">use</span>(router).<span class="title function_">mount</span>(<span class="string">&#x27;#app&#x27;</span>)</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Home.vue</span></span><br><span class="line">&lt;template&gt;</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;home&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>count值是:&#123;&#123; state.count &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>getters值是:&#123;&#123; getters.optCount &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;doAdd&quot;</span>&gt;</span>点我+1<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;doSub&quot;</span>&gt;</span>点我-若干<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span> <span class="attr">lang</span>=<span class="string">&quot;ts&quot;</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">import</span> &#123; computed, defineComponent, ref &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">import</span> &#123; useStore &#125; <span class="keyword">from</span> <span class="string">&quot;vuex&quot;</span>;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">import</span> <span class="title class_">HelloWorld</span> <span class="keyword">from</span> <span class="string">&quot;@/components/HelloWorld.vue&quot;</span>;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title function_">defineComponent</span>(&#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="attr">name</span>: <span class="string">&quot;Home&quot;</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="attr">components</span>: &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="title class_">HelloWorld</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="title function_">setup</span>(<span class="params"></span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">//获取store中的信息</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">const</span> &#123; state, getters, dispatch, commit &#125; = <span class="title function_">useStore</span>();</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">const</span> <span class="title function_">doAdd</span> = (<span class="params"></span>) =&gt; &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;doAdd&quot;</span>,commit)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="title function_">commit</span>(<span class="string">&quot;increment&quot;</span>);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">const</span> <span class="title function_">doSub</span> = (<span class="params"></span>) =&gt; &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="title function_">commit</span>(<span class="string">&quot;subtract&quot;</span>, &#123; <span class="attr">step</span>: <span class="number">3</span> &#125;);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">return</span> &#123; state, getters,doAdd,doSub &#125;;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">&#125;);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br></pre></td></tr></table></figure><h2 id="2-5-vant组件库的使用"><a href="#2-5-vant组件库的使用" class="headerlink" title="2.5 vant组件库的使用"></a>2.5 vant组件库的使用</h2><h3 id="2-5-1-全局引入"><a href="#2-5-1-全局引入" class="headerlink" title="2.5.1 全局引入"></a>2.5.1 全局引入</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//1.安装vant-ui</span></span><br><span class="line"><span class="comment">//注意：3.0项目中安装vue@next</span></span><br><span class="line">npm i vant@next -S</span><br><span class="line"></span><br><span class="line"><span class="comment">//2.main.ts全局引入Vant UI的样式以及组件库</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Vant</span> <span class="keyword">from</span> <span class="string">&#x27;vant&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;vant/lib/index.css&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="title function_">createApp</span>(<span class="title class_">App</span>).<span class="title function_">use</span>(<span class="title class_">Vant</span>).<span class="title function_">use</span>(store).<span class="title function_">use</span>(router).<span class="title function_">mount</span>(<span class="string">&#x27;#app&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">//3.Home.vue中使用vant组件库</span></span><br><span class="line">&lt;van-button type=<span class="string">&quot;default&quot;</span> @click=<span class="string">&quot;showPopup&quot;</span>&gt;默认按钮&lt;/van-button&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">van-button</span> <span class="attr">type</span>=<span class="string">&quot;primary&quot;</span>&gt;</span>主要按钮<span class="tag">&lt;/<span class="name">van-button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">van-button</span> <span class="attr">type</span>=<span class="string">&quot;info&quot;</span>&gt;</span>信息按钮<span class="tag">&lt;/<span class="name">van-button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">van-button</span> <span class="attr">type</span>=<span class="string">&quot;warning&quot;</span>&gt;</span>警告按钮<span class="tag">&lt;/<span class="name">van-button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">van-button</span> <span class="attr">type</span>=<span class="string">&quot;danger&quot;</span>&gt;</span>危险按钮<span class="tag">&lt;/<span class="name">van-button</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">van-popup</span> <span class="attr">v-model:show</span>=<span class="string">&quot;flag&quot;</span>&gt;</span>内容<span class="tag">&lt;/<span class="name">van-popup</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span> <span class="attr">lang</span>=<span class="string">&quot;ts&quot;</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">import</span> &#123; computed, defineComponent, ref &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title function_">defineComponent</span>(&#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="attr">name</span>: <span class="string">&quot;Home&quot;</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="attr">components</span>: &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="title function_">setup</span>(<span class="params"></span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">const</span> flag = <span class="title function_">ref</span>(<span class="literal">false</span>);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">const</span> <span class="title function_">showPopup</span> = (<span class="params"></span>)=&gt;&#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      flag.<span class="property">value</span> = <span class="literal">true</span>;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">return</span> &#123; flag,showPopup &#125;;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">&#125;);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br></pre></td></tr></table></figure><h3 id="2-5-2-按需加载"><a href="#2-5-2-按需加载" class="headerlink" title="2.5.2 按需加载"></a>2.5.2 按需加载</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//1.安装babel-plugin-import</span></span><br><span class="line">npm i babel-plugin-<span class="keyword">import</span> -D</span><br><span class="line"></span><br><span class="line"><span class="comment">//2.修改babel.config.js</span></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">presets</span>: [</span><br><span class="line">    <span class="string">&#x27;@vue/cli-plugin-babel/preset&#x27;</span></span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">plugins</span>: [</span><br><span class="line">    [<span class="string">&#x27;import&#x27;</span>, &#123;</span><br><span class="line">      <span class="attr">libraryName</span>: <span class="string">&#x27;vant&#x27;</span>,</span><br><span class="line">      <span class="attr">libraryDirectory</span>: <span class="string">&#x27;es&#x27;</span>,</span><br><span class="line">      <span class="attr">style</span>: <span class="literal">true</span></span><br><span class="line">    &#125;, <span class="string">&#x27;vant&#x27;</span>]</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//3.修改main.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Button</span>,<span class="title class_">Popup</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;vant&#x27;</span>;</span><br><span class="line"><span class="title function_">createApp</span>(<span class="title class_">App</span>).<span class="title function_">use</span>(<span class="title class_">Button</span>).<span class="title function_">use</span>(<span class="title class_">Popup</span>).<span class="title function_">use</span>(store).<span class="title function_">use</span>(router).<span class="title function_">mount</span>(<span class="string">&#x27;#app&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//4.Home.vue使用vant组件</span></span><br><span class="line">&lt;template&gt;</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;home&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">van-button</span> <span class="attr">type</span>=<span class="string">&quot;default&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;showPopup&quot;</span>&gt;</span>默认按钮<span class="tag">&lt;/<span class="name">van-button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">van-button</span> <span class="attr">type</span>=<span class="string">&quot;primary&quot;</span>&gt;</span>主要按钮<span class="tag">&lt;/<span class="name">van-button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">van-button</span> <span class="attr">type</span>=<span class="string">&quot;info&quot;</span>&gt;</span>信息按钮<span class="tag">&lt;/<span class="name">van-button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">van-button</span> <span class="attr">type</span>=<span class="string">&quot;warning&quot;</span>&gt;</span>警告按钮<span class="tag">&lt;/<span class="name">van-button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">van-button</span> <span class="attr">type</span>=<span class="string">&quot;danger&quot;</span>&gt;</span>危险按钮<span class="tag">&lt;/<span class="name">van-button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">van-popup</span> <span class="attr">v-model:show</span>=<span class="string">&quot;flag&quot;</span>&gt;</span>内容<span class="tag">&lt;/<span class="name">van-popup</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure><h2 id="2-6-vue3-0和vue2-0比较"><a href="#2-6-vue3-0和vue2-0比较" class="headerlink" title="2.6 vue3.0和vue2.0比较"></a>2.6 vue3.0和vue2.0比较</h2><p>vue3.0 的发布与 vue2.0 相比，优势主要体现在：更快、更小、更易维护、更易于原生、让开发者更轻松；</p><p><strong>更快</strong></p><p>　　1、virtual DOM 完全重写，mounting &amp; patching 提速 100%；</p><p>　　2、更多编译时 （compile-time）提醒以减少 runtime 开销；</p><p>　　3、基于 Proxy 观察者机制以满足全语言覆盖以及更好的性能；</p><p>　　4、放弃 Object.defineProperty ，使用更快的原生 Proxy；</p><p>　　5、组件实例初始化速度提高 100%;</p><p>　　6、提速一倍&#x2F;内存使用降低一半；</p><p><strong>更小</strong></p><p>　　1、Tree-shaking 更友好；（<em>tree shaking</em> 是一个术语，通常用于描述移除 JavaScript 上下文中的未引用代码(dead-code)）</p><p>　　2、新的 core runtime：~ 10kb gzipped；</p>]]></content>
      
      
      <categories>
          
          <category> Vue </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Vue </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Ant Design Pro</title>
      <link href="/2020/07/22/Ant%20Design%20Pro/"/>
      <url>/2020/07/22/Ant%20Design%20Pro/</url>
      
        <content type="html"><![CDATA[<h1 id="1-Ant-Design-Pro介绍"><a href="#1-Ant-Design-Pro介绍" class="headerlink" title="1.Ant Design Pro介绍"></a>1.Ant Design Pro介绍</h1><p>Ant Design Pro 是一个企业级中后台前端&#x2F;设计解决方案</p><blockquote><p>特性</p></blockquote><ul><li><strong>优雅美观</strong>：基于 Ant Design 体系精心设计</li><li><strong>常见设计模式</strong>：提炼自中后台应用的典型页面和场景</li><li><strong>最新技术栈</strong>：使用 React&#x2F;dva&#x2F;antd 等前端前沿技术开发</li><li><strong>响应式</strong>：针对不同屏幕大小设计</li><li><strong>主题</strong>：可配置的主题满足多样化的品牌诉求</li><li><strong>国际化</strong>：内建业界通用的国际化方案</li><li><strong>最佳实践</strong>：良好的工程实践助您持续产出高质量代码</li><li><strong>Mock 数据</strong>：实用的本地数据调试方案</li><li><strong>UI 测试</strong>：自动化测试保障前端产品质量</li></ul><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://i.loli.net/2020/11/03/dCVM1AmtL3OrY4P.png"></p><p>创建项目：</p><p>yarn create umi myprotest</p><p>yarn install</p><p>yarn start</p><p>注意：这里创建项目的时候选择V5版本</p><p>​    Pro V4+antd@4 版本权限验证不好用。<strong>Pro V4+antd@4 可以查看完整版的ant design pro项目</strong>。</p><p>​    Pro V4+antd@3 版本有区块不好用</p><h1 id="2-目录结构和配置介绍"><a href="#2-目录结构和配置介绍" class="headerlink" title="2.目录结构和配置介绍"></a>2.目录结构和配置介绍</h1><h2 id="2-1-目录结构"><a href="#2-1-目录结构" class="headerlink" title="2.1 目录结构"></a>2.1 目录结构</h2><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://i.loli.net/2020/11/03/PN8yAJ3OzcvteQM.png"></p><h2 id="2-2-配置文件"><a href="#2-2-配置文件" class="headerlink" title="2.2 配置文件"></a>2.2 配置文件</h2><h3 id="2-2-1-config-ts"><a href="#2-2-1-config-ts" class="headerlink" title="2.2.1 config.ts"></a>2.2.1 config.ts</h3><p>该文件类似.umirc.ts文件</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//引入umi中的配置文件的类型 ts中要用</span></span><br><span class="line"><span class="keyword">import</span> &#123; defineConfig &#125; <span class="keyword">from</span> <span class="string">&#x27;umi&#x27;</span>;</span><br><span class="line"><span class="comment">//引入默认的配置文件</span></span><br><span class="line"><span class="keyword">import</span> defaultSettings <span class="keyword">from</span> <span class="string">&#x27;./defaultSettings&#x27;</span>;</span><br><span class="line"><span class="comment">//代理配置文件</span></span><br><span class="line"><span class="keyword">import</span> proxy <span class="keyword">from</span> <span class="string">&#x27;./proxy&#x27;</span>;</span><br><span class="line"><span class="keyword">let</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>);</span><br><span class="line"><span class="comment">//当前开发环境\发布环境</span></span><br><span class="line"><span class="keyword">const</span> &#123; <span class="variable constant_">REACT_APP_ENV</span> &#125; = process.<span class="property">env</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//导出配置对象</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title function_">defineConfig</span>(&#123;</span><br><span class="line">  <span class="comment">//文件名支持hash命名</span></span><br><span class="line">  <span class="attr">hash</span>: <span class="literal">true</span>,  </span><br><span class="line">  <span class="comment">//启用dva插件</span></span><br><span class="line">  <span class="comment">//每个插件都会对应一个 id 和一个 key，id 是路径的简写，key 是进一步简化后用于配置的唯一值。</span></span><br><span class="line">  <span class="comment">//比如插件 /node_modules/@umijs/plugin-antd ,id 为 @umijs/plugin-antd，key 为 antd。</span></span><br><span class="line">  <span class="attr">antd</span>: &#123;&#125;,</span><br><span class="line">  <span class="comment">//启用dva插件</span></span><br><span class="line">  <span class="attr">dva</span>: &#123;</span><br><span class="line">    <span class="attr">hmr</span>: <span class="literal">true</span>,  <span class="comment">//热更新</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">//启用layout布局插件  ant design pro中需要使用</span></span><br><span class="line">  <span class="attr">layout</span>: &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;Ant Design Pro&#x27;</span>,</span><br><span class="line">    <span class="attr">locale</span>: <span class="literal">true</span>,     <span class="comment">//国际化</span></span><br><span class="line">    <span class="attr">siderWidth</span>: <span class="number">208</span>,  <span class="comment">//侧边栏宽度</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">//启用locale国际化插件 配置之后才可以使用useIntl </span></span><br><span class="line">  <span class="attr">locale</span>: &#123;</span><br><span class="line">    <span class="comment">//默认的语言环境</span></span><br><span class="line">    <span class="attr">default</span>: <span class="string">&#x27;zh-CN&#x27;</span>,</span><br><span class="line">    <span class="comment">//antd开启国际化</span></span><br><span class="line">    <span class="attr">antd</span>: <span class="literal">true</span>, </span><br><span class="line">    <span class="comment">// default true, when it is true, will use `navigator.language` overwrite default</span></span><br><span class="line">    <span class="attr">baseNavigator</span>: <span class="literal">false</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">//配置按需加载   即是否把构建产物进行拆分，在需要的时候下载额外的 JS 再执行。</span></span><br><span class="line">  <span class="attr">dynamicImport</span>: &#123;</span><br><span class="line">    <span class="attr">loading</span>: <span class="string">&#x27;@/components/PageLoading/index&#x27;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">//兼容ie11</span></span><br><span class="line">  <span class="attr">targets</span>: &#123;</span><br><span class="line">    <span class="attr">ie</span>: <span class="number">11</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// umi routes: https://umijs.org/docs/routing</span></span><br><span class="line">  <span class="comment">//路由配置</span></span><br><span class="line">  <span class="attr">routes</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">path</span>: <span class="string">&#x27;/user&#x27;</span>,</span><br><span class="line">      <span class="comment">//不使用默认的页面布局模板，如果此属性不写就会使用默认页面布局模板(app.tsx中声明的layout)</span></span><br><span class="line">      <span class="attr">layout</span>: <span class="literal">false</span>,</span><br><span class="line">      <span class="comment">//子路由</span></span><br><span class="line">      <span class="attr">routes</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">name</span>: <span class="string">&#x27;login&#x27;</span>,</span><br><span class="line">          <span class="attr">path</span>: <span class="string">&#x27;/user/login&#x27;</span>,</span><br><span class="line">          <span class="attr">component</span>: <span class="string">&#x27;./user/login&#x27;</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">      ],</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">path</span>: <span class="string">&#x27;/welcome&#x27;</span>,</span><br><span class="line">      <span class="attr">name</span>: <span class="string">&#x27;welcome&#x27;</span>,</span><br><span class="line">      <span class="comment">// access: &#x27;canUser&#x27;,  //只有user登录可以访问  在access.ts中有声明</span></span><br><span class="line">      <span class="attr">icon</span>: <span class="string">&#x27;smile&#x27;</span>,      <span class="comment">//指定icon图标  可以使用ant design中的图标</span></span><br><span class="line">      <span class="attr">component</span>: <span class="string">&#x27;./Welcome&#x27;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">path</span>: <span class="string">&#x27;/admin&#x27;</span>,</span><br><span class="line">      <span class="attr">name</span>: <span class="string">&#x27;admin&#x27;</span>,</span><br><span class="line">      <span class="attr">icon</span>: <span class="string">&#x27;crown&#x27;</span>,</span><br><span class="line">      <span class="attr">access</span>: <span class="string">&#x27;canAdmin&#x27;</span>,  <span class="comment">//只有admin登录可以访问  在access.ts中有声明</span></span><br><span class="line">      <span class="attr">component</span>: <span class="string">&#x27;./Admin&#x27;</span>,</span><br><span class="line">      <span class="attr">routes</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">path</span>: <span class="string">&#x27;/admin/sub-page&#x27;</span>,</span><br><span class="line">          <span class="attr">name</span>: <span class="string">&#x27;sub-page&#x27;</span>,</span><br><span class="line">          <span class="attr">icon</span>: <span class="string">&#x27;smile&#x27;</span>,</span><br><span class="line">          <span class="attr">component</span>: <span class="string">&#x27;./Welcome&#x27;</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">      ],</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">name</span>: <span class="string">&#x27;list.table-list&#x27;</span>,</span><br><span class="line">      <span class="attr">icon</span>: <span class="string">&#x27;table&#x27;</span>,</span><br><span class="line">      <span class="attr">path</span>: <span class="string">&#x27;/list&#x27;</span>,</span><br><span class="line">      <span class="attr">component</span>: <span class="string">&#x27;./ListTableList&#x27;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">path</span>: <span class="string">&#x27;/&#x27;</span>,</span><br><span class="line">      <span class="attr">redirect</span>: <span class="string">&#x27;/welcome&#x27;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">component</span>: <span class="string">&#x27;./404&#x27;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">  ],</span><br><span class="line">  <span class="comment">// Theme for antd: https://ant.design/docs/react/customize-theme-cn</span></span><br><span class="line">  <span class="attr">theme</span>: &#123;</span><br><span class="line">    <span class="comment">// ...darkTheme,</span></span><br><span class="line">    <span class="comment">// 主要颜色,</span></span><br><span class="line">    <span class="string">&#x27;primary-color&#x27;</span>: defaultSettings.<span class="property">primaryColor</span>,</span><br><span class="line">    <span class="comment">//主题颜色配置</span></span><br><span class="line">    <span class="comment">// &#x27;font-size-base&#x27;: &#x27;14px&#x27;,</span></span><br><span class="line">    <span class="comment">// &#x27;badge-font-size&#x27;: &#x27;12px&#x27;,</span></span><br><span class="line">    <span class="comment">// &#x27;btn-font-size-lg&#x27;: &#x27;@font-size-base&#x27;,</span></span><br><span class="line">    <span class="comment">// &#x27;menu-dark-bg&#x27;: &#x27;#00182E&#x27;,</span></span><br><span class="line">    <span class="comment">// &#x27;menu-dark-submenu-bg&#x27;: &#x27;#000B14&#x27;,</span></span><br><span class="line">    <span class="comment">// &#x27;layout-sider-background&#x27;: &#x27;#00182E&#x27;,</span></span><br><span class="line">    <span class="comment">// &#x27;layout-body-background&#x27;: &#x27;#f0f2f5&#x27;,</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// @ts-ignore</span></span><br><span class="line">  <span class="attr">title</span>: <span class="literal">false</span>,</span><br><span class="line">  <span class="attr">ignoreMomentLocale</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="comment">//代理</span></span><br><span class="line">  <span class="attr">proxy</span>: proxy[<span class="variable constant_">REACT_APP_ENV</span> || <span class="string">&#x27;dev&#x27;</span>],</span><br><span class="line">  <span class="attr">manifest</span>: &#123;</span><br><span class="line">    <span class="attr">basePath</span>: <span class="string">&#x27;/&#x27;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">//别名</span></span><br><span class="line">  <span class="attr">alias</span>: &#123;</span><br><span class="line">    <span class="string">&#x27;@&#x27;</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&#x27;src&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h3 id="2-2-2-defaultSettings-ts"><a href="#2-2-2-defaultSettings-ts" class="headerlink" title="2.2.2 defaultSettings.ts"></a>2.2.2 defaultSettings.ts</h3><p>页面样式的配置文件</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Settings</span> <span class="keyword">as</span> <span class="title class_">LayoutSettings</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@ant-design/pro-layout&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="attr">navTheme</span>: <span class="string">&#x27;dark&#x27;</span>,         <span class="comment">//主题颜色   dark light</span></span><br><span class="line">  <span class="attr">primaryColor</span>: <span class="string">&#x27;#1890ff&#x27;</span>,   <span class="comment">//主要颜色</span></span><br><span class="line">  <span class="attr">layout</span>: <span class="string">&#x27;mix&#x27;</span>,             <span class="comment">//布局方式  slide</span></span><br><span class="line">  <span class="attr">contentWidth</span>: <span class="string">&#x27;Fluid&#x27;</span>,     <span class="comment">//内容宽度</span></span><br><span class="line">  <span class="attr">fixedHeader</span>: <span class="literal">false</span>,        <span class="comment">//固定头</span></span><br><span class="line">  <span class="attr">fixSiderbar</span>: <span class="literal">true</span>,         <span class="comment">//固定左侧内容</span></span><br><span class="line">  <span class="attr">colorWeak</span>: <span class="literal">false</span>,          <span class="comment">//弱视</span></span><br><span class="line">  <span class="attr">menu</span>: &#123;</span><br><span class="line">    <span class="attr">locale</span>: <span class="literal">true</span>,            <span class="comment">//菜单国际化</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">title</span>: <span class="string">&#x27;Ant Design Pro&#x27;</span>,   <span class="comment">//标题</span></span><br><span class="line">  <span class="attr">pwa</span>: <span class="literal">false</span>,</span><br><span class="line">  <span class="attr">iconfontUrl</span>: <span class="string">&#x27;&#x27;</span>,           <span class="comment">//icon图标地址</span></span><br><span class="line">&#125; <span class="keyword">as</span> <span class="title class_">LayoutSettings</span> &amp; &#123;</span><br><span class="line">  <span class="attr">pwa</span>: boolean;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h3 id="2-2-3-proxy-ts"><a href="#2-2-3-proxy-ts" class="headerlink" title="2.2.3 proxy.ts"></a>2.2.3 proxy.ts</h3><p>该文件主要是代理的配置文件，仅在开发环境有效</p><h3 id="2-2-4-app-tsx"><a href="#2-2-4-app-tsx" class="headerlink" title="2.2.4 app.tsx"></a>2.2.4 app.tsx</h3><p>app.tsx为运行时配置文件，导出的信息会使用对应的插件在运行时配置到程序中</p><h2 id="2-3-配置详解"><a href="#2-3-配置详解" class="headerlink" title="2.3 配置详解"></a>2.3 配置详解</h2><h3 id="2-3-1-路由和菜单"><a href="#2-3-1-路由和菜单" class="headerlink" title="2.3.1 路由和菜单"></a>2.3.1 路由和菜单</h3><p>ant design pro会根据配置的路由自动生成对应的菜单</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// umi routes: https://umijs.org/docs/routing</span></span><br><span class="line"><span class="comment">// hideChildrenInMenu 用于隐藏不需要在菜单中展示的子路由。用法可以查看 分步表单 的配置。</span></span><br><span class="line"><span class="comment">// hideInMenu 可以在菜单中不展示这个路由，包括子路由。</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//路由配置</span></span><br><span class="line"><span class="attr">routes</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">path</span>: <span class="string">&#x27;/user&#x27;</span>,</span><br><span class="line">        <span class="comment">//不使用默认的页面布局模板，如果此属性不写就会使用默认页面布局模板(app.tsx中声明的layout)</span></span><br><span class="line">        <span class="attr">layout</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="comment">//子路由</span></span><br><span class="line">        <span class="attr">routes</span>: [</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="attr">name</span>: <span class="string">&#x27;login&#x27;</span>,</span><br><span class="line">                <span class="attr">path</span>: <span class="string">&#x27;/user/login&#x27;</span>,</span><br><span class="line">                <span class="attr">component</span>: <span class="string">&#x27;./user/login&#x27;</span>,</span><br><span class="line">            &#125;,</span><br><span class="line">        ],</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">path</span>: <span class="string">&#x27;/welcome&#x27;</span>,</span><br><span class="line">        <span class="attr">name</span>: <span class="string">&#x27;welcome&#x27;</span>,</span><br><span class="line">        <span class="comment">// access: &#x27;canUser&#x27;,  //只有user登录可以访问  在access.ts中有声明</span></span><br><span class="line">        <span class="attr">icon</span>: <span class="string">&#x27;smile&#x27;</span>,      <span class="comment">//指定icon图标  可以使用ant design中的图标</span></span><br><span class="line">        <span class="attr">component</span>: <span class="string">&#x27;./Welcome&#x27;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">path</span>: <span class="string">&#x27;/admin&#x27;</span>,</span><br><span class="line">        <span class="attr">name</span>: <span class="string">&#x27;admin&#x27;</span>,</span><br><span class="line">        <span class="attr">icon</span>: <span class="string">&#x27;crown&#x27;</span>,</span><br><span class="line">        <span class="attr">access</span>: <span class="string">&#x27;canAdmin&#x27;</span>,  <span class="comment">//只有admin登录可以访问  在access.ts中有声明</span></span><br><span class="line">        <span class="attr">component</span>: <span class="string">&#x27;./Admin&#x27;</span>,</span><br><span class="line">        <span class="attr">routes</span>: [</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="attr">path</span>: <span class="string">&#x27;/admin/sub-page&#x27;</span>,</span><br><span class="line">                <span class="attr">name</span>: <span class="string">&#x27;sub-page&#x27;</span>,</span><br><span class="line">                <span class="attr">icon</span>: <span class="string">&#x27;smile&#x27;</span>,</span><br><span class="line">                <span class="attr">component</span>: <span class="string">&#x27;./Welcome&#x27;</span>,</span><br><span class="line">            &#125;,</span><br><span class="line">        ],</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">name</span>: <span class="string">&#x27;list.table-list&#x27;</span>,</span><br><span class="line">        <span class="attr">icon</span>: <span class="string">&#x27;table&#x27;</span>,</span><br><span class="line">        <span class="attr">path</span>: <span class="string">&#x27;/list&#x27;</span>,</span><br><span class="line">        <span class="attr">component</span>: <span class="string">&#x27;./ListTableList&#x27;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">path</span>: <span class="string">&#x27;/&#x27;</span>,</span><br><span class="line">        <span class="attr">redirect</span>: <span class="string">&#x27;/welcome&#x27;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">component</span>: <span class="string">&#x27;./404&#x27;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">],</span><br></pre></td></tr></table></figure><h3 id="2-3-2-权限"><a href="#2-3-2-权限" class="headerlink" title="2.3.2 权限"></a>2.3.2 权限</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span>当要设定某些菜单只有部分用户可见的时候，可以在菜单配置中写 <span class="attr">access</span>: <span class="string">&#x27;canAdmin&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="number">2.</span>canAdmin的信息在src/access.<span class="property">ts</span>中声明，该文件中导出的access函数会用插件<span class="meta">@umijs</span>/plugin-access进行运行时配置，函数返回的结果要是下面类型</span><br><span class="line"> *  返回结果:</span><br><span class="line"> *  &#123;</span><br><span class="line"> *     <span class="attr">canAdmin</span>:<span class="literal">true</span>,</span><br><span class="line"> *     <span class="attr">canUser</span>:<span class="literal">false</span></span><br><span class="line"> *  &#125;</span><br><span class="line"></span><br><span class="line"><span class="number">3.</span>useAccess：可以在页面根据不同的登录用户显示不同的信息</span><br><span class="line">   <span class="keyword">import</span> &#123; useAccess, <span class="title class_">Access</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;umi&#x27;</span>;</span><br><span class="line">   <span class="keyword">const</span> access = <span class="title function_">useAccess</span>();      <span class="comment">//此处为当前返回的结果数据</span></span><br><span class="line">   </span><br><span class="line">   <span class="keyword">if</span> (access.<span class="property">canReadFoo</span>) &#123;</span><br><span class="line">    <span class="comment">// 如果可以读取 Foo，则...</span></span><br><span class="line">   &#125; </span><br><span class="line">   &lt;<span class="title class_">Access</span></span><br><span class="line">     accessible=&#123;access.<span class="property">canReadFoo</span>&#125;</span><br><span class="line">     fallback=&#123;<span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>Can not read foo content.<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>&#125;</span><br><span class="line">          &gt;</span><br><span class="line">          <span class="title class_">Foo</span> content.</span><br><span class="line">    &lt;/<span class="title class_">Access</span>&gt;</span><br></pre></td></tr></table></figure><h3 id="2-3-3-布局"><a href="#2-3-3-布局" class="headerlink" title="2.3.3 布局"></a>2.3.3 布局</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">当某个路由不需要布局文件的时候，只需要在config.<span class="property">ts</span>的路由配置中设定<span class="attr">layout</span>: <span class="literal">false</span>即可，如果没有写这个，则会使用默认的布局文件</span><br><span class="line"></span><br><span class="line">默认的布局文件在app.<span class="property">tsx</span>中layout中声明，会使用@umijs/plugin-layout进行运行时配置</span><br></pre></td></tr></table></figure><h3 id="2-3-4-InitialState"><a href="#2-3-4-InitialState" class="headerlink" title="2.3.4 InitialState"></a>2.3.4 InitialState</h3><p>在app.tsx中导出getInitialState方法，会使用@umijs&#x2F;plugin-initial-state插件进行运行时配置，该方法会在整个应用最开始执行，返回值会作为全局共享的数据。(每次刷新页面的之后都会执行)</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">#<span class="number">1.</span> app.<span class="property">tsx</span>使用getInitialState提供全局共享数据</span><br><span class="line"><span class="comment">/**<span class="doctag">@umijs</span>/plugin-initial-state  会启用这个插件</span></span><br><span class="line"><span class="comment">* getInitialState会在整个应用最开始执行，返回值会作为全局共享的数据</span></span><br><span class="line"><span class="comment">* 其他组件中可以使用useModel来获取这份数据 (类似生产者消费者模式)</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">getInitialState</span>(<span class="params"></span>): <span class="title class_">Promise</span>&lt;&#123;</span><br><span class="line">  currentUser?: <span class="variable constant_">API</span>.<span class="property">CurrentUser</span>;</span><br><span class="line">  settings?: <span class="title class_">LayoutSettings</span>;</span><br><span class="line">&#125;&gt; &#123;</span><br><span class="line">  <span class="comment">// 如果是登录页面，不执行</span></span><br><span class="line">  <span class="keyword">if</span> (history.<span class="property">location</span>.<span class="property">pathname</span> !== <span class="string">&#x27;/user/login&#x27;</span>) &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> currentUser = <span class="keyword">await</span> <span class="title function_">queryCurrent</span>();</span><br><span class="line">      <span class="keyword">return</span> &#123;</span><br><span class="line">        currentUser,</span><br><span class="line">        <span class="attr">settings</span>: defaultSettings,</span><br><span class="line">      &#125;;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">      history.<span class="title function_">push</span>(<span class="string">&#x27;/user/login&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    <span class="attr">settings</span>: defaultSettings,</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#<span class="number">2.</span>在其他组件中可以通过useModel获取上面暴露的数据</span><br><span class="line"><span class="keyword">import</span> &#123; useModel &#125; <span class="keyword">from</span> <span class="string">&#x27;umi&#x27;</span>;</span><br><span class="line"><span class="comment">//initialState是getInitialState方法的返回值</span></span><br><span class="line"><span class="comment">//loading是数据加载状态</span></span><br><span class="line"><span class="comment">//refresh可以重新执行getInitialState方法</span></span><br><span class="line"><span class="keyword">const</span> &#123; initialState,loading,refresh &#125; = <span class="title function_">useModel</span>(<span class="string">&#x27;@@initialState&#x27;</span>);   </span><br></pre></td></tr></table></figure><h3 id="2-3-5-国际化"><a href="#2-3-5-国际化" class="headerlink" title="2.3.5 国际化"></a>2.3.5 国际化</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">#<span class="number">1.</span>src/locales 是国际化的配置文件</span><br><span class="line"></span><br><span class="line">#<span class="number">2.</span><span class="title class_">SelectLang</span>是语言选择组件</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">SelectLang</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;umi&#x27;</span>;</span><br><span class="line"></span><br><span class="line">#<span class="number">3.</span>useIntl国际化库</span><br><span class="line"><span class="keyword">import</span> &#123; useIntl,<span class="title class_">FormattedMessage</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;umi&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//useIntl().formatMessage  使用formatMessage这个api进行国际化</span></span><br><span class="line"><span class="title function_">useIntl</span>().<span class="title function_">formatMessage</span>(&#123;</span><br><span class="line">    <span class="attr">id</span>: <span class="string">&#x27;menu.home&#x27;</span>,</span><br><span class="line">    <span class="attr">defaultMessage</span>: <span class="string">&#x27;Home&#x27;</span>,</span><br><span class="line">&#125;),</span><br><span class="line"></span><br><span class="line"><span class="comment">//使用FormattedMessage组件进行国际化</span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">button</span>&gt;</span><span class="tag">&lt;<span class="name">FormattedMessage</span> <span class="attr">id</span>=<span class="string">&quot;menu.admin&quot;</span> /&gt;</span><span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br></pre></td></tr></table></figure><h1 id="3-知识点介绍"><a href="#3-知识点介绍" class="headerlink" title="3.知识点介绍"></a>3.知识点介绍</h1><h2 id="3-1-封装组件介绍"><a href="#3-1-封装组件介绍" class="headerlink" title="3.1 封装组件介绍"></a>3.1 封装组件介绍</h2><p>Footer 网页底部组件的封装</p><p>HeaderDropdown 鼠标移动的下拉组件的封装</p><p>PageLoading  页面加载组件的封装   需要在config.ts中配置</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//PageLoading  pro-layout封装的一个简单的加载页面</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">PageLoading</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@ant-design/pro-layout&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// loading components from code split</span></span><br><span class="line"><span class="comment">// https://umijs.org/plugin/umi-plugin-react.html#dynamicimport</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">PageLoading</span>;</span><br></pre></td></tr></table></figure><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//配置按需加载   即是否把构建产物进行拆分，在需要的时候下载额外的 JS 再执行。</span></span><br><span class="line"><span class="attr">dynamicImport</span>: &#123;</span><br><span class="line">    <span class="attr">loading</span>: <span class="string">&#x27;@/components/PageLoading/index&#x27;</span>,</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure><p>RightContent  登录后右上侧组件的封装(包含搜索、用户头像、语言选择等信息)</p><h2 id="3-2-procomponents"><a href="#3-2-procomponents" class="headerlink" title="3.2  procomponents"></a>3.2  procomponents</h2><p><a href="https://procomponents.ant.design/components/layout#api">https://procomponents.ant.design/components/layout#api</a></p><h3 id="3-2-1-高级布局ProLayout"><a href="#3-2-1-高级布局ProLayout" class="headerlink" title="3.2.1 高级布局ProLayout"></a>3.2.1 高级布局ProLayout</h3><h4 id="a-BasicLayout-BasicLayoutProps"><a href="#a-BasicLayout-BasicLayoutProps" class="headerlink" title="a) BasicLayout&amp;&amp;BasicLayoutProps"></a>a) BasicLayout&amp;&amp;BasicLayoutProps</h4><p>BasicLayout 基础页面布局，包含了头部导航，侧边栏和通知栏等等。</p><p>ProLayout 与 umi 配合使用会有最好的效果，umi 会把 config.ts 中的路由帮我们自动注入到配置的 layout 中，这样我们就可以免去手写菜单的烦恼。</p><p>BasicLayoutProps基本页面布局的属性</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * app.tsx :  这边没有直接使用BasicLayout，而是写一个箭头函数返回BasicLayoutProps的实现，原因在于此处要根据initialState处理页面切换。</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@umijs</span>/plugin-layout</span></span><br><span class="line"><span class="comment"> * 默认登录后的页面布局模板 (此处权限验证的代码已经封装，看不到了，在老版本的项目中可以看到源代码)</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> layout = (&#123;</span><br><span class="line">  initialState,</span><br><span class="line">&#125;: &#123;</span><br><span class="line">  <span class="attr">initialState</span>: &#123; settings?: <span class="title class_">LayoutSettings</span>; currentUser?: <span class="variable constant_">API</span>.<span class="property">CurrentUser</span> &#125;;</span><br><span class="line">&#125;): <span class="function"><span class="params">BasicLayoutProps</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    <span class="comment">//渲染顶部右侧内容</span></span><br><span class="line">    <span class="attr">rightContentRender</span>: <span class="function">() =&gt;</span> <span class="language-xml"><span class="tag">&lt;<span class="name">RightContent</span> /&gt;</span></span>,</span><br><span class="line">    <span class="comment">//关闭 content的 margin</span></span><br><span class="line">    <span class="attr">disableContentMargin</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="comment">//渲染网页底部页面</span></span><br><span class="line">    <span class="attr">footerRender</span>: <span class="function">() =&gt;</span> <span class="language-xml"><span class="tag">&lt;<span class="name">Footer</span> /&gt;</span></span>,</span><br><span class="line">    <span class="comment">//当切换页面的时候触发的事件</span></span><br><span class="line">    <span class="attr">onPageChange</span>: <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">// 如果没有登录，重定向到 login</span></span><br><span class="line">      <span class="keyword">if</span> (!initialState?.<span class="property">currentUser</span>?.<span class="property">userid</span> &amp;&amp; history.<span class="property">location</span>.<span class="property">pathname</span> !== <span class="string">&#x27;/user/login&#x27;</span>) &#123;</span><br><span class="line">        history.<span class="title function_">push</span>(<span class="string">&#x27;/user/login&#x27;</span>);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">//渲染路径导航(代码为后来新增)</span></span><br><span class="line">    <span class="attr">breadcrumbRender</span>: <span class="function">(<span class="params">routers = []</span>) =&gt;</span> [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">path</span>: <span class="string">&#x27;/&#x27;</span>,</span><br><span class="line">        <span class="attr">breadcrumbName</span>: <span class="title function_">useIntl</span>().<span class="title function_">formatMessage</span>(&#123;</span><br><span class="line">          <span class="attr">id</span>: <span class="string">&#x27;menu.home&#x27;</span>,</span><br><span class="line">          <span class="attr">defaultMessage</span>: <span class="string">&#x27;Home&#x27;</span>,</span><br><span class="line">        &#125;),</span><br><span class="line">      &#125;,</span><br><span class="line">      ...routers,</span><br><span class="line">    ],</span><br><span class="line">    <span class="comment">//路径导航相关(代码为后来新增)</span></span><br><span class="line">    <span class="attr">itemRender</span>: <span class="function">(<span class="params">route, params, routes, paths</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> first = routes.<span class="title function_">indexOf</span>(route) === <span class="number">0</span>;</span><br><span class="line">      <span class="keyword">return</span> first ? (</span><br><span class="line">        <span class="language-xml"><span class="tag">&lt;<span class="name">Link</span> <span class="attr">to</span>=<span class="string">&#123;paths.join(</span>&#x27;/&#x27;)&#125;&gt;</span>&#123;route.breadcrumbName&#125;<span class="tag">&lt;/<span class="name">Link</span>&gt;</span></span></span><br><span class="line">      ) : (</span><br><span class="line">        <span class="language-xml"><span class="tag">&lt;<span class="name">span</span>&gt;</span>&#123;route.breadcrumbName&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line">      );</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">//渲染menu菜单头的方法(代码为后来新增)</span></span><br><span class="line">    <span class="attr">menuHeaderRender</span>: <span class="function">() =&gt;</span> <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>测试菜单<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>,</span><br><span class="line">    <span class="comment">//渲染菜单数据(此处可以修改返回的菜单数据从而实现渲染服务器返回的菜单信息)</span></span><br><span class="line">    <span class="comment">//menuData 为confit.ts中配置的菜单信息</span></span><br><span class="line">    <span class="attr">menuDataRender</span>: <span class="function">(<span class="params">menuData</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> menuData;</span><br><span class="line">      <span class="comment">/*</span></span><br><span class="line"><span class="comment">      return [</span></span><br><span class="line"><span class="comment">        &#123;</span></span><br><span class="line"><span class="comment">          path: &#x27;/user&#x27;,</span></span><br><span class="line"><span class="comment">          layout: false,</span></span><br><span class="line"><span class="comment">          //子路由</span></span><br><span class="line"><span class="comment">          routes: [</span></span><br><span class="line"><span class="comment">            &#123;</span></span><br><span class="line"><span class="comment">              name: &#x27;login&#x27;,</span></span><br><span class="line"><span class="comment">              path: &#x27;/user/login&#x27;,</span></span><br><span class="line"><span class="comment">              component: &#x27;./user/login&#x27;,</span></span><br><span class="line"><span class="comment">            &#125;,</span></span><br><span class="line"><span class="comment">          ],</span></span><br><span class="line"><span class="comment">        &#125;,</span></span><br><span class="line"><span class="comment">        &#123;</span></span><br><span class="line"><span class="comment">          path: &#x27;/welcome&#x27;,</span></span><br><span class="line"><span class="comment">          name: &#x27;welcome&#x27;,</span></span><br><span class="line"><span class="comment">          icon: &lt;QuestionCircleOutlined /&gt;,</span></span><br><span class="line"><span class="comment">          component: &#x27;./Welcome&#x27;,</span></span><br><span class="line"><span class="comment">        &#125;,</span></span><br><span class="line"><span class="comment">      ];</span></span><br><span class="line"><span class="comment">      */</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">//传入配置参数</span></span><br><span class="line">    ...initialState?.<span class="property">settings</span>,</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h4 id="b-PageContainer"><a href="#b-PageContainer" class="headerlink" title="b) PageContainer"></a>b) PageContainer</h4><p>正文内容组件，封装了 ant design 的 PageHeader 组件，增加了 tabList 和 content。 根据当前的路由填入 title 和 breadcrumb。</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//content 指定页面内容</span></span><br><span class="line"><span class="comment">//title 指定页面标题</span></span><br><span class="line"><span class="comment">//pageHeaderRender 重新渲染页面头</span></span><br><span class="line"><span class="comment">//footer 网页尾部内容</span></span><br><span class="line"><span class="comment">//tabList 切换的tab列表</span></span><br><span class="line">&lt;<span class="title class_">PageContainer</span></span><br><span class="line">  content=<span class="string">&quot; 这个页面只有 admin 权限才能查看&quot;</span></span><br><span class="line">  title=<span class="string">&quot;管理员页面头部信息&quot;</span></span><br><span class="line">  pageHeaderRender=&#123;<span class="function">(<span class="params">props</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>测试<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>;</span><br><span class="line">  &#125;&#125;</span><br><span class="line">  footer=&#123;[<span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>页面尾巴<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>]&#125;</span><br><span class="line">  tabList=&#123;</span><br><span class="line">     [&#123;<span class="attr">key</span>:<span class="string">&quot;张三&quot;</span>,<span class="attr">tab</span>:<span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>张三<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>&#125;,&#123;<span class="attr">key</span>:<span class="string">&quot;李四&quot;</span>,<span class="attr">tab</span>:<span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>李四<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>&#125;]</span><br><span class="line">  &#125;</span><br><span class="line">&gt;</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">p</span>&gt;</span>正文内容<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line">&lt;/<span class="title class_">PageContainer</span>&gt;</span><br></pre></td></tr></table></figure><h4 id="c-DefaultFooter"><a href="#c-DefaultFooter" class="headerlink" title="c) DefaultFooter"></a>c) DefaultFooter</h4><p>网页默认的底部组件</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="title class_">DefaultFooter</span></span><br><span class="line">    copyright=<span class="string">&quot;2019 蚂蚁金服体验技术部出品&quot;</span></span><br><span class="line">    links=&#123;[</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">key</span>: <span class="string">&#x27;Ant Design Pro&#x27;</span>,</span><br><span class="line">        <span class="attr">title</span>: <span class="string">&#x27;Ant Design Pro&#x27;</span>,</span><br><span class="line">        <span class="attr">href</span>: <span class="string">&#x27;https://pro.ant.design&#x27;</span>,</span><br><span class="line">        <span class="attr">blankTarget</span>: <span class="literal">true</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">key</span>: <span class="string">&#x27;github&#x27;</span>,</span><br><span class="line">        <span class="attr">title</span>: <span class="language-xml"><span class="tag">&lt;<span class="name">GithubOutlined</span> /&gt;</span></span>,</span><br><span class="line">        <span class="attr">href</span>: <span class="string">&#x27;https://github.com/ant-design/ant-design-pro&#x27;</span>,</span><br><span class="line">        <span class="attr">blankTarget</span>: <span class="literal">true</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">key</span>: <span class="string">&#x27;Ant Design&#x27;</span>,</span><br><span class="line">        <span class="attr">title</span>: <span class="string">&#x27;Ant Design&#x27;</span>,</span><br><span class="line">        <span class="attr">href</span>: <span class="string">&#x27;https://ant.design&#x27;</span>,</span><br><span class="line">        <span class="attr">blankTarget</span>: <span class="literal">true</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">    ]&#125;</span><br><span class="line">/&gt;</span><br></pre></td></tr></table></figure><h4 id="d-PageLoading"><a href="#d-PageLoading" class="headerlink" title="d) PageLoading"></a>d) PageLoading</h4><p>加载页面组件，需要在config.ts中配置。配置之后加载页面就默认会用该组件</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//配置按需加载   即是否把构建产物进行拆分，在需要的时候下载额外的 JS 再执行。</span></span><br><span class="line"><span class="attr">dynamicImport</span>: &#123;</span><br><span class="line">    <span class="attr">loading</span>: <span class="string">&#x27;@/components/PageLoading/index&#x27;</span>,</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure><h4 id="e-FooterToolbar"><a href="#e-FooterToolbar" class="headerlink" title="e) FooterToolbar"></a>e) FooterToolbar</h4><p>底部工具栏组件</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="title class_">FooterToolbar</span></span><br><span class="line">    extra=&#123;</span><br><span class="line">        <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        已选择项<span class="symbol">&amp;nbsp;</span><span class="symbol">&amp;nbsp;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">span</span>&gt;</span>服务调用次数总计万<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    &#125;</span><br><span class="line">    &gt;</span><br><span class="line">        &#123;<span class="comment">/**批量删除按钮 */</span>&#125;</span><br><span class="line">    &lt;<span class="title class_">Button</span>&gt;批量删除&lt;/<span class="title class_">Button</span>&gt;</span><br><span class="line">    &#123;<span class="comment">/**批量审批按钮 */</span>&#125;</span><br><span class="line">    &lt;<span class="title class_">Button</span> <span class="keyword">type</span>=<span class="string">&quot;primary&quot;</span>&gt;批量审批&lt;/<span class="title class_">Button</span>&gt;</span><br><span class="line">&lt;/<span class="title class_">FooterToolbar</span>&gt;</span><br></pre></td></tr></table></figure><h3 id="3-2-2-高级表格ProTable"><a href="#3-2-2-高级表格ProTable" class="headerlink" title="3.2.2  高级表格ProTable"></a>3.2.2  高级表格ProTable</h3><h4 id="a-ProColumns"><a href="#a-ProColumns" class="headerlink" title="a) ProColumns"></a>a) ProColumns</h4><p>高级列，会嵌套在高级表格中使用</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//定义高级列(会嵌套在高级表格中)</span></span><br><span class="line">  <span class="keyword">const</span> <span class="attr">columns</span>: <span class="title class_">ProColumns</span>&lt;<span class="title class_">TableListItem</span>&gt;[] = [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">title</span>: <span class="string">&#x27;规则名称&#x27;</span>, <span class="comment">//页面显示的标题</span></span><br><span class="line">      <span class="attr">dataIndex</span>: <span class="string">&#x27;name&#x27;</span>, <span class="comment">//对应数据源中的字段</span></span><br><span class="line">      <span class="attr">tip</span>: <span class="string">&#x27;规则名称是唯一的 key&#x27;</span>, <span class="comment">//tip提示信息</span></span><br><span class="line">      <span class="attr">formItemProps</span>: &#123;</span><br><span class="line">        <span class="comment">//校验规则</span></span><br><span class="line">        <span class="attr">rules</span>: [</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">required</span>: <span class="literal">true</span>,</span><br><span class="line">            <span class="attr">message</span>: <span class="string">&#x27;规则名称为必填项&#x27;</span>,</span><br><span class="line">          &#125;,</span><br><span class="line">        ],</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="comment">//渲染列的方法 : dom为页面元素,entity为数据源</span></span><br><span class="line">      <span class="attr">render</span>: <span class="function">(<span class="params">dom, entity</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">a</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> setRow(entity)&#125;&gt;&#123;dom&#125;<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span>;</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">title</span>: <span class="string">&#x27;描述&#x27;</span>,</span><br><span class="line">      <span class="attr">dataIndex</span>: <span class="string">&#x27;desc&#x27;</span>,</span><br><span class="line">      <span class="comment">//input的type类型</span></span><br><span class="line">      <span class="attr">valueType</span>: <span class="string">&#x27;textarea&#x27;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">title</span>: <span class="string">&#x27;服务调用次数&#x27;</span>,</span><br><span class="line">      <span class="attr">dataIndex</span>: <span class="string">&#x27;callNo&#x27;</span>,</span><br><span class="line">      <span class="attr">sorter</span>: <span class="literal">true</span>,</span><br><span class="line">      <span class="comment">//新建表单和查询的展开表单中不显示当前信息</span></span><br><span class="line">      <span class="attr">hideInForm</span>: <span class="literal">true</span>,</span><br><span class="line">      <span class="comment">//渲染文字的方法</span></span><br><span class="line">      <span class="attr">renderText</span>: <span class="function">(<span class="params">val: <span class="built_in">string</span></span>) =&gt;</span> <span class="string">`<span class="subst">$&#123;val&#125;</span> 万`</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">title</span>: <span class="string">&#x27;状态&#x27;</span>,</span><br><span class="line">      <span class="attr">dataIndex</span>: <span class="string">&#x27;status&#x27;</span>,</span><br><span class="line">      <span class="comment">//新建表单和查询的展开表单中不显示当前信息</span></span><br><span class="line">      <span class="attr">hideInForm</span>: <span class="literal">true</span>,</span><br><span class="line">      <span class="comment">//枚举值</span></span><br><span class="line">      <span class="attr">valueEnum</span>: &#123;</span><br><span class="line">        <span class="number">0</span>: &#123; <span class="attr">text</span>: <span class="string">&#x27;关闭&#x27;</span>, <span class="attr">status</span>: <span class="string">&#x27;Default&#x27;</span> &#125;,</span><br><span class="line">        <span class="number">1</span>: &#123; <span class="attr">text</span>: <span class="string">&#x27;运行中&#x27;</span>, <span class="attr">status</span>: <span class="string">&#x27;Processing&#x27;</span> &#125;,</span><br><span class="line">        <span class="number">2</span>: &#123; <span class="attr">text</span>: <span class="string">&#x27;已上线&#x27;</span>, <span class="attr">status</span>: <span class="string">&#x27;Success&#x27;</span> &#125;,</span><br><span class="line">        <span class="number">3</span>: &#123; <span class="attr">text</span>: <span class="string">&#x27;异常&#x27;</span>, <span class="attr">status</span>: <span class="string">&#x27;Error&#x27;</span> &#125;,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">title</span>: <span class="string">&#x27;上次调度时间&#x27;</span>,</span><br><span class="line">      <span class="attr">dataIndex</span>: <span class="string">&#x27;updatedAt&#x27;</span>,</span><br><span class="line">      <span class="attr">sorter</span>: <span class="literal">true</span>,</span><br><span class="line">      <span class="comment">// input的type类型</span></span><br><span class="line">      <span class="attr">valueType</span>: <span class="string">&#x27;dateTime&#x27;</span>,</span><br><span class="line">      <span class="comment">// 新建表单查询的展开表单中不显示当前信息</span></span><br><span class="line">      <span class="comment">// hideInForm: true,</span></span><br><span class="line">      <span class="comment">// 自定义渲染内容(会在新增表单和查询的展开表单中显示,要看到这个属性的结果需要把hideInForm: true去掉)</span></span><br><span class="line">      <span class="attr">renderFormItem</span>: <span class="function">(<span class="params">item, &#123; defaultRender, ...rest &#125;, form</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">//获取当前数据的状态信息</span></span><br><span class="line">        <span class="keyword">const</span> status = form.<span class="title function_">getFieldValue</span>(<span class="string">&#x27;status&#x27;</span>);</span><br><span class="line">        <span class="keyword">if</span> (<span class="string">`<span class="subst">$&#123;status&#125;</span>`</span> === <span class="string">&#x27;0&#x27;</span>) &#123;</span><br><span class="line">          <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (<span class="string">`<span class="subst">$&#123;status&#125;</span>`</span> === <span class="string">&#x27;3&#x27;</span>) &#123;</span><br><span class="line">          <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">Input</span> &#123;<span class="attr">...rest</span>&#125; <span class="attr">placeholder</span>=<span class="string">&quot;请输入异常原因！&quot;</span> /&gt;</span></span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">defaultRender</span>(item);</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">title</span>: <span class="string">&#x27;操作&#x27;</span>,</span><br><span class="line">      <span class="attr">dataIndex</span>: <span class="string">&#x27;option&#x27;</span>,</span><br><span class="line">      <span class="attr">valueType</span>: <span class="string">&#x27;option&#x27;</span>,</span><br><span class="line">      <span class="comment">//渲染操作栏的方法</span></span><br><span class="line">      <span class="attr">render</span>: <span class="function">(<span class="params">_, record</span>) =&gt;</span> (</span><br><span class="line">        <span class="language-xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml">          &#123;/**配置按钮 */&#125;</span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">a</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-xml">              //点击配置按钮让更新表单可见</span></span><br><span class="line"><span class="language-xml">              handleUpdateModalVisible(true);</span></span><br><span class="line"><span class="language-xml">              //点击配置按钮设置更新表单的数据</span></span><br><span class="line"><span class="language-xml">              setStepFormValues(record);</span></span><br><span class="line"><span class="language-xml">            &#125;&#125;</span></span><br><span class="line"><span class="language-xml">          &gt;</span></span><br><span class="line"><span class="language-xml">            配置</span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;/<span class="name">a</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">Divider</span> <span class="attr">type</span>=<span class="string">&quot;vertical&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">          &#123;/**订阅警报按钮 */&#125;</span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;&quot;</span>&gt;</span>订阅警报<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">      ),</span><br><span class="line">    &#125;,</span><br><span class="line">  ];</span><br></pre></td></tr></table></figure><h4 id="b-ProTable-ActionType"><a href="#b-ProTable-ActionType" class="headerlink" title="b) ProTable&amp;ActionType"></a>b) ProTable&amp;ActionType</h4><p>ProTable 高级表格</p><p>ActionType  记录高级表格的常用事件  (reload reset reloadAndRest等事件)</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">ProTable</span>, &#123; <span class="title class_">ProColumns</span>, <span class="title class_">ActionType</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@ant-design/pro-table&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//actionRef 记录高级表格的常用事件  (reload reset reloadAndRest等事件)</span></span><br><span class="line"><span class="keyword">const</span> actionRef = useRef&lt;<span class="title class_">ActionType</span>&gt;();</span><br><span class="line"></span><br><span class="line">&lt;<span class="title class_">ProTable</span>&lt;<span class="title class_">TableListItem</span>&gt;</span><br><span class="line">        headerTitle=<span class="string">&quot;查询表格&quot;</span> <span class="comment">//表格标题</span></span><br><span class="line">        actionRef=&#123;actionRef&#125; <span class="comment">//表格事件的引用</span></span><br><span class="line">        rowKey=<span class="string">&quot;key&quot;</span> <span class="comment">//表格每一行的key，这边为数据源中每一条数据的key</span></span><br><span class="line">        search=&#123;&#123;</span><br><span class="line">          <span class="attr">labelWidth</span>: <span class="number">120</span>, <span class="comment">//搜索lable的宽度   如果不想显示搜索栏，设置成false即可</span></span><br><span class="line">        &#125;&#125;</span><br><span class="line">        <span class="comment">//渲染工具栏(新建按钮)</span></span><br><span class="line">        toolBarRender=&#123;<span class="function">() =&gt;</span> [</span><br><span class="line">          <span class="comment">//点击新建按钮，让新建表单可见</span></span><br><span class="line">          <span class="language-xml"><span class="tag">&lt;<span class="name">Button</span> <span class="attr">type</span>=<span class="string">&quot;primary&quot;</span>&gt;</span>新建<span class="tag">&lt;/<span class="name">Button</span>&gt;</span></span>,</span><br><span class="line">        ]&#125;</span><br><span class="line">        <span class="comment">//设置表格数据 (columns配置的sorter没有用，这边入参的sorter为空，要实现排序，手动storter写死)</span></span><br><span class="line">        request=&#123;<span class="function">(<span class="params">params, sorter, filter</span>) =&gt;</span> </span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//指定表格列</span></span><br><span class="line">        columns=&#123;columns&#125;</span><br><span class="line">        <span class="comment">//选中每一行(打钩)，记录下选中的数据</span></span><br><span class="line">        rowSelection=&#123;&#123;</span><br><span class="line">        &#125;&#125;</span><br><span class="line">/&gt;</span><br></pre></td></tr></table></figure><h3 id="3-2-3-高级描述ProDescriptions"><a href="#3-2-3-高级描述ProDescriptions" class="headerlink" title="3.2.3 高级描述ProDescriptions"></a>3.2.3 高级描述ProDescriptions</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">ProDescriptions</span> <span class="keyword">from</span> <span class="string">&#x27;@ant-design/pro-descriptions&#x27;</span>;</span><br><span class="line"></span><br><span class="line">&lt;<span class="title class_">ProDescriptions</span>&lt;<span class="title class_">TableListItem</span>&gt;</span><br><span class="line">    <span class="comment">//几列显示</span></span><br><span class="line">    column=&#123;<span class="number">2</span>&#125;</span><br><span class="line">    <span class="comment">//标题 如果row存在则取name，如果row不存在则不取name，避免row不存在的时候报错</span></span><br><span class="line">    title=&#123;row?.<span class="property">name</span>&#125;</span><br><span class="line">    <span class="comment">//设置ProDescriptions的数据</span></span><br><span class="line">    request=&#123;<span class="keyword">async</span> () =&gt; (&#123;</span><br><span class="line">        <span class="attr">data</span>: row || &#123;&#125;,</span><br><span class="line">    &#125;)&#125;</span><br><span class="line">    <span class="comment">//传参，参数改变的时候会触发页面刷新</span></span><br><span class="line">    params=&#123;&#123;</span><br><span class="line">        <span class="attr">id</span>: row?.<span class="property">name</span>,</span><br><span class="line">    &#125;&#125;</span><br><span class="line">    <span class="comment">//设置ProDescriptions的列数据</span></span><br><span class="line">    columns=&#123;columns&#125;</span><br><span class="line">/&gt;</span><br></pre></td></tr></table></figure><h2 id="3-3-登录页面及流程"><a href="#3-3-登录页面及流程" class="headerlink" title="3.3 登录页面及流程"></a>3.3 登录页面及流程</h2><h3 id="3-3-1-登录页面及子组件"><a href="#3-3-1-登录页面及子组件" class="headerlink" title="3.3.1 登录页面及子组件"></a>3.3.1 登录页面及子组件</h3><p>user&#x2F;login&#x2F;index.tsx   登录页面</p><p>user&#x2F;login&#x2F;components&#x2F;login&#x2F;index.tsx  封装的login组件，同时把Tab、Submit、Username、Password、Mobile、Captcha等组件挂在到当前index.tsx中</p><p>LoginContext.tsx  上下文对象，主要通过上下文在user&#x2F;login&#x2F;components&#x2F;login&#x2F;index.tsx中给子组件共享和暴露数据</p><p>LoginItem.tsx    登录项，主要在这里通过map.tsx中的配置动态创建登录子组件，包括Username、Password、Mobile、Captcha等</p><p>LoginSumit.tsx  提交登录表单的组件</p><p>LoginTab.tsx  登录切换Tab组件</p><h3 id="3-3-2-登录流程"><a href="#3-3-2-登录流程" class="headerlink" title="3.3.2 登录流程"></a>3.3.2 登录流程</h3><ol><li><p>提交登录表单</p></li><li><p>调用fakeAccountLogin这个service发送登录请求</p></li><li><p>登录成功之后跳回回调地址 </p><p>注意：这边使用window.location.href&#x3D;”xx”，会刷新页面，从而触发app.tsx中的getInitialState方法重新执行</p></li><li><p>根据当前url从路由配置中找寻相应的规则，然后根据getInitialState中的CurrentUser做权限验证，呈现登录后的用户菜单和页面</p></li></ol><h2 id="3-4-列表页流程"><a href="#3-4-列表页流程" class="headerlink" title="3.4 列表页流程"></a>3.4 列表页流程</h2><h3 id="3-4-1-列表页面及子组件"><a href="#3-4-1-列表页面及子组件" class="headerlink" title="3.4.1 列表页面及子组件"></a>3.4.1 列表页面及子组件</h3><p>pages&#x2F;ListTableList&#x2F;index.tsx   列表页面</p><p>pages&#x2F;ListTableList&#x2F;service.ts  列表页面的请求文件</p><p>pages&#x2F;ListTableList&#x2F;data.d.ts   列表页面的类型声明文件</p><p>pages&#x2F;ListTableList&#x2F;components&#x2F;createForm.tsx  创建表单的组件</p><p>pages&#x2F;ListTableList&#x2F;components&#x2F;updateForm.tsx  更新表单的组件</p><h3 id="3-4-2-列表流程"><a href="#3-4-2-列表流程" class="headerlink" title="3.4.2 列表流程"></a>3.4.2 列表流程</h3><h4 id="a-列表页面展示、查询、分页"><a href="#a-列表页面展示、查询、分页" class="headerlink" title="a) 列表页面展示、查询、分页"></a>a) 列表页面展示、查询、分页</h4><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//设置表格数据 (columns配置的sorter没有用，这边入参的sorter为空，要实现排序，手动storter写死)</span></span><br><span class="line">request=&#123;<span class="function">(<span class="params">params, sorter, filter</span>) =&gt;</span></span><br><span class="line">         <span class="title function_">queryRule</span>(&#123; ...params, <span class="attr">sorter</span>: &#123; <span class="attr">callNo</span>: <span class="string">&#x27;ascend&#x27;</span> &#125;, filter &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="b-规则新增"><a href="#b-规则新增" class="headerlink" title="b) 规则新增"></a>b) 规则新增</h4><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//1.点击新建按钮，让新建表单模态框可见</span></span><br><span class="line">&lt;<span class="title class_">Button</span> <span class="keyword">type</span>=<span class="string">&quot;primary&quot;</span> onClick=&#123;<span class="function">() =&gt;</span> <span class="title function_">handleModalVisible</span>(<span class="literal">true</span>)&#125;&gt;</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">PlusOutlined</span> /&gt;</span></span> 新建</span><br><span class="line">&lt;/<span class="title class_">Button</span>&gt;,</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//2.点击新建表单的提交表单按钮，发送请求，然后让新建表单不可见，然后让外边的表单刷新页面</span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">CreateForm</span> <span class="attr">onCancel</span>=<span class="string">&#123;()</span> =&gt;</span> handleModalVisible(false)&#125; modalVisible=&#123;createModalVisible&#125;&gt;</span></span><br><span class="line"><span class="language-xml">        &#123;/**嵌套一个ProTable */&#125;</span></span><br><span class="line"><span class="language-xml">        &lt;ProTable&lt;TableListItem, TableListItem&gt;</span></span><br><span class="line"><span class="language-xml">          //点击提交按钮 发送请求 让外部的ProTable刷新表格</span></span><br><span class="line"><span class="language-xml">          onSubmit=&#123;async (value) =&gt; &#123;</span></span><br><span class="line"><span class="language-xml">            const success = await handleAdd(value);</span></span><br><span class="line"><span class="language-xml">            if (success) &#123;</span></span><br><span class="line"><span class="language-xml">              handleModalVisible(false);</span></span><br><span class="line"><span class="language-xml">              if (actionRef.current) &#123;</span></span><br><span class="line"><span class="language-xml">                actionRef.current.reload();</span></span><br><span class="line"><span class="language-xml">              &#125;</span></span><br><span class="line"><span class="language-xml">            &#125;</span></span><br><span class="line"><span class="language-xml">          &#125;&#125;</span></span><br><span class="line"><span class="language-xml">          //每一行的索引</span></span><br><span class="line"><span class="language-xml">          rowKey=&quot;key&quot;</span></span><br><span class="line"><span class="language-xml">          //表格的类型</span></span><br><span class="line"><span class="language-xml">          type=&quot;form&quot;</span></span><br><span class="line"><span class="language-xml">          //指定表格的列  此时columns中配置的hideInForm生效了</span></span><br><span class="line"><span class="language-xml">          columns=&#123;columns&#125;</span></span><br><span class="line"><span class="language-xml">        /&gt;</span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">CreateForm</span>&gt;</span></span></span><br></pre></td></tr></table></figure><h4 id="c-规则更新"><a href="#c-规则更新" class="headerlink" title="c) 规则更新"></a>c) 规则更新</h4><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//1.点击配置按钮，让配置表单可见，并设置配置表单的数据</span></span><br><span class="line"><span class="title function_">handleUpdateModalVisible</span>(<span class="literal">true</span>);</span><br><span class="line"><span class="comment">//点击配置按钮设置更新表单的数据</span></span><br><span class="line"><span class="title function_">setStepFormValues</span>(record);</span><br><span class="line"></span><br><span class="line"><span class="comment">//2.点击配置表单的提交按钮，发送请求，然后让配置表单不可见，然后让外边的表单刷新页面</span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">UpdateForm</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          //<span class="attr">提交表单</span> <span class="attr">发送请求</span> <span class="attr">让外部的ProTable刷新表格</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">onSubmit</span>=<span class="string">&#123;async</span> (<span class="attr">value</span>) =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-xml">            const success = await handleUpdate(value);</span></span><br><span class="line"><span class="language-xml">            if (success) &#123;</span></span><br><span class="line"><span class="language-xml">              handleUpdateModalVisible(false);</span></span><br><span class="line"><span class="language-xml">              setStepFormValues(&#123;&#125;);</span></span><br><span class="line"><span class="language-xml">              if (actionRef.current) &#123;</span></span><br><span class="line"><span class="language-xml">                actionRef.current.reload();</span></span><br><span class="line"><span class="language-xml">              &#125;</span></span><br><span class="line"><span class="language-xml">            &#125;</span></span><br><span class="line"><span class="language-xml">          &#125;&#125;</span></span><br><span class="line"><span class="language-xml">          //取消更新表单</span></span><br><span class="line"><span class="language-xml">          onCancel=&#123;() =&gt; &#123;</span></span><br><span class="line"><span class="language-xml">            handleUpdateModalVisible(false);</span></span><br><span class="line"><span class="language-xml">            setStepFormValues(&#123;&#125;);</span></span><br><span class="line"><span class="language-xml">          &#125;&#125;</span></span><br><span class="line"><span class="language-xml">          //更新表单的显示隐藏状态</span></span><br><span class="line"><span class="language-xml">          updateModalVisible=&#123;updateModalVisible&#125;</span></span><br><span class="line"><span class="language-xml">          //更新表单的数据</span></span><br><span class="line"><span class="language-xml">          values=&#123;stepFormValues&#125;</span></span><br><span class="line"><span class="language-xml">/&gt;</span></span><br></pre></td></tr></table></figure><h4 id="d-规则选中"><a href="#d-规则选中" class="headerlink" title="d) 规则选中"></a>d) 规则选中</h4><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//1.选中规则，保存选中的数据到selectedRows数组</span></span><br><span class="line">rowSelection=&#123;&#123;</span><br><span class="line">    <span class="attr">onChange</span>: <span class="function">(<span class="params">_, selectedRows</span>) =&gt;</span> <span class="title function_">setSelectedRows</span>(selectedRows),</span><br><span class="line">&#125;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//2.如果选中行的长度&gt;0，则让底部FooterToolbar显示出来</span></span><br><span class="line"><span class="comment">//点击批量删除，发送请求，设置选中的selectedRows数组为空(让FooterToolbar不可见)，同时让外边的表单刷新页面</span></span><br><span class="line">&#123;selectedRowsState?.<span class="property">length</span> &gt; <span class="number">0</span> &amp;&amp; (</span><br><span class="line">        <span class="language-xml"><span class="tag">&lt;<span class="name">FooterToolbar</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">extra</span>=<span class="string">&#123;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            &lt;<span class="attr">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">              已选择 <span class="tag">&lt;<span class="name">a</span> <span class="attr">style</span>=<span class="string">&#123;&#123;</span> <span class="attr">fontWeight:</span> <span class="attr">600</span> &#125;&#125;&gt;</span>&#123;selectedRowsState.length&#125;<span class="tag">&lt;/<span class="name">a</span>&gt;</span> 项<span class="symbol">&amp;nbsp;</span><span class="symbol">&amp;nbsp;</span></span></span><br><span class="line"><span class="language-xml">              <span class="tag">&lt;<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                服务调用次数总计 &#123;selectedRowsState.reduce((pre, item) =&gt; pre + item.callNo, 0)&#125; 万</span></span><br><span class="line"><span class="language-xml">              <span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          &#125;</span></span><br><span class="line"><span class="language-xml">        &gt;</span></span><br><span class="line"><span class="language-xml">          &#123;/**批量删除按钮 */&#125;</span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">Button</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">onClick</span>=<span class="string">&#123;async</span> () =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-xml">              await handleRemove(selectedRowsState);</span></span><br><span class="line"><span class="language-xml">              setSelectedRows([]);</span></span><br><span class="line"><span class="language-xml">              actionRef.current?.reloadAndRest?.();</span></span><br><span class="line"><span class="language-xml">            &#125;&#125;</span></span><br><span class="line"><span class="language-xml">          &gt;</span></span><br><span class="line"><span class="language-xml">            批量删除</span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;/<span class="name">Button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">           &#123;/**批量审批按钮 */&#125;</span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">Button</span> <span class="attr">type</span>=<span class="string">&quot;primary&quot;</span>&gt;</span>批量审批<span class="tag">&lt;/<span class="name">Button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">FooterToolbar</span>&gt;</span></span></span><br><span class="line">)&#125;</span><br></pre></td></tr></table></figure><h4 id="e-查看规则名称"><a href="#e-查看规则名称" class="headerlink" title="e) 查看规则名称"></a>e) 查看规则名称</h4><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//1.点击规则名称记录当前点击的规则数据(row)</span></span><br><span class="line">&lt;a onClick=&#123;<span class="function">() =&gt;</span> <span class="title function_">setRow</span>(entity)&#125;&gt;&#123;dom&#125;&lt;/a&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment">//2.当前记录的规则有数据的时候，让抽屉可见，并使用ProDescriptions展示数据</span></span><br><span class="line"><span class="comment">// 点击抽屉组件的关闭按钮的时候，让row数据置空(此时Drawer会隐藏)</span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">Drawer</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">width</span>=<span class="string">&#123;500&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        //<span class="attr">当row数据存在的时候让抽屉组件显示</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">visible</span>=<span class="string">&#123;!!row&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        //<span class="attr">关闭抽屉组件的时候触发的方法</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">onClose</span>=<span class="string">&#123;()</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-xml">          setRow(undefined);</span></span><br><span class="line"><span class="language-xml">        &#125;&#125;</span></span><br><span class="line"><span class="language-xml">        //是否显示抽屉组件的关闭按钮</span></span><br><span class="line"><span class="language-xml">        closable=&#123;false&#125;</span></span><br><span class="line"><span class="language-xml">      &gt; </span></span><br><span class="line"><span class="language-xml">        &#123;/**如果row中有信息则显示规则的详细信息 */&#125;</span></span><br><span class="line"><span class="language-xml">        &#123;row?.name &amp;&amp; (</span></span><br><span class="line"><span class="language-xml">          &lt;ProDescriptions<span class="tag">&lt;<span class="name">TableListItem</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            //几列显示</span></span><br><span class="line"><span class="language-xml">            column=&#123;2&#125;</span></span><br><span class="line"><span class="language-xml">            //标题 如果row存在则取name，如果row不存在则不取name，避免row不存在的时候报错</span></span><br><span class="line"><span class="language-xml">            title=&#123;row?.name&#125;</span></span><br><span class="line"><span class="language-xml">            //设置ProDescriptions的数据</span></span><br><span class="line"><span class="language-xml">            request=&#123;async () =&gt; (&#123;</span></span><br><span class="line"><span class="language-xml">              data: row || &#123;&#125;,</span></span><br><span class="line"><span class="language-xml">            &#125;)&#125;</span></span><br><span class="line"><span class="language-xml">            //传参，参数改变的时候会触发reload</span></span><br><span class="line"><span class="language-xml">            params=&#123;&#123;</span></span><br><span class="line"><span class="language-xml">              id: row?.name,</span></span><br><span class="line"><span class="language-xml">            &#125;&#125;</span></span><br><span class="line"><span class="language-xml">            //设置ProDescriptions的列数据</span></span><br><span class="line"><span class="language-xml">            columns=&#123;columns&#125;</span></span><br><span class="line"><span class="language-xml">          /&gt;</span></span><br><span class="line"><span class="language-xml">        )&#125;</span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">Drawer</span>&gt;</span></span></span><br></pre></td></tr></table></figure><h1 id="4-ant-design-pro区块"><a href="#4-ant-design-pro区块" class="headerlink" title="4. ant design pro区块"></a>4. ant design pro区块</h1><p><a href="https://pro.ant.design/docs/block-cn">https://pro.ant.design/docs/block-cn</a></p><p>区块是研发资产的一种，它是一系列快速搭建页面的代码片段，它可以帮助你快速的在项目中初始化好一个页面，帮助你更快速的开发代码。当前的区块都是页面级别的区块，你可以理解为它是一些项目中经常会用到的典型页面的模板，使用区块其实相当于从已有的项目中复制一些页面的代码到你当前的项目中。</p><ul><li>以前开发一个页面：创建 JS -&gt; 创建 CSS -&gt; 创建 Model -&gt; 创建 service -&gt; 写页面组件。</li><li>现在开发一个页面：下载区块 -&gt; 基于区块初始化好的页面组件修改代码。</li></ul><p>在 Pro 中资产被分为了两种，区块和模板。区块可以类比为一个组件，而模板代表一个页面。区块现在支持所有 antd 中的 demo，可以更加快速的将 demo 导入到项目中去。</p><h1 id="5-vue-antd-admin"><a href="#5-vue-antd-admin" class="headerlink" title="5.vue-antd-admin"></a>5.vue-antd-admin</h1><p><a href="https://github.com/iczer/vue-antd-admin">https://github.com/iczer/vue-antd-admin</a></p>]]></content>
      
      
      <categories>
          
          <category> React </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Ant Design Pro </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>微信小程序-前端商城</title>
      <link href="/2020/06/17/%E5%B0%8F%E7%A8%8B%E5%BA%8F--%E5%89%8D%E7%AB%AF%E5%95%86%E5%9F%8E/"/>
      <url>/2020/06/17/%E5%B0%8F%E7%A8%8B%E5%BA%8F--%E5%89%8D%E7%AB%AF%E5%95%86%E5%9F%8E/</url>
      
        <content type="html"><![CDATA[<h1 id="项目预览"><a href="#项目预览" class="headerlink" title="项目预览"></a>项目预览</h1><p>小程序商城主要分为首页、分类、购物车和我的四个模块。<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://i.loli.net/2020/08/24/sebW1OCGxl7HpNX.jpg"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://i.loli.net/2020/08/24/Cjyo7c5ruXRNeZW.jpg"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://i.loli.net/2020/08/24/RYLzJaOHl9KnB5E.jpg"></p><h1 id="项目需求"><a href="#项目需求" class="headerlink" title="项目需求"></a>项目需求</h1><h3 id="接口文档"><a href="#接口文档" class="headerlink" title="接口文档"></a>接口文档</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://www.showdoc.com.cn/128719739414963?page_id=2513282464078443</span><br></pre></td></tr></table></figure><h3 id="项目搭建"><a href="#项目搭建" class="headerlink" title="项目搭建"></a>项目搭建</h3><h5 id="新建小程序项目"><a href="#新建小程序项目" class="headerlink" title="新建小程序项目"></a>新建小程序项目</h5><p>进入官网，自行获取appId并下载微信开发者工具，在程序中点“+”创建新的小程序</p><h5 id="搭建目录结构"><a href="#搭建目录结构" class="headerlink" title="搭建目录结构"></a>搭建目录结构</h5><table><thead><tr><th align="center">目录名</th><th align="center">作用</th></tr></thead><tbody><tr><td align="center">components</td><td align="center">存放组件</td></tr><tr><td align="center">images</td><td align="center">tabbar所用图片</td></tr><tr><td align="center">request</td><td align="center">请求的接口封装</td></tr><tr><td align="center">utils</td><td align="center">自己的帮助库</td></tr><tr><td align="center">styles</td><td align="center">存放公共样式</td></tr></tbody></table><h5 id="搭建项目页面"><a href="#搭建项目页面" class="headerlink" title="搭建项目页面"></a>搭建项目页面</h5><table><thead><tr><th align="center">页面名称</th><th align="center">文件名称</th></tr></thead><tbody><tr><td align="center">首页</td><td align="center">index</td></tr><tr><td align="center">分类页面</td><td align="center">category</td></tr><tr><td align="center">商品列表页面</td><td align="center">goods_list</td></tr><tr><td align="center">商品详情页面</td><td align="center">goods_detail</td></tr><tr><td align="center">购物车页面</td><td align="center">cart</td></tr><tr><td align="center">收藏页面</td><td align="center">collect</td></tr><tr><td align="center">个人中心页面</td><td align="center">user</td></tr><tr><td align="center">意见反馈页面</td><td align="center">feedback</td></tr><tr><td align="center">登录页面</td><td align="center">login</td></tr><tr><td align="center">授权页面</td><td align="center">auth</td></tr><tr><td align="center">结算页面</td><td align="center">pay</td></tr><tr><td align="center">订单页面</td><td align="center">order</td></tr><tr><td align="center">搜索页面</td><td align="center">search</td></tr></tbody></table><h5 id="引入字体图标"><a href="#引入字体图标" class="headerlink" title="引入字体图标"></a>引入字体图标</h5><ol><li><p>打开阿里巴巴字体图标网站：<a href="https://www.iconfont.cn/">https://www.iconfont.cn/</a> </p></li><li><p>搜索需要的图标，添加购物车，并添加至项目</p></li><li><p>生成新的链接，并通过链接在网页中打开，复制全部</p></li><li><p>在本地的styles文件夹下创建iconfont.wxss文件，并将复制文件粘贴即可</p></li><li><p>在app.wxss中引入</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">@import</span> <span class="string">&quot;./styles/iconfont.wxss&quot;</span>;</span><br></pre></td></tr></table></figure></li></ol><h5 id="搭建项目tabbar结构"><a href="#搭建项目tabbar结构" class="headerlink" title="搭建项目tabbar结构"></a>搭建项目tabbar结构</h5><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://i.loli.net/2020/08/19/jkR9osFtE7BNnVa.jpg"></p><p>在images文件夹下存放上面几个类似的图片，并在app.json中如下配置即可：</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&quot;tabBar&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;list&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;pagePath&quot;</span><span class="punctuation">:</span> <span class="string">&quot;pages/index/index&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;text&quot;</span><span class="punctuation">:</span> <span class="string">&quot;首页&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;iconPath&quot;</span><span class="punctuation">:</span> <span class="string">&quot;images/主页.png&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;selectedIconPath&quot;</span><span class="punctuation">:</span> <span class="string">&quot;images/主页1.png&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;pagePath&quot;</span><span class="punctuation">:</span> <span class="string">&quot;pages/category/index&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;text&quot;</span><span class="punctuation">:</span> <span class="string">&quot;分类&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;iconPath&quot;</span><span class="punctuation">:</span> <span class="string">&quot;images/分类.png&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;selectedIconPath&quot;</span><span class="punctuation">:</span> <span class="string">&quot;images/分类1.png&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;pagePath&quot;</span><span class="punctuation">:</span> <span class="string">&quot;pages/cart/index&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;text&quot;</span><span class="punctuation">:</span> <span class="string">&quot;购物车&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;iconPath&quot;</span><span class="punctuation">:</span> <span class="string">&quot;images/购物车.png&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;selectedIconPath&quot;</span><span class="punctuation">:</span> <span class="string">&quot;images/购物车1.png&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;pagePath&quot;</span><span class="punctuation">:</span> <span class="string">&quot;pages/user/index&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;text&quot;</span><span class="punctuation">:</span> <span class="string">&quot;我的&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;iconPath&quot;</span><span class="punctuation">:</span> <span class="string">&quot;images/用户.png&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;selectedIconPath&quot;</span><span class="punctuation">:</span> <span class="string">&quot;images/用户1.png&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h1 id="项目开发"><a href="#项目开发" class="headerlink" title="项目开发"></a>项目开发</h1><h3 id="首页"><a href="#首页" class="headerlink" title="首页"></a>首页</h3><p>首页共分为：搜索框、轮播图、导航和楼层四个部分。又因为搜索框属于常见的可复用的，所以可以单独将搜索框抽离成一个组件来使用。</p><h5 id="搜索框组件"><a href="#搜索框组件" class="headerlink" title="搜索框组件"></a>搜索框组件</h5><p>1.组件json文件中的”component”:true</p><p>2.wxml文件代码：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;serach_input&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">navigator</span> <span class="attr">class</span>=<span class="string">&quot;&quot;</span> <span class="attr">target</span>=<span class="string">&quot;&quot;</span> <span class="attr">url</span>=<span class="string">&quot;/pages/search/index&quot;</span> <span class="attr">hover-class</span>=<span class="string">&quot;navigator-hover&quot;</span> <span class="attr">open-type</span>=<span class="string">&quot;navigate&quot;</span>&gt;</span></span><br><span class="line">        搜索</span><br><span class="line">    <span class="tag">&lt;/<span class="name">navigator</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br></pre></td></tr></table></figure><p>搜索框组件只是一个模仿input框的伪搜索框，实际上的作用是导航到search页面下</p><p>3.wxss代码如下：</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.serach_input</span> &#123;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">90</span>rpx;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">10</span>rpx;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="built_in">var</span>(--themeColor);</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.serach_input</span> navigator &#123;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">  <span class="attribute">justify-content</span>: center;</span><br><span class="line">  <span class="attribute">align-items</span>: center;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="number">#fff</span>;</span><br><span class="line">  <span class="attribute">border-radius</span>: <span class="number">15</span>rpx;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#666666</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>4.在index文件夹下的json中引入组件。</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&quot;usingComponents&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;SearchInput&quot;</span><span class="punctuation">:</span><span class="string">&quot;../../components/SearchInput/SearchInput&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br></pre></td></tr></table></figure><h5 id="轮播图、导航和楼层布局"><a href="#轮播图、导航和楼层布局" class="headerlink" title="轮播图、导航和楼层布局"></a>轮播图、导航和楼层布局</h5><p>1.wxml文件代码如下：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 轮播图 --&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">swiper</span> <span class="attr">autoplay</span> <span class="attr">circular</span> <span class="attr">indicator-dots</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">swiper-item</span> <span class="attr">class</span>=<span class="string">&quot;&quot;</span> <span class="attr">wx:for</span>=<span class="string">&quot;&#123;&#123;swiperList&#125;&#125;&quot;</span> <span class="attr">wx:key</span>=<span class="string">&quot;goods_id&quot;</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">navigator</span> <span class="attr">class</span>=<span class="string">&quot;&quot;</span> <span class="attr">target</span>=<span class="string">&quot;&quot;</span> <span class="attr">url</span>=<span class="string">&quot;/pages/goods_detail/index?goods_id=&#123;&#123;item.goods_id&#125;&#125;&quot;</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">image</span> <span class="attr">class</span>=<span class="string">&quot;&quot;</span> <span class="attr">mode</span>=<span class="string">&quot;widthFix&quot;</span> <span class="attr">src</span>=<span class="string">&quot;&#123;&#123;item.image_src&#125;&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">image</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;/<span class="name">navigator</span>&gt;</span></span><br><span class="line"></span><br><span class="line">       <span class="tag">&lt;/<span class="name">swiper-item</span>&gt;</span></span><br><span class="line"></span><br><span class="line">   <span class="tag">&lt;/<span class="name">swiper</span>&gt;</span></span><br><span class="line"></span><br><span class="line">   <span class="comment">&lt;!-- 导航 --&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;index_cate&quot;</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">navigator</span> <span class="attr">class</span>=<span class="string">&quot;&quot;</span> <span class="attr">wx:for</span>=<span class="string">&quot;&#123;&#123;CateList&#125;&#125;&quot;</span> <span class="attr">wx:key</span>=<span class="string">&quot;name&quot;</span> <span class="attr">url</span>=<span class="string">&quot;/pages/category/index&quot;</span> <span class="attr">open-type</span>=<span class="string">&quot;switchTab&quot;</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">image</span> <span class="attr">class</span>=<span class="string">&quot;&quot;</span> <span class="attr">mode</span>=<span class="string">&quot;widthFix&quot;</span> <span class="attr">src</span>=<span class="string">&quot;&#123;&#123;item.image_src&#125;&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">image</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">navigator</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"></span><br><span class="line">   <span class="comment">&lt;!-- 楼层 --&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;index_floor&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">       <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;floor_group&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">wx:for</span>=<span class="string">&quot;&#123;&#123;floorList&#125;&#125;&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">wx:for-item</span>=<span class="string">&quot;item1&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">wx:for-index</span>=<span class="string">&quot;index1&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">wx:key</span>=<span class="string">&quot;floor_title&quot;</span></span></span><br><span class="line"><span class="tag">       &gt;</span></span><br><span class="line">           <span class="comment">&lt;!-- 标题 --&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;floor_title&quot;</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">image</span> <span class="attr">mode</span>=<span class="string">&quot;widthFix&quot;</span> <span class="attr">src</span>=<span class="string">&quot;&#123;&#123;item1.floor_title.image_src&#125;&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">image</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"></span><br><span class="line">           <span class="comment">&lt;!-- 内容 --&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;floor_list&quot;</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">navigator</span></span></span><br><span class="line"><span class="tag">               <span class="attr">wx:for</span>=<span class="string">&quot;&#123;&#123;item1.product_list&#125;&#125;&quot;</span></span></span><br><span class="line"><span class="tag">               <span class="attr">wx:for-item</span>=<span class="string">&quot;item2&quot;</span></span></span><br><span class="line"><span class="tag">               <span class="attr">wx:for-index</span>=<span class="string">&quot;index2&quot;</span></span></span><br><span class="line"><span class="tag">               <span class="attr">wx:key</span>=<span class="string">&quot;name&quot;</span></span></span><br><span class="line"><span class="tag">               <span class="attr">url</span>=<span class="string">&quot;/pages/goods_list/index?query=精选&quot;</span>&gt;</span></span><br><span class="line">                   <span class="tag">&lt;<span class="name">image</span> <span class="attr">src</span>=<span class="string">&quot;&#123;&#123;item2.image_src&#125;&#125;&quot;</span> <span class="attr">mode</span>=<span class="string">&quot;&#123;&#123;index2===0?&#x27;widthFix&#x27;:&#x27;scaleToFill&#x27;&#125;&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">image</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;/<span class="name">navigator</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br></pre></td></tr></table></figure><p>2.wxss样式布局</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.index_swiper</span> swiper &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">750</span>rpx;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">340</span>rpx;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.index_swiper</span> swiper image &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.index_cate</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.index_cate</span> navigator &#123;</span><br><span class="line">  <span class="attribute">flex</span>: <span class="number">1</span>;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">20</span>rpx;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.index_cate</span> navigator image &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.index_floor</span> <span class="selector-class">.floor_group</span> <span class="selector-class">.floor_title</span> &#123;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">10</span>rpx <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.index_floor</span> <span class="selector-class">.floor_group</span> <span class="selector-class">.floor_title</span> image &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.index_floor</span> <span class="selector-class">.floor_group</span> <span class="selector-class">.floor_list</span> navigator &#123;</span><br><span class="line">  <span class="attribute">float</span>: left;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">33.33%</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.index_floor</span> <span class="selector-class">.floor_group</span> <span class="selector-class">.floor_list</span> navigator<span class="selector-pseudo">:nth-last-child</span>(-n+<span class="number">4</span>) &#123;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">27.72711207vw</span>;</span><br><span class="line">  <span class="attribute">border-left</span>: <span class="number">10</span>rpx solid <span class="number">#fff</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.index_floor</span> <span class="selector-class">.floor_group</span> <span class="selector-class">.floor_list</span> navigator<span class="selector-pseudo">:nth-child</span>(<span class="number">2</span>),</span><br><span class="line"><span class="selector-class">.index_floor</span> <span class="selector-class">.floor_group</span> <span class="selector-class">.floor_list</span> navigator<span class="selector-pseudo">:nth-child</span>(<span class="number">3</span>) &#123;</span><br><span class="line">  <span class="attribute">border-bottom</span>: <span class="number">10</span>rpx solid <span class="number">#fff</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.index_floor</span> <span class="selector-class">.floor_group</span> <span class="selector-class">.floor_list</span> navigator image &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">100%</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>3.request函数封装</p><p>整个页面的数据都是通过wx.request函数来实现调用，为了代码的复用性，可将这块函数单独作为一个模块封装起来，其他页面使用时也只需要调用即可！</p><p>具体操作为：在request的文件夹下的js文件中写上如下代码。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> ajaxTimes=<span class="number">0</span>;<span class="comment">//全局变量，为的是让整个页面完全加载完成后，才让loading消失</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">request</span> = (<span class="params">params</span>) =&gt; &#123;</span><br><span class="line">    <span class="comment">// 判断url中是否带有/my/请求的私有路径 带上header token</span></span><br><span class="line">    <span class="keyword">let</span> header=&#123;...params.<span class="property">header</span>&#125;</span><br><span class="line">    <span class="keyword">if</span>(params.<span class="property">url</span>.<span class="title function_">includes</span>(<span class="string">&quot;/my/&quot;</span>))&#123;   <span class="comment">//对个别页面，需要添加请求头</span></span><br><span class="line">        header[<span class="string">&quot;Authorization&quot;</span>]=wx.<span class="title function_">getStorageSync</span>(<span class="string">&quot;token&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ajaxTimes++</span><br><span class="line">    <span class="comment">// 显示加载中 效果</span></span><br><span class="line">    wx.<span class="title function_">showLoading</span>(&#123;</span><br><span class="line">        <span class="attr">title</span>: <span class="string">&#x27;加载中&#x27;</span>,</span><br><span class="line">        <span class="attr">mask</span>: <span class="literal">true</span></span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> baseUrl = <span class="string">&quot;https://api-hmugo-web.itheima.net/api/public/v1&quot;</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">        wx.<span class="title function_">request</span>(&#123;</span><br><span class="line">            ...params,</span><br><span class="line">            header,</span><br><span class="line">            <span class="attr">url</span>: baseUrl + params.<span class="property">url</span>,</span><br><span class="line">            <span class="attr">success</span>: <span class="function">(<span class="params">result</span>) =&gt;</span> &#123;</span><br><span class="line">                <span class="title function_">resolve</span>(result.<span class="property">data</span>.<span class="property">message</span>)</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">fail</span>: <span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">                <span class="title function_">reject</span>(err)</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">complete</span>: <span class="function">() =&gt;</span> &#123;</span><br><span class="line">                ajaxTimes--;</span><br><span class="line">                <span class="keyword">if</span>(ajaxTimes===<span class="number">0</span>)&#123;</span><br><span class="line">                    wx.<span class="title function_">hideLoading</span>()</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>4.js代码如下：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; request &#125; <span class="keyword">from</span> <span class="string">&quot;../../request/index&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="title class_">Page</span>(&#123;</span><br><span class="line">  <span class="attr">data</span>: &#123;</span><br><span class="line">    <span class="comment">// 轮播图数组</span></span><br><span class="line">    <span class="attr">swiperList</span>: [],</span><br><span class="line">    <span class="comment">// 导航数组</span></span><br><span class="line">    <span class="title class_">CateList</span>:[],</span><br><span class="line">    <span class="comment">// 楼层数组</span></span><br><span class="line">    <span class="attr">floorList</span>:[]</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 页面开始加载 就会触发</span></span><br><span class="line">  <span class="attr">onLoad</span>: <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">getSwiperList</span>();</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">getCateList</span>();</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">getFloorList</span>();</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="title function_">getSwiperList</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// 发送异步请求获取轮播图数据</span></span><br><span class="line">    <span class="title function_">request</span>(&#123; <span class="attr">url</span>: <span class="string">&#x27;/home/swiperdata&#x27;</span>&#125;)</span><br><span class="line">      .<span class="title function_">then</span>(<span class="function"><span class="params">result</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">setData</span>(&#123;</span><br><span class="line">          <span class="attr">swiperList</span>: result</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;)</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="title function_">getCateList</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// 发送异步请求获取导航数据</span></span><br><span class="line">    <span class="title function_">request</span>(&#123; <span class="attr">url</span>: <span class="string">&#x27;/home/catitems&#x27;</span>&#125;)</span><br><span class="line">      .<span class="title function_">then</span>(<span class="function"><span class="params">result</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">setData</span>(&#123;</span><br><span class="line">          <span class="title class_">CateList</span>: result</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;)</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="title function_">getFloorList</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// 发送异步请求获取楼层数据</span></span><br><span class="line">    <span class="title function_">request</span>(&#123; <span class="attr">url</span>: <span class="string">&#x27;/home/floordata&#x27;</span>&#125;)</span><br><span class="line">      .<span class="title function_">then</span>(<span class="function"><span class="params">result</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">setData</span>(&#123;</span><br><span class="line">          <span class="attr">floorList</span>: result</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h3 id="搜索框"><a href="#搜索框" class="headerlink" title="搜索框"></a>搜索框</h3><p>搜索框的页面十分简陋，这里特别注意的是一点，针对移动端的用户体验问题。</p><p>一般来说，移动端很少会搜索信息的时候还需要点击”搜索”按钮才开始搜索，而对监听input框的事件设置延迟搜索效果更好，一定程度上减少了http发送次数，又优化了用户体验。</p><h5 id="wxml和wxss的页面布局"><a href="#wxml和wxss的页面布局" class="headerlink" title="wxml和wxss的页面布局"></a>wxml和wxss的页面布局</h5><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;search_row&quot;</span>&gt;</span>   </span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">placeholder</span>=<span class="string">&quot;请输入您要搜索的商品&quot;</span> <span class="attr">value</span>=<span class="string">&quot;&#123;&#123;inpValue&#125;&#125;&quot;</span> <span class="attr">bindinput</span>=<span class="string">&quot;handleInput&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">input</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">hidden</span>=<span class="string">&quot;&#123;&#123;!isFocus&#125;&#125;&quot;</span> <span class="attr">bindtap</span>=<span class="string">&quot;handleCancel&quot;</span>&gt;</span>取消<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;search_content&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">navigator</span> </span></span><br><span class="line"><span class="tag">    <span class="attr">url</span>=<span class="string">&quot;/pages/goods_detail/index?goods_id=&#123;&#123;item.goods_id&#125;&#125;&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">wx:for</span>=<span class="string">&quot;&#123;&#123;goods&#125;&#125;&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">wx:key</span>=<span class="string">&quot;goods_id&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">class</span>=<span class="string">&quot;search_item&quot;</span>&gt;</span></span><br><span class="line">    &#123;&#123;item.goods_name&#125;&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">navigator</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">page &#123;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="number">#dedede</span>;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">20</span>rpx;</span><br><span class="line">&#125;</span><br><span class="line">view<span class="selector-class">.search_row</span> &#123;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">60</span>rpx;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">&#125;</span><br><span class="line">view<span class="selector-class">.search_row</span> <span class="selector-tag">input</span> &#123;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="number">#fff</span>;</span><br><span class="line">  <span class="attribute">flex</span>: <span class="number">1</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">padding-left</span>: <span class="number">30</span>rpx;</span><br><span class="line">&#125;</span><br><span class="line">view<span class="selector-class">.search_row</span> <span class="selector-tag">button</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">110</span>rpx;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">28</span>rpx;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">margin</span>: <span class="number">0</span> <span class="number">10</span>rpx;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">  <span class="attribute">justify-content</span>: center;</span><br><span class="line">  <span class="attribute">align-items</span>: center;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">26</span>rpx;</span><br><span class="line">  <span class="attribute">font-weight</span>: normal;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.search_content</span> &#123;</span><br><span class="line">  <span class="attribute">margin-top</span>: <span class="number">40</span>rpx;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.search_content</span> <span class="selector-class">.search_item</span> &#123;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="number">#fff</span>;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">26</span>rpx;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">15</span>rpx <span class="number">10</span>rpx;</span><br><span class="line">  <span class="attribute">border-bottom</span>: <span class="number">1</span>rpx solid <span class="number">#969595</span>;</span><br><span class="line">  <span class="attribute">overflow</span>: hidden;</span><br><span class="line">  <span class="attribute">white-space</span>: nowrap;</span><br><span class="line">  <span class="attribute">text-overflow</span>: ellipsis;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="实机效果图"><a href="#实机效果图" class="headerlink" title="实机效果图"></a>实机效果图</h5><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://i.loli.net/2020/08/24/FTnU71H4GMEsfl5.jpg"></p><p>页面布局中，在搜索之前或者input框为空时，”取消”按钮将会消失这一小小的特点。而每一个搜索出来的列表项，都是导向商品详情页面下。</p><h5 id="js功能实现"><a href="#js功能实现" class="headerlink" title="js功能实现"></a>js功能实现</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;request&#125; <span class="keyword">from</span> <span class="string">&quot;../../request/index&quot;</span><span class="comment">//引入request请求</span></span><br><span class="line"><span class="title class_">Page</span>(&#123;</span><br><span class="line">  <span class="attr">data</span>: &#123;</span><br><span class="line">    <span class="attr">goods</span>:[],<span class="comment">//搜索到的数据存放 数组</span></span><br><span class="line">    <span class="attr">isFocus</span>:<span class="literal">false</span>,  <span class="comment">//判断取消按钮的显示隐藏</span></span><br><span class="line">    <span class="attr">inpValue</span>:<span class="string">&quot;&quot;</span><span class="comment">//用于删除输入框中的值</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="title class_">TimeId</span>:-<span class="number">1</span>,<span class="comment">//定义定时器</span></span><br><span class="line">  <span class="title function_">handleInput</span>(<span class="params">e</span>)&#123;</span><br><span class="line">    <span class="keyword">const</span> &#123;value&#125;=e.<span class="property">detail</span></span><br><span class="line">    <span class="keyword">if</span>(!value.<span class="title function_">trim</span>())&#123;<span class="comment">//value.trim()用于删除字符串的头尾空格</span></span><br><span class="line">      <span class="built_in">clearTimeout</span>(<span class="variable language_">this</span>.<span class="property">TimeId</span>)<span class="comment">//先清除定时器</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">TimeId</span>=<span class="built_in">setTimeout</span>(<span class="function">()=&gt;</span>&#123;<span class="comment">//设置定时器</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">setData</span>(&#123;</span><br><span class="line">          <span class="attr">goods</span>:[],</span><br><span class="line">          <span class="attr">isFocus</span>:<span class="literal">false</span></span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;,<span class="number">1000</span>)</span><br><span class="line">      </span><br><span class="line">      <span class="keyword">return</span><span class="comment">//跳出循环</span></span><br><span class="line">    &#125;</span><br><span class="line">      </span><br><span class="line">    <span class="comment">//此时input的值为空</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">setData</span>(&#123;</span><br><span class="line">      <span class="attr">isFocus</span>:<span class="literal">true</span></span><br><span class="line">    &#125;)</span><br><span class="line">     <span class="comment">//输入框为空时，清除商品列表项</span></span><br><span class="line">    <span class="built_in">clearTimeout</span>(<span class="variable language_">this</span>.<span class="property">TimeId</span>);</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">TimeId</span>=<span class="built_in">setTimeout</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="title function_">qsearch</span>(value)</span><br><span class="line">    &#125;,<span class="number">1000</span>)</span><br><span class="line">  &#125;,</span><br><span class="line">   <span class="comment">//请求数据的封装函数</span></span><br><span class="line">  <span class="title function_">qsearch</span>(<span class="params">query</span>)&#123;</span><br><span class="line">    <span class="title function_">request</span>(&#123;<span class="attr">url</span>:<span class="string">&quot;/goods/qsearch&quot;</span>,<span class="attr">data</span>:&#123;query&#125;&#125;).<span class="title function_">then</span>(<span class="function"><span class="params">res</span>=&gt;</span>&#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="title function_">setData</span>(&#123;</span><br><span class="line">        <span class="attr">goods</span>:res</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">//取消按钮的点击事件</span></span><br><span class="line">  <span class="title function_">handleCancel</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">setData</span>(&#123;</span><br><span class="line">      <span class="attr">inpValue</span>:<span class="string">&quot;&quot;</span>,</span><br><span class="line">      <span class="attr">goods</span>:[]</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h3 id="分类"><a href="#分类" class="headerlink" title="分类"></a>分类</h3><h5 id="页面布局"><a href="#页面布局" class="headerlink" title="页面布局"></a>页面布局</h5><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://i.loli.net/2020/08/24/Cjyo7c5ruXRNeZW.jpg"></p><p>页面其实可以看做两个部分，其一是搜索框组件，其二是scroll-view内容。具体页面内容如下：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;cates&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">SearchInput</span>&gt;</span><span class="tag">&lt;/<span class="name">SearchInput</span>&gt;</span>//搜索框组件</span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;cates_container&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 左侧菜单 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scroll-view</span> <span class="attr">class</span>=<span class="string">&quot;left_menu&quot;</span> <span class="attr">scroll-y</span> <span class="attr">scroll-top</span>=<span class="string">&quot;&#123;&#123;scrollTop&#125;&#125;&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">view</span> </span></span><br><span class="line"><span class="tag">            <span class="attr">class</span>=<span class="string">&quot;menu_item &#123;&#123;index===currentIndex?&#x27;active&#x27;:&#x27;&#x27;&#125;&#125;&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">wx:for</span>=<span class="string">&quot;&#123;&#123;leftMenuList&#125;&#125;&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">wx:key</span>=<span class="string">&quot;*this&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">bindtap</span>=<span class="string">&quot;handleItemTap&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">data-index</span>=<span class="string">&quot;&#123;&#123;index&#125;&#125;&quot;</span></span></span><br><span class="line"><span class="tag">            &gt;</span></span><br><span class="line">            &#123;&#123;item&#125;&#125;</span><br><span class="line">            <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">scroll-view</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 右侧商品内容 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scroll-view</span> <span class="attr">class</span>=<span class="string">&quot;right_content&quot;</span> <span class="attr">scroll-y</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;goods_group&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">wx:for</span>=<span class="string">&quot;&#123;&#123;rightContent&#125;&#125;&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">wx:for-index</span>=<span class="string">&quot;index1&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">wx:for-item</span>=<span class="string">&quot;item1&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;goods_title&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">text</span> <span class="attr">class</span>=<span class="string">&quot;delimiter&quot;</span>&gt;</span>/<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">text</span> <span class="attr">class</span>=<span class="string">&quot;title&quot;</span>&gt;</span>&#123;&#123;item1.cat_name&#125;&#125;<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">text</span> <span class="attr">class</span>=<span class="string">&quot;delimiter&quot;</span>&gt;</span>/<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;goods_list&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">navigator</span></span></span><br><span class="line"><span class="tag">                    <span class="attr">wx:for</span>=<span class="string">&quot;&#123;&#123;item1.children&#125;&#125;&quot;</span></span></span><br><span class="line"><span class="tag">                    <span class="attr">wx:for-index</span>=<span class="string">&quot;index2&quot;</span></span></span><br><span class="line"><span class="tag">                    <span class="attr">wx:for-item</span>=<span class="string">&quot;item2&quot;</span></span></span><br><span class="line"><span class="tag">                    <span class="attr">wx:key</span>=<span class="string">&quot;cat_id&quot;</span></span></span><br><span class="line"><span class="tag">                    <span class="attr">url</span>=<span class="string">&quot;/pages/goods_list/index?cid=&#123;&#123;item2.cat_id&#125;&#125;&quot;</span></span></span><br><span class="line"><span class="tag">                    &gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">image</span> <span class="attr">mode</span>=<span class="string">&quot;widthFix&quot;</span> <span class="attr">src</span>=<span class="string">&quot;&#123;&#123;item2.cat_icon&#125;&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">image</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;goods_name&quot;</span>&gt;</span>&#123;&#123;item.cat_name&#125;&#125;<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">navigator</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">scroll-view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">page &#123;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">100%</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.cates</span> &#123;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">100%</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.cates</span> <span class="selector-class">.cates_container</span> &#123;</span><br><span class="line">  <span class="attribute">height</span>: <span class="built_in">calc</span>( <span class="number">100vh</span> - <span class="number">90</span>rpx );</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.cates</span> <span class="selector-class">.cates_container</span> <span class="selector-class">.left_menu</span> &#123;</span><br><span class="line">  <span class="attribute">flex</span>: <span class="number">2</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.cates</span> <span class="selector-class">.cates_container</span> <span class="selector-class">.left_menu</span> <span class="selector-class">.menu_item</span> &#123;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">80</span>rpx;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">  <span class="attribute">justify-content</span>: center;</span><br><span class="line">  <span class="attribute">align-items</span>: center;</span><br><span class="line">  <span class="attribute">font-style</span>: <span class="number">30</span>rpx;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.cates</span> <span class="selector-class">.cates_container</span> <span class="selector-class">.left_menu</span> <span class="selector-class">.active</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: <span class="built_in">var</span>(--themeColor);</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.cates</span> <span class="selector-class">.cates_container</span> <span class="selector-class">.right_content</span> &#123;</span><br><span class="line">  <span class="attribute">flex</span>: <span class="number">5</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.cates</span> <span class="selector-class">.cates_container</span> <span class="selector-class">.right_content</span> <span class="selector-class">.goods_group</span> <span class="selector-class">.goods_title</span> &#123;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">80</span>rpx;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">  <span class="attribute">justify-content</span>: center;</span><br><span class="line">  <span class="attribute">align-items</span>: center;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.cates</span> <span class="selector-class">.cates_container</span> <span class="selector-class">.right_content</span> <span class="selector-class">.goods_group</span> <span class="selector-class">.goods_title</span> <span class="selector-class">.delimiter</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#ccc</span>;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">0</span> <span class="number">10</span>rpx;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.cates</span> <span class="selector-class">.cates_container</span> <span class="selector-class">.right_content</span> <span class="selector-class">.goods_group</span> <span class="selector-class">.goods_list</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">  <span class="attribute">flex-wrap</span>: wrap;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.cates</span> <span class="selector-class">.cates_container</span> <span class="selector-class">.right_content</span> <span class="selector-class">.goods_group</span> <span class="selector-class">.goods_list</span> navigator &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">33.33%</span>;</span><br><span class="line">  <span class="attribute">text-align</span>: center;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.cates</span> <span class="selector-class">.cates_container</span> <span class="selector-class">.right_content</span> <span class="selector-class">.goods_group</span> <span class="selector-class">.goods_list</span> navigator image &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">50%</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="js功能实现-1"><a href="#js功能实现-1" class="headerlink" title="js功能实现"></a>js功能实现</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; request &#125; <span class="keyword">from</span> <span class="string">&quot;../../request/index&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="title class_">Page</span>(&#123;</span><br><span class="line"></span><br><span class="line">  <span class="attr">data</span>: &#123;</span><br><span class="line">    <span class="attr">leftMenuList</span>:[],<span class="comment">//左边菜单栏</span></span><br><span class="line">    <span class="attr">rightContent</span>:[],<span class="comment">//右边商品栏</span></span><br><span class="line">    <span class="attr">currentIndex</span>:<span class="number">0</span>,</span><br><span class="line">    <span class="attr">scrollTop</span>:<span class="number">0</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 接口的返回数据</span></span><br><span class="line">  <span class="title class_">Cates</span>:[],</span><br><span class="line">  <span class="attr">onLoad</span>: <span class="keyword">function</span> (<span class="params">options</span>) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 1.获取本地存储中的数据</span></span><br><span class="line">    <span class="keyword">const</span> <span class="title class_">Cates</span>=wx.<span class="title function_">getStorageSync</span>(<span class="string">&quot;cates&quot;</span>);</span><br><span class="line">    <span class="comment">// 2.判断</span></span><br><span class="line">    <span class="keyword">if</span>(!<span class="title class_">Cates</span>)&#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="title function_">getCates</span>();</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">      <span class="comment">// 有旧的数据 定义过期时间 10s 改成 5分钟</span></span><br><span class="line">      <span class="keyword">if</span>(<span class="title class_">Date</span>.<span class="title function_">now</span>()-<span class="title class_">Cates</span>.<span class="property">time</span>&gt;<span class="number">1000</span>*<span class="number">300</span>)&#123;</span><br><span class="line">        <span class="comment">// 重新发送请求</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">getCates</span>()</span><br><span class="line">      &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="comment">// 可以使用旧的数据</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">Cates</span>=<span class="title class_">Cates</span>.<span class="property">data</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">dealListCont</span>();</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 获取分类数据</span></span><br><span class="line">  <span class="title function_">getCates</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="title function_">request</span>(&#123;</span><br><span class="line">        <span class="attr">url</span>:<span class="string">&quot;/categories&quot;</span></span><br><span class="line">    &#125;).<span class="title function_">then</span>(<span class="function"><span class="params">res</span>=&gt;</span>&#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">Cates</span>=res;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 把接口的数据存入到本地存储中</span></span><br><span class="line">        wx.<span class="title function_">setStorageSync</span>(<span class="string">&quot;cates&quot;</span>, &#123;<span class="attr">time</span>:<span class="title class_">Date</span>.<span class="title function_">now</span>(),<span class="attr">data</span>:<span class="variable language_">this</span>.<span class="property">Cates</span>&#125;);</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">dealListCont</span>();</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 初始页面数据分装</span></span><br><span class="line">  <span class="title function_">dealListCont</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="comment">// 构造左侧的大菜单数据</span></span><br><span class="line">    <span class="keyword">let</span> leftMenuList=<span class="variable language_">this</span>.<span class="property">Cates</span>.<span class="title function_">map</span>(<span class="function"><span class="params">v</span>=&gt;</span>v.<span class="property">cat_name</span>)</span><br><span class="line">    <span class="comment">// 构造右侧的商品内容</span></span><br><span class="line">    <span class="keyword">let</span> rightContent=<span class="variable language_">this</span>.<span class="property">Cates</span>[<span class="number">0</span>].<span class="property">children</span>;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">setData</span>(&#123;</span><br><span class="line">      leftMenuList,</span><br><span class="line">      rightContent</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 左侧菜单点击事件</span></span><br><span class="line">  <span class="title function_">handleItemTap</span>(<span class="params">e</span>)&#123;</span><br><span class="line">    <span class="keyword">const</span> &#123;index&#125;=e.<span class="property">currentTarget</span>.<span class="property">dataset</span>;</span><br><span class="line">    <span class="keyword">let</span> rightContent=<span class="variable language_">this</span>.<span class="property">Cates</span>[index].<span class="property">children</span>;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">setData</span>(&#123;</span><br><span class="line">      <span class="attr">currentIndex</span>:index,</span><br><span class="line">      rightContent,</span><br><span class="line">      <span class="attr">scrollTop</span>:<span class="number">0</span></span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h3 id="商品列表"><a href="#商品列表" class="headerlink" title="商品列表"></a>商品列表</h3><p>在分类右侧商品栏中，点击每一个商品都会来到相应的商品1列表下。商品列表算是分类和商品详情页面的中转站，也是商城中必不可少的一栏。</p><h5 id="列表页面布局"><a href="#列表页面布局" class="headerlink" title="列表页面布局"></a>列表页面布局</h5><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">SearchInput</span>&gt;</span><span class="tag">&lt;/<span class="name">SearchInput</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 监听自定义事件 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">Tabs</span> <span class="attr">tabs</span>=<span class="string">&quot;&#123;&#123;tabs&#125;&#125;&quot;</span> <span class="attr">bindtabsItemChange</span>=<span class="string">&quot;handleTabsItemChange&quot;</span>&gt;</span>//bindtabsItemChange绑定的是tabs组件传回的tabsItemChange这个事件名    </span><br><span class="line">    <span class="tag">&lt;<span class="name">block</span> <span class="attr">wx:if</span>=<span class="string">&quot;&#123;&#123;tabs[0].isActive&#125;&#125;&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;first_tab&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">navigator</span> </span></span><br><span class="line"><span class="tag">            <span class="attr">class</span>=<span class="string">&quot;goods_item&quot;</span> </span></span><br><span class="line"><span class="tag">            <span class="attr">wx:for</span>=<span class="string">&quot;&#123;&#123;goodsList&#125;&#125;&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">wx:key</span>=<span class="string">&quot;goods_id&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">url</span>=<span class="string">&quot;/pages/goods_detail/index?goods_id=&#123;&#123;item.goods_id&#125;&#125;&quot;</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!-- 左侧 图片容器 --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;goods_img_wrap&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">image</span> <span class="attr">class</span>=<span class="string">&quot;&quot;</span> <span class="attr">src</span>=<span class="string">&quot;&#123;&#123;item.goods_small_logo?item.goods_small_logo:&#x27;https://ww1.sinaimg.cn/large/007rAy9hgy1g24by9t530j30i20i2glm.jpg&#x27;&#125;&#125;&quot;</span> <span class="attr">mode</span>=<span class="string">&quot;widthFix&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">image</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"></span><br><span class="line">                <span class="comment">&lt;!-- 右侧 图片容器 --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;goods_info_wrap&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;goods_name&quot;</span>&gt;</span>&#123;&#123;item.goods_name&#125;&#125;<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;goods_price&quot;</span>&gt;</span>¥ &#123;&#123;item.goods_price&#125;&#125;<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="tag">&lt;/<span class="name">navigator</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">block</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">block</span> <span class="attr">wx:elif</span>=<span class="string">&quot;&#123;&#123;tabs[1].isActive&#125;&#125;&quot;</span>&gt;</span></span><br><span class="line">        //没有数据，否则可以显示其他有关销量数据的商品</span><br><span class="line">    <span class="tag">&lt;/<span class="name">block</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">block</span> <span class="attr">wx:else</span>=<span class="string">&quot;&#123;&#123;tabs[2].isActive&#125;&#125;&quot;</span>&gt;</span></span><br><span class="line">        //没有数据，否则可以显示其他有关价格数据的商品</span><br><span class="line">    <span class="tag">&lt;/<span class="name">block</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">Tabs</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.first_tab</span> <span class="selector-class">.goods_item</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">  <span class="attribute">border-bottom</span>: <span class="number">2</span>rpx solid <span class="number">#ccc</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.first_tab</span> <span class="selector-class">.goods_item</span> <span class="selector-class">.goods_img_wrap</span> &#123;</span><br><span class="line">  <span class="attribute">flex</span>: <span class="number">2</span>;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">  <span class="attribute">justify-content</span>: center;</span><br><span class="line">  <span class="attribute">align-items</span>: center;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.first_tab</span> <span class="selector-class">.goods_item</span> <span class="selector-class">.goods_img_wrap</span> image &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">70%</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.first_tab</span> <span class="selector-class">.goods_item</span> <span class="selector-class">.goods_info_wrap</span> &#123;</span><br><span class="line">  <span class="attribute">flex</span>: <span class="number">3</span>;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">  <span class="attribute">flex-direction</span>: column;</span><br><span class="line">  <span class="attribute">justify-content</span>: space-around;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.first_tab</span> <span class="selector-class">.goods_item</span> <span class="selector-class">.goods_info_wrap</span> <span class="selector-class">.goods_name</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: -webkit-box;</span><br><span class="line">  <span class="attribute">overflow</span>: hidden;</span><br><span class="line">  -webkit-box-orient: vertical;</span><br><span class="line">  -webkit-line-clamp: <span class="number">2</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.first_tab</span> <span class="selector-class">.goods_item</span> <span class="selector-class">.goods_info_wrap</span> <span class="selector-class">.goods_price</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: <span class="built_in">var</span>(--themeColor);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>实机效果：</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://i.loli.net/2020/08/24/5LlwV9vzUNRMZqQ.jpg"></p><h5 id="tab栏组件"><a href="#tab栏组件" class="headerlink" title="tab栏组件"></a>tab栏组件</h5><p>tab切换的组件，原理同搜索框组件一样，不过它多了个父传子和子传父的数据传输过程。</p><h6 id="tab组件布局"><a href="#tab组件布局" class="headerlink" title="tab组件布局"></a>tab组件布局</h6><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;tabs&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;tabs_title&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">view</span> <span class="attr">wx:for</span>=<span class="string">&quot;&#123;&#123;tabs&#125;&#125;&quot;</span> <span class="attr">wx:key</span>=<span class="string">&quot;id&quot;</span> <span class="attr">class</span>=<span class="string">&quot;title_item &#123;&#123;item.isActive?&#x27;active&#x27;:&#x27;&#x27;&#125;&#125;&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">bindtap</span>=<span class="string">&quot;handleItemTap&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">data-index</span>=<span class="string">&quot;&#123;&#123;index&#125;&#125;&quot;</span>&gt;</span></span><br><span class="line">            &#123;&#123;item.value&#125;&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;tabs_content&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">slot</span>&gt;</span><span class="tag">&lt;/<span class="name">slot</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.tabs</span> <span class="selector-class">.tabs_title</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.tabs</span> <span class="selector-class">.tabs_title</span> <span class="selector-class">.title_item</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">  <span class="attribute">justify-content</span>: center;</span><br><span class="line">  <span class="attribute">align-items</span>: center;</span><br><span class="line">  <span class="attribute">flex</span>: <span class="number">1</span>;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">15</span>rpx <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.active</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: <span class="built_in">var</span>(--themeColor);</span><br><span class="line">  <span class="attribute">border-bottom</span>: <span class="number">5</span>rpx solid currentColor;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h6 id="js功能实现-2"><a href="#js功能实现-2" class="headerlink" title="js功能实现"></a>js功能实现</h6><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Component</span>(&#123;</span><br><span class="line"></span><br><span class="line">  <span class="attr">properties</span>: &#123;</span><br><span class="line">  <span class="comment">//对父组件传输的tabs对象名设置属性</span></span><br><span class="line">    <span class="attr">tabs</span>:&#123;</span><br><span class="line">      <span class="attr">type</span>:<span class="title class_">Array</span>,</span><br><span class="line">      <span class="attr">value</span>:[]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">data</span>: &#123;</span><br><span class="line"></span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="attr">methods</span>: &#123;</span><br><span class="line">      <span class="comment">//子组件的点击事件，并将索引值传回到父组件中</span></span><br><span class="line">    <span class="title function_">handleItemTap</span>(<span class="params">e</span>)&#123;</span><br><span class="line">      <span class="keyword">const</span> &#123;index&#125;=e.<span class="property">currentTarget</span>.<span class="property">dataset</span>;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="title function_">triggerEvent</span>(<span class="string">&quot;tabsItemChange&quot;</span>,&#123;index&#125;)<span class="comment">//tabsItemChange子组件传回的事件名</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br></pre></td></tr></table></figure><h5 id="js功能实现-3"><a href="#js功能实现-3" class="headerlink" title="js功能实现"></a>js功能实现</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; request &#125; <span class="keyword">from</span> <span class="string">&quot;../../request/index&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="title class_">Page</span>(&#123;</span><br><span class="line"></span><br><span class="line">  <span class="attr">data</span>: &#123;</span><br><span class="line">    <span class="attr">tabs</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">id</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="attr">value</span>: <span class="string">&quot;综合&quot;</span>,</span><br><span class="line">        <span class="attr">isActive</span>: <span class="literal">true</span></span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">id</span>: <span class="number">1</span>,</span><br><span class="line">        <span class="attr">value</span>: <span class="string">&quot;销量&quot;</span>,</span><br><span class="line">        <span class="attr">isActive</span>: <span class="literal">false</span></span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">id</span>: <span class="number">2</span>,</span><br><span class="line">        <span class="attr">value</span>: <span class="string">&quot;价格&quot;</span>,</span><br><span class="line">        <span class="attr">isActive</span>: <span class="literal">false</span></span><br><span class="line">      &#125;</span><br><span class="line">    ],</span><br><span class="line">    <span class="attr">goodsList</span>: []</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 接口要的参数</span></span><br><span class="line">  <span class="title class_">QueryParams</span>: &#123;</span><br><span class="line">    <span class="attr">query</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">    <span class="attr">cid</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">    <span class="attr">pagenum</span>: <span class="number">1</span>,</span><br><span class="line">    <span class="attr">pagesize</span>: <span class="number">10</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">totalPages</span>: <span class="number">1</span>,</span><br><span class="line"></span><br><span class="line">  <span class="attr">onLoad</span>: <span class="keyword">function</span> (<span class="params">options</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">QueryParams</span>.<span class="property">cid</span> = options.<span class="property">cid</span>||<span class="string">&quot;&quot;</span>;<span class="comment">//根据cid请求数据</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">QueryParams</span>.<span class="property">query</span> = options.<span class="property">query</span>||<span class="string">&quot;&quot;</span>;<span class="comment">//根据商品名请求数据</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">getGoodsList</span>();</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="title function_">onReachBottom</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">QueryParams</span>.<span class="property">pagenum</span> &gt;= <span class="variable language_">this</span>.<span class="property">totalPages</span>) &#123;</span><br><span class="line">      wx.<span class="title function_">showToast</span>(&#123;</span><br><span class="line">        <span class="attr">title</span>: <span class="string">&#x27;没有下一页数据了&#x27;</span>,</span><br><span class="line">        <span class="string">&quot;icon&quot;</span>: <span class="string">&quot;none&quot;</span></span><br><span class="line">      &#125;);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">QueryParams</span>.<span class="property">pagenum</span>++;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="title function_">getGoodsList</span>()</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="title function_">onPullDownRefresh</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">setData</span>(&#123;</span><br><span class="line">      <span class="attr">goodsList</span>: []</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">QueryParams</span>.<span class="property">pagenum</span> = <span class="number">1</span>;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">getGoodsList</span>()</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">//获取商品列表 </span></span><br><span class="line">  <span class="title function_">getGoodsList</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> res = <span class="title function_">request</span>(&#123; <span class="attr">url</span>: <span class="string">&#x27;/goods/search&#x27;</span>, <span class="attr">data</span>: <span class="variable language_">this</span>.<span class="property">QueryParams</span> &#125;)</span><br><span class="line">      .<span class="title function_">then</span>(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> total = res.<span class="property">total</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">totalPages</span> = <span class="title class_">Math</span>.<span class="title function_">ceil</span>(total / <span class="variable language_">this</span>.<span class="property">QueryParams</span>.<span class="property">pagesize</span>)<span class="comment">//获取页数</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">setData</span>(&#123;</span><br><span class="line">          <span class="attr">goodsList</span>: [...<span class="variable language_">this</span>.<span class="property">data</span>.<span class="property">goodsList</span>, ...res.<span class="property">goods</span>]<span class="comment">//拼接数组获得下拉刷新效果</span></span><br><span class="line">        &#125;)</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 配合request封装函数，可以完美实现关闭下拉刷新的窗口之前，先获取完所有数据</span></span><br><span class="line">        wx.<span class="title function_">stopPullDownRefresh</span>()</span><br><span class="line">      &#125;)</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">//实现tabs样式切换效果</span></span><br><span class="line">  <span class="title function_">handleTabsItemChange</span>(<span class="params">e</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; index &#125; = e.<span class="property">detail</span>;</span><br><span class="line">    <span class="keyword">let</span> &#123; tabs &#125; = <span class="variable language_">this</span>.<span class="property">data</span>;</span><br><span class="line">    tabs.<span class="title function_">forEach</span>(<span class="function">(<span class="params">v, i</span>) =&gt;</span> i === index ? v.<span class="property">isActive</span> = <span class="literal">true</span> : v.<span class="property">isActive</span> = <span class="literal">false</span>)</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">setData</span>(&#123;</span><br><span class="line">      tabs</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h3 id="商品详情"><a href="#商品详情" class="headerlink" title="商品详情"></a>商品详情</h3><h5 id="详情页面布局"><a href="#详情页面布局" class="headerlink" title="详情页面布局"></a>详情页面布局</h5><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;detail_swiper&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">swiper</span> <span class="attr">indicator-dots</span> <span class="attr">autoplay</span> <span class="attr">circular</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">swiper-item</span> <span class="attr">wx:for</span>=<span class="string">&quot;&#123;&#123;goodsObj.pics&#125;&#125;&quot;</span> <span class="attr">wx:key</span>=<span class="string">&quot;pics_id&quot;</span> <span class="attr">data-url</span>=<span class="string">&quot;&#123;&#123;item.pics_mid&#125;&#125;&quot;</span> <span class="attr">bindtap</span>=<span class="string">&quot;handlePreviewImage&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">image</span> <span class="attr">src</span>=<span class="string">&quot;&#123;&#123;item.pics_mid&#125;&#125;&quot;</span> <span class="attr">mode</span>=<span class="string">&quot;widthFix&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">image</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">swiper-item</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">swiper</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;goods_price&quot;</span>&gt;</span>¥&#123;&#123;goodsObj.goods_price&#125;&#125;<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;goods_name_row&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;goods_name&quot;</span>&gt;</span>&#123;&#123;goodsObj.goods_name&#125;&#125;<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;goods_collect&quot;</span> <span class="attr">bindtap</span>=<span class="string">&quot;handleCollect&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">text</span> <span class="attr">class</span>=<span class="string">&quot;iconfont &#123;&#123;isCollect?&#x27;icon-Collection&#x27;:&#x27;icon-shoucang1&#x27;&#125;&#125; &quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;collect_text&quot;</span>&gt;</span>收藏<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;goods_info&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;goods_info_title&quot;</span>&gt;</span>图文详情<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;goods_info_content&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">rich-text</span> <span class="attr">class</span>=<span class="string">&quot;&quot;</span> <span class="attr">nodes</span>=<span class="string">&quot;&#123;&#123;goodsObj.goods_introduce&#125;&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">rich-text</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;btm_tool&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;tool_item&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;iconfont icon-kefu&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">view</span>&gt;</span>联系客服<span class="tag">&lt;/<span class="name">view</span>&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">open-type</span>=<span class="string">&quot;contact&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">button</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;tool_item&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;iconfont icon-share-line&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">view</span>&gt;</span>分享<span class="tag">&lt;/<span class="name">view</span>&gt;</span>   </span><br><span class="line">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">open-type</span>=<span class="string">&quot;share&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">button</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">navigator</span> <span class="attr">url</span>=<span class="string">&quot;/pages/cart/index&quot;</span> <span class="attr">open-type</span>=<span class="string">&quot;switchTab&quot;</span> <span class="attr">class</span>=<span class="string">&quot;tool_item&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;iconfont icon-gouwuchezhengpin&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">view</span>&gt;</span>购物车<span class="tag">&lt;/<span class="name">view</span>&gt;</span>    </span><br><span class="line">    <span class="tag">&lt;/<span class="name">navigator</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;tool_item btn_cart&quot;</span> <span class="attr">bindtap</span>=<span class="string">&quot;handleCartAdd&quot;</span>&gt;</span></span><br><span class="line">       加入购物车</span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;tool_item btn_buy&quot;</span>&gt;</span></span><br><span class="line">       立即购买</span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span>    </span><br><span class="line">    </span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><span class="line">page &#123;</span><br><span class="line">  <span class="attribute">padding-bottom</span>: <span class="number">90</span>rpx;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.detail_swiper</span> swiper &#123;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">65vw</span>;</span><br><span class="line">  <span class="attribute">text-align</span>: center;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.detail_swiper</span> swiper image &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">60%</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.goods_price</span> &#123;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">15</span>rpx;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">32</span>rpx;</span><br><span class="line">  <span class="attribute">font-weight</span>: <span class="number">600</span>;</span><br><span class="line">  <span class="attribute">color</span>: <span class="built_in">var</span>(--themeColor);</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.goods_name_row</span> &#123;</span><br><span class="line">  <span class="attribute">border-top</span>: <span class="number">5</span>rpx solid <span class="number">#dedede</span>;</span><br><span class="line">  <span class="attribute">border-bottom</span>: <span class="number">5</span>rpx solid <span class="number">#ddeedd</span>;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">10</span>rpx <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.goods_name_row</span> <span class="selector-class">.goods_name</span> &#123;</span><br><span class="line">  <span class="attribute">flex</span>: <span class="number">5</span>;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#999</span>;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">26</span>rpx;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">0</span> <span class="number">10</span>rpx;</span><br><span class="line">  <span class="attribute">display</span>: -webkit-box;</span><br><span class="line">  <span class="attribute">overflow</span>: hidden;</span><br><span class="line">  -webkit-line-clamp: <span class="number">2</span>;</span><br><span class="line">  -webkit-box-orient: vertical;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.goods_name_row</span> <span class="selector-class">.goods_collect</span> &#123;</span><br><span class="line">  <span class="attribute">flex</span>: <span class="number">1</span>;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">  <span class="attribute">flex-direction</span>: column;</span><br><span class="line">  <span class="attribute">justify-content</span>: center;</span><br><span class="line">  <span class="attribute">align-items</span>: center;</span><br><span class="line">  <span class="attribute">border-left</span>: <span class="number">1</span>rpx solid <span class="number">#000</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.goods_name_row</span> <span class="selector-class">.goods_collect</span> <span class="selector-class">.icon-Collection</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: orangered;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.goods_name_row</span> <span class="selector-class">.goods_collect</span> <span class="selector-class">.collect_text</span> &#123;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">26</span>rpx;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#999</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.goods_info</span> <span class="selector-class">.goods_info_title</span> &#123;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">32</span>rpx;</span><br><span class="line">  <span class="attribute">color</span>: <span class="built_in">var</span>(--themeColor);</span><br><span class="line">  <span class="attribute">font-weight</span>: <span class="number">600</span>;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">20</span>rpx;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.btm_tool</span> &#123;</span><br><span class="line">  <span class="attribute">border-top</span>: <span class="number">1</span>rpx solid <span class="number">#ccc</span>;</span><br><span class="line">  <span class="attribute">position</span>: fixed;</span><br><span class="line">  <span class="attribute">left</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">bottom</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">90</span>rpx;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="number">#fff</span>;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.btm_tool</span> <span class="selector-class">.tool_item</span> &#123;</span><br><span class="line">  <span class="attribute">flex</span>: <span class="number">1</span>;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">  <span class="attribute">flex-direction</span>: column;</span><br><span class="line">  <span class="attribute">justify-content</span>: center;</span><br><span class="line">  <span class="attribute">align-items</span>: center;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">24</span>rpx;</span><br><span class="line">  <span class="attribute">position</span>: relative;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.btm_tool</span> <span class="selector-class">.tool_item</span> <span class="selector-tag">button</span> &#123;</span><br><span class="line">  <span class="attribute">position</span>: absolute;</span><br><span class="line">  <span class="attribute">top</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">left</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">opacity</span>: <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.btm_tool</span> <span class="selector-class">.btn_cart</span> &#123;</span><br><span class="line">  <span class="attribute">flex</span>: <span class="number">2</span>;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="number">#ffa500</span>;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#fff</span>;</span><br><span class="line">  <span class="attribute">font-weight</span>: <span class="number">600</span>;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">30</span>rpx;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.btm_tool</span> <span class="selector-class">.btn_buy</span> &#123;</span><br><span class="line">  <span class="attribute">flex</span>: <span class="number">2</span>;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="number">#eb4450</span>;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#fff</span>;</span><br><span class="line">  <span class="attribute">font-weight</span>: <span class="number">600</span>;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">30</span>rpx;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h5 id="js功能实现-4"><a href="#js功能实现-4" class="headerlink" title="js功能实现"></a>js功能实现</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; request &#125; <span class="keyword">from</span> <span class="string">&quot;../../request/index&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="title class_">Page</span>(&#123;</span><br><span class="line"></span><br><span class="line">  <span class="attr">data</span>: &#123;</span><br><span class="line">    <span class="attr">goodsObj</span>:&#123;&#125;,</span><br><span class="line">    <span class="attr">isCollect</span>:<span class="literal">false</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="title class_">GoodsInfo</span>:&#123;&#125;,</span><br><span class="line"></span><br><span class="line">  <span class="attr">onShow</span>: <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> pages= <span class="title function_">getCurrentPages</span>();</span><br><span class="line">    <span class="keyword">let</span> currentPage=pages[pages.<span class="property">length</span>-<span class="number">1</span>]</span><br><span class="line">    <span class="keyword">let</span> options=currentPage.<span class="property">options</span></span><br><span class="line">    <span class="keyword">const</span> &#123;goods_id&#125;=options;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">getGoodsDetail</span>(goods_id)</span><br><span class="line"></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">//获取数据，并存入缓存，以及添加是否收藏标志</span></span><br><span class="line">  <span class="title function_">getGoodsDetail</span>(<span class="params">goods_id</span>)&#123;</span><br><span class="line">    <span class="title function_">request</span>(&#123;<span class="attr">url</span>:<span class="string">&#x27;/goods/detail&#x27;</span>,<span class="attr">data</span>:&#123;goods_id&#125;&#125;)</span><br><span class="line">    .<span class="title function_">then</span>(<span class="function"><span class="params">res</span>=&gt;</span>&#123;</span><br><span class="line">     <span class="keyword">let</span> goodsObj=res;</span><br><span class="line">     <span class="variable language_">this</span>.<span class="property">GoodsInfo</span>=res;</span><br><span class="line">     <span class="comment">// 获取缓存中商品收藏数组</span></span><br><span class="line">    <span class="keyword">let</span> collect=wx.<span class="title function_">getStorageSync</span>(<span class="string">&quot;collect&quot;</span>)||[];</span><br><span class="line">    <span class="keyword">let</span> isCollect=collect.<span class="title function_">some</span>(<span class="function"><span class="params">v</span>=&gt;</span>v.<span class="property">goods_id</span>===<span class="variable language_">this</span>.<span class="property">GoodsInfo</span>.<span class="property">goods_id</span>)</span><br><span class="line">      <span class="variable language_">this</span>.<span class="title function_">setData</span>(&#123;</span><br><span class="line">        <span class="attr">goodsObj</span>:&#123;</span><br><span class="line">          <span class="attr">goods_name</span>:goodsObj.<span class="property">goods_name</span>,</span><br><span class="line">          <span class="attr">goods_price</span>:goodsObj.<span class="property">goods_price</span>,</span><br><span class="line">          <span class="attr">goods_introduce</span>:goodsObj.<span class="property">goods_introduce</span>.<span class="title function_">replace</span>(<span class="regexp">/\.webp/g</span>,<span class="string">&#x27;.jpg&#x27;</span>),</span><br><span class="line">          <span class="attr">pics</span>:goodsObj.<span class="property">pics</span></span><br><span class="line">        &#125;,</span><br><span class="line">        isCollect</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 预览轮播图的图片</span></span><br><span class="line">  <span class="title function_">handlePreviewImage</span>(<span class="params">e</span>)&#123;</span><br><span class="line">    <span class="comment">// 先构造要预览的图片数组</span></span><br><span class="line">    <span class="keyword">const</span> urls=<span class="variable language_">this</span>.<span class="property">GoodsInfo</span>.<span class="property">pics</span>.<span class="title function_">map</span>(<span class="function"><span class="params">v</span>=&gt;</span>v.<span class="property">pics_mid</span>)</span><br><span class="line">    <span class="keyword">const</span> current=e.<span class="property">currentTarget</span>.<span class="property">dataset</span>.<span class="property">url</span></span><br><span class="line">    wx.<span class="title function_">previewImage</span>(&#123;</span><br><span class="line">      current,</span><br><span class="line">      urls</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">//添加购物车功能</span></span><br><span class="line">  <span class="title function_">handleCartAdd</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="comment">// 先获取缓存中的购物车 数组</span></span><br><span class="line">    <span class="keyword">let</span> cart=wx.<span class="title function_">getStorageSync</span>(<span class="string">&quot;cart&quot;</span>)||[];</span><br><span class="line">    <span class="comment">// 判断 商品对象是否存在于购物车数组中</span></span><br><span class="line">    <span class="keyword">let</span> index=cart.<span class="title function_">findIndex</span>(<span class="function"><span class="params">v</span>=&gt;</span>v.<span class="property">goods_id</span>===<span class="variable language_">this</span>.<span class="property">GoodsInfo</span>.<span class="property">goods_id</span>)</span><br><span class="line">    <span class="keyword">if</span>(index===-<span class="number">1</span>)&#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">GoodsInfo</span>.<span class="property">num</span>=<span class="number">1</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">GoodsInfo</span>.<span class="property">checked</span>=<span class="literal">true</span></span><br><span class="line">      cart.<span class="title function_">push</span>(<span class="variable language_">this</span>.<span class="property">GoodsInfo</span>)</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">      cart[index].<span class="property">num</span>++</span><br><span class="line">    &#125;</span><br><span class="line">    wx.<span class="title function_">setStorageSync</span>(<span class="string">&quot;cart&quot;</span>, cart);</span><br><span class="line">    wx.<span class="title function_">showToast</span>(&#123;</span><br><span class="line">      <span class="attr">title</span>: <span class="string">&#x27;加入成功&#x27;</span>,</span><br><span class="line">      <span class="attr">icon</span>: <span class="string">&#x27;success&#x27;</span>,</span><br><span class="line">      <span class="attr">duration</span>: <span class="number">1500</span>,</span><br><span class="line">      <span class="attr">mask</span>: <span class="literal">true</span></span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 点击收藏商品</span></span><br><span class="line">  <span class="title function_">handleCollect</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="keyword">let</span> isCollect=<span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">let</span> collect=wx.<span class="title function_">getStorageSync</span>(<span class="string">&quot;collect&quot;</span>)||[];</span><br><span class="line">    <span class="keyword">let</span> index=collect.<span class="title function_">findIndex</span>(<span class="function"><span class="params">v</span>=&gt;</span>v.<span class="property">goods_id</span>===<span class="variable language_">this</span>.<span class="property">GoodsInfo</span>.<span class="property">goods_id</span>)</span><br><span class="line">    <span class="keyword">if</span>(index!=-<span class="number">1</span>)&#123;</span><br><span class="line">      collect.<span class="title function_">splice</span>(index,<span class="number">1</span>)</span><br><span class="line">      isCollect=<span class="literal">false</span></span><br><span class="line">      wx.<span class="title function_">showToast</span>(&#123;</span><br><span class="line">        <span class="attr">title</span>: <span class="string">&#x27;取消成功&#x27;</span>,</span><br><span class="line">        <span class="attr">icon</span>: <span class="string">&#x27;success&#x27;</span>,</span><br><span class="line">        <span class="attr">image</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">        <span class="attr">duration</span>: <span class="number">1500</span>,</span><br><span class="line">        <span class="attr">mask</span>: <span class="literal">true</span></span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">      collect.<span class="title function_">push</span>(<span class="variable language_">this</span>.<span class="property">GoodsInfo</span>)</span><br><span class="line">      isCollect=<span class="literal">true</span></span><br><span class="line">      wx.<span class="title function_">showToast</span>(&#123;</span><br><span class="line">        <span class="attr">title</span>: <span class="string">&#x27;收藏成功&#x27;</span>,</span><br><span class="line">        <span class="attr">icon</span>: <span class="string">&#x27;success&#x27;</span>,</span><br><span class="line">        <span class="attr">image</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">        <span class="attr">duration</span>: <span class="number">1500</span>,</span><br><span class="line">        <span class="attr">mask</span>: <span class="literal">true</span></span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    wx.<span class="title function_">setStorageSync</span>(<span class="string">&quot;collect&quot;</span>, collect);</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">setData</span>(&#123;</span><br><span class="line">      isCollect</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h5 id="页面完成图"><a href="#页面完成图" class="headerlink" title="页面完成图"></a>页面完成图</h5><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://i.loli.net/2020/08/24/oHYn57LT9UGO23X.jpg"></p><p>其中收藏、联系客服、分享、购物车、加入购物车功能均已实现，而立即购买仍没有去实现！</p><h3 id="购物车"><a href="#购物车" class="headerlink" title="购物车"></a>购物车</h3><h5 id="页面布局-1"><a href="#页面布局-1" class="headerlink" title="页面布局"></a>页面布局</h5><p>购物车页面布局很简单，只有添加收货地址和商品列表这两大项，重难点在于js的代码实现。</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 收货地址 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;recieve_address_row&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 当收货地址 不存在 按钮显示 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;address_btn&quot;</span> <span class="attr">wx:if</span>=<span class="string">&quot;&#123;&#123;!address.userName&#125;&#125;&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;primary&quot;</span> <span class="attr">bindtap</span>=<span class="string">&quot;handleChooseAddress&quot;</span> <span class="attr">plain</span>&gt;</span>获取收货地址<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 当收货地址 存在 详细信息就显示 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">wx:elese</span> <span class="attr">class</span>=<span class="string">&quot;user_info_row&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;user_info&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">view</span>&gt;</span>&#123;&#123;address.userName&#125;&#125;<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">view</span>&gt;</span>&#123;&#123;address.all&#125;&#125;<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;user_phone&quot;</span>&gt;</span>&#123;&#123;address.telNumber&#125;&#125;<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 购物车内容 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;cart_content&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;cart_title&quot;</span>&gt;</span>购物车<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;cart_main&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 当cart数组 长度不为0 显示 商品信息 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">block</span> <span class="attr">wx:if</span>=<span class="string">&quot;&#123;&#123;cart.length!=0&#125;&#125;&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;cart_item&quot;</span> <span class="attr">wx:for</span>=<span class="string">&quot;&#123;&#123;cart&#125;&#125;&quot;</span> <span class="attr">wx:key</span>=<span class="string">&quot;goods_id&quot;</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!-- 复选框 --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;cart_chk_wrap&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">checkbox-group</span> <span class="attr">data-id</span>=<span class="string">&quot;&#123;&#123;item.goods_id&#125;&#125;&quot;</span> <span class="attr">bindchange</span>=<span class="string">&quot;handleItemChange&quot;</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">checkbox</span> <span class="attr">checked</span>=<span class="string">&quot;&#123;&#123;item.checked&#125;&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">checkbox</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">                    <span class="tag">&lt;/<span class="name">checkbox-group</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!-- 商品图片 --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">navigator</span> <span class="attr">class</span>=<span class="string">&quot;cart_img_wrap&quot;</span> <span class="attr">url</span>=<span class="string">&quot;&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">image</span> <span class="attr">class</span>=<span class="string">&quot;&quot;</span> <span class="attr">src</span>=<span class="string">&quot;&#123;&#123;item.goods_small_logo?item.goods_small_logo:&#x27;https://ww1.sinaimg.cn/large/007rAy9hgy1g24by9t530j30i20i2glm.jpg&#x27;&#125;&#125;&quot;</span> <span class="attr">mode</span>=<span class="string">&quot;widthFix&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">image</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">navigator</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!-- 商品信息 --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;cart_info_wrap&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;goods_name&quot;</span>&gt;</span>&#123;&#123;item.goods_name&#125;&#125;<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;goods_prie_wrap&quot;</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;goods_price&quot;</span>&gt;</span>¥&#123;&#123;item.goods_price&#125;&#125;<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;cart_num_tool&quot;</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">view</span> <span class="attr">bindtap</span>=<span class="string">&quot;handleItemNumEdit&quot;</span> <span class="attr">data-id</span>=<span class="string">&quot;&#123;&#123;item.goods_id&#125;&#125;&quot;</span> <span class="attr">data-operation</span>=<span class="string">&quot;&#123;&#123;-1&#125;&#125;&quot;</span> <span class="attr">class</span>=<span class="string">&quot;num_edit&quot;</span>&gt;</span>-<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;goods_num&quot;</span>&gt;</span>&#123;&#123;item.num&#125;&#125;<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">view</span> <span class="attr">bindtap</span>=<span class="string">&quot;handleItemNumEdit&quot;</span> <span class="attr">data-id</span>=<span class="string">&quot;&#123;&#123;item.goods_id&#125;&#125;&quot;</span> <span class="attr">data-operation</span>=<span class="string">&quot;&#123;&#123;1&#125;&#125;&quot;</span> <span class="attr">class</span>=<span class="string">&quot;num_edit&quot;</span>&gt;</span>+<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">block</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">block</span> <span class="attr">wx:else</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">image</span> <span class="attr">class</span>=<span class="string">&quot;&quot;</span> <span class="attr">src</span>=<span class="string">&quot;https://timgsa.baidu.com/timg?image&amp;quality=80&amp;size=b9999_10000&amp;sec=1597867170872&amp;di=16a56791de9a4a330bb64ba090fad32c&amp;imgtype=0&amp;src=http%3A%2F%2Fhbimg.b0.upaiyun.com%2Fe1b1467beea0a9c7d6a56b32bac6d7e5dcd914f7c3e6-YTwUd6_fw658&quot;</span> <span class="attr">mode</span>=<span class="string">&quot;widthFix&quot;</span>&gt;</span></span><br><span class="line">               </span><br><span class="line">           <span class="tag">&lt;/<span class="name">image</span>&gt;</span> </span><br><span class="line">        <span class="tag">&lt;/<span class="name">block</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 底部工具栏 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;footer_tool&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 全选 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;all_chk_wrap&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">checkbox-group</span> <span class="attr">bindchange</span>=<span class="string">&quot;handleItemAllCheck&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">checkbox</span> <span class="attr">checked</span>=<span class="string">&quot;&#123;&#123;allChecked&#125;&#125;&quot;</span>&gt;</span>全选<span class="tag">&lt;/<span class="name">checkbox</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">checkbox-group</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 总价格 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;total_price_wrap&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;total_price&quot;</span>&gt;</span></span><br><span class="line">            合计：<span class="tag">&lt;<span class="name">text</span> <span class="attr">class</span>=<span class="string">&quot;total_price_text&quot;</span>&gt;</span>¥&#123;&#123;totalPrice&#125;&#125;<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">view</span>&gt;</span>包含运费<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 结算 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;order_pay_wrap&quot;</span> <span class="attr">bindtap</span>=<span class="string">&quot;handlePay&quot;</span>&gt;</span></span><br><span class="line">        结算(&#123;&#123;totalNum&#125;&#125;)</span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br></pre></td><td class="code"><pre><span class="line">page &#123;</span><br><span class="line">  <span class="attribute">padding-bottom</span>: <span class="number">90</span>rpx;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.recieve_address_row</span> <span class="selector-class">.address_btn</span> &#123;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">20</span>rpx;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.recieve_address_row</span> <span class="selector-class">.address_btn</span> <span class="selector-tag">button</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">60%</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.recieve_address_row</span> <span class="selector-class">.user_info_row</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">20</span>rpx;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.recieve_address_row</span> <span class="selector-class">.user_info_row</span> <span class="selector-class">.user_info</span> &#123;</span><br><span class="line">  <span class="attribute">flex</span>: <span class="number">5</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.recieve_address_row</span> <span class="selector-class">.user_info_row</span> <span class="selector-class">.user_phone</span> &#123;</span><br><span class="line">  <span class="attribute">flex</span>: <span class="number">3</span>;</span><br><span class="line">  <span class="attribute">text-align</span>: right;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.cart_content</span> <span class="selector-class">.cart_title</span> &#123;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">20</span>rpx;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">36</span>rpx;</span><br><span class="line">  <span class="attribute">color</span>: <span class="built_in">var</span>(--themeColor);</span><br><span class="line">  <span class="attribute">border-top</span>: <span class="number">1</span>rpx solid currentColor;</span><br><span class="line">  <span class="attribute">border-bottom</span>: <span class="number">1</span>rpx solid currentColor;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.cart_content</span> <span class="selector-class">.cart_main</span> <span class="selector-class">.cart_item</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">10</span>rpx;</span><br><span class="line">  <span class="attribute">border-bottom</span>: <span class="number">1</span>rpx solid <span class="number">#ccc</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.cart_content</span> <span class="selector-class">.cart_main</span> <span class="selector-class">.cart_item</span> <span class="selector-class">.cart_chk_wrap</span> &#123;</span><br><span class="line">  <span class="attribute">flex</span>: <span class="number">1</span>;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">  <span class="attribute">justify-content</span>: center;</span><br><span class="line">  <span class="attribute">align-items</span>: center;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.cart_content</span> <span class="selector-class">.cart_main</span> <span class="selector-class">.cart_item</span> <span class="selector-class">.cart_img_wrap</span> &#123;</span><br><span class="line">  <span class="attribute">flex</span>: <span class="number">2</span>;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">  <span class="attribute">justify-content</span>: center;</span><br><span class="line">  <span class="attribute">align-items</span>: center;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.cart_content</span> <span class="selector-class">.cart_main</span> <span class="selector-class">.cart_item</span> <span class="selector-class">.cart_img_wrap</span> image &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">80%</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.cart_content</span> <span class="selector-class">.cart_main</span> <span class="selector-class">.cart_item</span> <span class="selector-class">.cart_info_wrap</span> &#123;</span><br><span class="line">  <span class="attribute">flex</span>: <span class="number">4</span>;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">  <span class="attribute">flex-direction</span>: column;</span><br><span class="line">  <span class="attribute">justify-content</span>: space-around;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">0</span> <span class="number">20</span>rpx;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.cart_content</span> <span class="selector-class">.cart_main</span> <span class="selector-class">.cart_item</span> <span class="selector-class">.cart_info_wrap</span> <span class="selector-class">.goods_name</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: -webkit-box;</span><br><span class="line">  <span class="attribute">overflow</span>: hidden;</span><br><span class="line">  -webkit-box-orient: vertical;</span><br><span class="line">  -webkit-line-clamp: <span class="number">2</span>;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#666</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.cart_content</span> <span class="selector-class">.cart_main</span> <span class="selector-class">.cart_item</span> <span class="selector-class">.cart_info_wrap</span> <span class="selector-class">.goods_prie_wrap</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">  <span class="attribute">justify-content</span>: space-between;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.cart_content</span> <span class="selector-class">.cart_main</span> <span class="selector-class">.cart_item</span> <span class="selector-class">.cart_info_wrap</span> <span class="selector-class">.goods_prie_wrap</span> <span class="selector-class">.goods_price</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: <span class="built_in">var</span>(--themeColor);</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">34</span>rpx;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.cart_content</span> <span class="selector-class">.cart_main</span> <span class="selector-class">.cart_item</span> <span class="selector-class">.cart_info_wrap</span> <span class="selector-class">.goods_prie_wrap</span> <span class="selector-class">.cart_num_tool</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.cart_content</span> <span class="selector-class">.cart_main</span> <span class="selector-class">.cart_item</span> <span class="selector-class">.cart_info_wrap</span> <span class="selector-class">.goods_prie_wrap</span> <span class="selector-class">.cart_num_tool</span> <span class="selector-class">.num_edit</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">55</span>rpx;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">55</span>rpx;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">  <span class="attribute">justify-content</span>: center;</span><br><span class="line">  <span class="attribute">align-items</span>: center;</span><br><span class="line">  <span class="attribute">border</span>: <span class="number">1</span>rpx solid <span class="number">#ccc</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.cart_content</span> <span class="selector-class">.cart_main</span> <span class="selector-class">.cart_item</span> <span class="selector-class">.cart_info_wrap</span> <span class="selector-class">.goods_prie_wrap</span> <span class="selector-class">.cart_num_tool</span> <span class="selector-class">.goods_num</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">55</span>rpx;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">55</span>rpx;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">  <span class="attribute">justify-content</span>: center;</span><br><span class="line">  <span class="attribute">align-items</span>: center;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.footer_tool</span> &#123;</span><br><span class="line">  <span class="attribute">position</span>: fixed;</span><br><span class="line">  <span class="attribute">bottom</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">left</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">90</span>rpx;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="number">#fff</span>;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">  <span class="attribute">border-top</span>: <span class="number">1</span>rpx solid <span class="number">#ccc</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.footer_tool</span> <span class="selector-class">.all_chk_wrap</span> &#123;</span><br><span class="line">  <span class="attribute">flex</span>: <span class="number">2</span>;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">  <span class="attribute">justify-content</span>: center;</span><br><span class="line">  <span class="attribute">align-items</span>: center;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.footer_tool</span> <span class="selector-class">.total_price_wrap</span> &#123;</span><br><span class="line">  <span class="attribute">flex</span>: <span class="number">5</span>;</span><br><span class="line">  <span class="attribute">padding-right</span>: <span class="number">15</span>rpx;</span><br><span class="line">  <span class="attribute">text-align</span>: right;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.footer_tool</span> <span class="selector-class">.total_price_wrap</span> <span class="selector-class">.total_price</span> <span class="selector-class">.total_price_text</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: <span class="built_in">var</span>(--themeColor);</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">34</span>rpx;</span><br><span class="line">  <span class="attribute">font-weight</span>: <span class="number">600</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.footer_tool</span> <span class="selector-class">.order_pay_wrap</span> &#123;</span><br><span class="line">  <span class="attribute">flex</span>: <span class="number">3</span>;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="built_in">var</span>(--themeColor);</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#fff</span>;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">32</span>rpx;</span><br><span class="line">  <span class="attribute">font-weight</span>: <span class="number">600</span>;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">  <span class="attribute">justify-content</span>: center;</span><br><span class="line">  <span class="attribute">align-items</span>: center;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="js功能实现-5"><a href="#js功能实现-5" class="headerlink" title="js功能实现"></a>js功能实现</h5><h6 id="utils封装函数"><a href="#utils封装函数" class="headerlink" title="utils封装函数"></a>utils封装函数</h6><p>由于涉及wx的封装函数过多，故而在utils中封装了一些函数。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">getSetting</span>=(<span class="params"></span>)=&gt;&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve,reject</span>)=&gt;</span>&#123;</span><br><span class="line">        wx.<span class="title function_">getSetting</span>(&#123;</span><br><span class="line">            <span class="attr">success</span>: <span class="function">(<span class="params">result</span>)=&gt;</span>&#123;</span><br><span class="line">                <span class="title function_">resolve</span>(result)</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">fail</span>: <span class="function">(<span class="params">err</span>)=&gt;</span>&#123;</span><br><span class="line">                <span class="title function_">reject</span>(err)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">chooseAddress</span>=(<span class="params"></span>)=&gt;&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve,reject</span>)=&gt;</span>&#123;</span><br><span class="line">        wx.<span class="title function_">chooseAddress</span>(&#123;</span><br><span class="line">            <span class="attr">success</span>: <span class="function">(<span class="params">result</span>)=&gt;</span>&#123;</span><br><span class="line">                <span class="title function_">resolve</span>(result)</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">fail</span>: <span class="function">(<span class="params">err</span>)=&gt;</span>&#123;</span><br><span class="line">                <span class="title function_">reject</span>(err)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">openSetting</span>=(<span class="params"></span>)=&gt;&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve,reject</span>)=&gt;</span>&#123;</span><br><span class="line">        wx.<span class="title function_">openSetting</span>(&#123;</span><br><span class="line">            <span class="attr">success</span>: <span class="function">(<span class="params">result</span>)=&gt;</span>&#123;</span><br><span class="line">                <span class="title function_">resolve</span>(result)</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">fail</span>: <span class="function">(<span class="params">err</span>)=&gt;</span>&#123;</span><br><span class="line">                <span class="title function_">reject</span>(err)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">showModal</span>=(<span class="params">&#123;content&#125;</span>)=&gt;&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve,reject</span>)=&gt;</span>&#123;</span><br><span class="line">        wx.<span class="title function_">showModal</span>(&#123;</span><br><span class="line">            <span class="attr">title</span>: <span class="string">&#x27;提示&#x27;</span>,</span><br><span class="line">            content,</span><br><span class="line">            <span class="attr">showCancel</span>: <span class="literal">true</span>,</span><br><span class="line">            <span class="attr">cancelText</span>: <span class="string">&#x27;取消&#x27;</span>,</span><br><span class="line">            <span class="attr">cancelColor</span>: <span class="string">&#x27;#000000&#x27;</span>,</span><br><span class="line">            <span class="attr">confirmText</span>: <span class="string">&#x27;确定&#x27;</span>,</span><br><span class="line">            <span class="attr">confirmColor</span>: <span class="string">&#x27;#3CC51F&#x27;</span>,</span><br><span class="line">            <span class="attr">success</span>: <span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">              <span class="title function_">resolve</span>(res)</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">fail</span>:<span class="function">(<span class="params">err</span>)=&gt;</span>&#123;</span><br><span class="line">                <span class="title function_">reject</span>(err)</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;);</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">showToast</span>=(<span class="params">&#123;title&#125;</span>)=&gt;&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve,reject</span>)=&gt;</span>&#123;</span><br><span class="line">        wx.<span class="title function_">showToast</span>(&#123;</span><br><span class="line">            title,</span><br><span class="line">            <span class="attr">icon</span>: <span class="string">&#x27;none&#x27;</span>,</span><br><span class="line">            <span class="attr">success</span>: <span class="function">(<span class="params">res</span>)=&gt;</span>&#123;</span><br><span class="line">                <span class="title function_">resolve</span>(res)</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">fail</span>: <span class="function">(<span class="params">err</span>)=&gt;</span>&#123;</span><br><span class="line">                <span class="title function_">reject</span>(err)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">login</span>=(<span class="params"></span>)=&gt;&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve,reject</span>)=&gt;</span>&#123;</span><br><span class="line">     wx.<span class="title function_">login</span>(&#123;</span><br><span class="line">         <span class="attr">timeout</span>:<span class="number">10000</span>,</span><br><span class="line">         <span class="attr">success</span>: <span class="function">(<span class="params">res</span>)=&gt;</span>&#123;</span><br><span class="line">             <span class="title function_">resolve</span>(res)</span><br><span class="line">         &#125;,</span><br><span class="line">         <span class="attr">fail</span>: <span class="function">(<span class="params">err</span>)=&gt;</span>&#123;</span><br><span class="line">             <span class="title function_">reject</span>(res)</span><br><span class="line">         &#125;</span><br><span class="line">     &#125;);</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 支付！！</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">requestPayment</span>=(<span class="params">pay</span>)=&gt;&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve,reject</span>)=&gt;</span>&#123;</span><br><span class="line">    wx.<span class="title function_">requestPayment</span>(&#123;</span><br><span class="line">        ...pay,</span><br><span class="line">        <span class="attr">success</span>: <span class="function">(<span class="params">result</span>)=&gt;</span>&#123;</span><br><span class="line">            <span class="title function_">resolve</span>(result)</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">fail</span>: <span class="function">(<span class="params">err</span>)=&gt;</span>&#123;</span><br><span class="line">            <span class="title function_">reject</span>(err)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h6 id="js代码"><a href="#js代码" class="headerlink" title="js代码"></a>js代码</h6><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; request &#125; <span class="keyword">from</span> <span class="string">&quot;../../request/index&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; getSetting, chooseAddress, openSetting,showModal,showToast &#125; <span class="keyword">from</span> <span class="string">&quot;../../utils/asyncWx&quot;</span>;</span><br><span class="line"><span class="title class_">Page</span>(&#123;</span><br><span class="line"></span><br><span class="line">  <span class="attr">data</span>: &#123;</span><br><span class="line">    <span class="attr">address</span>:&#123;&#125;,</span><br><span class="line">    <span class="attr">cart</span>:[],</span><br><span class="line">    <span class="attr">allChecked</span>:<span class="literal">false</span>,</span><br><span class="line">    <span class="attr">totalPrice</span>:<span class="number">0</span>,</span><br><span class="line">    <span class="attr">totalNum</span>:<span class="number">0</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="title function_">onShow</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="keyword">const</span> address=wx.<span class="title function_">getStorageSync</span>(<span class="string">&quot;address&quot;</span>);<span class="comment">//获取地址缓存</span></span><br><span class="line">    <span class="keyword">const</span> cart=wx.<span class="title function_">getStorageSync</span>(<span class="string">&quot;cart&quot;</span>)||[];<span class="comment">//获取购物车缓存</span></span><br><span class="line">    <span class="comment">// const allChecked=cart.length?cart.every(v=&gt;v.checked):false</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">setData</span>(&#123;address&#125;)</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">setCart</span>(cart)</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="attr">onLoad</span>: <span class="keyword">function</span> (<span class="params">options</span>) &#123;</span><br><span class="line"></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 点击 收货地址</span></span><br><span class="line">  <span class="title function_">handleChooseAddress</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="title function_">getSetting</span>().<span class="title function_">then</span>(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> scopAddress = res.<span class="property">authSetting</span>[<span class="string">&quot;scope.address&quot;</span>]</span><br><span class="line">        <span class="keyword">if</span> (scopAddress === <span class="literal">false</span>) &#123;</span><br><span class="line">          <span class="title function_">openSetting</span>()</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">          <span class="title function_">chooseAddress</span>().<span class="title function_">then</span>(<span class="function"><span class="params">res</span>=&gt;</span>&#123;</span><br><span class="line">            res.<span class="property">all</span>=res.<span class="property">provinceName</span>+res.<span class="property">cityName</span>+res.<span class="property">countyName</span>+res.<span class="property">detailInfo</span></span><br><span class="line">           wx.<span class="title function_">setStorageSync</span>(<span class="string">&quot;address&quot;</span>, res);</span><br><span class="line">          &#125;)</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">      &#125;)</span><br><span class="line">    &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(error);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">//商品的选中</span></span><br><span class="line">  <span class="title function_">handleItemChange</span>(<span class="params">e</span>)&#123;</span><br><span class="line">    <span class="keyword">const</span> goods_id=e.<span class="property">currentTarget</span>.<span class="property">dataset</span>.<span class="property">id</span></span><br><span class="line">    <span class="comment">// console.log(goods_id);</span></span><br><span class="line">    <span class="keyword">let</span> &#123;cart&#125;=<span class="variable language_">this</span>.<span class="property">data</span>;</span><br><span class="line">    <span class="keyword">let</span> index=cart.<span class="title function_">findIndex</span>(<span class="function"><span class="params">v</span>=&gt;</span>v.<span class="property">goods_id</span>===goods_id)</span><br><span class="line">    cart[index].<span class="property">checked</span>=!cart[index].<span class="property">checked</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">setCart</span>(cart)</span><br><span class="line"></span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="title function_">setCart</span>(<span class="params">cart</span>)&#123;</span><br><span class="line">    <span class="keyword">let</span> allChecked=<span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">let</span> totalPrice=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">let</span> totalNum=<span class="number">0</span>;</span><br><span class="line">    cart.<span class="title function_">forEach</span>(<span class="function"><span class="params">v</span>=&gt;</span>&#123;</span><br><span class="line">      <span class="keyword">if</span>(v.<span class="property">checked</span>)&#123;</span><br><span class="line">        totalPrice+=v.<span class="property">num</span>*v.<span class="property">goods_price</span></span><br><span class="line">        totalNum+=v.<span class="property">num</span>;</span><br><span class="line">      &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        allChecked=<span class="literal">false</span><span class="comment">//只要有一个列表复选框未选，则底部的复选框为false</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">    allChecked=cart.<span class="property">length</span>!=<span class="number">0</span>?<span class="attr">allChecked</span>:<span class="literal">false</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">setData</span>(&#123;</span><br><span class="line">      cart,</span><br><span class="line">      allChecked,</span><br><span class="line">      totalPrice,</span><br><span class="line">      totalNum</span><br><span class="line">    &#125;)</span><br><span class="line">    wx.<span class="title function_">setStorageSync</span>(<span class="string">&quot;cart&quot;</span>, cart);</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 商品全选功能</span></span><br><span class="line">  <span class="title function_">handleItemAllCheck</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="keyword">let</span> &#123;cart,allChecked&#125;=<span class="variable language_">this</span>.<span class="property">data</span></span><br><span class="line">    allChecked=!allChecked</span><br><span class="line">    cart.<span class="title function_">forEach</span>(<span class="function"><span class="params">v</span>=&gt;</span>v.<span class="property">checked</span>=allChecked)</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">setCart</span>(cart)</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 商品数量的编辑功能</span></span><br><span class="line">  <span class="title function_">handleItemNumEdit</span>(<span class="params">e</span>)&#123;</span><br><span class="line">    <span class="keyword">let</span> &#123;operation,id&#125;=e.<span class="property">currentTarget</span>.<span class="property">dataset</span></span><br><span class="line">    <span class="keyword">let</span> &#123;cart&#125; = <span class="variable language_">this</span>.<span class="property">data</span></span><br><span class="line">    <span class="keyword">const</span> index=cart.<span class="title function_">findIndex</span>(<span class="function"><span class="params">v</span>=&gt;</span>v.<span class="property">goods_id</span>===id)</span><br><span class="line">    <span class="keyword">if</span>(cart[index].<span class="property">num</span>===<span class="number">1</span>&amp;&amp;operation===-<span class="number">1</span>)&#123;</span><br><span class="line">      <span class="title function_">showModal</span>(&#123;<span class="attr">content</span>:<span class="string">&quot;您是否要删除？&quot;</span>&#125;).<span class="title function_">then</span>(<span class="function"><span class="params">res</span>=&gt;</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(res.<span class="property">confirm</span>)&#123;</span><br><span class="line">          cart.<span class="title function_">splice</span>(index,<span class="number">1</span>)</span><br><span class="line">          <span class="variable language_">this</span>.<span class="title function_">setCart</span>(cart)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">      cart[index].<span class="property">num</span>+=operation</span><br><span class="line">      <span class="variable language_">this</span>.<span class="title function_">setCart</span>(cart)</span><br><span class="line">    &#125;</span><br><span class="line">   </span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 商品结算</span></span><br><span class="line">  <span class="title function_">handlePay</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="keyword">const</span> &#123;address,totalNum&#125;=<span class="variable language_">this</span>.<span class="property">data</span>;</span><br><span class="line">    <span class="keyword">if</span>(!address.<span class="property">userName</span>)&#123;</span><br><span class="line">      <span class="title function_">showToast</span>(&#123;<span class="attr">title</span>:<span class="string">&quot;您还没有选择收货地址&quot;</span>&#125;)</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(totalNum===<span class="number">0</span>)&#123;</span><br><span class="line">      <span class="title function_">showToast</span>(&#123;<span class="attr">title</span>:<span class="string">&quot;您还没有选购商品&quot;</span>&#125;)</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    wx.<span class="title function_">navigateTo</span>(&#123;</span><br><span class="line">      <span class="attr">url</span>: <span class="string">&#x27;/pages/pay/index&#x27;</span>,</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h5 id="页面图"><a href="#页面图" class="headerlink" title="页面图"></a>页面图</h5><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://i.loli.net/2020/08/24/R6mNrBMd4VE2kSs.jpg"></p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://i.loli.net/2020/08/24/mAtZyq396SUX1TP.jpg"></p><h3 id="支付"><a href="#支付" class="headerlink" title="支付"></a>支付</h3><p>此项功能是调取wx自带的函数，需要appId为商用id才可以，具体流程是，获取登录的用户token，根据token才能够实现支付效果。我不能通过此项步骤，实机操作会出现报错，所以只能伪装获取到token以及跳过支付界面！</p><h5 id="页面布局-2"><a href="#页面布局-2" class="headerlink" title="页面布局"></a>页面布局</h5><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 收货地址 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;recieve_address_row&quot;</span>&gt;</span></span><br><span class="line">   </span><br><span class="line">    <span class="comment">&lt;!-- 当收货地址 存在 详细信息就显示 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;user_info_row&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;user_info&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">view</span>&gt;</span>&#123;&#123;address.userName&#125;&#125;<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">view</span>&gt;</span>&#123;&#123;address.all&#125;&#125;<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;user_phone&quot;</span>&gt;</span>&#123;&#123;address.telNumber&#125;&#125;<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 购物车内容 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;cart_content&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;cart_title&quot;</span>&gt;</span>购物车<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;cart_main&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 当cart数组 长度不为0 显示 商品信息 --&gt;</span></span><br><span class="line">     </span><br><span class="line">            <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;cart_item&quot;</span> <span class="attr">wx:for</span>=<span class="string">&quot;&#123;&#123;cart&#125;&#125;&quot;</span> <span class="attr">wx:key</span>=<span class="string">&quot;goods_id&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">                <span class="comment">&lt;!-- 商品图片 --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">navigator</span> <span class="attr">class</span>=<span class="string">&quot;cart_img_wrap&quot;</span> <span class="attr">url</span>=<span class="string">&quot;&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">image</span> <span class="attr">class</span>=<span class="string">&quot;&quot;</span> <span class="attr">src</span>=<span class="string">&quot;&#123;&#123;item.goods_small_logo?item.goods_small_logo:&#x27;https://ww1.sinaimg.cn/large/007rAy9hgy1g24by9t530j30i20i2glm.jpg&#x27;&#125;&#125;&quot;</span> <span class="attr">mode</span>=<span class="string">&quot;widthFix&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">image</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">navigator</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!-- 商品信息 --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;cart_info_wrap&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;goods_name&quot;</span>&gt;</span>&#123;&#123;item.goods_name&#125;&#125;<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;goods_prie_wrap&quot;</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;goods_price&quot;</span>&gt;</span>¥&#123;&#123;item.goods_price&#125;&#125;<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;cart_num_tool&quot;</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;goods_num&quot;</span>&gt;</span>X &#123;&#123;item.num&#125;&#125;<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 底部工具栏 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;footer_tool&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 总价格 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;total_price_wrap&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;total_price&quot;</span>&gt;</span></span><br><span class="line">            合计：<span class="tag">&lt;<span class="name">text</span> <span class="attr">class</span>=<span class="string">&quot;total_price_text&quot;</span>&gt;</span>¥&#123;&#123;totalPrice&#125;&#125;<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">view</span>&gt;</span>包含运费<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;order_pay_wrap&quot;</span> <span class="attr">bindtap</span>=<span class="string">&quot;handleOderPay&quot;</span>&gt;</span></span><br><span class="line">        支付(&#123;&#123;totalNum&#125;&#125;)</span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br></pre></td><td class="code"><pre><span class="line">page &#123;</span><br><span class="line">  <span class="attribute">padding-bottom</span>: <span class="number">90</span>rpx;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.recieve_address_row</span> <span class="selector-class">.user_info_row</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">20</span>rpx;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.recieve_address_row</span> <span class="selector-class">.user_info_row</span> <span class="selector-class">.user_info</span> &#123;</span><br><span class="line">  <span class="attribute">flex</span>: <span class="number">5</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.recieve_address_row</span> <span class="selector-class">.user_info_row</span> <span class="selector-class">.user_phone</span> &#123;</span><br><span class="line">  <span class="attribute">flex</span>: <span class="number">3</span>;</span><br><span class="line">  <span class="attribute">text-align</span>: right;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.cart_content</span> <span class="selector-class">.cart_title</span> &#123;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">20</span>rpx;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">36</span>rpx;</span><br><span class="line">  <span class="attribute">color</span>: <span class="built_in">var</span>(--themeColor);</span><br><span class="line">  <span class="attribute">border-top</span>: <span class="number">1</span>rpx solid currentColor;</span><br><span class="line">  <span class="attribute">border-bottom</span>: <span class="number">1</span>rpx solid currentColor;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.cart_content</span> <span class="selector-class">.cart_main</span> <span class="selector-class">.cart_item</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">10</span>rpx;</span><br><span class="line">  <span class="attribute">border-bottom</span>: <span class="number">1</span>rpx solid <span class="number">#ccc</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.cart_content</span> <span class="selector-class">.cart_main</span> <span class="selector-class">.cart_item</span> <span class="selector-class">.cart_img_wrap</span> &#123;</span><br><span class="line">  <span class="attribute">flex</span>: <span class="number">2</span>;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">  <span class="attribute">justify-content</span>: center;</span><br><span class="line">  <span class="attribute">align-items</span>: center;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.cart_content</span> <span class="selector-class">.cart_main</span> <span class="selector-class">.cart_item</span> <span class="selector-class">.cart_img_wrap</span> image &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">80%</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.cart_content</span> <span class="selector-class">.cart_main</span> <span class="selector-class">.cart_item</span> <span class="selector-class">.cart_info_wrap</span> &#123;</span><br><span class="line">  <span class="attribute">flex</span>: <span class="number">4</span>;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">  <span class="attribute">flex-direction</span>: column;</span><br><span class="line">  <span class="attribute">justify-content</span>: space-around;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">0</span> <span class="number">20</span>rpx;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.cart_content</span> <span class="selector-class">.cart_main</span> <span class="selector-class">.cart_item</span> <span class="selector-class">.cart_info_wrap</span> <span class="selector-class">.goods_name</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: -webkit-box;</span><br><span class="line">  <span class="attribute">overflow</span>: hidden;</span><br><span class="line">  -webkit-box-orient: vertical;</span><br><span class="line">  -webkit-line-clamp: <span class="number">2</span>;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#666</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.cart_content</span> <span class="selector-class">.cart_main</span> <span class="selector-class">.cart_item</span> <span class="selector-class">.cart_info_wrap</span> <span class="selector-class">.goods_prie_wrap</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">  <span class="attribute">justify-content</span>: space-between;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.cart_content</span> <span class="selector-class">.cart_main</span> <span class="selector-class">.cart_item</span> <span class="selector-class">.cart_info_wrap</span> <span class="selector-class">.goods_prie_wrap</span> <span class="selector-class">.goods_price</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: <span class="built_in">var</span>(--themeColor);</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">34</span>rpx;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.cart_content</span> <span class="selector-class">.cart_main</span> <span class="selector-class">.cart_item</span> <span class="selector-class">.cart_info_wrap</span> <span class="selector-class">.goods_prie_wrap</span> <span class="selector-class">.cart_num_tool</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.cart_content</span> <span class="selector-class">.cart_main</span> <span class="selector-class">.cart_item</span> <span class="selector-class">.cart_info_wrap</span> <span class="selector-class">.goods_prie_wrap</span> <span class="selector-class">.cart_num_tool</span> <span class="selector-class">.goods_num</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">55</span>rpx;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">55</span>rpx;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">  <span class="attribute">justify-content</span>: center;</span><br><span class="line">  <span class="attribute">align-items</span>: center;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.footer_tool</span> &#123;</span><br><span class="line">  <span class="attribute">position</span>: fixed;</span><br><span class="line">  <span class="attribute">bottom</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">left</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">90</span>rpx;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="number">#fff</span>;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">  <span class="attribute">border-top</span>: <span class="number">1</span>rpx solid <span class="number">#ccc</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.footer_tool</span> <span class="selector-class">.total_price_wrap</span> &#123;</span><br><span class="line">  <span class="attribute">flex</span>: <span class="number">5</span>;</span><br><span class="line">  <span class="attribute">padding-right</span>: <span class="number">15</span>rpx;</span><br><span class="line">  <span class="attribute">text-align</span>: right;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.footer_tool</span> <span class="selector-class">.total_price_wrap</span> <span class="selector-class">.total_price</span> <span class="selector-class">.total_price_text</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: <span class="built_in">var</span>(--themeColor);</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">34</span>rpx;</span><br><span class="line">  <span class="attribute">font-weight</span>: <span class="number">600</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.footer_tool</span> <span class="selector-class">.order_pay_wrap</span> &#123;</span><br><span class="line">  <span class="attribute">flex</span>: <span class="number">3</span>;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="built_in">var</span>(--themeColor);</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#fff</span>;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">32</span>rpx;</span><br><span class="line">  <span class="attribute">font-weight</span>: <span class="number">600</span>;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">  <span class="attribute">justify-content</span>: center;</span><br><span class="line">  <span class="attribute">align-items</span>: center;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="auth页面"><a href="#auth页面" class="headerlink" title="auth页面"></a>auth页面</h5><h6 id="登录获取token"><a href="#登录获取token" class="headerlink" title="登录获取token"></a>登录获取token</h6><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;primary&quot;</span> <span class="attr">plain</span> <span class="attr">open-type</span>=<span class="string">&quot;getUserInfo&quot;</span> <span class="attr">bindgetuserinfo</span>=<span class="string">&quot;handleGetUserInfo&quot;</span>&gt;</span>获取授权<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">button</span>&#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">70%</span>;</span><br><span class="line">    <span class="attribute">margin-top</span>: <span class="number">40</span>rpx;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h6 id="js实现"><a href="#js实现" class="headerlink" title="js实现"></a>js实现</h6><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; request,request2 &#125; <span class="keyword">from</span> <span class="string">&quot;../../request/index&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; login &#125; <span class="keyword">from</span> <span class="string">&quot;../../utils/asyncWx&quot;</span>;</span><br><span class="line"><span class="title class_">Page</span>(&#123;</span><br><span class="line"></span><br><span class="line">  <span class="attr">data</span>: &#123;</span><br><span class="line"></span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="attr">onLoad</span>: <span class="keyword">function</span> (<span class="params">options</span>) &#123;</span><br><span class="line"></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="title function_">handleGetUserInfo</span>(<span class="params">e</span>) &#123;</span><br><span class="line">   <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; encryptedData, rawData, iv, signature &#125; = e.<span class="property">detail</span></span><br><span class="line">  <span class="comment">//   request2(&#123;url:&quot;/api/login&quot;,data:&#123;</span></span><br><span class="line">  <span class="comment">//     &quot;username&quot;:&quot;root&quot;,</span></span><br><span class="line">  <span class="comment">//     &quot;password&quot;:&quot;123456&quot;</span></span><br><span class="line">  <span class="comment">// &#125;,method:&quot;post&quot;&#125;).then(res=&gt;&#123;</span></span><br><span class="line">  <span class="comment">//   wx.setStorageSync(&quot;token&quot;, res.data.token);</span></span><br><span class="line">  <span class="comment">//   request2(&#123;url:&#x27;/api/profile&#x27;,header:&#123;&#x27;Authorization&#x27;:res.data.token&#125;&#125;)</span></span><br><span class="line">  <span class="comment">//     .then(res=&gt;&#123;</span></span><br><span class="line">  <span class="comment">//       wx.navigateBack(&#123;</span></span><br><span class="line">  <span class="comment">//         delta: 1</span></span><br><span class="line">  <span class="comment">//       &#125;);</span></span><br><span class="line">  <span class="comment">//     &#125;)</span></span><br><span class="line">  <span class="comment">// &#125;)</span></span><br><span class="line">    <span class="comment">// login().then(res=&gt;&#123;</span></span><br><span class="line">    <span class="comment">//   const &#123;code&#125;=res;</span></span><br><span class="line">    <span class="comment">//   console.log(code);</span></span><br><span class="line">    <span class="comment">//   wx.request(&#123;</span></span><br><span class="line">    <span class="comment">//     url: &#x27;https://api.it120.cc/dhqm/user/wxapp/login&#x27;,</span></span><br><span class="line">    <span class="comment">//     data: &#123;code&#125;,</span></span><br><span class="line">    <span class="comment">//     header: &#123;&#x27;content-type&#x27;:&#x27;application/x-www-form-urlencoded&#x27;&#125;,</span></span><br><span class="line">    <span class="comment">//     method: &#x27;POST&#x27;,</span></span><br><span class="line">    <span class="comment">//     dataType: &#x27;json&#x27;,</span></span><br><span class="line">    <span class="comment">//     responseType: &#x27;text&#x27;,</span></span><br><span class="line">    <span class="comment">//     success: (result)=&gt;&#123;</span></span><br><span class="line">    <span class="comment">//       console.log(&quot;登陆成功&quot;,result);</span></span><br><span class="line">    <span class="comment">//     &#125;</span></span><br><span class="line">    <span class="comment">//   &#125;);</span></span><br><span class="line">    <span class="title function_">login</span>().<span class="title function_">then</span>(<span class="function"><span class="params">res</span>=&gt;</span>&#123;</span><br><span class="line">      <span class="keyword">const</span> &#123;code&#125;=res;</span><br><span class="line">      <span class="keyword">const</span> loginParams=&#123; encryptedData, rawData, iv, signature ,code&#125;</span><br><span class="line">      <span class="title function_">request</span>(&#123;<span class="attr">url</span>:<span class="string">&#x27;/users/wxlogin&#x27;</span>,<span class="attr">data</span>:loginParams,<span class="attr">method</span>:<span class="string">&quot;POST&quot;</span>&#125;)</span><br><span class="line">      .<span class="title function_">then</span>(<span class="function"><span class="params">res</span>=&gt;</span>&#123;</span><br><span class="line">        <span class="comment">// 伪装token</span></span><br><span class="line">        wx.<span class="title function_">setStorageSync</span>(<span class="string">&quot;token&quot;</span>, <span class="string">&quot;Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1aWQiOjIzLCJpYXQiOjE1NjQ3MzAwNzksImV4cCI6MTAwMTU2NDczMDA3OH0.YPt-XeLnjV-_1ITaXGY2FhxmCe4NvXuRnRB8OMCfnPo&quot;</span>);</span><br><span class="line">        wx.<span class="title function_">navigateBack</span>(&#123;</span><br><span class="line">          <span class="attr">delta</span>: <span class="number">1</span></span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// &#125;)</span></span><br><span class="line">   &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">     <span class="variable language_">console</span>.<span class="title function_">log</span>(error);</span><br><span class="line">   &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h5 id="支付功能实现"><a href="#支付功能实现" class="headerlink" title="支付功能实现"></a>支付功能实现</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; request &#125; <span class="keyword">from</span> <span class="string">&quot;../../request/index&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; getSetting, chooseAddress, openSetting, showModal, showToast, requestPayment &#125; <span class="keyword">from</span> <span class="string">&quot;../../utils/asyncWx&quot;</span>;</span><br><span class="line"><span class="title class_">Page</span>(&#123;</span><br><span class="line"></span><br><span class="line">  <span class="attr">data</span>: &#123;</span><br><span class="line">    <span class="attr">address</span>: &#123;&#125;,</span><br><span class="line">    <span class="attr">cart</span>: [],</span><br><span class="line">    <span class="attr">totalPrice</span>: <span class="number">0</span>,</span><br><span class="line">    <span class="attr">totalNum</span>: <span class="number">0</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="title function_">onShow</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> address = wx.<span class="title function_">getStorageSync</span>(<span class="string">&quot;address&quot;</span>);</span><br><span class="line">    <span class="keyword">let</span> cart = wx.<span class="title function_">getStorageSync</span>(<span class="string">&quot;cart&quot;</span>) || [];</span><br><span class="line">    cart = cart.<span class="title function_">filter</span>(<span class="function"><span class="params">v</span> =&gt;</span> v.<span class="property">checked</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> totalPrice = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">let</span> totalNum = <span class="number">0</span>;</span><br><span class="line">    cart.<span class="title function_">forEach</span>(<span class="function"><span class="params">v</span> =&gt;</span> &#123;</span><br><span class="line">      totalPrice += v.<span class="property">num</span> * v.<span class="property">goods_price</span></span><br><span class="line">      totalNum += v.<span class="property">num</span>;</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">setData</span>(&#123;</span><br><span class="line">      cart,</span><br><span class="line">      totalPrice,</span><br><span class="line">      totalNum,</span><br><span class="line">      address</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="attr">onLoad</span>: <span class="keyword">function</span> (<span class="params">options</span>) &#123;</span><br><span class="line"></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="title function_">handleOderPay</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> token = wx.<span class="title function_">getStorageSync</span>(<span class="string">&quot;token&quot;</span>);</span><br><span class="line">      <span class="keyword">if</span> (!token) &#123;</span><br><span class="line">        wx.<span class="title function_">navigateTo</span>(&#123;</span><br><span class="line">          <span class="attr">url</span>: <span class="string">&#x27;/pages/auth/index&#x27;</span></span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">// const header = &#123; Authorization: token &#125;;</span></span><br><span class="line">      <span class="keyword">const</span> order_price = <span class="variable language_">this</span>.<span class="property">data</span>.<span class="property">totalPrice</span>;</span><br><span class="line">      <span class="keyword">const</span> consignee_addr = <span class="variable language_">this</span>.<span class="property">data</span>.<span class="property">address</span>.<span class="property">all</span>;</span><br><span class="line">      <span class="keyword">const</span> cart = <span class="variable language_">this</span>.<span class="property">data</span>.<span class="property">cart</span>;</span><br><span class="line">      <span class="keyword">let</span> goods = []</span><br><span class="line">      cart.<span class="title function_">forEach</span>(<span class="function"><span class="params">v</span> =&gt;</span> goods.<span class="title function_">push</span>(&#123;</span><br><span class="line">        <span class="attr">goods_id</span>: v.<span class="property">goods_id</span>,</span><br><span class="line">        <span class="attr">goods_number</span>: v.<span class="property">num</span>,</span><br><span class="line">        <span class="attr">goods_price</span>: v.<span class="property">goods_price</span></span><br><span class="line">      &#125;))</span><br><span class="line">      <span class="keyword">const</span> orderParams = &#123; order_price, consignee_addr, goods &#125;</span><br><span class="line">      <span class="title function_">request</span>(&#123; <span class="attr">url</span>: <span class="string">&quot;/my/orders/create&quot;</span>, <span class="attr">method</span>: <span class="string">&quot;POST&quot;</span>, <span class="attr">data</span>: orderParams&#125;)</span><br><span class="line">        .<span class="title function_">then</span>(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">          <span class="keyword">const</span> order_number = res.<span class="property">order_number</span></span><br><span class="line">          <span class="title function_">request</span>(&#123; <span class="attr">url</span>: <span class="string">&quot;/my/orders/req_unifiedorder&quot;</span>, <span class="attr">method</span>: <span class="string">&quot;POST&quot;</span>, <span class="attr">data</span>: &#123; order_number &#125; &#125;)</span><br><span class="line">            .<span class="title function_">then</span>(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">              <span class="title function_">showToast</span>(&#123; <span class="attr">title</span>: <span class="string">&quot;支付成功！&quot;</span> &#125;).<span class="title function_">then</span>(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">log</span>(&#123; <span class="attr">errMsg</span>: <span class="string">&quot;requestPayment:ok&quot;</span> &#125;);</span><br><span class="line">              &#125;)</span><br><span class="line">              <span class="comment">// 支付流程</span></span><br><span class="line">              <span class="comment">// const pay=&#123;...res.pay&#125;</span></span><br><span class="line">              <span class="comment">// requestPayment(pay).then(res=&gt;&#123;</span></span><br><span class="line">              <span class="comment">//   console.log(res);</span></span><br><span class="line">              <span class="comment">// &#125;)</span></span><br><span class="line">              <span class="keyword">let</span> newCart=wx.<span class="title function_">getStorageSync</span>(<span class="string">&quot;cart&quot;</span>);</span><br><span class="line">              newCart=newCart.<span class="title function_">filter</span>(<span class="function"><span class="params">v</span>=&gt;</span>!v.<span class="property">checked</span>)</span><br><span class="line">              wx.<span class="title function_">setStorageSync</span>(<span class="string">&quot;cart&quot;</span>, newCart);</span><br><span class="line">              wx.<span class="title function_">redirectTo</span>(&#123;</span><br><span class="line">                <span class="attr">url</span>: <span class="string">&#x27;/pages/order/index&#x27;</span>,</span><br><span class="line"></span><br><span class="line">              &#125;);</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">      <span class="title function_">showToast</span>(&#123; <span class="attr">title</span>: <span class="string">&quot;支付失败&quot;</span> &#125;).<span class="title function_">then</span>(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(&#123; <span class="attr">errMsg</span>: <span class="string">&quot;requestPayment:cancel&quot;</span> &#125;);</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h5 id="页面图-1"><a href="#页面图-1" class="headerlink" title="页面图"></a>页面图</h5><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://i.loli.net/2020/08/24/TRHwU3CxzAYoIWX.jpg"></p><h3 id="我的"><a href="#我的" class="headerlink" title="我的"></a>我的</h3><h5 id="页面布局-3"><a href="#页面布局-3" class="headerlink" title="页面布局"></a>页面布局</h5><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;user_info_wrap&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">wx:if</span>=<span class="string">&quot;&#123;&#123;userinfo.avatarUrl&#125;&#125;&quot;</span> <span class="attr">class</span>=<span class="string">&quot;user_img_wrap&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">image</span> <span class="attr">class</span>=<span class="string">&quot;user_bg&quot;</span> <span class="attr">src</span>=<span class="string">&quot;&#123;&#123;userinfo.avatarUrl&#125;&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">image</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;user_info&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">image</span> <span class="attr">class</span>=<span class="string">&quot;user_icon&quot;</span> <span class="attr">src</span>=<span class="string">&quot;&#123;&#123;userinfo.avatarUrl&#125;&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">image</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;user_name&quot;</span>&gt;</span>&#123;&#123;userinfo.nickName&#125;&#125;<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">wx:else</span> <span class="attr">class</span>=<span class="string">&quot;user_btn&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">navigator</span> <span class="attr">class</span>=<span class="string">&quot;&quot;</span> <span class="attr">target</span>=<span class="string">&quot;&quot;</span> <span class="attr">url</span>=<span class="string">&quot;/pages/login/index&quot;</span> <span class="attr">hover-class</span>=<span class="string">&quot;navigator-hover&quot;</span> <span class="attr">open-type</span>=<span class="string">&quot;navigate&quot;</span>&gt;</span></span><br><span class="line">            登录</span><br><span class="line">        <span class="tag">&lt;/<span class="name">navigator</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;user_content&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;user_main&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 历史足迹 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;history_wrap&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">navigator</span> <span class="attr">url</span>=<span class="string">&quot;&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;his_num&quot;</span>&gt;</span>0<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;his_name&quot;</span>&gt;</span>收藏的店铺<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">navigator</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">navigator</span> <span class="attr">url</span>=<span class="string">&quot;/pages/collect/index&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;his_num&quot;</span>&gt;</span>&#123;&#123;collectNums&#125;&#125;<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;his_name&quot;</span>&gt;</span>收藏的商品<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">navigator</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">navigator</span> <span class="attr">url</span>=<span class="string">&quot;&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;his_num&quot;</span>&gt;</span>0<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;his_name&quot;</span>&gt;</span>关注的商品<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">navigator</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">navigator</span> <span class="attr">url</span>=<span class="string">&quot;&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;his_num&quot;</span>&gt;</span>0<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;his_name&quot;</span>&gt;</span>我的足迹<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">navigator</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 我的订单 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;orders_wrap&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;orders_title&quot;</span>&gt;</span>我的订单<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;order_content&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">navigator</span> <span class="attr">class</span>=<span class="string">&quot;&quot;</span> <span class="attr">target</span>=<span class="string">&quot;&quot;</span> <span class="attr">url</span>=<span class="string">&quot;/pages/order/index?type=1&quot;</span> <span class="attr">hover-class</span>=<span class="string">&quot;navigator-hover&quot;</span> <span class="attr">open-type</span>=<span class="string">&quot;navigate&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;iconfont icon-dingdan-&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;order_name&quot;</span>&gt;</span>全部订单<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">navigator</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">navigator</span> <span class="attr">class</span>=<span class="string">&quot;&quot;</span> <span class="attr">target</span>=<span class="string">&quot;&quot;</span> <span class="attr">url</span>=<span class="string">&quot;/pages/order/index?type=2&quot;</span> <span class="attr">hover-class</span>=<span class="string">&quot;navigator-hover&quot;</span> <span class="attr">open-type</span>=<span class="string">&quot;navigate&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;iconfont icon-fukuantongzhi&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;order_name&quot;</span>&gt;</span>待付款<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">navigator</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">navigator</span> <span class="attr">class</span>=<span class="string">&quot;&quot;</span> <span class="attr">target</span>=<span class="string">&quot;&quot;</span> <span class="attr">url</span>=<span class="string">&quot;/pages/order/index?type=3&quot;</span> <span class="attr">hover-class</span>=<span class="string">&quot;navigator-hover&quot;</span> <span class="attr">open-type</span>=<span class="string">&quot;navigate&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;iconfont icon-huoche&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;order_name&quot;</span>&gt;</span>待收货<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">navigator</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">navigator</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;iconfont icon-tuihuotuikuan-&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;order_name&quot;</span>&gt;</span>退款/退货<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">navigator</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">&lt;!-- 收货地址管理 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;address_wrap&quot;</span>&gt;</span></span><br><span class="line">            收货地址管理</span><br><span class="line">        <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- 应用信息相关 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;app_info_wrap&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;app_info_item app_info_contact&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">text</span>&gt;</span>联系客服<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">text</span>&gt;</span>400-618-4000<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">navigator</span> <span class="attr">url</span>=<span class="string">&quot;/pages/feedback/index&quot;</span> <span class="attr">class</span>=<span class="string">&quot;app_info_item&quot;</span>&gt;</span>意见反馈<span class="tag">&lt;/<span class="name">navigator</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;app_info_item&quot;</span>&gt;</span>关于我们<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- 推荐 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;recommend_wrap&quot;</span>&gt;</span></span><br><span class="line">            把应用推荐给他人</span><br><span class="line">        <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    </span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br></pre></td><td class="code"><pre><span class="line">page &#123;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="number">#ccc</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.user_info_wrap</span> &#123;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">40vh</span>;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="built_in">var</span>(--themeColor);</span><br><span class="line">  <span class="attribute">position</span>: relative;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.user_info_wrap</span> <span class="selector-class">.user_img_wrap</span> &#123;</span><br><span class="line">  <span class="attribute">position</span>: relative;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.user_info_wrap</span> <span class="selector-class">.user_img_wrap</span> <span class="selector-class">.user_bg</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">45vh</span>;</span><br><span class="line">  <span class="attribute">filter</span>: <span class="built_in">blur</span>(<span class="number">6</span>rpx);</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.user_info_wrap</span> <span class="selector-class">.user_img_wrap</span> <span class="selector-class">.user_info</span> &#123;</span><br><span class="line">  <span class="attribute">position</span>: absolute;</span><br><span class="line">  <span class="attribute">left</span>: <span class="number">50%</span>;</span><br><span class="line">  <span class="attribute">transform</span>: <span class="built_in">translateX</span>(-<span class="number">50%</span>);</span><br><span class="line">  <span class="attribute">top</span>: <span class="number">20%</span>;</span><br><span class="line">  <span class="attribute">text-align</span>: center;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.user_info_wrap</span> <span class="selector-class">.user_img_wrap</span> <span class="selector-class">.user_info</span> <span class="selector-class">.user_icon</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">150</span>rpx;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">150</span>rpx;</span><br><span class="line">  <span class="attribute">border-radius</span>: <span class="number">50%</span>;</span><br><span class="line">  <span class="attribute">z-index</span>: <span class="number">100</span>;</span><br><span class="line">  <span class="attribute">margin</span>: <span class="number">0</span> auto;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.user_info_wrap</span> <span class="selector-class">.user_img_wrap</span> <span class="selector-class">.user_info</span> <span class="selector-class">.user_name</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#fff</span>;</span><br><span class="line">  <span class="attribute">margin-top</span>: <span class="number">40</span>rpx;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">40</span>rpx;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.user_info_wrap</span> <span class="selector-class">.user_btn</span> &#123;</span><br><span class="line">  <span class="attribute">position</span>: absolute;</span><br><span class="line">  <span class="attribute">left</span>: <span class="number">50%</span>;</span><br><span class="line">  <span class="attribute">transform</span>: <span class="built_in">translateX</span>(-<span class="number">50%</span>);</span><br><span class="line">  <span class="attribute">top</span>: <span class="number">40%</span>;</span><br><span class="line">  <span class="attribute">border</span>: <span class="number">1</span>rpx solid greenyellow;</span><br><span class="line">  <span class="attribute">color</span>: greenyellow;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">38</span>rpx;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">30</span>rpx;</span><br><span class="line">  <span class="attribute">border-radius</span>: <span class="number">10</span>rpx;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.user_content</span> &#123;</span><br><span class="line">  <span class="attribute">position</span>: relative;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.user_content</span> <span class="selector-class">.user_main</span> &#123;</span><br><span class="line">  <span class="attribute">position</span>: absolute;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">90%</span>;</span><br><span class="line">  <span class="attribute">left</span>: <span class="number">50%</span>;</span><br><span class="line">  <span class="attribute">transform</span>: <span class="built_in">translateX</span>(-<span class="number">50%</span>);</span><br><span class="line">  <span class="attribute">top</span>: <span class="number">40</span>rpx;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#666</span>;</span><br><span class="line">  <span class="attribute">padding-bottom</span>: <span class="number">100</span>rpx;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.user_content</span> <span class="selector-class">.user_main</span> <span class="selector-class">.history_wrap</span> &#123;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="number">#fff</span>;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">  <span class="attribute">flex-direction</span>: row;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.user_content</span> <span class="selector-class">.user_main</span> <span class="selector-class">.history_wrap</span> navigator &#123;</span><br><span class="line">  <span class="attribute">flex</span>: <span class="number">1</span>;</span><br><span class="line">  <span class="attribute">text-align</span>: center;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">10</span>rpx <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.user_content</span> <span class="selector-class">.user_main</span> <span class="selector-class">.history_wrap</span> navigator <span class="selector-class">.his_num</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: <span class="built_in">var</span>(--themeColor);</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.user_content</span> <span class="selector-class">.user_main</span> <span class="selector-class">.orders_wrap</span> &#123;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="number">#fff</span>;</span><br><span class="line">  <span class="attribute">margin-top</span>: <span class="number">30</span>rpx;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.user_content</span> <span class="selector-class">.user_main</span> <span class="selector-class">.orders_wrap</span> <span class="selector-class">.orders_title</span> &#123;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">20</span>rpx;</span><br><span class="line">  <span class="attribute">border-bottom</span>: <span class="number">1</span>rpx solid <span class="number">#ccc</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.user_content</span> <span class="selector-class">.user_main</span> <span class="selector-class">.orders_wrap</span> <span class="selector-class">.order_content</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.user_content</span> <span class="selector-class">.user_main</span> <span class="selector-class">.orders_wrap</span> <span class="selector-class">.order_content</span> navigator &#123;</span><br><span class="line">  <span class="attribute">flex</span>: <span class="number">1</span>;</span><br><span class="line">  <span class="attribute">text-align</span>: center;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">15</span>rpx <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.user_content</span> <span class="selector-class">.user_main</span> <span class="selector-class">.orders_wrap</span> <span class="selector-class">.order_content</span> navigator <span class="selector-class">.iconfont</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: <span class="built_in">var</span>(--themeColor);</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">40</span>rpx;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.user_content</span> <span class="selector-class">.user_main</span> <span class="selector-class">.address_wrap</span> &#123;</span><br><span class="line">  <span class="attribute">margin-top</span>: <span class="number">30</span>rpx;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="number">#fff</span>;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">20</span>rpx;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.user_content</span> <span class="selector-class">.user_main</span> <span class="selector-class">.app_info_wrap</span> &#123;</span><br><span class="line">  <span class="attribute">margin-top</span>: <span class="number">30</span>rpx;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="number">#fff</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.user_content</span> <span class="selector-class">.user_main</span> <span class="selector-class">.app_info_wrap</span> <span class="selector-class">.app_info_item</span> &#123;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">20</span>rpx;</span><br><span class="line">  <span class="attribute">border-bottom</span>: <span class="number">1</span>rpx solid <span class="number">#ccc</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.user_content</span> <span class="selector-class">.user_main</span> <span class="selector-class">.app_info_contact</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">  <span class="attribute">justify-content</span>: space-between;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.user_content</span> <span class="selector-class">.user_main</span> <span class="selector-class">.recommend_wrap</span> &#123;</span><br><span class="line">  <span class="attribute">margin-top</span>: <span class="number">30</span>rpx;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="number">#fff</span>;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">20</span>rpx;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h5 id="收藏浏览"><a href="#收藏浏览" class="headerlink" title="收藏浏览"></a>收藏浏览</h5><h6 id="页面布局-4"><a href="#页面布局-4" class="headerlink" title="页面布局"></a>页面布局</h6><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">Tabs</span> <span class="attr">tabs</span>=<span class="string">&quot;&#123;&#123;tabs&#125;&#125;&quot;</span> <span class="attr">bindtabsItemChange</span>=<span class="string">&quot;handleTabsItemChange&quot;</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;collect_main&quot;</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;collect_title&quot;</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;collect_tips active&quot;</span>&gt;</span>全部<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;collect_tips&quot;</span>&gt;</span>正在热卖<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;collect_tips&quot;</span>&gt;</span>即将上线<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;collect_content&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">navigator</span> </span></span><br><span class="line"><span class="tag">        <span class="attr">class</span>=<span class="string">&quot;goods_item&quot;</span> </span></span><br><span class="line"><span class="tag">        <span class="attr">wx:for</span>=<span class="string">&quot;&#123;&#123;collect&#125;&#125;&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">wx:key</span>=<span class="string">&quot;goods_id&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">url</span>=<span class="string">&quot;/pages/goods_detail/index?goods_id=&#123;&#123;item.goods_id&#125;&#125;&quot;</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 左侧 图片容器 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;goods_img_wrap&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">image</span> <span class="attr">class</span>=<span class="string">&quot;&quot;</span> <span class="attr">src</span>=<span class="string">&quot;&#123;&#123;item.goods_small_logo?item.goods_small_logo:&#x27;https://ww1.sinaimg.cn/large/007rAy9hgy1g24by9t530j30i20i2glm.jpg&#x27;&#125;&#125;&quot;</span> <span class="attr">mode</span>=<span class="string">&quot;widthFix&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">image</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">&lt;!-- 右侧 图片容器 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;goods_info_wrap&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;goods_name&quot;</span>&gt;</span>&#123;&#123;item.goods_name&#125;&#125;<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;goods_price&quot;</span>&gt;</span>¥ &#123;&#123;item.goods_price&#125;&#125;<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;/<span class="name">navigator</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">Tabs</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.collect_main</span> &#123;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="number">#f3f4f6</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.collect_main</span> <span class="selector-class">.collect_title</span> &#123;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">30</span>rpx <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.collect_main</span> <span class="selector-class">.collect_title</span> <span class="selector-class">.collect_tips</span> &#123;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">15</span>rpx;</span><br><span class="line">  <span class="attribute">border</span>: <span class="number">1</span>rpx solid <span class="number">#ccc</span>;</span><br><span class="line">  <span class="attribute">margin-left</span>: <span class="number">25</span>rpx;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="number">#fff</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.collect_main</span> <span class="selector-class">.collect_title</span> <span class="selector-class">.active</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: <span class="built_in">var</span>(--themeColor);</span><br><span class="line">  <span class="attribute">border-color</span>: currentColor;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.collect_main</span> <span class="selector-class">.collect_content</span> <span class="selector-class">.goods_item</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">  <span class="attribute">border-bottom</span>: <span class="number">2</span>rpx solid <span class="number">#ccc</span>;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="number">#fff</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.collect_main</span> <span class="selector-class">.collect_content</span> <span class="selector-class">.goods_item</span> <span class="selector-class">.goods_img_wrap</span> &#123;</span><br><span class="line">  <span class="attribute">flex</span>: <span class="number">2</span>;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">  <span class="attribute">justify-content</span>: center;</span><br><span class="line">  <span class="attribute">align-items</span>: center;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.collect_main</span> <span class="selector-class">.collect_content</span> <span class="selector-class">.goods_item</span> <span class="selector-class">.goods_img_wrap</span> image &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">70%</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.collect_main</span> <span class="selector-class">.collect_content</span> <span class="selector-class">.goods_item</span> <span class="selector-class">.goods_info_wrap</span> &#123;</span><br><span class="line">  <span class="attribute">flex</span>: <span class="number">3</span>;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">  <span class="attribute">flex-direction</span>: column;</span><br><span class="line">  <span class="attribute">justify-content</span>: space-around;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.collect_main</span> <span class="selector-class">.collect_content</span> <span class="selector-class">.goods_item</span> <span class="selector-class">.goods_info_wrap</span> <span class="selector-class">.goods_name</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: -webkit-box;</span><br><span class="line">  <span class="attribute">overflow</span>: hidden;</span><br><span class="line">  -webkit-box-orient: vertical;</span><br><span class="line">  -webkit-line-clamp: <span class="number">2</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.collect_main</span> <span class="selector-class">.collect_content</span> <span class="selector-class">.goods_item</span> <span class="selector-class">.goods_info_wrap</span> <span class="selector-class">.goods_price</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: <span class="built_in">var</span>(--themeColor);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h6 id="收藏界面js功能"><a href="#收藏界面js功能" class="headerlink" title="收藏界面js功能"></a>收藏界面js功能</h6><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// pages/collect/index.js</span></span><br><span class="line"><span class="title class_">Page</span>(&#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 页面的初始数据</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="attr">data</span>: &#123;</span><br><span class="line">    <span class="attr">collect</span>:[],</span><br><span class="line">    <span class="attr">tabs</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">id</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="attr">value</span>: <span class="string">&quot;商品收藏&quot;</span>,</span><br><span class="line">        <span class="attr">isActive</span>: <span class="literal">true</span></span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">id</span>: <span class="number">1</span>,</span><br><span class="line">        <span class="attr">value</span>: <span class="string">&quot;品牌收藏&quot;</span>,</span><br><span class="line">        <span class="attr">isActive</span>: <span class="literal">false</span></span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">id</span>: <span class="number">2</span>,</span><br><span class="line">        <span class="attr">value</span>: <span class="string">&quot;店铺收藏&quot;</span>,</span><br><span class="line">        <span class="attr">isActive</span>: <span class="literal">false</span></span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">id</span>: <span class="number">3</span>,</span><br><span class="line">        <span class="attr">value</span>: <span class="string">&quot;浏览足迹&quot;</span>,</span><br><span class="line">        <span class="attr">isActive</span>: <span class="literal">false</span></span><br><span class="line">      &#125;</span><br><span class="line">    ],</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="attr">onShow</span>: <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> collect=wx.<span class="title function_">getStorageSync</span>(<span class="string">&quot;collect&quot;</span>)||[];</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">setData</span>(&#123;</span><br><span class="line">      collect</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="title function_">handleTabsItemChange</span>(<span class="params">e</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; index &#125; = e.<span class="property">detail</span>;</span><br><span class="line">    <span class="keyword">let</span> &#123; tabs &#125; = <span class="variable language_">this</span>.<span class="property">data</span>;</span><br><span class="line">    tabs.<span class="title function_">forEach</span>(<span class="function">(<span class="params">v, i</span>) =&gt;</span> i === index ? v.<span class="property">isActive</span> = <span class="literal">true</span> : v.<span class="property">isActive</span> = <span class="literal">false</span>)</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">setData</span>(&#123;</span><br><span class="line">      tabs</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h6 id="页面图-2"><a href="#页面图-2" class="headerlink" title="页面图"></a>页面图</h6><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://i.loli.net/2020/08/24/xfwXRjleIG86uEy.jpg"></p><h5 id="登录"><a href="#登录" class="headerlink" title="登录"></a>登录</h5><h6 id="页面布局-5"><a href="#页面布局-5" class="headerlink" title="页面布局"></a>页面布局</h6><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;primary&quot;</span> <span class="attr">plain</span> <span class="attr">open-type</span>=<span class="string">&quot;getUserInfo&quot;</span> <span class="attr">bindgetuserinfo</span>=<span class="string">&quot;handleGetUserInfo&quot;</span>&gt;</span>登录<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">button</span>&#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">70%</span>;</span><br><span class="line">    <span class="attribute">margin-top</span>: <span class="number">40</span>rpx;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h6 id="js功能实现-6"><a href="#js功能实现-6" class="headerlink" title="js功能实现"></a>js功能实现</h6><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Page</span>(&#123;</span><br><span class="line">  <span class="title function_">handleGetUserInfo</span>(<span class="params">e</span>)&#123;</span><br><span class="line">    <span class="comment">// console.log(e);</span></span><br><span class="line">    <span class="keyword">const</span> &#123;userInfo&#125;=e.<span class="property">detail</span></span><br><span class="line">    wx.<span class="title function_">setStorageSync</span>(<span class="string">&quot;userinfo&quot;</span>, userInfo);</span><br><span class="line">    wx.<span class="title function_">navigateBack</span>(&#123;</span><br><span class="line">      <span class="attr">delta</span>: <span class="number">1</span></span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h5 id="订单"><a href="#订单" class="headerlink" title="订单"></a>订单</h5><h6 id="页面布局-6"><a href="#页面布局-6" class="headerlink" title="页面布局"></a>页面布局</h6><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">Tabs</span> <span class="attr">tabs</span>=<span class="string">&quot;&#123;&#123;tabs&#125;&#125;&quot;</span> <span class="attr">bindtabsItemChange</span>=<span class="string">&quot;handleTabsItemChange&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;order_main&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">view</span></span></span><br><span class="line"><span class="tag">        <span class="attr">wx:for</span>=<span class="string">&quot;&#123;&#123;orders&#125;&#125;&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">wx:key</span>=<span class="string">&quot;order_id&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">class</span>=<span class="string">&quot;order_item&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;order_no_row&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;order_no_text&quot;</span>&gt;</span>订单编号<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;order_no_value&quot;</span>&gt;</span>&#123;&#123;item.order_number&#125;&#125;<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;order_price_row&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;order_price_text&quot;</span>&gt;</span>订单价格<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;order_price_value&quot;</span>&gt;</span>￥&#123;&#123;item.order_price&#125;&#125;<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;order_time_row&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;order_time_text&quot;</span>&gt;</span>订单日期<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;order_time_value&quot;</span>&gt;</span>&#123;&#123;item.create_time_cn&#125;&#125;<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">Tabs</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.order_main</span> <span class="selector-class">.order_item</span> &#123;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">20</span>rpx;</span><br><span class="line">  <span class="attribute">border-bottom</span>: <span class="number">1</span>rpx solid <span class="number">#ccc</span>;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#666</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.order_main</span> <span class="selector-class">.order_item</span> <span class="selector-class">.order_no_row</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">  <span class="attribute">justify-content</span>: space-between;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">10</span>rpx <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.order_main</span> <span class="selector-class">.order_item</span> <span class="selector-class">.order_price_row</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">  <span class="attribute">justify-content</span>: space-between;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">10</span>rpx <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.order_main</span> <span class="selector-class">.order_item</span> <span class="selector-class">.order_price_row</span> <span class="selector-class">.order_price_value</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: <span class="built_in">var</span>(--themeColor);</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">32</span>rpx;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.order_main</span> <span class="selector-class">.order_item</span> <span class="selector-class">.order_time_row</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">  <span class="attribute">justify-content</span>: space-between;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">10</span>rpx <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h6 id="js功能实现-7"><a href="#js功能实现-7" class="headerlink" title="js功能实现"></a>js功能实现</h6><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; request &#125; = <span class="built_in">require</span>(<span class="string">&quot;../../request/index&quot;</span>);</span><br><span class="line"><span class="title class_">Page</span>(&#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 页面的初始数据</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="attr">data</span>: &#123;</span><br><span class="line">    <span class="attr">orders</span>:[],</span><br><span class="line">    <span class="attr">tabs</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">id</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="attr">value</span>: <span class="string">&quot;全部&quot;</span>,</span><br><span class="line">        <span class="attr">isActive</span>: <span class="literal">true</span></span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">id</span>: <span class="number">1</span>,</span><br><span class="line">        <span class="attr">value</span>: <span class="string">&quot;待付款&quot;</span>,</span><br><span class="line">        <span class="attr">isActive</span>: <span class="literal">false</span></span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">id</span>: <span class="number">2</span>,</span><br><span class="line">        <span class="attr">value</span>: <span class="string">&quot;待收货&quot;</span>,</span><br><span class="line">        <span class="attr">isActive</span>: <span class="literal">false</span></span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">id</span>: <span class="number">3</span>,</span><br><span class="line">        <span class="attr">value</span>: <span class="string">&quot;退款/退货&quot;</span>,</span><br><span class="line">        <span class="attr">isActive</span>: <span class="literal">false</span></span><br><span class="line">      &#125;</span><br><span class="line">    ],</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="attr">onShow</span>: <span class="keyword">function</span> (<span class="params">options</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> token=wx.<span class="title function_">getStorageSync</span>(<span class="string">&quot;token&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span>(!token)&#123;</span><br><span class="line">      wx.<span class="title function_">navigateTo</span>(&#123;</span><br><span class="line">        <span class="attr">url</span>: <span class="string">&#x27;/pages/auth/index&#x27;</span>,</span><br><span class="line">      &#125;);</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> pages= <span class="title function_">getCurrentPages</span>();</span><br><span class="line">    <span class="keyword">let</span> currentPage=pages[pages.<span class="property">length</span>-<span class="number">1</span>]</span><br><span class="line">    <span class="keyword">const</span> &#123;type&#125;=currentPage.<span class="property">options</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">changeTitleByIndex</span>(type-<span class="number">1</span>)</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">getOrders</span>(type)</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 获取列表的方法</span></span><br><span class="line">  <span class="title function_">getOrders</span>(<span class="params">type</span>)&#123;</span><br><span class="line">    <span class="title function_">request</span>(&#123;<span class="attr">url</span>:<span class="string">&quot;/my/orders/all&quot;</span>,<span class="attr">data</span>:&#123;type&#125;&#125;)</span><br><span class="line">    .<span class="title function_">then</span>(<span class="function"><span class="params">res</span>=&gt;</span>&#123;</span><br><span class="line">     <span class="variable language_">this</span>.<span class="title function_">setData</span>(&#123;</span><br><span class="line">        <span class="attr">orders</span>:res.<span class="property">orders</span>.<span class="title function_">map</span>(<span class="function"><span class="params">v</span>=&gt;</span>(&#123;...v,<span class="attr">create_time_cn</span>:(<span class="keyword">new</span> <span class="title class_">Date</span>(v.<span class="property">create_time</span>*<span class="number">1000</span>).<span class="title function_">toLocaleString</span>())&#125;)),   </span><br><span class="line">     &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 根据标题索引来激活选中 标题数组</span></span><br><span class="line">  <span class="title function_">changeTitleByIndex</span>(<span class="params">index</span>)&#123;</span><br><span class="line">    <span class="keyword">let</span> &#123; tabs &#125; = <span class="variable language_">this</span>.<span class="property">data</span>;</span><br><span class="line">    tabs.<span class="title function_">forEach</span>(<span class="function">(<span class="params">v, i</span>) =&gt;</span> i === index ? v.<span class="property">isActive</span> = <span class="literal">true</span> : v.<span class="property">isActive</span> = <span class="literal">false</span>)</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">setData</span>(&#123;</span><br><span class="line">      tabs</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="title function_">handleTabsItemChange</span>(<span class="params">e</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; index &#125; = e.<span class="property">detail</span>;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">changeTitleByIndex</span>(index);</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">getOrders</span>(index+<span class="number">1</span>)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h6 id="订单页面图"><a href="#订单页面图" class="headerlink" title="订单页面图"></a>订单页面图</h6><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://i.loli.net/2020/08/24/jztXGn1vHJoF2Nr.jpg"></p><h5 id="反馈"><a href="#反馈" class="headerlink" title="反馈"></a>反馈</h5><h6 id="页面布局-7"><a href="#页面布局-7" class="headerlink" title="页面布局"></a>页面布局</h6><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">Tabs</span> <span class="attr">tabs</span>=<span class="string">&quot;&#123;&#123;tabs&#125;&#125;&quot;</span> <span class="attr">bindtabsItemChange</span>=<span class="string">&quot;handleTabsItemChange&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;fb_main&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;fb_title&quot;</span>&gt;</span>问题的种类<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;fb_tips&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">text</span>&gt;</span>功能建议<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">text</span>&gt;</span>购买遇到问题<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">text</span>&gt;</span>性能问题<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">text</span>&gt;</span>其他<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;fb_content&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">textarea</span> <span class="attr">placeholder</span>=<span class="string">&quot;请描述您的问题&quot;</span> <span class="attr">value</span>=<span class="string">&quot;&#123;&#123;textVal&#125;&#125;&quot;</span> <span class="attr">bindinput</span>=<span class="string">&quot;handleTextInput&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">textarea</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;fb_tool&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">button</span> <span class="attr">bindtap</span>=<span class="string">&quot;handleChooseImg&quot;</span>&gt;</span>+<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">view</span> </span></span><br><span class="line"><span class="tag">                <span class="attr">class</span>=<span class="string">&quot;up_img_item&quot;</span> </span></span><br><span class="line"><span class="tag">                <span class="attr">wx:for</span>=<span class="string">&quot;&#123;&#123;chooseImgs&#125;&#125;&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">wx:key</span>=<span class="string">&quot;*this&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">bindtap</span>=<span class="string">&quot;handleRemoveImg&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">data-index</span>=<span class="string">&quot;&#123;&#123;index&#125;&#125;&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">UpImg</span> <span class="attr">src</span>=<span class="string">&quot;&#123;&#123;item&#125;&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">UpImg</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;form_btn_wrap&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;warn&quot;</span> <span class="attr">bindtap</span>=<span class="string">&quot;handleFormSubmit&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">icon</span> <span class="attr">type</span>=<span class="string">&quot;success_no_circle&quot;</span> <span class="attr">size</span>=<span class="string">&quot;23&quot;</span> <span class="attr">color</span>=<span class="string">&quot;white&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">icon</span>&gt;</span></span><br><span class="line">                提交</span><br><span class="line">            <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">        </span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">Tabs</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line">page &#123;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="number">#eeeeee</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.fb_main</span> &#123;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">20</span>rpx;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#666</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.fb_main</span> <span class="selector-class">.fb_tips</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">  <span class="attribute">flex-wrap</span>: wrap;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.fb_main</span> <span class="selector-class">.fb_tips</span> text &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">30%</span>;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">10</span>rpx;</span><br><span class="line">  <span class="attribute">text-align</span>: center;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="number">#fff</span>;</span><br><span class="line">  <span class="attribute">margin</span>: <span class="number">20</span>rpx <span class="number">10</span>rpx;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.fb_main</span> <span class="selector-class">.fb_content</span> &#123;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="number">#fff</span>;</span><br><span class="line">  <span class="attribute">margin-top</span>: <span class="number">20</span>rpx;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.fb_main</span> <span class="selector-class">.fb_content</span> <span class="selector-tag">textarea</span> &#123;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">10</span>rpx;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.fb_main</span> <span class="selector-class">.fb_content</span> <span class="selector-class">.fb_tool</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">  <span class="attribute">flex-wrap</span>: wrap;</span><br><span class="line">  <span class="attribute">padding-bottom</span>: <span class="number">30</span>rpx;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.fb_main</span> <span class="selector-class">.fb_content</span> <span class="selector-class">.fb_tool</span> <span class="selector-tag">button</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">90</span>rpx;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">90</span>rpx;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">60</span>rpx;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">  <span class="attribute">justify-content</span>: center;</span><br><span class="line">  <span class="attribute">align-items</span>: center;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#ccc</span>;</span><br><span class="line">  <span class="attribute">margin</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">margin-left</span>: <span class="number">20</span>rpx;</span><br><span class="line">  <span class="attribute">margin-top</span>: <span class="number">20</span>rpx;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.fb_main</span> <span class="selector-class">.fb_content</span> <span class="selector-class">.fb_tool</span> <span class="selector-class">.up_img_item</span> &#123;</span><br><span class="line">  <span class="attribute">margin-left</span>: <span class="number">20</span>rpx;</span><br><span class="line">  <span class="attribute">margin-top</span>: <span class="number">20</span>rpx;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.fb_main</span> <span class="selector-class">.form_btn_wrap</span> &#123;</span><br><span class="line">  <span class="attribute">margin-top</span>: <span class="number">20</span>rpx;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">  <span class="attribute">justify-content</span>: flex-end;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.fb_main</span> <span class="selector-class">.form_btn_wrap</span> <span class="selector-tag">button</span> &#123;</span><br><span class="line">  <span class="attribute">margin</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">30%</span>;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">  <span class="attribute">align-items</span>: center;</span><br><span class="line">  <span class="attribute">justify-content</span>: center;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h6 id="js功能实现-8"><a href="#js功能实现-8" class="headerlink" title="js功能实现"></a>js功能实现</h6><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// pages/feedback/index.js</span></span><br><span class="line"><span class="title class_">Page</span>(&#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 页面的初始数据</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="attr">data</span>: &#123;</span><br><span class="line">    <span class="attr">tabs</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">id</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="attr">value</span>: <span class="string">&quot;体验问题&quot;</span>,</span><br><span class="line">        <span class="attr">isActive</span>: <span class="literal">true</span></span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">id</span>: <span class="number">1</span>,</span><br><span class="line">        <span class="attr">value</span>: <span class="string">&quot;商品、商家投诉&quot;</span>,</span><br><span class="line">        <span class="attr">isActive</span>: <span class="literal">false</span></span><br><span class="line">      &#125;</span><br><span class="line">    ],</span><br><span class="line">    <span class="attr">chooseImgs</span>:[],</span><br><span class="line">    <span class="attr">textVal</span>:<span class="string">&quot;&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="title class_">UploadImgs</span>:[],</span><br><span class="line">  <span class="title function_">handleTabsItemChange</span>(<span class="params">e</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; index &#125; = e.<span class="property">detail</span>;</span><br><span class="line">    <span class="keyword">let</span> &#123; tabs &#125; = <span class="variable language_">this</span>.<span class="property">data</span>;</span><br><span class="line">    tabs.<span class="title function_">forEach</span>(<span class="function">(<span class="params">v, i</span>) =&gt;</span> i === index ? v.<span class="property">isActive</span> = <span class="literal">true</span> : v.<span class="property">isActive</span> = <span class="literal">false</span>)</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">setData</span>(&#123;</span><br><span class="line">      tabs</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="title function_">handleChooseImg</span>(<span class="params"></span>)&#123;</span><br><span class="line">    wx.<span class="title function_">chooseImage</span>(&#123;</span><br><span class="line">      <span class="attr">count</span>: <span class="number">9</span>,</span><br><span class="line">      <span class="attr">sizeType</span>: [<span class="string">&#x27;original&#x27;</span>,<span class="string">&#x27;compressed&#x27;</span>],</span><br><span class="line">      <span class="attr">sourceType</span>: [<span class="string">&#x27;album&#x27;</span>,<span class="string">&#x27;camera&#x27;</span>],</span><br><span class="line">      <span class="attr">success</span>: <span class="function">(<span class="params">result</span>)=&gt;</span>&#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">setData</span>(&#123;</span><br><span class="line">          <span class="attr">chooseImgs</span>:[...<span class="variable language_">this</span>.<span class="property">data</span>.<span class="property">chooseImgs</span>,...result.<span class="property">tempFilePaths</span>]</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="title function_">handleRemoveImg</span>(<span class="params">e</span>)&#123;</span><br><span class="line">    <span class="keyword">const</span> &#123;index&#125;=e.<span class="property">currentTarget</span>.<span class="property">dataset</span></span><br><span class="line">    <span class="keyword">let</span> &#123;chooseImgs&#125;=<span class="variable language_">this</span>.<span class="property">data</span></span><br><span class="line">    chooseImgs.<span class="title function_">splice</span>(index,<span class="number">1</span>)</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">setData</span>(&#123;</span><br><span class="line">      chooseImgs</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="title function_">handleTextInput</span>(<span class="params">e</span>)&#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">setData</span>(&#123;</span><br><span class="line">      <span class="attr">textVal</span>:e.<span class="property">detail</span>.<span class="property">value</span></span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="title function_">handleFormSubmit</span>(<span class="params">e</span>)&#123;</span><br><span class="line">    <span class="keyword">const</span> &#123;textVal,chooseImgs&#125;=<span class="variable language_">this</span>.<span class="property">data</span></span><br><span class="line">    <span class="keyword">if</span>(!textVal.<span class="title function_">trim</span>())&#123;</span><br><span class="line">      wx.<span class="title function_">showToast</span>(&#123;</span><br><span class="line">        <span class="attr">title</span>: <span class="string">&#x27;输入不合法&#x27;</span>,</span><br><span class="line">        <span class="attr">icon</span>: <span class="string">&#x27;none&#x27;</span>,</span><br><span class="line">        <span class="attr">mask</span>: <span class="literal">true</span></span><br><span class="line">      &#125;);</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    wx.<span class="title function_">showLoading</span>(&#123;</span><br><span class="line">      <span class="attr">title</span>: <span class="string">&quot;正在上传中&quot;</span>,</span><br><span class="line">      <span class="attr">mask</span>: <span class="literal">true</span></span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">if</span>(chooseImgs.<span class="property">length</span>!=<span class="number">0</span>)&#123;</span><br><span class="line">      chooseImgs.<span class="title function_">forEach</span>(<span class="function">(<span class="params">v,i</span>)=&gt;</span>&#123;</span><br><span class="line">        wx.<span class="title function_">uploadFile</span>(&#123;</span><br><span class="line">          <span class="attr">url</span>: <span class="string">&#x27;https://media.mogu.com/image/scale?appKey=15m&amp;w=500&amp;h=500&amp;quality=100&#x27;</span>,</span><br><span class="line">          <span class="attr">filePath</span>: v,</span><br><span class="line">          <span class="attr">name</span>: <span class="string">&quot;image&quot;</span>,</span><br><span class="line">          <span class="attr">formData</span>: &#123;&#125;,</span><br><span class="line">          <span class="attr">success</span>: <span class="function">(<span class="params">result</span>)=&gt;</span>&#123;</span><br><span class="line">            <span class="keyword">let</span> url=<span class="title class_">JSON</span>.<span class="title function_">parse</span>(result.<span class="property">data</span>).<span class="property">result</span>.<span class="property">url</span></span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">UploadImgs</span>.<span class="title function_">push</span>(url)</span><br><span class="line">            <span class="keyword">if</span>(i===chooseImgs.<span class="property">length</span>-<span class="number">1</span>)&#123;</span><br><span class="line">              wx.<span class="title function_">hideLoading</span>();</span><br><span class="line">              <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;把文本的内容和外网的图片数组 提交到后台中&quot;</span>);</span><br><span class="line">              <span class="variable language_">this</span>.<span class="title function_">setData</span>(&#123;</span><br><span class="line">                <span class="attr">textVal</span>:<span class="string">&quot;&quot;</span>,</span><br><span class="line">                <span class="attr">chooseImgs</span>:[]</span><br><span class="line">              &#125;)</span><br><span class="line">              wx.<span class="title function_">showToast</span>(&#123;</span><br><span class="line">                <span class="attr">title</span>: <span class="string">&#x27;全部上传成功&#x27;</span>,</span><br><span class="line">                <span class="attr">icon</span>: <span class="string">&#x27;none&#x27;</span>,</span><br><span class="line">                <span class="attr">duration</span>: <span class="number">1500</span>,</span><br><span class="line">                <span class="attr">mask</span>: <span class="literal">true</span>,</span><br><span class="line">              &#125;);</span><br><span class="line">              wx.<span class="title function_">navigateBack</span>(&#123;</span><br><span class="line">                <span class="attr">delta</span>: <span class="number">1</span></span><br><span class="line">              &#125;);</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">      wx.<span class="title function_">hideLoading</span>();</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;只是提交了文本&quot;</span>);</span><br><span class="line">      wx.<span class="title function_">navigateBack</span>(&#123;</span><br><span class="line">        <span class="attr">delta</span>: <span class="number">1</span></span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h6 id="反馈页面图"><a href="#反馈页面图" class="headerlink" title="反馈页面图"></a>反馈页面图</h6><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://i.loli.net/2020/08/24/k4b8rYvZThJOB6V.jpg"></p><h5 id="js功能"><a href="#js功能" class="headerlink" title="js功能"></a>js功能</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// pages/user/index.js</span></span><br><span class="line"><span class="title class_">Page</span>(&#123;</span><br><span class="line"></span><br><span class="line">  <span class="attr">data</span>: &#123;</span><br><span class="line">    <span class="attr">userinfo</span>:&#123;&#125;,</span><br><span class="line">    <span class="attr">collectNums</span>:<span class="number">0</span></span><br><span class="line">  &#125;,</span><br><span class="line"> </span><br><span class="line">  <span class="attr">onShow</span>: <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> userinfo=wx.<span class="title function_">getStorageSync</span>(<span class="string">&quot;userinfo&quot;</span>);</span><br><span class="line">    <span class="keyword">const</span> collect=wx.<span class="title function_">getStorageSync</span>(<span class="string">&quot;collect&quot;</span>)||[];</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">setData</span>(&#123;</span><br><span class="line">      userinfo,</span><br><span class="line">      <span class="attr">collectNums</span>:collect.<span class="property">length</span></span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><p>此次微信小程序，大多是和线上视频的老师跟打的。大多数的原理实现以及页面布局还算清楚，可从<strong>6.购物车</strong>开始，特别是支付那一段，的确有些晦涩别扭，是后续复习的注重点。</p><p>笔记于2020&#x2F;8&#x2F;24 20:50完成</p><p>纪念！</p>]]></content>
      
      
      <categories>
          
          <category> 微信小程序 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 微信小程序 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Angular</title>
      <link href="/2020/05/24/Angular/"/>
      <url>/2020/05/24/Angular/</url>
      
        <content type="html"><![CDATA[<h2 id="1-Angular-介绍"><a href="#1-Angular-介绍" class="headerlink" title="1.Angular 介绍"></a>1.Angular 介绍</h2><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/rainlotus97/images/data/2024-01-27/angular-3478c5.png"></p><h3 id="1-1-Angular是什么"><a href="#1-1-Angular是什么" class="headerlink" title="1.1 Angular是什么"></a>1.1 Angular是什么</h3><p>Angular（读音[‘æŋgjʊlə]）是一套用于构建用户界面的 JavaScript 框架。由 Google 开发和维护，主要被用来开发单页面应用程序。</p><ul><li>类似于 <a href="https://cn.vuejs.org/">Vue.js</a><ul><li>MVVM（提供了双向数据绑定）</li><li>组件化</li><li>模块化</li><li>指令</li><li>……</li></ul></li><li>由 Google 开发和维护</li><li>开发单页面应用程序（SPA）</li></ul><h3 id="1-2-特性"><a href="#1-2-特性" class="headerlink" title="1.2 特性"></a>1.2 特性</h3><ul><li>MVVM</li><li>组件化</li><li>模块化</li><li>指令</li><li>服务</li><li>依赖注入(很多概念从后台开发中引入的)</li><li>TypeScript</li><li>…</li></ul><h3 id="1-3-Angular发展历史"><a href="#1-3-Angular发展历史" class="headerlink" title="1.3 Angular发展历史"></a>1.3 Angular发展历史</h3><h4 id="1-3-1-Angular1"><a href="#1-3-1-Angular1" class="headerlink" title="1.3.1 Angular1"></a>1.3.1 Angular1</h4><p>2009年，Misko hevery 和 Adam abrons 在业余时间打造了 <code>GetAngular</code></p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/rainlotus97/images/data/2024-01-27/MiskoInterview-00f825.png"></p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/rainlotus97/images/data/2024-01-27/4529-4deb85.jpg"></p><p>Misko Hevery 接手了 Google 内部的一个项目 <code>Feedback</code> ，该项目经过6个月的迭代代码量已经达到了17000行。项目的开发和维护已经变得非常的困难。所有 Misko 就决定用 <code>GetAngular</code> 重写这个项目。</p><p>结果就是小伙子成功了，使用 <code>GetAngular</code> 之后该项目从17000行缩减到了1500行，前后仅仅使用了三周时间。</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/rainlotus97/images/data/2024-01-27/17000-1500-ada574.png"></p><p>Misko 领导一看，小伙子厉害啊，同时也看到了 <code>GetAngular</code> 所带来的商业价值，所以决定把  <code>GetAngular</code> 正式立项，组织专职团队开发和维护。</p><p>Abrons 后来离开了这个计划，但在 Google 工作的 Hevery 和一些谷歌员工如 Igor Minár 和 Vojta Jína 等则继续开发维护此库。</p><p>由于已不再是个人项目，所以开发团队将 <code>GetAngular</code> 重新命名为了 <code>AngularJS</code> 。</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/rainlotus97/images/data/2024-01-27/AngularJS-large-6c5b64.png"></p><p>至此，AngularJS 就进入了漫长的发展迭代阶段。</p><ul><li>经过了3年的发展，AngularJS 在2012年6月份，<code>1.0.0</code> 版本正式推出。</li><li>AngularJS 在1.2之后的版本不再支持 IE 6和7</li><li>AngularJS 在 1.3 之后不再支持 IE8</li><li>AngularJS 在 1.5 增加了类似组件化的开发方式<ul><li>为过渡到 Angular2 做铺垫</li></ul></li><li>AngularJS <code>1.x.x</code> 已发布到了 <code>1.6.x</code></li></ul><h4 id="1-3-2-Angular1的困境"><a href="#1-3-2-Angular1的困境" class="headerlink" title="1.3.2 Angular1的困境"></a>1.3.2 Angular1的困境</h4><ul><li>饱受诟病的性能问题<ul><li>脏检查 (<a href="https://segmentfault.com/a/1190000010433675">https://segmentfault.com/a/1190000010433675</a>)</li></ul></li><li>落后于当前 Web 发展理念<ul><li>例如组件化</li><li>模块化支持不好</li></ul></li><li>对移动端支持不够友好</li></ul><h4 id="1-3-3-Angular-2-横空出世"><a href="#1-3-3-Angular-2-横空出世" class="headerlink" title="1.3.3 Angular 2 横空出世"></a>1.3.3 Angular 2 横空出世</h4><p><a href="https://angular.io/">https://angular.io/</a></p><p>Angular 1.x 由于问题太多，历史包袱太重，重构几乎不可能。</p><p>不过早在2014年3月，官方博客就有提及开发新版本 Angular 的计划。</p><p>2014年9月下旬一个大会上，<code>Angular2</code> 正式亮相。</p><p>2016年9月15号，<code>Angular2</code> 正式发布。</p><p>由于 ng2 几乎完全重写了 ng1 ，所以官方把2之后的版本都称之为 Angular。</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/rainlotus97/images/data/2024-01-27/Angular-large-0fe0d5.png"></p><p>Angular 2 之后的正式 Logo：</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/rainlotus97/images/data/2024-01-27/angular-02037d.png"></p><p>新版本发布了，那用户如何从 1 升级到 2 呢？</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/rainlotus97/images/data/2024-01-27/ng2-ng1-260e8d.png"></p><p>那到底要不要更新呢？</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/rainlotus97/images/data/2024-01-27/mountain-7dd750.png"></p><h4 id="1-3-4-ng2-相比-ng1"><a href="#1-3-4-ng2-相比-ng1" class="headerlink" title="1.3.4 ng2 相比 ng1"></a>1.3.4 ng2 相比 ng1</h4><ul><li>移除了 controller+$scope 的设计方式，改用了当前主流的组件化构建</li><li>相比 ng1 性能更好(脏检查机制已做优化)</li><li>优先为移动端设计</li><li>更贴合未来标准<ul><li>EcmaScript 6  (TypeScript)</li><li>Web Component</li></ul></li><li>TypeScript</li><li>反正就是更现代化，更好了……</li></ul><h4 id="1-3-5-Angular现状"><a href="#1-3-5-Angular现状" class="headerlink" title="1.3.5 Angular现状"></a>1.3.5 Angular现状</h4><ul><li>自 Angular 2 之后，官方承诺之后的版本都会兼容到 Angular 2</li><li>当前 Angular 最新发布版为 <code>8.x.x</code></li><li>新版的 Angular 在 Github 上也已收获了 3万+ ☆</li><li>使用量低于 React 和 Vue</li></ul><h3 id="1-4-相关链接"><a href="#1-4-相关链接" class="headerlink" title="1.4 相关链接"></a>1.4 相关链接</h3><ul><li><a href="https://zh.wikipedia.org/wiki/Angular">维基百科 - Angular</a></li><li><a href="https://angularjs.org/">AngularJS 1.x.x 官网</a></li><li><a href="https://angular.io/">Angular 官网</a></li><li><a href="https://github.com/angular/angular">Angular Github</a></li><li><a href="https://angular.io/docs">Angular 官方文档</a></li><li><a href="https://angular.io/tutorial">Angular 官方教程</a></li><li><a href="https://angular.io/api">Angular APi文档</a></li></ul><h2 id="2-Angular-cli"><a href="#2-Angular-cli" class="headerlink" title="2.Angular-cli"></a>2.Angular-cli</h2><h3 id="2-1-创建Angular-cli项目"><a href="#2-1-创建Angular-cli项目" class="headerlink" title="2.1 创建Angular-cli项目"></a>2.1 创建Angular-cli项目</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span>环境要求</span><br><span class="line">   <span class="title class_">Node</span> <span class="number">10.9</span><span class="number">.0</span> or higher</span><br><span class="line">   <span class="variable constant_">NPM</span> <span class="number">3</span> or higher</span><br><span class="line">   <span class="title class_">Python2</span><span class="number">.7</span><span class="number">.1</span>                  </span><br><span class="line">   C++ 编译工具</span><br><span class="line">   </span><br><span class="line">   <span class="comment">//Python下载地址</span></span><br><span class="line">   <span class="attr">https</span>:<span class="comment">//www.python.org/downloads/release/python-271/</span></span><br><span class="line">   python --version</span><br><span class="line">   </span><br><span class="line">   <span class="comment">//C++编译工具   windows7/Vista依赖于.NET Framework 4.5.1</span></span><br><span class="line">   <span class="comment">//npm install --global --production windows-build-tools</span></span><br><span class="line">   <span class="comment">//如果安装出错，可以去用户目录下的.windows-build-tools下选择安装文件双击运行</span></span><br><span class="line"></span><br><span class="line"><span class="number">2.</span>安装<span class="title class_">Angular</span>-cli</span><br><span class="line">   npm install -g @angular/cli</span><br><span class="line">   ng help</span><br><span class="line">   ng <span class="keyword">new</span> &lt;项目名称&gt;</span><br><span class="line">   ng serve    <span class="comment">//默认占用 4200 端口号，可以通过下面选项配置</span></span><br><span class="line">   ng serve --port <span class="number">4201</span></span><br></pre></td></tr></table></figure><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/rainlotus97/images/data/2024-01-27/1563331466612-fefc7e.png"></p><h3 id="2-2-Angular-cli项目目录结构"><a href="#2-2-Angular-cli项目目录结构" class="headerlink" title="2.2 Angular-cli项目目录结构"></a>2.2 Angular-cli项目目录结构</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/rainlotus97/images/data/2024-01-27/1563333171751-cd66a0.png"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">├── e2e 端到端测试（暂且不关心）</span><br><span class="line">├── node_modules npm安装的第三方包</span><br><span class="line">├── src 存放业务源码</span><br><span class="line">├── .angular.json            AngularCLI脚手架工具配置文件</span><br><span class="line">├── .editorconfig            针对编辑器的代码风格约束</span><br><span class="line">├── .gitignore                 Git仓库忽略配置项</span><br><span class="line">├── karma.conf.js            测试配置文件（给karma用的，暂且不用关心）</span><br><span class="line">├── package.json            项目包说明文件</span><br><span class="line">├── README.md             项目说明文件</span><br><span class="line">├── tsconfig.json             TypeScript配置文件</span><br><span class="line">└── tslint.json                  TypeScript代码风格校验工具配置文件（类似于 eslint）</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//npm scripts介绍</span></span><br><span class="line">...</span><br><span class="line"><span class="string">&quot;scripts&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;ng&quot;</span>: <span class="string">&quot;ng&quot;</span>, 运行查看 <span class="title class_">Angular</span> <span class="variable constant_">CLI</span> 脚手架工具使用帮助</span><br><span class="line">    <span class="string">&quot;start&quot;</span>: <span class="string">&quot;ng serve&quot;</span>, 运行开发模式</span><br><span class="line">    <span class="string">&quot;build&quot;</span>: <span class="string">&quot;ng build --prod&quot;</span>, 运行项目打包构建（用于发布到生成环境）</span><br><span class="line">    <span class="string">&quot;test&quot;</span>: <span class="string">&quot;ng test&quot;</span>, 运行karma单元测试</span><br><span class="line">    <span class="string">&quot;lint&quot;</span>: <span class="string">&quot;ng lint&quot;</span>, 运行<span class="title class_">TypeScript</span>代码校验</span><br><span class="line">    <span class="string">&quot;e2e&quot;</span>: <span class="string">&quot;ng e2e&quot;</span> 运行protractor端到端测试</span><br><span class="line">  &#125;,</span><br><span class="line">...</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">main.<span class="property">js</span></span><br><span class="line">- 描述：模块化启动入口</span><br><span class="line">- 职责：加载启动根模块</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">AppModule</span></span><br><span class="line">- 描述：项目根模块</span><br><span class="line">- 职责：把组件、服务、路由、指令等组织到一起，设置<span class="title class_">AppComponent</span>为根组件</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">BrowserModule</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@angular/platform-browser&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">NgModule</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@angular/core&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">AppRoutingModule</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;./app-routing.module&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">AppComponent</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;./app.component&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">FooComponent</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;./foo/foo.component&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">LoginComponent</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;./home/login/login.component&#x27;</span>;</span><br><span class="line"></span><br><span class="line">@<span class="title class_">NgModule</span>(&#123;</span><br><span class="line">  <span class="comment">//声明模块资源：组件、指令、服务</span></span><br><span class="line">  <span class="attr">declarations</span>: [</span><br><span class="line">    <span class="title class_">AppComponent</span>,</span><br><span class="line">    <span class="title class_">FooComponent</span>,</span><br><span class="line">    <span class="title class_">LoginComponent</span></span><br><span class="line">  ],</span><br><span class="line">  <span class="comment">//依赖模块</span></span><br><span class="line">  <span class="attr">imports</span>: [</span><br><span class="line">    <span class="title class_">BrowserModule</span>,</span><br><span class="line">    <span class="title class_">AppRoutingModule</span></span><br><span class="line">  ],</span><br><span class="line">  <span class="comment">//指定应用程序的根级别需要使用的service</span></span><br><span class="line">  <span class="attr">providers</span>: [],</span><br><span class="line">  <span class="comment">//指定启动组件</span></span><br><span class="line">  <span class="attr">bootstrap</span>: [<span class="title class_">AppComponent</span>]</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">AppModule</span> &#123; &#125;</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">AppComponent</span></span><br><span class="line">- 描述：项目根组件</span><br><span class="line">- 职责：替换掉 index.<span class="property">html</span> 文件中的 &lt;app-root&gt;&lt;/app-root&gt; 节点</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">app.component.spec.ts      单元测试文件，暂时不用管他</span><br></pre></td></tr></table></figure><h2 id="3-Angular核心语法"><a href="#3-Angular核心语法" class="headerlink" title="3.Angular核心语法"></a>3.Angular核心语法</h2><h3 id="3-1-组件"><a href="#3-1-组件" class="headerlink" title="3.1 组件"></a>3.1 组件</h3><h4 id="3-1-1-组件基本使用"><a href="#3-1-1-组件基本使用" class="headerlink" title="3.1.1 组件基本使用"></a>3.1.1 组件基本使用</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">#<span class="number">1.</span>app.<span class="property">component</span>.<span class="property">ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Component</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@angular/core&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//在Angular中，组件就是一个类</span></span><br><span class="line"><span class="comment">//@Component 组件的装饰器 (组件的元数据)</span></span><br><span class="line"><span class="comment">// selector: 用来定义组件渲染的标签名称(index.html中有一个app-root)  其实就是组件的名称</span></span><br><span class="line"><span class="comment">// templateUrl: 用来指定组件的页面模板</span></span><br><span class="line"><span class="comment">// styleUrls : 一个数组，用来存放组件相关的样式文件</span></span><br><span class="line">@<span class="title class_">Component</span>(&#123;</span><br><span class="line">  <span class="attr">selector</span>: <span class="string">&#x27;app-root&#x27;</span>,</span><br><span class="line">  <span class="attr">templateUrl</span>: <span class="string">&#x27;./app.component.html&#x27;</span>,</span><br><span class="line">  <span class="attr">styleUrls</span>: [<span class="string">&#x27;./app.component.less&#x27;</span>]</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">AppComponent</span> &#123;</span><br><span class="line">  <span class="comment">//这里面用来放组件的数据和方法</span></span><br><span class="line">  title = <span class="string">&#x27;testng2&#x27;</span>;</span><br><span class="line">  count = <span class="number">0</span>;</span><br><span class="line">  increment = <span class="function">()=&gt;</span>&#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">count</span> ++;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#<span class="number">2.</span>app.<span class="property">component</span>.<span class="property">html</span></span><br><span class="line">&lt;h3&gt;&#123;&#123;count&#125;&#125;&lt;/h3&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">button</span> (<span class="attr">click</span>)=<span class="string">&quot;increment()&quot;</span>&gt;</span>点我+1<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br></pre></td></tr></table></figure><h4 id="3-1-2-组件的创建"><a href="#3-1-2-组件的创建" class="headerlink" title="3.1.2 组件的创建"></a>3.1.2 组件的创建</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">创建组件  组件会被创建到app目录下</span></span><br><span class="line">ng generate component foo</span><br><span class="line">ng generate component /home/login</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">app.component.html中使用上面创建的组件</span></span><br><span class="line">&lt;app-foo&gt;&lt;/app-foo&gt;</span><br><span class="line">&lt;app-login&gt;&lt;/app-login&gt;</span><br></pre></td></tr></table></figure><h3 id="3-2-指令与模板语法"><a href="#3-2-指令与模板语法" class="headerlink" title="3.2 指令与模板语法"></a>3.2 指令与模板语法</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">NgClass</span>  作用：添加或移除一组 <span class="variable constant_">CSS</span> 类</span><br><span class="line"></span><br><span class="line"><span class="title class_">NgStyle</span>  作用：添加或移除一组 <span class="variable constant_">CSS</span> 样式</span><br><span class="line"></span><br><span class="line"><span class="title class_">NgModel</span> 作用：双向绑定到 <span class="variable constant_">HTML</span> 表单元素</span><br><span class="line"></span><br><span class="line"><span class="title class_">NgIf</span>  作用：根据条件添加或移除 <span class="variable constant_">DOM</span></span><br><span class="line"></span><br><span class="line"><span class="title class_">NgSwitch</span>  作用：类似于 <span class="title class_">JavaScript</span> 中的 <span class="keyword">switch</span> 语句，根据条件渲染多个选项中的一个。</span><br><span class="line"></span><br><span class="line"><span class="title class_">NgFor</span> 作用：列表渲染</span><br></pre></td></tr></table></figure><h4 id="3-2-1-插值表达式"><a href="#3-2-1-插值表达式" class="headerlink" title="3.2.1 插值表达式"></a>3.2.1 插值表达式</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//&#123;&#123;js表达式&#125;&#125;</span></span><br><span class="line"><span class="comment">//[xx] = &quot;js表达式&quot;     angular中的[]类似于vue中的v-bind</span></span><br><span class="line">&lt;p&gt;<span class="title class_">Message</span>: &#123;&#123; msg &#125;&#125;&lt;/p&gt;</span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">p</span> [<span class="attr">innerHTML</span>]=<span class="string">&quot;msg&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br></pre></td></tr></table></figure><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 写法一 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;&#123;&#123; heroImageUrl &#125;&#125;&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 写法二，推荐 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">img</span> [<span class="attr">src</span>]=<span class="string">&quot;heroImageUrl&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 写法三 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">bind-src</span>=<span class="string">&quot;heroImageUrl&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure><p>在布尔特性的情况下，它们的存在即暗示为 <code>true</code>，属性绑定工作起来略有不同，在这个例子中：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">button</span> [<span class="attr">disabled</span>]=<span class="string">&quot;isButtonDisabled&quot;</span>&gt;</span>Button<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"></span><br><span class="line">如果 isButtonDisabled 的值是 null、undefined 或 false，则 disabled 特性甚至不会被包含在渲染出来的 <span class="tag">&lt;<span class="name">button</span>&gt;</span> 元素中。</span><br></pre></td></tr></table></figure><h4 id="3-2-2-使用-JavaScript-表达式"><a href="#3-2-2-使用-JavaScript-表达式" class="headerlink" title="3.2.2 使用 JavaScript 表达式"></a>3.2.2 使用 JavaScript 表达式</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>1 + 1 = &#123;&#123; 1 + 1 &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;&#123; num + 1 &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;&#123; isDone ? &#x27;完了&#x27; : &#x27;没完&#x27; &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;&#123; title.split(&#x27;&#x27;).reverse().join(&#x27;&#x27;) &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span> [<span class="attr">title</span>]=<span class="string">&quot;title.split(&#x27;&#x27;).reverse().join(&#x27;&#x27;)&quot;</span>&gt;</span>&#123;&#123; title &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></table></figure><p>编写模板表达式所用的语言看起来很像 JavaScript。 很多 JavaScript 表达式也是合法的模板表达式，但不是全部。</p><p>Angular 遵循轻逻辑的设计思路，所以在模板引擎中不能编写非常复杂的 JavaScript 表达式，这里有一些约定：</p><ul><li>赋值 (<code>=</code>, <code>+=</code>, <code>-=</code>, …)</li><li><code>new</code> 运算符</li><li>使用 <code>;</code> 或 <code>,</code> 的链式表达式</li><li>自增或自减操作符 (<code>++</code>和<code>--</code>)</li></ul><h4 id="3-2-3-列表渲染"><a href="#3-2-3-列表渲染" class="headerlink" title="3.2.3 列表渲染"></a>3.2.3 列表渲染</h4><p>基本用法：</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">AppComponent</span> &#123;</span><br><span class="line">  heroes = [<span class="string">&#x27;Windstorm&#x27;</span>, <span class="string">&#x27;Bombasto&#x27;</span>, <span class="string">&#x27;Magneta&#x27;</span>, <span class="string">&#x27;Tornado&#x27;</span>];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>Heroes:<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">li</span> [<span class="attr">id</span>]=<span class="string">&quot;&#x27;list-&#x27; + hero&quot;</span> *<span class="attr">ngFor</span>=<span class="string">&quot;let hero of heroes&quot;</span>&gt;</span></span><br><span class="line">    &#123;&#123; hero &#125;&#125;</span><br><span class="line">  <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br></pre></td></tr></table></figure><p>也可以获取 index 索引：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> *<span class="attr">ngFor</span>=<span class="string">&quot;let hero of heroes; let i=index&quot;</span>&gt;</span>&#123;&#123;i + 1&#125;&#125; - &#123;&#123;hero.name&#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="3-2-4-条件渲染"><a href="#3-2-4-条件渲染" class="headerlink" title="3.2.4 条件渲染"></a>3.2.4 条件渲染</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> *<span class="attr">ngIf</span>=<span class="string">&quot;heroes.length&gt;3; else templateName&quot;</span>&gt;</span>有很多英雄<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">ng-template</span> #<span class="attr">templateName</span>&gt;</span>没有很多英雄<span class="tag">&lt;/<span class="name">ng-template</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="3-2-5-NgSwitch"><a href="#3-2-5-NgSwitch" class="headerlink" title="3.2.5 NgSwitch"></a>3.2.5 NgSwitch</h4><p>NgSwitch 的语法比较啰嗦，使用频率小一些。</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> [<span class="attr">ngSwitch</span>]=<span class="string">&quot;currentHero&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> *<span class="attr">ngSwitchCase</span>=<span class="string">&quot;&#x27;Windstorm&#x27;&quot;</span>&gt;</span>Windstorm<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> *<span class="attr">ngSwitchCase</span>=<span class="string">&quot;&#x27;Bombasto&#x27;&quot;</span>&gt;</span>Bombasto<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> *<span class="attr">ngSwitchCase</span>=<span class="string">&quot;&#x27;Magneta&#x27;&quot;</span>&gt;</span>Magneta<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> *<span class="attr">ngSwitchDefault</span>&gt;</span>Tornado<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="3-2-6-自定义指令"><a href="#3-2-6-自定义指令" class="headerlink" title="3.2.6 自定义指令"></a>3.2.6 自定义指令</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">自定义指令：<span class="attr">https</span>:<span class="comment">//www.angular.cn/guide/attribute-directives</span></span><br><span class="line"></span><br><span class="line">ng generate directive highlight</span><br><span class="line"></span><br><span class="line">#highlight.<span class="property">directive</span>.<span class="property">ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Directive</span>,<span class="title class_">ElementRef</span>  &#125; <span class="keyword">from</span> <span class="string">&#x27;@angular/core&#x27;</span>;</span><br><span class="line"></span><br><span class="line">@<span class="title class_">Directive</span>(&#123;</span><br><span class="line">  <span class="attr">selector</span>: <span class="string">&#x27;[appHighlight]&#x27;</span></span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">HighlightDirective</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">el: ElementRef</span>) &#123;</span><br><span class="line">    el.<span class="property">nativeElement</span>.<span class="property">style</span>.<span class="property">backgroundColor</span> = <span class="string">&#x27;yellow&#x27;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#app.<span class="property">component</span>.<span class="property">html</span></span><br><span class="line">&lt;p appHighlight&gt;<span class="title class_">Highlight</span> me!&lt;/p&gt;</span><br></pre></td></tr></table></figure><h4 id="3-2-7-事件处理"><a href="#3-2-7-事件处理" class="headerlink" title="3.2.7 事件处理"></a>3.2.7 事件处理</h4><p>事件绑定只需要用圆括号把事件名包起来即可：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">button</span> (<span class="attr">click</span>)=<span class="string">&quot;onSave()&quot;</span>&gt;</span>Save<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br></pre></td></tr></table></figure><p>可以把事件对象传递到事件处理函数中：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">button</span> (<span class="attr">click</span>)=<span class="string">&quot;onSave($event)&quot;</span>&gt;</span>On Save<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br></pre></td></tr></table></figure><p>也可以传递额外的参数（取决于你的业务）：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">button</span> (<span class="attr">click</span>)=<span class="string">&quot;onSave($event, 123)&quot;</span>&gt;</span>On Save<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br></pre></td></tr></table></figure><p>当事件处理语句比较简单的时候，我们可以内联事件处理语句：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">button</span> (<span class="attr">click</span>)=<span class="string">&quot;message = &#x27;哈哈哈&#x27;&quot;</span>&gt;</span>内联事件处理<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br></pre></td></tr></table></figure><p>我们可以利用 <strong>属性绑定 + 事件处理</strong> 的方式实现表单文本框双向绑定：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">input</span> [<span class="attr">value</span>]=<span class="string">&quot;message&quot;</span></span></span><br><span class="line"><span class="tag">       (<span class="attr">input</span>)=<span class="string">&quot;message=$event.target.value&quot;</span> &gt;</span></span><br></pre></td></tr></table></figure><p>事件绑定的另一种写法，使用 <code>on-</code> 前缀的方式：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 绑定事件处理函数 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">on-click</span>=<span class="string">&quot;onSave()&quot;</span>&gt;</span>On Save<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="3-2-8-双向绑定"><a href="#3-2-8-双向绑定" class="headerlink" title="3.2.8 双向绑定"></a>3.2.8 双向绑定</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;&#123; message &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> [(<span class="attr">ngModel</span>)]=<span class="string">&quot;message&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure><p>运行之后你会发现报错了，原因是使用 <code>ngModel</code> 必须导入 <code>FormsModule</code> 并把它添加到 Angular 模块的 <code>imports</code> 列表中。</p><p>导入 <code>FormsModule</code> 并让 <code>[(ngModel)]</code> 可用的代码如下：</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">BrowserModule</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@angular/platform-browser&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">NgModule</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@angular/core&#x27;</span>;</span><br><span class="line">+++ <span class="keyword">import</span> &#123; <span class="title class_">FormsModule</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@angular/forms&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">AppComponent</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;./app.component&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@NgModule</span>(&#123;</span><br><span class="line">  <span class="attr">declarations</span>: [</span><br><span class="line">    <span class="title class_">AppComponent</span></span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">imports</span>: [</span><br><span class="line">    <span class="title class_">BrowserModule</span>,</span><br><span class="line">+++ <span class="title class_">FormsModule</span></span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">providers</span>: [],</span><br><span class="line">  <span class="attr">bootstrap</span>: [<span class="title class_">AppComponent</span>]</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">AppModule</span> &#123; &#125;</span><br></pre></td></tr></table></figure><p>通过以上的配置之后，你就可以开心的在 Angular 中使用双向数据绑定了。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//多行文本</span></span><br><span class="line">&lt;textarea cols=<span class="string">&quot;30&quot;</span> rows=<span class="string">&quot;10&quot;</span> [(ngModel)]=<span class="string">&quot;message&quot;</span>&gt;&lt;/textarea&gt;</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//复选框</span></span><br><span class="line">&lt;h3&gt;复选框&lt;/h3&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;checkbox&quot;</span> [(<span class="attr">ngModel</span>)]=<span class="string">&quot;seen&quot;</span>&gt;</span></span></span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//单选按钮</span></span><br><span class="line">&lt;input type=<span class="string">&quot;radio&quot;</span> [value]=<span class="string">&quot;0&quot;</span> [(ngModel)]=<span class="string">&quot;gender&quot;</span>&gt; 男</span><br><span class="line">&lt;input type=<span class="string">&quot;radio&quot;</span> [value]=<span class="string">&quot;1&quot;</span> [(ngModel)]=<span class="string">&quot;gender&quot;</span>&gt; 女</span><br><span class="line">&lt;p&gt;选中了：&#123;&#123; gender &#125;&#125;&lt;/p&gt;</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//下拉列表</span></span><br><span class="line">&lt;select [(ngModel)]=<span class="string">&quot;hobby&quot;</span>&gt;</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">option</span> [<span class="attr">value</span>]=<span class="string">&quot;0&quot;</span>&gt;</span>吃饭<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span></span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">option</span> [<span class="attr">value</span>]=<span class="string">&quot;1&quot;</span>&gt;</span>睡觉<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span></span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">option</span> [<span class="attr">value</span>]=<span class="string">&quot;2&quot;</span>&gt;</span>打豆豆<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span></span><br><span class="line">&lt;/select&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">p</span>&gt;</span>选中的爱好：&#123;&#123; hobby &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br></pre></td></tr></table></figure><h4 id="3-2-9-Class绑定"><a href="#3-2-9-Class绑定" class="headerlink" title="3.2.9 Class绑定"></a>3.2.9 Class绑定</h4><ul><li><a href="https://angular.io/guide/template-syntax#ngClass">https://angular.io/guide/template-syntax#ngClass</a></li></ul><p>a) 普通写法</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//我们也可以通过类绑定或样式绑定来显示或隐藏一个元素。</span></span><br><span class="line"><span class="comment">//  isSpecial = true</span></span><br><span class="line"></span><br><span class="line">&lt;div [<span class="keyword">class</span>.<span class="property">hidden</span>]=<span class="string">&quot;!isSpecial&quot;</span>&gt;<span class="title class_">Show</span> <span class="keyword">with</span> <span class="keyword">class</span>&lt;/div&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">div</span> [<span class="attr">class.hidden</span>]=<span class="string">&quot;isSpecial&quot;</span>&gt;</span>Hide with class<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br></pre></td></tr></table></figure><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 标准class绑定写法 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;bad curly special&quot;</span>&gt;</span>Bad curly special<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--使用bind来添加指定的class  --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;bad curly special&quot;</span></span></span><br><span class="line"><span class="tag">     [<span class="attr">class</span>]=<span class="string">&quot;&#x27;bad&#x27;&quot;</span>&gt;</span>Bad curly<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--通过isSpecial属性来切换special样式 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> [<span class="attr">class.special</span>]=<span class="string">&quot;isSpecial&quot;</span>&gt;</span>The class binding is special<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><p>b) 使用NgClass指令 </p><p><code>NgClass</code> 指令接收一个对象，对象的 <code>key</code> 指定 css 类名，value 给定一个布尔值，当布尔值为真则作用该类名，当布尔值为假则移除给类名。</p><p>语法规则：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> [<span class="attr">ngClass</span>]=<span class="string">&quot;&#123;</span></span></span><br><span class="line"><span class="string"><span class="tag">  css类名: 布尔值,</span></span></span><br><span class="line"><span class="string"><span class="tag">  css类名: 布尔值</span></span></span><br><span class="line"><span class="string"><span class="tag">&#125;&quot;</span>&gt;</span>测试文本<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><p>基本示例：</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.saveable</span>&#123;</span><br><span class="line">    <span class="attribute">font-size</span>: <span class="number">18px</span>;</span><br><span class="line">&#125; </span><br><span class="line"><span class="selector-class">.modified</span> &#123;</span><br><span class="line">    <span class="attribute">font-weight</span>: bold;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.special</span>&#123;</span><br><span class="line">    <span class="attribute">background-color</span>: <span class="number">#ff3300</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">currentClasses = &#123;</span><br><span class="line">    <span class="string">&#x27;special&#x27;</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="string">&#x27;modified&#x27;</span>:<span class="literal">true</span>,</span><br><span class="line">    <span class="string">&#x27;saveable&#x27;</span>:<span class="literal">true</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> [<span class="attr">ngClass</span>]=<span class="string">&quot;&#123;&#x27;special&#x27;:true,&#x27;saveable&#x27;:true&#125;&quot;</span>&gt;</span>This div is initially saveable, unchanged, and special<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> [<span class="attr">ngClass</span>]=<span class="string">&quot;currentClasses&quot;</span>&gt;</span>This div is initially saveable, unchanged, and special<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="3-2-10-Style绑定"><a href="#3-2-10-Style绑定" class="headerlink" title="3.2.10 Style绑定"></a>3.2.10 Style绑定</h4><p>a) 普通写法</p><p>通过<strong>样式绑定</strong>，可以设置内联样式。</p><p>样式绑定的语法与属性绑定类似。 但方括号中的部分不是元素的属性名，而由<strong>style</strong>前缀，一个点 (<code>.</code>)和 CSS 样式的属性名组成。 形如：<code>[style.style-property]</code>。</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">button</span> [<span class="attr">style.color</span>]=<span class="string">&quot;isSpecial ? &#x27;red&#x27;: &#x27;green&#x27;&quot;</span>&gt;</span>Red<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 也可以 backgroundColor --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> [<span class="attr">style.background-color</span>]=<span class="string">&quot;canSave ? &#x27;cyan&#x27;: &#x27;grey&#x27;&quot;</span> &gt;</span>Save<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> [<span class="attr">style.display</span>]=<span class="string">&quot;isSpecial ? &#x27;block&#x27; : &#x27;none&#x27;&quot;</span>&gt;</span>Show with style<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> [<span class="attr">style.display</span>]=<span class="string">&quot;isSpecial ? &#x27;none&#x27;  : &#x27;block&#x27;&quot;</span>&gt;</span>Hide with style<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><p>有些样式绑定中的样式带有单位。在这里，以根据条件用 “em” 和 “%” 来设置字体大小的单位。</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">button</span> [<span class="attr">style.font-size.em</span>]=<span class="string">&quot;isSpecial ? 3 : 1&quot;</span> &gt;</span>Big<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> [<span class="attr">style.font-size.</span>%]=<span class="string">&quot;!isSpecial ? 150 : 50&quot;</span> &gt;</span>Small<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br></pre></td></tr></table></figure><blockquote><p>提示：<em>样式属性</em>命名方法可以用<a href="https://angular.cn/guide/glossary#dash-case">中线命名法</a>，像上面的一样 也可以用<a href="https://angular.cn/guide/glossary#camelcase">驼峰式命名法</a>，如<code>fontSize</code>。</p></blockquote><p>b) 使用NgStyle指令</p><p>虽然这是设置单一样式的好办法，但我们通常更喜欢使用 <a href="https://angular.cn/guide/template-syntax#ngStyle">NgStyle指令</a> 来同时设置多个内联样式。</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"> currentStyles = &#123;</span><br><span class="line">    <span class="string">&#x27;font-style&#x27;</span>: <span class="string">&#x27;italic&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;font-weight&#x27;</span>: <span class="string">&#x27;bold&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;font-size&#x27;</span>: <span class="string">&#x27;24px&#x27;</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> [<span class="attr">ngStyle</span>]=<span class="string">&quot;currentStyles&quot;</span>&gt;</span></span><br><span class="line">  This div is initially italic, normal weight, and extra large (24px).</span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><p>ngStyle 这种方式相当于在代码里面写 CSS 样式，比较丑陋，而且将来不太好修改，非常不建议这样写（足够简单的情况除外）。</p><h4 id="3-2-11-模板引用变量"><a href="#3-2-11-模板引用变量" class="headerlink" title="3.2.11 模板引用变量"></a>3.2.11 模板引用变量</h4><p><strong>模板引用变量</strong>通常用来引用模板中的某个DOM元素，它还可以引用Angular组件或指令或<a href="https://developer.mozilla.org/en-US/docs/Web/Web_Components">Web Component</a>。</p><p>使用井号 (#) 来声明引用变量。 <code>#phone</code>的意思就是声明一个名叫<code>phone</code>的变量来引用<code>&lt;input&gt;</code>元素。</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">input</span> #<span class="attr">phone</span> <span class="attr">placeholder</span>=<span class="string">&quot;phone number&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure><p>我们可以在模板中的任何地方引用模板引用变量。 比如声明在<code>&lt;input&gt;</code>上的<code>phone</code>变量就是在模板另一侧的<code>&lt;button&gt;</code>上使用的。</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">input</span> #<span class="attr">phone</span> <span class="attr">placeholder</span>=<span class="string">&quot;phone number&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- lots of other elements --&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- phone refers to the input element; pass its `value` to an event handler --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> (<span class="attr">click</span>)=<span class="string">&quot;callPhone(phone.value)&quot;</span>&gt;</span>Call<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br></pre></td></tr></table></figure><blockquote><p>大多数情况下，Angular会把模板引用变量的值设置为声明它的那个元素。在上面例子中，<code>phone</code> 引用的是表示<em>电话号码</em>的<code>&lt;input&gt;</code>框。 “拨号”按钮的点击事件处理器把这个<em>input</em>值传给了组件的<code>callPhone</code>方法。 不过，指令也可以修改这种行为，让这个值引用到别处，比如它自身。 <code>NgForm</code>指令就是这么做的。</p></blockquote><p>模板引用变量使用注意：</p><ul><li>模板引用变量的作用范围是<em>整个模板</em>。 不要在同一个模板中多次定义同一个变量名，否则它在运行期间的值是无法确定的。</li><li>如果我在模板里面定义的局部变量和组件内部的属性重名会怎么样呢<ul><li>如果真的出现了重名，Angular 会按照以下优先级来进行处理</li><li><code>模板局部变量 &gt; 指令中的同名变量 &gt; 组件中的同名属性</code></li></ul></li><li>我们也可以用<code>ref-</code>前缀代替<code>#</code>。 下面的例子中就用把<code>fax</code>变量声明成了<code>ref-fax</code>而不是<code>#fax</code>。</li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">ref-fax</span> <span class="attr">placeholder</span>=<span class="string">&quot;fax number&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> (<span class="attr">click</span>)=<span class="string">&quot;callFax(fax.value)&quot;</span>&gt;</span>Fax<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//在js代码中使用模板引用变量</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Component</span>, <span class="title class_">OnInit</span>,<span class="title class_">ViewChild</span>,<span class="title class_">ElementRef</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@angular/core&#x27;</span>;</span><br><span class="line"></span><br><span class="line">@<span class="title class_">Component</span>(&#123;</span><br><span class="line">  <span class="attr">selector</span>: <span class="string">&#x27;app-login&#x27;</span>,</span><br><span class="line">  <span class="attr">templateUrl</span>: <span class="string">&#x27;./login.component.html&#x27;</span>,</span><br><span class="line">  <span class="attr">styleUrls</span>: [<span class="string">&#x27;./login.component.less&#x27;</span>]</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">LoginComponent</span> implements <span class="title class_">OnInit</span> &#123;</span><br><span class="line">  <span class="comment">//ViewChild可以在js代码中获取页面引用的模板</span></span><br><span class="line">  @<span class="title class_">ViewChild</span>(<span class="string">&#x27;phone&#x27;</span>) <span class="attr">phone</span>: <span class="title class_">ElementRef</span>;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"></span>) &#123; </span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  isSpecial = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">  currentClasses = &#123;</span><br><span class="line">    <span class="attr">saveable</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">modified</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">special</span>: <span class="literal">false</span></span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  currentStyles = &#123;</span><br><span class="line">    <span class="string">&#x27;font-style&#x27;</span>: <span class="string">&#x27;italic&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;font-weight&#x27;</span>: <span class="string">&#x27;bold&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;font-size&#x27;</span>: <span class="string">&#x27;24px&#x27;</span></span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  currentTime=<span class="keyword">new</span> <span class="title class_">Date</span>();</span><br><span class="line"></span><br><span class="line">  callPhone = <span class="function">(<span class="params">value</span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="comment">//获取页面模板 phone中的内容</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">phone</span>.<span class="property">nativeElement</span>.<span class="property">value</span>)</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">ngOnInit</span>(): <span class="keyword">void</span> &#123;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="3-2-12-过滤器"><a href="#3-2-12-过滤器" class="headerlink" title="3.2.12 过滤器"></a>3.2.12 过滤器</h4><p>在 Angular 中，过滤器也叫管道。它最重要的作用就是用来格式化数据的输出。</p><p>举个简单例子：</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">currentTime=<span class="keyword">new</span> <span class="title class_">Date</span>();</span><br></pre></td></tr></table></figure><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>&#123;&#123;currentTime | date:&#x27;yyyy-MM-dd HH:mm:ss&#x27;&#125;&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br></pre></td></tr></table></figure><p>Angular 一共内置了一些过滤器：<a href="https://angular.io/api?type=pipe%E3%80%82">https://angular.io/api?type=pipe。</a></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//货币转换 currency</span></span><br><span class="line">&#123;&#123;<span class="number">123</span> | currency &#125;&#125;  <span class="comment">//$123</span></span><br><span class="line">&#123;&#123;<span class="number">123</span> | <span class="attr">currency</span>:<span class="string">&#x27;￥&#x27;</span> &#125;&#125;  <span class="comment">//￥123</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//格式化时间 date</span></span><br><span class="line">&#123;&#123;<span class="keyword">new</span> <span class="title class_">Date</span>() | <span class="attr">date</span>:<span class="string">&#x27;yyyyMMdd&#x27;</span>&#125;&#125;  <span class="comment">//2016/11/02</span></span><br><span class="line">yyyy/yy : <span class="number">2016</span> / <span class="number">16</span>（年）</span><br><span class="line"><span class="variable constant_">MM</span>： <span class="number">11</span>  （月）</span><br><span class="line">dd：<span class="number">02</span> （日）</span><br><span class="line">h/hh : <span class="number">8</span> / <span class="number">08</span> （时）</span><br><span class="line">m/mm : <span class="number">5</span> / <span class="number">05</span> （分）</span><br><span class="line">s /ss : <span class="number">9</span> /<span class="number">09</span>（秒）</span><br><span class="line"><span class="variable constant_">EEEE</span>/<span class="variable constant_">EEE</span> :（星期）</span><br><span class="line"></span><br><span class="line"><span class="comment">//json</span></span><br><span class="line">将<span class="title class_">JavaScript</span>对象转为json字符串</span><br><span class="line">&#123;&#123;&#123;<span class="attr">name</span>:<span class="string">&#x27;jack&#x27;</span>&#125; | json&#125;&#125; <span class="comment">// &#123;&quot;name&quot;:&quot;jack&quot;&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//将字符串数字转为数字 number</span></span><br><span class="line">&#123;&#123;<span class="string">&#x27;123.134545&#x27;</span>| number&#125;&#125; <span class="comment">// 默认保留3位小数</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//uppercase lowercase</span></span><br><span class="line">将英文字母转为大写或小写。</span><br><span class="line">&#123;&#123; <span class="string">&#x27;Hello&#x27;</span> | uppercase  &#125;&#125;  <span class="comment">//HELLO</span></span><br><span class="line">&#123;&#123;<span class="string">&#x27;Hello&#x27;</span> | lowercase&#125;&#125;  <span class="comment">//hello</span></span><br></pre></td></tr></table></figure><p>在复杂业务场景中，内置的过滤器肯定是不够用的，所有 Angular 也支持自定义过滤器。</p><p><a href="https://angular.io/guide/pipes">https://angular.io/guide/pipes</a></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//自定义过滤器</span></span><br><span class="line">ng generate pipe msgformat</span><br><span class="line"></span><br><span class="line"><span class="comment">//msgformat.pipe.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Pipe</span>, <span class="title class_">PipeTransform</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@angular/core&#x27;</span>;</span><br><span class="line"></span><br><span class="line">@<span class="title class_">Pipe</span>(&#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;msgformat&#x27;</span></span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">MsgformatPipe</span> implements <span class="title class_">PipeTransform</span> &#123;</span><br><span class="line">  <span class="title function_">transform</span>(<span class="attr">value</span>: string, ...<span class="attr">args</span>: unknown[]): unknown &#123;</span><br><span class="line">    <span class="keyword">return</span> value.<span class="title function_">split</span>(<span class="string">&#x27;&#x27;</span>).<span class="title function_">reverse</span>().<span class="title function_">join</span>(<span class="string">&#x27;&#x27;</span>);;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//使用</span></span><br><span class="line">&lt;div&gt;&#123;&#123;<span class="string">&quot;123&quot;</span>|msgformat&#125;&#125;&lt;/div&gt;</span><br></pre></td></tr></table></figure><h3 id="3-3-路由"><a href="#3-3-路由" class="headerlink" title="3.3 路由"></a>3.3 路由</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line">#<span class="number">1.</span>app.<span class="property">module</span>.<span class="property">ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">BrowserModule</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@angular/platform-browser&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">NgModule</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@angular/core&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">AppRoutingModule</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;./app-routing.module&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">AppComponent</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;./app.component&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">FooComponent</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;./foo/foo.component&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">LoginComponent</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;./home/login/login.component&#x27;</span>;</span><br><span class="line"><span class="comment">//引入路由模块</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">RouterModule</span>, <span class="title class_">Routes</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@angular/router&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//声明路由</span></span><br><span class="line"><span class="keyword">const</span> <span class="attr">appRoutes</span>: <span class="title class_">Routes</span> = [</span><br><span class="line">  &#123; <span class="attr">path</span>: <span class="string">&#x27;foo&#x27;</span>, <span class="attr">component</span>: <span class="title class_">FooComponent</span> &#125;,</span><br><span class="line">  <span class="comment">//路由路径、组件和路由数据</span></span><br><span class="line">  &#123; <span class="attr">path</span>: <span class="string">&#x27;login/:id&#x27;</span>, <span class="attr">component</span>: <span class="title class_">LoginComponent</span> ,<span class="attr">data</span>: &#123; <span class="attr">title</span>: <span class="string">&#x27;login信息&#x27;</span> &#125;&#125;,</span><br><span class="line">];</span><br><span class="line"></span><br><span class="line">@<span class="title class_">NgModule</span>(&#123;</span><br><span class="line">  <span class="comment">//声明模块资源：组件、指令、服务</span></span><br><span class="line">  <span class="attr">declarations</span>: [</span><br><span class="line">    <span class="title class_">AppComponent</span>,</span><br><span class="line">    <span class="title class_">FooComponent</span>,</span><br><span class="line">    <span class="title class_">LoginComponent</span></span><br><span class="line">  ],</span><br><span class="line">  <span class="comment">//依赖模块</span></span><br><span class="line">  <span class="attr">imports</span>: [</span><br><span class="line">    <span class="title class_">RouterModule</span>.<span class="title function_">forRoot</span>(</span><br><span class="line">      appRoutes</span><br><span class="line">    ),</span><br><span class="line">    <span class="title class_">BrowserModule</span>,</span><br><span class="line">    <span class="title class_">AppRoutingModule</span></span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">providers</span>: [],</span><br><span class="line">  <span class="comment">//指定启动组件</span></span><br><span class="line">  <span class="attr">bootstrap</span>: [<span class="title class_">AppComponent</span>]</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">AppModule</span> &#123; &#125;</span><br><span class="line"></span><br><span class="line">#<span class="number">2.</span>app.<span class="property">component</span>.<span class="property">html</span></span><br><span class="line">&lt;!--routerLinkActive：指定路由被激活的样式</span><br><span class="line">      queryParams：路由传参</span><br><span class="line">    --&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">a</span> <span class="attr">routerLink</span>=<span class="string">&quot;/foo&quot;</span> <span class="attr">routerLinkActive</span>=<span class="string">&quot;active&quot;</span>&gt;</span>来到foo<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">a</span> <span class="attr">routerLink</span>=<span class="string">&quot;/login/5&quot;</span> [<span class="attr">queryParams</span>]=<span class="string">&quot;&#123;name: &#x27;zhangsan&#x27;&#125;&quot;</span> <span class="attr">routerLinkActive</span>=<span class="string">&quot;active&quot;</span>&gt;</span>来到login<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line">&lt;!--这边的router-outlet就类似于vue中的router-view--&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">router-outlet</span>&gt;</span><span class="tag">&lt;/<span class="name">router-outlet</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line">#<span class="number">3.</span>login.<span class="property">component</span>.<span class="property">ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Component</span>, <span class="title class_">OnInit</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@angular/core&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">ActivatedRoute</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@angular/router&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Location</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@angular/common&#x27;</span>;</span><br><span class="line"></span><br><span class="line">@<span class="title class_">Component</span>(&#123;</span><br><span class="line">  <span class="attr">selector</span>: <span class="string">&#x27;app-login&#x27;</span>,</span><br><span class="line">  <span class="attr">templateUrl</span>: <span class="string">&#x27;./login.component.html&#x27;</span>,</span><br><span class="line">  <span class="attr">styleUrls</span>: [<span class="string">&#x27;./login.component.less&#x27;</span>]</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">LoginComponent</span> implements <span class="title class_">OnInit</span> &#123;</span><br><span class="line">  <span class="comment">//声明id</span></span><br><span class="line">  public <span class="attr">id</span>:string;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//将route和location注入到构造函数</span></span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"></span></span><br><span class="line"><span class="params">    private route: ActivatedRoute,</span></span><br><span class="line"><span class="params">    private location: Location</span></span><br><span class="line"><span class="params">  </span>) &#123; &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="title function_">ngOnInit</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">//获取路由中的 参数信息</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">id</span> = <span class="variable language_">this</span>.<span class="property">route</span>.<span class="property">snapshot</span>.<span class="property">paramMap</span>.<span class="title function_">get</span>(<span class="string">&#x27;id&#x27;</span>)</span><br><span class="line">      </span><br><span class="line">    <span class="comment">//获取路由中的data 信息</span></span><br><span class="line">    <span class="comment">//console.log(this.route.snapshot.data.title)</span></span><br><span class="line">      </span><br><span class="line"><span class="comment">//获取路由参数的信息</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">route</span>.<span class="property">snapshot</span>.<span class="property">queryParams</span>)</span><br><span class="line">      </span><br><span class="line">    <span class="comment">//获取当前路径，回退</span></span><br><span class="line">    <span class="comment">//console.log(this.location.path())</span></span><br><span class="line">    <span class="comment">//this.location.back();</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#<span class="number">3.</span>login.<span class="property">components</span>.<span class="property">html</span></span><br><span class="line">&lt;p&gt;login works! &#123;&#123;id&#125;&#125;&lt;/p&gt;</span><br></pre></td></tr></table></figure><h3 id="3-4-Services（服务）"><a href="#3-4-Services（服务）" class="headerlink" title="3.4 Services（服务）"></a>3.4 Services（服务）</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/rainlotus97/images/data/2024-01-27/service-495b35.png"></p><p>服务是一个广义范畴，包括：值、函数或应用所需的功能。</p><p>说白了服务就是针对某个单一或系统功能的封装，例如在 Angular 核心包里面，最典型的一个服务就是 Http 服务。</p><p>几乎任何东西都可以是一个服务。 典型的服务是一个类，具有专注的、明确的用途。它应该做一件特定的事情，并把它做好。</p><p>例如：</p><ul><li>日志服务</li><li>和服务端接口交互的服务</li></ul><p>组件类应保持精简。组件本身不从服务器获得数据、不进行验证输入，也不直接往控制台写日志。 它们把这些任务委托给服务。</p><p>服务仍然是任何 Angular 应用的基础。组件就是最大的服务消费者。</p><p>组件的任务就是提供用户体验，仅此而已。它介于视图（由模板渲染）和应用逻辑（通常包括<em>模型</em>的某些概念）之间。 设计良好的组件为数据绑定提供属性和方法，把其它琐事都委托给服务。</p><p>Angular 不会<em>强制要求</em>我们遵循这些原则。 即使我们花 3000 行代码写了一个“厨房洗碗槽”组件，它也不会抱怨什么。</p><h3 id="3-5-依赖注入（Dependency-injection）"><a href="#3-5-依赖注入（Dependency-injection）" class="headerlink" title="3.5 依赖注入（Dependency injection）"></a>3.5 依赖注入（Dependency injection）</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/rainlotus97/images/data/2024-01-27/dependency-injection-ed5e5a.png"></p><p>“依赖注入”是提供类的新实例的一种方式，还负责处理好类所需的全部依赖。大多数依赖都是服务。 Angular 使用依赖注入来提供新组件以及组件所需的服务。</p><h3 id="3-6-HTTP服务"><a href="#3-6-HTTP服务" class="headerlink" title="3.6 HTTP服务"></a>3.6 HTTP服务</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//app.module.ts:</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> &#123;<span class="title class_">NgModule</span>&#125; <span class="keyword">from</span> <span class="string">&#x27;@angular/core&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;<span class="title class_">BrowserModule</span>&#125; <span class="keyword">from</span> <span class="string">&#x27;@angular/platform-browser&#x27;</span>;</span><br><span class="line"> </span><br><span class="line"><span class="comment">//HttpClientModule</span></span><br><span class="line"><span class="keyword">import</span> &#123;<span class="title class_">HttpClientModule</span>&#125; <span class="keyword">from</span> <span class="string">&#x27;@angular/common/http&#x27;</span>;</span><br><span class="line"> </span><br><span class="line"><span class="meta">@NgModule</span>(&#123;</span><br><span class="line">  <span class="attr">imports</span>: [</span><br><span class="line">    <span class="title class_">BrowserModule</span>,</span><br><span class="line">    <span class="comment">//加入HttpClientModule</span></span><br><span class="line">    <span class="title class_">HttpClientModule</span>,</span><br><span class="line">  ],</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">MyAppModule</span> &#123;&#125;</span><br></pre></td></tr></table></figure><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">HttpClient</span>, <span class="title class_">HttpHeaders</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@angular/common/http&#x27;</span>;</span><br><span class="line"><span class="comment">//发起一个 get 请求</span></span><br><span class="line"><span class="meta">@Component</span>(...)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">MyComponent</span> <span class="keyword">implements</span> <span class="title class_">OnInit</span> &#123;</span><br><span class="line">  <span class="attr">results</span>: <span class="built_in">string</span>[];</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//在构造函数中注入HttpClient</span></span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"><span class="keyword">private</span> http: HttpClient</span>) &#123;&#125;</span><br><span class="line"> </span><br><span class="line">  <span class="title function_">ngOnInit</span>(): <span class="built_in">void</span> &#123;</span><br><span class="line">    <span class="comment">// 发送get请求</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">http</span>.<span class="title function_">get</span>(<span class="string">&#x27;/api/homead&#x27;</span>).<span class="title function_">subscribe</span>(<span class="function"><span class="params">data</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(data)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">//请求错误</span></span><br><span class="line">    <span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Something went wrong!&#x27;</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">#代理设置</span><br><span class="line"><span class="comment">//在项目根目录下创建 proxy.conf.json</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;/api&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;target&quot;</span>: <span class="string">&quot;http://localhost:3001/&quot;</span>,</span><br><span class="line">        <span class="string">&quot;changeOrigin&quot;</span>: <span class="literal">true</span>, </span><br><span class="line">        <span class="string">&quot;logLevel&quot;</span>: <span class="string">&quot;debug&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#修改package.<span class="property">json</span></span><br><span class="line"><span class="string">&quot;start&quot;</span>: <span class="string">&quot;ng serve --proxy-config proxy.conf.json&quot;</span>,</span><br></pre></td></tr></table></figure><h2 id="4-TodoMVC案例"><a href="#4-TodoMVC案例" class="headerlink" title="4.TodoMVC案例"></a>4.TodoMVC案例</h2><h3 id="4-1-下载模板"><a href="#4-1-下载模板" class="headerlink" title="4.1 下载模板"></a>4.1 下载模板</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git clone https://github.com/tastejs/todomvc-app-template.git --depth 1</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">//初始化项目</span><br><span class="line">ng new todomvc-angular</span><br><span class="line">cd todomvc-angular</span><br><span class="line">ng serve</span><br></pre></td></tr></table></figure><p>将 <code>todomvc-angular\src\app\app.component.html</code> 文件内容替换如下：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">section</span> <span class="attr">class</span>=<span class="string">&quot;todoapp&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">header</span> <span class="attr">class</span>=<span class="string">&quot;header&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>todos<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">class</span>=<span class="string">&quot;new-todo&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;What needs to be done?&quot;</span> <span class="attr">autofocus</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">header</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- This section should be hidden by default and shown when there are todos --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">section</span> <span class="attr">class</span>=<span class="string">&quot;main&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">id</span>=<span class="string">&quot;toggle-all&quot;</span> <span class="attr">class</span>=<span class="string">&quot;toggle-all&quot;</span> <span class="attr">type</span>=<span class="string">&quot;checkbox&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;toggle-all&quot;</span>&gt;</span>Mark all as complete<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ul</span> <span class="attr">class</span>=<span class="string">&quot;todo-list&quot;</span>&gt;</span></span><br><span class="line">      <span class="comment">&lt;!-- These are here just to show the structure of the list items --&gt;</span></span><br><span class="line">      <span class="comment">&lt;!-- List items should get the class `editing` when editing and `completed` when marked as completed --&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">&quot;completed&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;view&quot;</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">input</span> <span class="attr">class</span>=<span class="string">&quot;toggle&quot;</span> <span class="attr">type</span>=<span class="string">&quot;checkbox&quot;</span> <span class="attr">checked</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">label</span>&gt;</span>Taste JavaScript<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">&quot;destroy&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">class</span>=<span class="string">&quot;edit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;Create a TodoMVC template&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;view&quot;</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">input</span> <span class="attr">class</span>=<span class="string">&quot;toggle&quot;</span> <span class="attr">type</span>=<span class="string">&quot;checkbox&quot;</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">label</span>&gt;</span>Buy a unicorn<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">&quot;destroy&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">class</span>=<span class="string">&quot;edit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;Rule the web&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">section</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- This footer should hidden by default and shown when there are todos --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">footer</span> <span class="attr">class</span>=<span class="string">&quot;footer&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- This should be `0 items left` by default --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;todo-count&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">strong</span>&gt;</span>0<span class="tag">&lt;/<span class="name">strong</span>&gt;</span> item left<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- Remove this if you don&#x27;t implement routing --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ul</span> <span class="attr">class</span>=<span class="string">&quot;filters&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">&quot;selected&quot;</span> <span class="attr">href</span>=<span class="string">&quot;#/&quot;</span>&gt;</span>All<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#/active&quot;</span>&gt;</span>Active<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#/completed&quot;</span>&gt;</span>Completed<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- Hidden if no completed items are left ↓ --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">&quot;clear-completed&quot;</span>&gt;</span>Clear completed<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">footer</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">section</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">footer</span> <span class="attr">class</span>=<span class="string">&quot;info&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">p</span>&gt;</span>Double-click to edit a todo<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- Remove the below line ↓ --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">p</span>&gt;</span>Template by <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;http://sindresorhus.com&quot;</span>&gt;</span>Sindre Sorhus<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- Change this out with your name and url ↓ --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">p</span>&gt;</span>Created by <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;http://todomvc.com&quot;</span>&gt;</span>you<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">p</span>&gt;</span>Part of <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;http://todomvc.com&quot;</span>&gt;</span>TodoMVC<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">footer</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>安装模板依赖的样式文件：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install todomvc-app-css</span><br></pre></td></tr></table></figure><p>在 <code>todomvc-angular\src\styles.less</code> 文件中导入样式文件：</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* You can add global styles to this file, and also import other style files */</span></span><br><span class="line"><span class="keyword">@import</span> url(<span class="string">&#x27;todomvc-app-css/index.css&#x27;</span>);</span><br></pre></td></tr></table></figure><p>看到如下页面说明成功。</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/rainlotus97/images/data/2024-01-27/1563418624733-44a72f.png"></p><h3 id="4-2-列表数据渲染"><a href="#4-2-列表数据渲染" class="headerlink" title="4.2 列表数据渲染"></a>4.2 列表数据渲染</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/rainlotus97/images/data/2024-01-27/1581060581989-2b79aa.png"></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line">#<span class="number">1.</span>app.<span class="property">components</span>.<span class="property">ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Component</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@angular/core&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> todos = [&#123;</span><br><span class="line">  <span class="attr">id</span>:<span class="number">1</span>,</span><br><span class="line">  <span class="attr">title</span>:<span class="string">&quot;吃饭&quot;</span>,</span><br><span class="line">  <span class="attr">done</span>:<span class="literal">true</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">id</span>:<span class="number">2</span>,</span><br><span class="line">  <span class="attr">title</span>:<span class="string">&quot;睡觉&quot;</span>,</span><br><span class="line">  <span class="attr">done</span>:<span class="literal">false</span></span><br><span class="line">&#125;]</span><br><span class="line"></span><br><span class="line">@<span class="title class_">Component</span>(&#123;</span><br><span class="line">  <span class="attr">selector</span>: <span class="string">&#x27;app-root&#x27;</span>,</span><br><span class="line">  <span class="attr">templateUrl</span>: <span class="string">&#x27;./app.component.html&#x27;</span>,</span><br><span class="line">  <span class="attr">styleUrls</span>: [<span class="string">&#x27;./app.component.less&#x27;</span>]</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">AppComponent</span> &#123;</span><br><span class="line">  <span class="comment">//声明一个todos变量，他是一个对象数组，赋予一个初值</span></span><br><span class="line">  public <span class="attr">todos</span>:&#123;</span><br><span class="line">    <span class="attr">id</span>:number,</span><br><span class="line">    <span class="attr">title</span>:string,</span><br><span class="line">    <span class="attr">done</span>:boolean</span><br><span class="line">  &#125;[]= todos</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#<span class="number">2.</span>app.<span class="property">module</span>.<span class="property">ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">BrowserModule</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@angular/platform-browser&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">NgModule</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@angular/core&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">AppRoutingModule</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;./app-routing.module&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">AppComponent</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;./app.component&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">FormsModule</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@angular/forms&#x27;</span>;</span><br><span class="line"></span><br><span class="line">@<span class="title class_">NgModule</span>(&#123;</span><br><span class="line">  <span class="attr">declarations</span>: [</span><br><span class="line">    <span class="title class_">AppComponent</span></span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">imports</span>: [</span><br><span class="line">    <span class="title class_">BrowserModule</span>,</span><br><span class="line">    <span class="title class_">AppRoutingModule</span>,</span><br><span class="line">    <span class="comment">//引入FormsModule，可以在表单中使用ngModel(双向数据绑定)</span></span><br><span class="line">    <span class="title class_">FormsModule</span>,</span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">providers</span>: [],</span><br><span class="line">  <span class="attr">bootstrap</span>: [<span class="title class_">AppComponent</span>]</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">AppModule</span> &#123; &#125;</span><br><span class="line"></span><br><span class="line">#<span class="number">3.</span>app.<span class="property">component</span>.<span class="property">html</span></span><br><span class="line"> &lt;ul <span class="keyword">class</span>=<span class="string">&quot;todo-list&quot;</span>&gt;</span><br><span class="line">      <span class="language-xml"><span class="tag">&lt;<span class="name">li</span> *<span class="attr">ngFor</span>=<span class="string">&quot;let todo of todos&quot;</span> [<span class="attr">ngClass</span>]=<span class="string">&quot;&#123;completed: todo.done&#125;&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;view&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">input</span> <span class="attr">class</span>=<span class="string">&quot;toggle&quot;</span> <span class="attr">type</span>=<span class="string">&quot;checkbox&quot;</span> [(<span class="attr">ngModel</span>)]=<span class="string">&quot;todo.done&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">label</span>&gt;</span>&#123;&#123; todo.title &#125;&#125;<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">     &lt;!-- </span><br><span class="line">      li 是每一个任务项</span><br><span class="line">      每个任务项有三种状态：</span><br><span class="line">        正常状态 没有样式</span><br><span class="line">        完成状态 completed</span><br><span class="line">        编辑状态 editing</span><br><span class="line">     --&gt; </span><br></pre></td></tr></table></figure><h3 id="4-3-添加任务"><a href="#4-3-添加任务" class="headerlink" title="4.3 添加任务"></a>4.3 添加任务</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">#<span class="number">1.</span>app.<span class="property">component</span>.<span class="property">html</span></span><br><span class="line">    &lt;h1&gt;todos&lt;/h1&gt;</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">input</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">class</span>=<span class="string">&quot;new-todo&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">placeholder</span>=<span class="string">&quot;What needs to be done?&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">autofocus</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      (<span class="attr">keyup.enter</span>)=<span class="string">&quot;addTodo($event)&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      </span></span><br><span class="line"><span class="language-xml">      </span></span><br><span class="line"><span class="language-xml">#2.app.component.ts     </span></span><br><span class="line"><span class="language-xml">export class AppComponent &#123;</span></span><br><span class="line"><span class="language-xml">  //声明一个todos变量，他是一个对象数组，赋予一个初值</span></span><br><span class="line"><span class="language-xml">  public todos: &#123;</span></span><br><span class="line"><span class="language-xml">    id: number,</span></span><br><span class="line"><span class="language-xml">    title: string,</span></span><br><span class="line"><span class="language-xml">    done: boolean</span></span><br><span class="line"><span class="language-xml">  &#125;[] = todos</span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">  //声明一个添加任务的函数，该函数入参一个事件对象，返回值是void</span></span><br><span class="line"><span class="language-xml">  addTodo(e): void &#123;</span></span><br><span class="line"><span class="language-xml">    const titleText = e.target.value</span></span><br><span class="line"><span class="language-xml">    if (!titleText.length) &#123;</span></span><br><span class="line"><span class="language-xml">      return</span></span><br><span class="line"><span class="language-xml">    &#125;</span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">    const last = this.todos[this.todos.length - 1]</span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">    this.todos.push(&#123;</span></span><br><span class="line"><span class="language-xml">      id: last ? last.id + 1 : 1,</span></span><br><span class="line"><span class="language-xml">      title: titleText,</span></span><br><span class="line"><span class="language-xml">      done: false</span></span><br><span class="line"><span class="language-xml">    &#125;)</span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">    // 清除文本框</span></span><br><span class="line"><span class="language-xml">    e.target.value = &#x27;&#x27;</span></span><br><span class="line"><span class="language-xml">  &#125;</span></span><br><span class="line"><span class="language-xml">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="4-4-切换所有任务项"><a href="#4-4-切换所有任务项" class="headerlink" title="4.4 切换所有任务项"></a>4.4 切换所有任务项</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/rainlotus97/images/data/2024-01-27/1581061830879-efbe0b.png"></p><p>思路：切换input控件的checked属性值由任务列表中的任务状态决定，当任务列表中的所有任务都完成，input空间的checked状态为选中状态；反之为没有选中状态</p><p>这边我们通过get、set来完成</p><h4 id="4-4-1-所有任务都完成的情况"><a href="#4-4-1-所有任务都完成的情况" class="headerlink" title="4.4.1 所有任务都完成的情况"></a>4.4.1 所有任务都完成的情况</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">#<span class="number">1.</span>app.<span class="property">component</span>.<span class="property">html</span></span><br><span class="line">&lt;section <span class="keyword">class</span>=<span class="string">&quot;main&quot;</span>&gt;</span><br><span class="line">   <span class="language-xml"><span class="tag">&lt;<span class="name">input</span> <span class="attr">id</span>=<span class="string">&quot;toggle-all&quot;</span> <span class="attr">class</span>=<span class="string">&quot;toggle-all&quot;</span> <span class="attr">type</span>=<span class="string">&quot;checkbox&quot;</span> [<span class="attr">checked</span>]=<span class="string">&quot;toggleAll&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"> </span></span><br><span class="line"><span class="language-xml"> #2.app.component.ts   </span></span><br><span class="line"><span class="language-xml"> //当在外部使用toggleAll属性的时候，调用get方法，当前方法如果todos中所有的任务完成，返回true；如果有任何一个任务没有完成，返回false</span></span><br><span class="line"><span class="language-xml"> get toggleAll () &#123;</span></span><br><span class="line"><span class="language-xml">   return this.todos.every(t =&gt; t.done)</span></span><br><span class="line"><span class="language-xml"> &#125;</span></span><br></pre></td></tr></table></figure><h4 id="4-4-2-点击切换按钮"><a href="#4-4-2-点击切换按钮" class="headerlink" title="4.4.2 点击切换按钮"></a>4.4.2 点击切换按钮</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"> #<span class="number">1.</span>app.<span class="property">component</span>.<span class="property">html</span></span><br><span class="line">&lt;section <span class="keyword">class</span>=<span class="string">&quot;main&quot;</span>&gt;</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">input</span> <span class="attr">id</span>=<span class="string">&quot;toggle-all&quot;</span> <span class="attr">class</span>=<span class="string">&quot;toggle-all&quot;</span> <span class="attr">type</span>=<span class="string">&quot;checkbox&quot;</span> [<span class="attr">checked</span>]=<span class="string">&quot;toggleAll&quot;</span> (<span class="attr">change</span>)=<span class="string">&quot;toggleAll = $event.target.checked&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"> </span></span><br><span class="line"><span class="language-xml"> </span></span><br><span class="line"><span class="language-xml"> #2.app.component.ts   </span></span><br><span class="line"><span class="language-xml"> //当在外部给toggleAll赋值的时候，调用set方法，作用是修改todos中所有任务的状态</span></span><br><span class="line"><span class="language-xml">  set toggleAll (val: boolean) &#123;</span></span><br><span class="line"><span class="language-xml">    this.todos.forEach(t =&gt; t.done = val)</span></span><br><span class="line"><span class="language-xml">  &#125;</span></span><br></pre></td></tr></table></figure><h3 id="4-5-删除任务"><a href="#4-5-删除任务" class="headerlink" title="4.5 删除任务"></a>4.5 删除任务</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/rainlotus97/images/data/2024-01-27/1581062150742-6c6529.png"></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"> #<span class="number">1.</span>app.<span class="property">component</span>.<span class="property">html</span></span><br><span class="line"> &lt;!--<span class="number">1.</span>遍历的时候添加索引i--&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">li</span> *<span class="attr">ngFor</span>=<span class="string">&quot;let todo of todos; let i = index;&quot;</span> [<span class="attr">ngClass</span>]=<span class="string">&quot;&#123;</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">      completed: todo.done</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">    &#125;&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;view&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">input</span> <span class="attr">class</span>=<span class="string">&quot;toggle&quot;</span> <span class="attr">type</span>=<span class="string">&quot;checkbox&quot;</span> [(<span class="attr">ngModel</span>)]=<span class="string">&quot;todo.done&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">label</span>&gt;</span>&#123;&#123; todo.title &#125;&#125;<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="comment">&lt;!--2.添加删除按钮--&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">&quot;destroy&quot;</span> (<span class="attr">click</span>)=<span class="string">&quot;removeTodo(i)&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      </span></span><br><span class="line"><span class="language-xml">#2.app.component.ts       </span></span><br><span class="line"><span class="language-xml">removeTodo (index: number): void &#123;</span></span><br><span class="line"><span class="language-xml">    this.todos.splice(index, 1)</span></span><br><span class="line"><span class="language-xml"> &#125;</span></span><br></pre></td></tr></table></figure><h3 id="4-6-编辑功能"><a href="#4-6-编辑功能" class="headerlink" title="4.6 编辑功能"></a>4.6 编辑功能</h3><h4 id="4-6-1-双击label启用编辑样式"><a href="#4-6-1-双击label启用编辑样式" class="headerlink" title="4.6.1 双击label启用编辑样式"></a>4.6.1 双击label启用编辑样式</h4><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/rainlotus97/images/data/2024-01-27/1581062662377-334cf0.png"></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">  #<span class="number">1.</span>app.<span class="property">component</span>.<span class="property">html</span></span><br><span class="line">  &lt;ul <span class="keyword">class</span>=<span class="string">&quot;todo-list&quot;</span>&gt;</span><br><span class="line">      &lt;!--<span class="number">1.</span>新增一个currentEditing变量用于控制当前li是否添加editing样式--&gt;</span><br><span class="line">      <span class="language-xml"><span class="tag">&lt;<span class="name">li</span> *<span class="attr">ngFor</span>=<span class="string">&quot;let todo of todos; let i = index;&quot;</span> [<span class="attr">ngClass</span>]=<span class="string">&quot;&#123;completed: todo.done, editing: currentEditing === todo&#125;&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;view&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">input</span> <span class="attr">class</span>=<span class="string">&quot;toggle&quot;</span> <span class="attr">type</span>=<span class="string">&quot;checkbox&quot;</span> [(<span class="attr">ngModel</span>)]=<span class="string">&quot;todo.done&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="comment">&lt;!--2.双击当前label，修改currentEditing的值--&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">label</span> (<span class="attr">dblclick</span>)=<span class="string">&quot;currentEditing = todo&quot;</span>&gt;</span>&#123;&#123; todo.title &#125;&#125;<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">&quot;destroy&quot;</span> (<span class="attr">click</span>)=<span class="string">&quot;removeTodo(i)&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="comment">&lt;!--3.添加一个input文本框用于文本编辑，这里需要按下回车键保存，所以不需要使用ngModel---&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">class</span>=<span class="string">&quot;edit&quot;</span> [<span class="attr">value</span>]=<span class="string">&quot;todo.title&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  </span></span><br><span class="line"><span class="language-xml">  </span></span><br><span class="line"><span class="language-xml">#2.app.component.ts    </span></span><br><span class="line"><span class="language-xml">//4.声明currentEditing用来表示当前正在编辑的对象</span></span><br><span class="line"><span class="language-xml">  public currentEditing: &#123;</span></span><br><span class="line"><span class="language-xml">    id: number,</span></span><br><span class="line"><span class="language-xml">    title: string,</span></span><br><span class="line"><span class="language-xml">    done: boolean</span></span><br><span class="line"><span class="language-xml">  &#125; = null</span></span><br></pre></td></tr></table></figure><h4 id="4-6-2-回车键、失去焦点保存编辑、esc取消编辑"><a href="#4-6-2-回车键、失去焦点保存编辑、esc取消编辑" class="headerlink" title="4.6.2 回车键、失去焦点保存编辑、esc取消编辑"></a>4.6.2 回车键、失去焦点保存编辑、esc取消编辑</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"> #<span class="number">1.</span>app.<span class="property">component</span>.<span class="property">html</span></span><br><span class="line">      &lt;input <span class="keyword">class</span>=<span class="string">&quot;edit&quot;</span> [value]=<span class="string">&quot;todo.title&quot;</span> (keyup)=<span class="string">&quot;handleEditKeyUp($event)&quot;</span></span><br><span class="line">      (keyup.<span class="property">enter</span>)=<span class="string">&quot;saveEdit(todo, $event)&quot;</span> (blur)=<span class="string">&quot;saveEdit(todo, $event)&quot;</span>&gt;</span><br><span class="line">          </span><br><span class="line">          </span><br><span class="line">#<span class="number">2.</span>app.<span class="property">component</span>.<span class="property">ts</span></span><br><span class="line">  <span class="title function_">saveEdit</span>(<span class="params">todo, e</span>) &#123;</span><br><span class="line">    <span class="comment">// 保存编辑</span></span><br><span class="line">    todo.<span class="property">title</span> = e.<span class="property">target</span>.<span class="property">value</span></span><br><span class="line">    <span class="comment">// 去除编辑样式</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">currentEditing</span> = <span class="literal">null</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//键盘弹起的时候判断是否按下了回车键</span></span><br><span class="line">  <span class="title function_">handleEditKeyUp</span>(<span class="params">e</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; keyCode, target &#125; = e</span><br><span class="line">    <span class="comment">//esc键  还原最初的文字</span></span><br><span class="line">    <span class="keyword">if</span> (keyCode === <span class="number">27</span>) &#123;</span><br><span class="line">      <span class="comment">// 取消编辑</span></span><br><span class="line">      <span class="comment">// 同时把文本框的值恢复为原来的值</span></span><br><span class="line">      target.<span class="property">value</span> = <span class="variable language_">this</span>.<span class="property">currentEditing</span>.<span class="property">title</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">currentEditing</span> = <span class="literal">null</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><h3 id="4-7-剩余未完成任务数量显示"><a href="#4-7-剩余未完成任务数量显示" class="headerlink" title="4.7 剩余未完成任务数量显示"></a>4.7 剩余未完成任务数量显示</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"> #<span class="number">1.</span>app.<span class="property">component</span>.<span class="property">html</span></span><br><span class="line">&lt;footer <span class="keyword">class</span>=<span class="string">&quot;footer&quot;</span>&gt;</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;todo-count&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">strong</span>&gt;</span>&#123;&#123;remaningCount&#125;&#125;<span class="tag">&lt;/<span class="name">strong</span>&gt;</span> item left<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line">  </span><br><span class="line"> #<span class="number">2.</span>app.<span class="property">component</span>.<span class="property">ts</span>   </span><br><span class="line"> <span class="comment">//剩余未完成任务数量</span></span><br><span class="line">  get remaningCount () &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">todos</span>.<span class="title function_">filter</span>(<span class="function"><span class="params">t</span> =&gt;</span> !t.<span class="property">done</span>).<span class="property">length</span></span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><h3 id="4-8-清除所有已完成任务"><a href="#4-8-清除所有已完成任务" class="headerlink" title="4.8 清除所有已完成任务"></a>4.8 清除所有已完成任务</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">#<span class="number">1.</span>app.<span class="property">component</span>.<span class="property">html</span></span><br><span class="line">  &lt;button</span><br><span class="line">    (click)=<span class="string">&quot;clearAllDone()&quot;</span></span><br><span class="line">    <span class="keyword">class</span>=<span class="string">&quot;clear-completed&quot;</span>&gt;<span class="title class_">Clear</span> completed&lt;/button&gt;</span><br><span class="line">&lt;/footer&gt;  </span><br><span class="line">  </span><br><span class="line">#<span class="number">2.</span>app.<span class="property">component</span>.<span class="property">ts</span> </span><br><span class="line">  <span class="comment">// 清除所有已完成任务项</span></span><br><span class="line">   clearAllDone () &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">todos</span> = <span class="variable language_">this</span>.<span class="property">todos</span>.<span class="title function_">filter</span>(<span class="function"><span class="params">t</span> =&gt;</span> !t.<span class="property">done</span>)</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><h3 id="4-9-任务列表过滤"><a href="#4-9-任务列表过滤" class="headerlink" title="4.9 任务列表过滤"></a>4.9 任务列表过滤</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line">#<span class="number">1.</span>app.<span class="property">component</span>.<span class="property">html</span></span><br><span class="line"> &lt;footer <span class="keyword">class</span>=<span class="string">&quot;footer&quot;</span>&gt;</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;todo-count&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">strong</span>&gt;</span>&#123;&#123;remaningCount&#125;&#125;<span class="tag">&lt;/<span class="name">strong</span>&gt;</span> item left<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line">    &lt;!-- <span class="number">1.</span>点击a标签切换路由 --&gt;</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">ul</span> <span class="attr">class</span>=<span class="string">&quot;filters&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">&quot;selected&quot;</span> <span class="attr">href</span>=<span class="string">&quot;#/&quot;</span>&gt;</span>All<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#/active&quot;</span>&gt;</span>Active<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#/completed&quot;</span>&gt;</span>Completed<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span></span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">#<span class="number">2.</span>app.<span class="property">component</span>.<span class="property">ts</span>     </span><br><span class="line">  <span class="keyword">import</span> &#123; <span class="title class_">Router</span>, <span class="title class_">NavigationStart</span>, <span class="title class_">NavigationEnd</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@angular/router&#x27;</span>;</span><br><span class="line">  <span class="comment">//2.添加一个属性用于控制任务列表的切换</span></span><br><span class="line">  public <span class="attr">visibility</span>: string = <span class="string">&#x27;all&#x27;</span></span><br><span class="line">  <span class="comment">//3.注入路由对象</span></span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"> private router: Router</span>) &#123;&#125;</span><br><span class="line">  <span class="comment">//4.ngOnInit方法中监听路由变化，根据不同的地址修改this.visibility为不同类型</span></span><br><span class="line">  <span class="title function_">ngOnInit</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">router</span>.<span class="property">events</span></span><br><span class="line">    .<span class="title function_">subscribe</span>(<span class="function">(<span class="params">event</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">/* 路由事件类型：</span></span><br><span class="line"><span class="comment">        NavigationStart：导航开始</span></span><br><span class="line"><span class="comment">        NavigationEnd：导航结束</span></span><br><span class="line"><span class="comment">        NavigationCancel：取消导航</span></span><br><span class="line"><span class="comment">        NavigationError：导航出错</span></span><br><span class="line"><span class="comment">        RoutesRecoginzed：路由已认证</span></span><br><span class="line"><span class="comment">      */</span></span><br><span class="line">      <span class="keyword">if</span>(event <span class="keyword">instanceof</span> <span class="title class_">NavigationEnd</span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> hash = <span class="variable language_">window</span>.<span class="property">location</span>.<span class="property">hash</span>.<span class="title function_">substr</span>(<span class="number">1</span>)</span><br><span class="line">        <span class="keyword">switch</span> (hash) &#123;</span><br><span class="line">          <span class="keyword">case</span> <span class="string">&#x27;/&#x27;</span>:</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">visibility</span> = <span class="string">&#x27;all&#x27;</span></span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">          <span class="keyword">case</span> <span class="string">&#x27;/active&#x27;</span>:</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">visibility</span> = <span class="string">&#x27;active&#x27;</span></span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">          <span class="keyword">case</span> <span class="string">&#x27;/completed&#x27;</span>:</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">visibility</span> = <span class="string">&#x27;completed&#x27;</span></span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//5.get方法，当visibility发生变化的时候会触发该方法，在该方法中返回新列表</span></span><br><span class="line">  <span class="keyword">get</span> <span class="title function_">filterTodos</span>() &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">visibility</span> === <span class="string">&#x27;all&#x27;</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">todos</span></span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">visibility</span> === <span class="string">&#x27;active&#x27;</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">todos</span>.<span class="title function_">filter</span>(<span class="function"><span class="params">t</span> =&gt;</span> !t.<span class="property">done</span>)</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">visibility</span> === <span class="string">&#x27;completed&#x27;</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">todos</span>.<span class="title function_">filter</span>(<span class="function"><span class="params">t</span> =&gt;</span> t.<span class="property">done</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">#<span class="number">3.</span>修改app.<span class="property">component</span>.<span class="property">html</span>的ngFor循环的变量</span><br><span class="line">&lt;ul <span class="keyword">class</span>=<span class="string">&quot;todo-list&quot;</span>&gt;</span><br><span class="line">      &lt;!--<span class="number">1.</span>新增一个currentEditing变量用于控制当前li是否添加editing样式--&gt;</span><br><span class="line">      <span class="language-xml"><span class="tag">&lt;<span class="name">li</span> *<span class="attr">ngFor</span>=<span class="string">&quot;let todo of filterTodos; let i = index;&quot;</span></span></span></span><br></pre></td></tr></table></figure><h2 id="5-App开发模式介绍"><a href="#5-App开发模式介绍" class="headerlink" title="5.App开发模式介绍"></a>5.App开发模式介绍</h2><h3 id="5-1-常见的App开发模式"><a href="#5-1-常见的App开发模式" class="headerlink" title="5.1 常见的App开发模式"></a>5.1 常见的App开发模式</h3><ul><li>webApp(H5App)：采用html&#x2F;css&#x2F;js前端技术来实现的一些移动端的网页</li><li>nativeApp：使用 iOS、Android 官方提供的工具、开发平台、配套语言进行手机App开发的方式；</li><li>hybrid：使用前端已有的技术，HTML + CSS + JS ，然后再搭配一些相关的打包编译技术，就能够开发出一个手机App，安装到手机中进行使用。</li></ul><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/rainlotus97/images/data/2024-01-27/1581237370446-b57dd4.png"></p><h3 id="5-2-混合式开发的技术选型"><a href="#5-2-混合式开发的技术选型" class="headerlink" title="5.2 混合式开发的技术选型"></a>5.2 混合式开发的技术选型</h3><ul><li><p>Angular&#x2F;React(Vue) + Ionic4</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">特点：</span><br><span class="line">- 对Angular支持好</span><br><span class="line">- 开发H5App、HybirdApp</span><br><span class="line">- 基于Cordova提供的打包命令打包成iOS、android端程序</span><br><span class="line">- 支持web、iOS、android(HybirdApp应用)</span><br></pre></td></tr></table></figure></li><li><p>h5+</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">特点：</span><br><span class="line">- 提供打包工具将<span class="variable constant_">H5</span>应用打包成<span class="title class_">HybirdApp</span>应用</span><br></pre></td></tr></table></figure></li><li><p>React+React-Native</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">特点：</span><br><span class="line">- 基于<span class="title class_">React</span>语法</span><br><span class="line">- 开发<span class="title class_">NativeApp</span></span><br><span class="line">- 提供编译工具将源代码编译成iOS和android端应用</span><br><span class="line">- 坑多，社区生态多，目前是主流的原生开发技术</span><br><span class="line">- facebook正在重构<span class="title class_">React</span>-<span class="title class_">Native</span></span><br></pre></td></tr></table></figure></li><li><p>Vue+Weex(阿里)</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">- 使用vue作为上层框架</span><br><span class="line">- 开发<span class="title class_">WebApp</span>、<span class="title class_">NativeApp</span></span><br><span class="line">- 使用<span class="title class_">Weex</span>提供的打包工具打包成iOS、android端程序</span><br><span class="line">- 支持web、iOS、<span class="title function_">android</span>(<span class="title class_">NativeApp</span>应用)</span><br><span class="line">- 更新慢、坑多、社区不活跃</span><br></pre></td></tr></table></figure></li><li><p>flutter(谷歌)</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">特点：</span><br><span class="line">- 基于dart语言（不是JavaScript）</span><br><span class="line">- 框架较新，坑多</span><br><span class="line">- 开发NativeApp</span><br><span class="line">- 没有使用iOS和android的原生组件，使用的是自己定义的Widgets(小控件)</span><br></pre></td></tr></table></figure></li><li><p>React+Taro(京东)</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">特点：</span><br><span class="line">- 基于React语法</span><br><span class="line">- 一套源码，多端支持（微信/百度/支付宝/头条/QQ小程序、H5App、React Native）</span><br><span class="line">- 提供编译工具将源代码分别编译成各种小程序、H5、RN</span><br><span class="line">- 坑多、框架新、更新维护快、官方微信群活跃</span><br><span class="line">- 一般可以用来写各种小程序，只支持Taro自己提供的UI库，不支持第三方UI库(小程序的库肯定不能用在React Native)</span><br></pre></td></tr></table></figure></li><li><p>vue + uni-app</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">特点：</span><br><span class="line">- 基于Vue语法</span><br><span class="line">- 一套源码，多端支持(微信/百度/支付宝/头条/QQ小程序、H5App、NativeApp)</span><br><span class="line">- 提供编译工具将源代码分别编译成各种小程序、H5、NativeApp</span><br><span class="line">- App端使用H5+规范，H5+规范包括了html5plus、Native.js、weex</span><br><span class="line">- 国内有一定量的开发者，坑多，社区不够强大</span><br><span class="line">- 可以用来写各种小程序和H5App</span><br></pre></td></tr></table></figure></li></ul><h3 id="5-3-开发技术选型的区别"><a href="#5-3-开发技术选型的区别" class="headerlink" title="5.3 开发技术选型的区别"></a>5.3 开发技术选型的区别</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/rainlotus97/images/data/2024-01-27/aa-d899c9.png"></p><h2 id="6-Ionic"><a href="#6-Ionic" class="headerlink" title="6.Ionic"></a>6.Ionic</h2><h3 id="6-1-Ionic介绍"><a href="#6-1-Ionic介绍" class="headerlink" title="6.1 Ionic介绍"></a>6.1 Ionic介绍</h3><p><a href="https://ionicframework.com/docs/api/alert">https://ionicframework.com/docs/api/alert</a></p><p>Ionic是一个开源的移动应用程序开发框架，它可以轻松地使用web技术构建高质量的跨平台的移动应用。可以让我们快速开发移动App、移动端WEB页面、微信公众平台应用，混合app web页面。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Ionic</span> = <span class="title class_">Cordova</span> + <span class="title class_">AngularJS</span> + <span class="title class_">Ionic</span> <span class="variable constant_">UI</span></span><br><span class="line"></span><br><span class="line">- <span class="title class_">Cordova</span>：提供了使用 <span class="title class_">JavaScript</span> 调用 <span class="title class_">Native</span> 功能，提供一些打包命令</span><br><span class="line">- <span class="title class_">AngularJS</span>：<span class="title class_">Ionic4</span>之前和<span class="title class_">Angular</span>的耦合度非常高，所有的组件都是用<span class="title class_">Angular</span>来写的，<span class="title class_">Ionic4</span>开始构建了一套独立的web组件，但是我们仍然可以通过@ionic/angular包与<span class="title class_">Angular</span>深度集成</span><br><span class="line">- <span class="title class_">Ionic</span> <span class="variable constant_">UI</span>：<span class="title class_">Ionic</span> <span class="variable constant_">UI</span>提供了丰富的移动端<span class="variable constant_">UI</span>组件</span><br></pre></td></tr></table></figure><h3 id="6-2-Ionic的特点"><a href="#6-2-Ionic的特点" class="headerlink" title="6.2 Ionic的特点"></a>6.2 Ionic的特点</h3><p><strong>跨平台</strong>：构建和部署跨多个平台的应用程序，例如本机iOS，Android，移动Web应用。所有这些都具有一个代码库，写一次，到处运行。</p><p><strong>基于Web标准</strong>：Ionic4中所有的组件都是Web Components，可作为独立的Web组件库，集成了最新的JavaScript框架，如Angular、React、Vue。(对Vue 的支持尚处于 alpha 状态)</p><p><a href="https://www.jianshu.com/p/1fec065bb359">https://www.jianshu.com/p/1fec065bb359</a></p><p><strong>精美的设计</strong>：干净，简单，功能齐全。</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/rainlotus97/images/data/2024-01-27/1581127808417-0e4003.png"></p><p><strong>Ionic CLI</strong>：是一种快速支撑Ionic应用程序并为Ionic开发人员提供许多有用命令的工具</p><h3 id="6-3-Ionic基本使用"><a href="#6-3-Ionic基本使用" class="headerlink" title="6.3 Ionic基本使用"></a>6.3 Ionic基本使用</h3><h4 id="6-3-1-配置本地环境"><a href="#6-3-1-配置本地环境" class="headerlink" title="6.3.1 配置本地环境"></a>6.3.1 配置本地环境</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//1.确保本地安装了node环境(建议使用最新稳定版)、安装Java JDK</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//2.将资料中android文件夹解压到c盘目录下</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//3.将gradle-5.6.1.zip解压到c盘目录下</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//4.配置JAVA_HOME    ANDROID_HOME   GRADLE_HOME    Path环境变量</span></span><br><span class="line"><span class="variable constant_">JAVA_HOME</span>                <span class="attr">C</span>:\<span class="title class_">Program</span> <span class="title class_">Files</span>\<span class="title class_">Java</span>\jdk1<span class="number">.8</span><span class="number">.0_92</span></span><br><span class="line"><span class="variable constant_">ANDROID_HOME</span>        <span class="attr">C</span>:\android</span><br><span class="line"><span class="variable constant_">GRADLE_HOME</span>           <span class="attr">C</span>:\gradle-<span class="number">5.6</span><span class="number">.1</span>\bin</span><br><span class="line"><span class="title class_">Path</span>                             %<span class="variable constant_">JAVA_HOME</span>%\bin;%<span class="variable constant_">JAVA_HOME</span>%\lib\tools.<span class="property">jar</span>;%<span class="variable constant_">ANDROID_HOME</span>%\tools;%<span class="variable constant_">ANDROID_HOME</span>%\platform-tools;%<span class="variable constant_">GRADLE_HOME</span>%</span><br><span class="line"></span><br><span class="line"><span class="comment">//5.安装夜神模拟器</span></span><br><span class="line">- <span class="number">5.1</span> 将<span class="attr">C</span>:\android\platform-tools\adb.<span class="property">exe</span>拷贝一份，替换掉雷电模拟器中的adb.<span class="property">exe</span></span><br><span class="line">- <span class="number">5.2</span> 打开雷电模拟器</span><br><span class="line">- <span class="number">5.3</span> 使用adb命令连接模拟器</span><br><span class="line">adb connect <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">5555</span>   /  adb disconnect <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">5555</span></span><br><span class="line">-<span class="number">5.4</span> 查看连接到电脑上的设备列表</span><br><span class="line">adb devices</span><br></pre></td></tr></table></figure><h4 id="6-3-2-安装cordova和-ionic-cli，创建一个项目"><a href="#6-3-2-安装cordova和-ionic-cli，创建一个项目" class="headerlink" title="6.3.2 安装cordova和@ionic&#x2F;cli，创建一个项目"></a>6.3.2 安装cordova和@ionic&#x2F;cli，创建一个项目</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//1.安装cordova和@ionic/cli</span></span><br><span class="line">    npm install -g cordova@<span class="number">9.0</span><span class="number">.0</span> @ionic/cli@<span class="number">6.1</span><span class="number">.0</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//2.使用Ionic命令创建项目</span></span><br><span class="line">    ionic start myAppName tabs  </span><br><span class="line">    <span class="comment">//ionic start myAppName blank</span></span><br><span class="line">    <span class="comment">//ionic start myAppName sidemenu</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//这边可能会包网络错误，解决方案：</span></span><br><span class="line">      - 翻墙（可能解决不了） </span><br><span class="line">      - 开启手机热点，然后电脑连接手机热点的wifi，再次创建(正常可以解决)</span><br><span class="line">      - 如果以上两个方案都解决不了那么就找个已经创建好的ionic项目</span><br><span class="line"></span><br><span class="line"><span class="comment">//3.运行项目:</span></span><br><span class="line">$ cd myApp</span><br><span class="line">$ ionic serve</span><br><span class="line"></span><br><span class="line"><span class="comment">//4.打包成单页面项目运行在微信/web浏览器:</span></span><br><span class="line">$ ionic build browser</span><br><span class="line">$ ionic build browser --prod  <span class="comment">//发布环境的</span></span><br></pre></td></tr></table></figure><h4 id="6-3-3-打包混合App"><a href="#6-3-3-打包混合App" class="headerlink" title="6.3.3 打包混合App"></a>6.3.3 打包混合App</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">注意点：</span><br><span class="line"><span class="number">1.</span>全局安装的cordova版本号需要是<span class="number">9.0</span><span class="number">.0</span>，因为我们所配置android sdk版本号是<span class="number">28</span></span><br><span class="line"><span class="number">2.</span>项目必须是在非中文的路径下</span><br><span class="line"><span class="number">3.</span>在敲 ionic cordova platform add android 命令的时候需要翻墙</span><br><span class="line"><span class="number">4.</span>在using cordova-fetch <span class="keyword">for</span> cordova-android@^<span class="number">8.0</span><span class="number">.0</span>后续的下载过程中又不需要翻墙</span><br><span class="line"></span><br><span class="line">$  ionic cordova platform add android  </span><br><span class="line">报错：不能安装cordova-common模块，解决方案就是 npm install cordova-common</span><br><span class="line">$  ionic cordova build android </span><br><span class="line">报错：找不到properties-parser模块，解决方案就是 npm install properties-parser</span><br><span class="line">报错：找不到shelljs模块，解决方案就是 npm install shelljs</span><br><span class="line">报错：找不到nopt模块，解决方案就是 npm install nopt</span><br><span class="line">报错：找不到compare-func模块，解决方案就是 npm install compare-func</span><br><span class="line"></span><br><span class="line"><span class="comment">//连接夜神模拟器调试(需要先打开夜神模拟器、然后连接调试)</span></span><br><span class="line">$  ionic cordova run android   </span><br><span class="line"></span><br><span class="line"><span class="comment">//Ionic 5 ERR_AVD_HOME_NOT_FOUND: No valid Android AVD home found. </span></span><br><span class="line"><span class="comment">//https://stackoom.com/question/3vSIG/Ionic-ERR-AVD-HOME-NOT-FOUND-%E6%89%BE%E4%B8%8D%E5%88%B0%E6%9C%89%E6%95%88%E7%9A%84Android-AVD%E4%B8%BB%E7%9B%AE%E5%BD%95-%E5%9C%A8Windows-%E4%B8%AD</span></span><br><span class="line">本机运行找不到<span class="variable constant_">AVD</span> <span class="variable constant_">HOME</span>，只需在下创建一个新目录 <span class="attr">C</span>:<span class="regexp">/users/m</span>azg/.<span class="property">android</span>/avd</span><br><span class="line">如果这样不起作用，请将其添加到$ <span class="variable constant_">PATH</span>变量中。</span><br></pre></td></tr></table></figure><h3 id="6-4-Ionic项目目录结构介绍"><a href="#6-4-Ionic项目目录结构介绍" class="headerlink" title="6.4 Ionic项目目录结构介绍"></a>6.4 Ionic项目目录结构介绍</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">-e2e：端对端测试文件</span><br><span class="line">-node_modules：项目所需要的依赖包</span><br><span class="line">-resources：<span class="title class_">Android</span> / iOS 资源 （更换图标和启动动画）</span><br><span class="line">-src：开发工作目录，页面、样式、脚本和图片都放在这个目录下</span><br><span class="line">    - app：应用根目录（组件、页面、服务、模块）</span><br><span class="line">    - assets：资源目录（静态文件，图片，js框架...）</span><br><span class="line">    - theme：主题文件，里面有一个scss文件，设置主题信息</span><br><span class="line">    - <span class="variable language_">global</span>.<span class="property">scss</span>：全局 css 文件</span><br><span class="line">    - index.<span class="property">html</span>：index 入口文件</span><br><span class="line">    - main.<span class="property">ts</span>：主入口文件</span><br><span class="line">    - karma.<span class="property">conf</span>.<span class="property">js</span> / test.<span class="property">js</span>：测试相关的配置文件</span><br><span class="line">    - polyfills.<span class="property">ts</span>：这个文件包含 <span class="title class_">Angular</span> 需要的填充，并在应用程序之前加载</span><br><span class="line">-www：静态文件，ionic build --prod 生成的单页面静态资源文件</span><br><span class="line">-platforms：生成 <span class="title class_">Android</span> 或者 iOS 安装包需要的资源（cordova platform add <span class="title class_">Android</span>后会生成）</span><br><span class="line">-plugins：插件文件夹，里面放置各种cordova安装的插件</span><br><span class="line">-config.<span class="property">xml</span>：打包成 app 的配置文件</span><br><span class="line">-package.<span class="property">json</span>：配置项目的元数据和管理项目所需要的依赖</span><br><span class="line">-ionic.<span class="property">config</span>.<span class="property">json</span>：ionic配置文件</span><br><span class="line">-angular.<span class="property">json</span>：angular配置文件</span><br><span class="line">-tsconfig.<span class="property">json</span>：<span class="title class_">TypeScript</span> 项目的根目录，指定用来编译这个项目的问根文件和编译选项</span><br><span class="line">-tslint.<span class="property">json</span>：格式化和校验 typescript</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"># app.<span class="property">module</span>.<span class="property">ts</span>   <span class="comment">/*这个文件是Ionic 根模块，告诉 Ionic 如何组装应用*/</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">//angular 核心</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">NgModule</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@angular/core&#x27;</span>;</span><br><span class="line"><span class="comment">//BrowserModule，浏览器解析的模块</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">BrowserModule</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@angular/platform-browser&#x27;</span>;</span><br><span class="line"><span class="comment">//路由</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">RouteReuseStrategy</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@angular/router&#x27;</span>;</span><br><span class="line"><span class="comment">//ionic 核心模块</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">IonicModule</span>, <span class="title class_">IonicRouteStrategy</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@ionic/angular&#x27;</span>;</span><br><span class="line"><span class="comment">//启动画面插件相关服务</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">SplashScreen</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@ionic-native/splash-screen/ngx&#x27;</span>;</span><br><span class="line"><span class="comment">//导航条插件相关服务</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">StatusBar</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@ionic-native/status-bar/ngx&#x27;</span>;</span><br><span class="line"><span class="comment">//路由模块</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">AppRoutingModule</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;./app-routing.module&#x27;</span>;</span><br><span class="line"><span class="comment">//根模块</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">AppComponent</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;./app.component&#x27;</span>;</span><br><span class="line"> </span><br><span class="line">@<span class="title class_">NgModule</span>(&#123;</span><br><span class="line">  <span class="attr">declarations</span>: [<span class="title class_">AppComponent</span>],<span class="comment">//配置当前项目运行的组件</span></span><br><span class="line">  <span class="attr">entryComponents</span>: [],</span><br><span class="line">  <span class="attr">imports</span>: [<span class="title class_">BrowserModule</span>, <span class="title class_">IonicModule</span>.<span class="title function_">forRoot</span>(), <span class="title class_">AppRoutingModule</span>],<span class="comment">//配置当前模块运行依赖的其他模块</span></span><br><span class="line">  <span class="attr">providers</span>: [<span class="comment">//配置项目所需要的服务</span></span><br><span class="line">    <span class="title class_">StatusBar</span>,</span><br><span class="line">    <span class="title class_">SplashScreen</span>,</span><br><span class="line">    &#123; <span class="attr">provide</span>: <span class="title class_">RouteReuseStrategy</span>, <span class="attr">useClass</span>: <span class="title class_">IonicRouteStrategy</span> &#125;</span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">bootstrap</span>: [<span class="title class_">AppComponent</span>]   <span class="comment">//指定应用的主视图（称为根组件）通过引导根 AppModule来启动应用，这里一般写的是根组件</span></span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">AppModule</span> &#123;&#125;</span><br></pre></td></tr></table></figure><h3 id="6-5-配置新的路由页面"><a href="#6-5-配置新的路由页面" class="headerlink" title="6.5 配置新的路由页面"></a>6.5 配置新的路由页面</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ionic g page views/detail</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//在tab1中跳转</span></span><br><span class="line"></span><br><span class="line">&lt;ion-content&gt;</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">ion-button</span> [<span class="attr">routerLink</span>]=<span class="string">&quot;[&#x27;/detail&#x27;]&quot;</span> <span class="attr">routerLinkActive</span>=<span class="string">&quot;router-link-active&quot;</span> &gt;</span></span></span><br><span class="line"><span class="language-xml">      跳转detail</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">ion-button</span>&gt;</span></span></span><br><span class="line">&lt;/ion-content&gt;</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//detail页面中跳回前一个页面</span></span><br><span class="line"></span><br><span class="line">&lt;ion-header&gt;</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">ion-toolbar</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">   //++</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">ion-buttons</span> <span class="attr">slot</span>=<span class="string">&quot;start&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">ion-back-button</span>&gt;</span><span class="tag">&lt;/<span class="name">ion-back-button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">ion-buttons</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    //+</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">ion-title</span>&gt;</span>detail<span class="tag">&lt;/<span class="name">ion-title</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">ion-toolbar</span>&gt;</span></span></span><br><span class="line">&lt;/ion-header&gt;</span><br></pre></td></tr></table></figure><h3 id="6-6-新增底部导航"><a href="#6-6-新增底部导航" class="headerlink" title="6.6 新增底部导航"></a>6.6 新增底部导航</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 新增模块</span></span><br><span class="line">ionic g page tab4</span><br><span class="line"></span><br><span class="line"><span class="comment">//删除app-routing.module.ts中自动配的tab4的路由</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//tabs-routing.module.ts中新增路由</span></span><br><span class="line">&#123;</span><br><span class="line">        <span class="attr">path</span>: <span class="string">&#x27;tab4&#x27;</span>,</span><br><span class="line">        <span class="attr">children</span>: [</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">path</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">            <span class="attr">loadChildren</span>: <span class="function">() =&gt;</span></span><br><span class="line">              <span class="keyword">import</span>(<span class="string">&#x27;../tab4/tab4.module&#x27;</span>).<span class="title function_">then</span>(<span class="function"><span class="params">m</span> =&gt;</span> m.<span class="property">Tab4PageModule</span>)</span><br><span class="line">          &#125;</span><br><span class="line">        ]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//tabs.page.html中配置</span></span><br><span class="line"><span class="comment">//++ 新添加导航</span></span><br><span class="line">&lt;ion-tab-button tab=<span class="string">&quot;tab4&quot;</span>&gt;</span><br><span class="line">      <span class="language-xml"><span class="tag">&lt;<span class="name">ion-icon</span> <span class="attr">name</span>=<span class="string">&quot;logo-octocat&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">ion-icon</span>&gt;</span></span></span><br><span class="line">      <span class="language-xml"><span class="tag">&lt;<span class="name">ion-label</span>&gt;</span>Tab Four<span class="tag">&lt;/<span class="name">ion-label</span>&gt;</span></span></span><br><span class="line">&lt;/ion-tab-button&gt;</span><br></pre></td></tr></table></figure><h3 id="6-7-Ionic组件的使用"><a href="#6-7-Ionic组件的使用" class="headerlink" title="6.7 Ionic组件的使用"></a>6.7 Ionic组件的使用</h3><h4 id="6-7-1-alert组件"><a href="#6-7-1-alert组件" class="headerlink" title="6.7.1 alert组件"></a>6.7.1 alert组件</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"># tab2.<span class="property">page</span>.<span class="property">html</span></span><br><span class="line">&lt;ion-content&gt;</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">ion-button</span> <span class="attr">color</span>=<span class="string">&quot;primary&quot;</span> (<span class="attr">click</span>)=<span class="string">&quot;presentAlert()&quot;</span>&gt;</span>Primary<span class="tag">&lt;/<span class="name">ion-button</span>&gt;</span></span></span><br><span class="line">&lt;/ion-content&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># tab2.<span class="property">page</span>.<span class="property">ts</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">Tab2Page</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">public alertController: AlertController</span>) &#123;&#125;</span><br><span class="line">  <span class="keyword">async</span> <span class="title function_">presentAlert</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> alert = <span class="keyword">await</span> <span class="variable language_">this</span>.<span class="property">alertController</span>.<span class="title function_">create</span>(&#123;</span><br><span class="line">      <span class="attr">header</span>: <span class="string">&#x27;Alert&#x27;</span>,</span><br><span class="line">      <span class="attr">subHeader</span>: <span class="string">&#x27;Subtitle&#x27;</span>,</span><br><span class="line">      <span class="attr">message</span>: <span class="string">&#x27;This is an alert message.&#x27;</span>,</span><br><span class="line">      <span class="attr">buttons</span>: [<span class="string">&#x27;OK&#x27;</span>]</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">await</span> alert.<span class="title function_">present</span>();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="6-7-2-修改工具栏颜色"><a href="#6-7-2-修改工具栏颜色" class="headerlink" title="6.7.2 修改工具栏颜色"></a>6.7.2 修改工具栏颜色</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;ion-toolbar color=<span class="string">&quot;success&quot;</span>&gt;</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">ion-title</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      Tab One</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">ion-title</span>&gt;</span></span></span><br><span class="line">&lt;/ion-toolbar&gt;</span><br></pre></td></tr></table></figure><h4 id="6-7-3-修改返回按钮文字"><a href="#6-7-3-修改返回按钮文字" class="headerlink" title="6.7.3 修改返回按钮文字"></a>6.7.3 修改返回按钮文字</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//app.module.ts中配置</span></span><br><span class="line"></span><br><span class="line">@<span class="title class_">NgModule</span>(&#123;</span><br><span class="line">  ...</span><br><span class="line">  <span class="attr">imports</span>: [<span class="title class_">IonicModule</span>.<span class="title function_">forRoot</span>(&#123;</span><br><span class="line">    <span class="attr">backButtonText</span>:<span class="string">&quot;返回&quot;</span></span><br><span class="line">  &#125;)],</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">AppModule</span> &#123;&#125;</span><br></pre></td></tr></table></figure><h2 id="补充："><a href="#补充：" class="headerlink" title="补充："></a>补充：</h2><p><a href="https://www.yuque.com/chengbenchao/voarxb">https://www.yuque.com/chengbenchao/voarxb</a></p>]]></content>
      
      
      <categories>
          
          <category> Angular </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Angular </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Nuxt</title>
      <link href="/2020/04/29/Nuxt/"/>
      <url>/2020/04/29/Nuxt/</url>
      
        <content type="html"><![CDATA[<h3 id="1-1-Nuxt简介"><a href="#1-1-Nuxt简介" class="headerlink" title="1.1 Nuxt简介"></a>1.1 Nuxt简介</h3><p>Nuxt 是一个基于 Vue 生态的更高层的框架，为开发服务端渲染(SSR)的 Vue 应用提供了极其便利的开发体验。</p><p>Vue.js是开发SPA单页面应用的，传统的SPA应用是将bundle.js从服务端获取，然后在客户端解析并挂载到dom。</p><p>Nuxt这个框架是用Vue开发多页应用，并在服务端渲染。我们可以将组件渲染为服务器端的 HTML 字符串，将它们直接发送到浏览器，最后将这些静态标记”激活”为客户端上完全可交互的应用程序。</p><p>Nuxt适合做新闻、博客、电影、咨询这样的需要搜索引擎提供流量的项目。如果你要做到是移动端项目，就没有必要用nuxt这个框架了。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Nuxt.js有如下特点：</span><br><span class="line">Vue 2 ： nuxt是基于Vue2开发的</span><br><span class="line">Vue Router  ： nuxt整合了路由功能，配置非常简单</span><br><span class="line">VueX  ： 支持vuex</span><br><span class="line">Vue Server Renderer  ： 支持服务端渲染</span><br><span class="line">Vue-meta  ： 支持meta标签配置</span><br></pre></td></tr></table></figure><h3 id="1-2-Nuxt项目创建"><a href="#1-2-Nuxt项目创建" class="headerlink" title="1.2 Nuxt项目创建"></a>1.2 Nuxt项目创建</h3><p><a href="https://zh.nuxtjs.org/guide/installation#%E6%96%B0%E6%89%8B%E6%A8%A1%E6%9D%BF">https://zh.nuxtjs.org/guide/installation#%E6%96%B0%E6%89%8B%E6%A8%A1%E6%9D%BF</a></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//1.创建nuxt项目</span></span><br><span class="line">$ npx create-nuxt-app@<span class="number">3.4</span><span class="number">.0</span> nuxt-learn</span><br><span class="line"></span><br><span class="line"><span class="comment">//2.nuxt模式选择Universal</span></span><br><span class="line">   spa是单页，所以只有一个入口文件，不利于搜索引擎收录</span><br><span class="line">   <span class="title class_">Universal</span> 通用app，服务器渲染的 <span class="title class_">Vue</span>.<span class="property">js</span> 应用程序也可以被认为是<span class="string">&quot;同构&quot;</span>或<span class="string">&quot;通用&quot;</span>，因为应用程序的大部分代码都可以在服务器和客户端上运行</span><br><span class="line"></span><br><span class="line"><span class="comment">//3.注意不要选择pretty(会和eslint冲突)</span></span><br><span class="line">    我们都知道，如何与团队其他人高效地进行协作开发是多人团队的一个痛点。</span><br><span class="line">    每个人都有独立的编码习惯，虽然团队可以通过制定强制执行的规范来保持大家代码风格的尽量一致。</span><br><span class="line">    但是，在实际编码过程中，个人可能会不经意地继续使用着自己的代码风格，而等到发现不一致再解决又未免有点迟。</span><br><span class="line">    而<span class="title class_">ESLint</span>正是为解决这类问题而生的。<span class="title class_">ESLint</span> 由 <span class="title class_">JavaScript</span> 红宝书 作者 <span class="title class_">Nicholas</span> C. <span class="title class_">Zakas</span> 编写， <span class="number">2013</span> 年发布第一个版本，t是一款当前应用十分广泛的<span class="title class_">JavaScript</span>代码检查工具</span><br><span class="line">    </span><br><span class="line"><span class="comment">//4.npm run dev</span></span><br><span class="line">   访问  <span class="attr">http</span>:<span class="comment">//localhost:3000/</span></span><br></pre></td></tr></table></figure><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/rainlotus97/images/data/2024-01-27/1603173951023-091a39.png"></p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/rainlotus97/images/data/2024-01-27/1603174416233-cabf75.png"></p><h3 id="1-3-Nuxt基本使用"><a href="#1-3-Nuxt基本使用" class="headerlink" title="1.3 Nuxt基本使用"></a>1.3 Nuxt基本使用</h3><h4 id="a-路由"><a href="#a-路由" class="headerlink" title="a) 路由"></a>a) 路由</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//pages文件夹下面，文件名即路由</span></span><br><span class="line"></span><br><span class="line">#<span class="number">1.</span>pages下新建search.<span class="property">vue</span></span><br><span class="line">&lt;template&gt;</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    这是search页面</span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#<span class="number">2.</span>index.<span class="property">vue</span>使用路由</span><br><span class="line">&lt;nuxt-link to=<span class="string">&quot;/search&quot;</span>&gt;到search页面&lt;/nuxt-link&gt;</span><br></pre></td></tr></table></figure><h4 id="b-嵌套子模板"><a href="#b-嵌套子模板" class="headerlink" title="b) 嵌套子模板"></a>b) 嵌套子模板</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">#index.<span class="property">vue</span></span><br><span class="line"></span><br><span class="line">#<span class="number">1.</span>template</span><br><span class="line">&lt;template&gt;</span><br><span class="line">      <span class="language-xml"><span class="tag">&lt;<span class="name">section</span> <span class="attr">class</span>=<span class="string">&quot;container&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">              <span class="tag">&lt;<span class="name">Logo</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">             <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">section</span>&gt;</span></span></span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-handlebars"><span class="language-xml"></span></span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars"><span class="language-xml"></span></span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars"><span class="language-xml">#2. javascript</span></span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span> <span class="attr">lang</span>=<span class="string">&quot;ts&quot;</span>&gt;</span><span class="language-javascript"></span></span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="language-handlebars"><span class="language-xml"><span class="keyword">import</span> <span class="title class_">Vue</span> <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span></span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="language-handlebars"><span class="language-xml"><span class="keyword">import</span> <span class="title class_">Logo</span> <span class="keyword">from</span> <span class="string">&#x27;~/components/Logo.vue&#x27;</span></span></span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="language-handlebars"><span class="language-xml"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">Vue</span>.<span class="title function_">extend</span>(&#123;</span></span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="language-handlebars"><span class="language-xml">  <span class="attr">components</span>:&#123;</span></span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="language-handlebars"><span class="language-xml">    <span class="title class_">Logo</span></span></span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="language-handlebars"><span class="language-xml">  &#125;</span></span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="language-handlebars"><span class="language-xml">&#125;)</span></span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="language-handlebars"><span class="language-xml"></span></span></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br></pre></td></tr></table></figure><h4 id="c-layouts布局文件"><a href="#c-layouts布局文件" class="headerlink" title="c) layouts布局文件"></a>c) layouts布局文件</h4><p>默认情况下所有的页面都会默认使用layouts下面default.vue这个布局文件</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">#<span class="keyword">default</span>.<span class="property">vue</span></span><br><span class="line">&lt;template&gt;</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>头部<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="comment">&lt;!--nuxt就相当于 router-view--&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">nuxt</span>/&gt;</span>                     </span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>尾巴<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure><p>​</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">#自定义布局文件</span><br><span class="line">#<span class="number">1.</span>layouts下新建一个user.<span class="property">vue</span></span><br><span class="line">&lt;template&gt;</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>用户页面头部<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">nuxt</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>用户页面底部<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="keyword">export</span> <span class="keyword">default</span>&#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">style</span> <span class="attr">lang</span>=<span class="string">&quot;css&quot;</span> <span class="attr">scoped</span>&gt;</span><span class="language-css"></span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">  <span class="selector-tag">h1</span>&#123;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">    <span class="attribute">color</span>:green</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">  &#125;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line">#<span class="number">2.</span>pages下的search.<span class="property">vue</span>指定使用哪个布局文件</span><br><span class="line">&lt;script lang=<span class="string">&quot;ts&quot;</span>&gt;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Vue</span> <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">Vue</span>.<span class="title function_">extend</span>(&#123;</span><br><span class="line">  <span class="attr">layout</span>:<span class="string">&quot;user&quot;</span></span><br><span class="line">&#125;)</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><h4 id="d-全局的css文件"><a href="#d-全局的css文件" class="headerlink" title="d) 全局的css文件"></a>d) 全局的css文件</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">#<span class="number">1.</span>在assets下新建css/main.<span class="property">css</span></span><br><span class="line"></span><br><span class="line">#<span class="number">2.</span>修改nuxt.<span class="property">config</span>.<span class="property">css</span>配置文件</span><br><span class="line"><span class="attr">css</span>: [</span><br><span class="line">    <span class="string">&#x27;element-ui/lib/theme-chalk/index.css&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;~/assets/css/main.css&#x27;</span></span><br><span class="line">],</span><br><span class="line"></span><br><span class="line">#<span class="number">3.</span>重启服务</span><br></pre></td></tr></table></figure><h4 id="e-vuex的使用"><a href="#e-vuex的使用" class="headerlink" title="e) vuex的使用"></a>e) vuex的使用</h4><p>在nuxt中使用vuex的时候无需new Vue.Store实例，nuxt会帮我们自动创建。默认情况下，会使用index.js这个store</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line">#<span class="number">1.</span>store/index.<span class="property">js</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">state</span> = (<span class="params"></span>) =&gt; (&#123;</span><br><span class="line">  <span class="attr">list</span>: [<span class="string">&#x27;a&#x27;</span>,<span class="string">&#x27;b&#x27;</span>],</span><br><span class="line">  <span class="attr">user</span>:&#123;&#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> mutations = &#123;</span><br><span class="line">  increment (state,text) &#123;</span><br><span class="line">    state.<span class="property">list</span>.<span class="title function_">push</span>(text);</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> actions = &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#<span class="number">2.</span>store/city.<span class="property">js</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">state</span> = (<span class="params"></span>) =&gt; (&#123;</span><br><span class="line">  <span class="attr">list</span>: [<span class="string">&#x27;c&#x27;</span>,<span class="string">&#x27;d&#x27;</span>]</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> mutations = &#123;</span><br><span class="line">  increment (state,text) &#123;</span><br><span class="line">    state.<span class="property">list</span>.<span class="title function_">push</span>(text);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#<span class="number">3.</span>pages/city.<span class="property">vue</span></span><br><span class="line">&lt;template&gt;</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    Page is city</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">li</span> <span class="attr">v-for</span>=<span class="string">&quot;(item, idx) in $store.state.list&quot;</span> <span class="attr">:key</span>=<span class="string">&quot;idx&quot;</span>&gt;</span>&#123;&#123; item &#125;&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;button&quot;</span> <span class="attr">value</span>=<span class="string">&quot;增加信息index&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;addIndex&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">li</span> <span class="attr">v-for</span>=<span class="string">&quot;(item, idx) in $store.state.city.list&quot;</span> <span class="attr">:key</span>=<span class="string">&quot;idx&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        &#123;&#123; item &#125;&#125;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;button&quot;</span> <span class="attr">value</span>=<span class="string">&quot;增加信息city&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;addCity&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span> <span class="attr">lang</span>=<span class="string">&quot;ts&quot;</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">import</span> <span class="title class_">Vue</span> <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">Vue</span>.<span class="title function_">extend</span>(&#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="title function_">data</span>(<span class="params"></span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">return</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="attr">list</span>: [],</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="attr">methods</span>: &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="title function_">addIndex</span>(<span class="params"></span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="variable language_">this</span>.<span class="property">$store</span>.<span class="title function_">commit</span>(<span class="string">&quot;increment&quot;</span>, <span class="string">&quot;kk&quot;</span>);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="title function_">addCity</span>(<span class="params"></span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="variable language_">this</span>.<span class="property">$store</span>.<span class="title function_">commit</span>(<span class="string">&quot;city/increment&quot;</span>, <span class="string">&quot;jj&quot;</span>);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">&#125;);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br></pre></td></tr></table></figure><h3 id="1-4-SPA-SEO-SSR"><a href="#1-4-SPA-SEO-SSR" class="headerlink" title="1.4 SPA\SEO\SSR"></a>1.4 SPA\SEO\SSR</h3><h4 id="1-4-1-SPA-单页面应用"><a href="#1-4-1-SPA-单页面应用" class="headerlink" title="1.4.1 SPA:单页面应用"></a>1.4.1 SPA:单页面应用</h4><p>SPA 时代，主要是在客户端端使用了<code>history</code>或<code>hash</code>（主要是为了低版本浏览器的兼容）API，在首次请求经服务端路由输出整个应用程序后，接下来的路由都由前端掌控了，前端通过路由作为中心枢纽控制一系列页面（组件）的渲染(DOM的生成)加载和数据交互。</p><blockquote><p>优点</p></blockquote><pre><code>页面之间的切换非常快一定程度减少了后端服务器的压力后端程序只需要提供api，不需要客户端到底是web端还是手机等</code></pre><blockquote><p>缺点</p></blockquote><pre><code>首屏打开速度很慢，因为用户首次加载需要先下载SPA框架及应用程序的代码，然后在客户端渲染页面。不利于SEO搜索引擎优化</code></pre><h4 id="1-4-2-SEO-搜索引擎优化"><a href="#1-4-2-SEO-搜索引擎优化" class="headerlink" title="1.4.2 SEO:搜索引擎优化"></a>1.4.2 SEO:搜索引擎优化</h4><p>SEO是一种通过了解搜索引擎的运作规则（如何抓取网站页面，如何索引以及如何根据特定的关键字展现搜索结果排序等）来调整网站，以提高该网站在搜索引擎中某些关键词的搜索结果排名。</p><p>我们之前说SPA单页面应用，通过AJAX获取数据，这就难保证我们的页面能被搜索引擎正常收到，并且有一些搜索引擎不支持执行js和通过ajax获取数据，那就更不用提SEO了。为了解决这个问题，SSR登场了</p><h4 id="1-4-3-SSR-服务器端渲染"><a href="#1-4-3-SSR-服务器端渲染" class="headerlink" title="1.4.3 SSR:服务器端渲染"></a>1.4.3 SSR:服务器端渲染</h4><p>为了解决SPA不支持SEO的问题，我们也可以将同一个组件渲染为服务器端的 HTML 字符串，将它们直接发送到浏览器，但是这样的HTML页面还不具备交互能力，所以还需要与SPA框架配合，在浏览器上“混合”成可交互的应用程序。</p><p>基本流程是：</p><blockquote><p> 在浏览器第一次访问某个 URI 资源的时候（首屏），Web 服务器根据路由拿到对应数据渲染并输出，且输出的数据中包含两部分：</p><ul><li>路由页对应的页面及已渲染好的数据</li><li>完整的SPA程序代码</li></ul></blockquote><pre><code>在客户端首屏渲染完成之后，此时我们看到的其实已经是一个和之前的 SPA 相差无几的应用程序了，接下来我们进行的任何操作都只是客户端的应用进行交互，页面/组件由Web端渲染，路由也由浏览器控制，用户只需要和当前浏览器内的应用打交道就可以了。</code></pre><blockquote><p>SSR优点</p></blockquote><pre><code>更好的 SEO，由于搜索引擎爬虫抓取工具可以直接查看完全渲染的页面。更快的内容到达时间(time-to-content)，不用等待所有的JS都下载完成，浏览器便能显示比较完整的页面了</code></pre><blockquote><p>SSR缺点</p></blockquote><pre><code>占用更多的cpu和内存资源一些常用的浏览器的api可能无法正常使用，比如window，document，alert等，如果使用的话需要对运行环境加以判断开发调试会有一些麻烦，因为涉及到了浏览器及服务器，对于SPA的一些组件的生命周期的管理会变得复杂</code></pre><h4 id="1-4-4-Nuxt对SSR支持"><a href="#1-4-4-Nuxt对SSR支持" class="headerlink" title="1.4.4 Nuxt对SSR支持"></a>1.4.4 Nuxt对SSR支持</h4><p>从头搭建一个服务端渲染的应用是相当复杂的。幸运的是，我们有一个优秀的社区项目 <a href="https://nuxtjs.org/">Nuxt.js</a> 让这一切变得非常简单。Nuxt 是一个基于 Vue 生态的更高层的框架，为开发服务端渲染的 Vue 应用提供了极其便利的开发体验。</p><p>Nuxt.js 是使用 Webpack 和 Node.js 进行封装的基于Vue的SSR框架，预设了利用Vue.js开发<strong>服务端渲染</strong>的应用所需要的各种配置，使用它你可以不需要自己搭建一套 SSR 程序，而是通过其约定好的文件结构和API就可以实现一个首屏渲染的 Web 应用。</p><p>Nuxt.js 主要关注的是应用的 UI渲染。</p><p><a href="https://juejin.im/post/58ff960ba22b9d0065b722cd">https://juejin.im/post/58ff960ba22b9d0065b722cd</a></p><h3 id="1-5-数据预取"><a href="#1-5-数据预取" class="headerlink" title="1.5 数据预取"></a>1.5 数据预取</h3><h4 id="1-5-1-准备服务器接口"><a href="#1-5-1-准备服务器接口" class="headerlink" title="1.5.1 准备服务器接口"></a>1.5.1 准备服务器接口</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">#<span class="number">1.</span>在根目录创建api文件夹，创建city.<span class="property">js</span></span><br><span class="line"><span class="keyword">const</span> bodyParser = <span class="built_in">require</span>(<span class="string">&quot;body-parser&quot;</span>)</span><br><span class="line"><span class="keyword">const</span> app = <span class="built_in">require</span>(<span class="string">&quot;express&quot;</span>)()</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">use</span>(bodyParser.<span class="title function_">json</span>())</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/info&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> res.<span class="title function_">status</span>(<span class="number">200</span>).<span class="title function_">json</span>([<span class="string">&#x27;北京&#x27;</span>,<span class="string">&#x27;天津&#x27;</span>])</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = app</span><br><span class="line"></span><br><span class="line">#<span class="number">2.</span>nuxt.<span class="property">config</span>.<span class="property">js</span>中添加配置如下</span><br><span class="line"><span class="comment">//https://zh.nuxtjs.org/guides/configuration-glossary/configuration-servermiddleware/</span></span><br><span class="line">  <span class="attr">serverMiddleware</span>: [</span><br><span class="line">    &#123; <span class="attr">path</span>: <span class="string">&quot;/api&quot;</span>, <span class="attr">handler</span>: <span class="string">&quot;~/api/city.js&quot;</span> &#125;,</span><br><span class="line">  ]</span><br><span class="line"></span><br><span class="line">#<span class="number">3.</span>重启服务 访问接口</span><br><span class="line">  <span class="attr">localhost</span>:<span class="number">3000</span>/api/info  测试接口</span><br></pre></td></tr></table></figure><h4 id="1-5-2-不使用数据预取"><a href="#1-5-2-不使用数据预取" class="headerlink" title="1.5.2 不使用数据预取"></a>1.5.2 不使用数据预取</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">#<span class="number">1.</span>客户端pages下新建city.<span class="property">vue</span></span><br><span class="line">&lt;template&gt;</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    Page is city</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">li</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">v-for</span>=<span class="string">&quot;(item,idx) in list&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">:key</span>=<span class="string">&quot;idx&quot;</span>&gt;</span> &#123;&#123; item &#125;&#125; <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">&quot;axios&quot;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="keyword">import</span> <span class="title class_">Vue</span> <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">Vue</span>.<span class="title function_">extend</span>(&#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="title function_">data</span>(<span class="params"></span>)&#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="keyword">return</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="attr">list</span>:[]</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">async</span> <span class="title function_">mounted</span>(<span class="params"></span>)&#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="keyword">let</span> &#123;status,data&#125; = <span class="keyword">await</span> axios.<span class="title function_">get</span>(<span class="string">&quot;/api/info&quot;</span>);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="variable language_">this</span>.<span class="property">list</span> = data;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">list</span>);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  &#125;)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br></pre></td></tr></table></figure><h4 id="1-5-3-Nuxt-js工作流"><a href="#1-5-3-Nuxt-js工作流" class="headerlink" title="1.5.3 Nuxt.js工作流"></a>1.5.3 Nuxt.js工作流</h4><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/rainlotus97/images/data/2024-01-27/1546049173524-ab73b9.png"></p><blockquote><p>nuxtServerInit：如果在状态树(store)中指定了 <code>nuxtServerInit</code> 方法，Nuxt.js 调用它的时候会将页面的上下文对象作为第2个参数传给它（仅在服务端调用）。当我们想将服务端的一些数据传到客户端时，这个方法是非常好用的  </p><p>middleware：中间件允许您定义一个自定义函数运行在一个页面或一组页面渲染之前，服务端首屏渲染和路由跳转前均执行对应中间件。可以用作页面跳转时验证用户信息操作(登陆拦截)。</p><p>asyncData会在组件加载前（限于页面组件）调用，可以在<strong>服务端首屏渲染或者在路由跳转时执行</strong>，专门用来请求数据，Nuxt.js 会将 <code>asyncData</code> 返回的数据融合组件 <code>data</code> 方法返回的数据一并返回给当前组件。asyncData应该是用于影响SEO的内容，也就是需要让爬虫读取的内容。</p></blockquote><h4 id="1-5-4-数据预取"><a href="#1-5-4-数据预取" class="headerlink" title="1.5.4 数据预取"></a>1.5.4 数据预取</h4><h5 id="a-nuxtServerInit"><a href="#a-nuxtServerInit" class="headerlink" title="a)  nuxtServerInit"></a>a)  nuxtServerInit</h5><p>nuxtServerInit可以将服务端的数据通过vuex同步到客户端，该方法仅会在服务端首屏渲染时执行</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">#store/index.<span class="property">js</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">state</span> = (<span class="params"></span>) =&gt; (&#123;</span><br><span class="line">  <span class="attr">list</span>: [<span class="string">&#x27;a&#x27;</span>,<span class="string">&#x27;b&#x27;</span>],</span><br><span class="line">  <span class="attr">user</span>:&#123;&#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> mutations = &#123;</span><br><span class="line">  increment (state,text) &#123;</span><br><span class="line">    state.<span class="property">list</span>.<span class="title function_">push</span>(text);</span><br><span class="line">  &#125;,</span><br><span class="line">  setlist (state,text) &#123;</span><br><span class="line">    text.<span class="title function_">forEach</span>(<span class="function"><span class="params">item</span>=&gt;</span>&#123;</span><br><span class="line">      state.<span class="property">list</span>.<span class="title function_">push</span>(item)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> actions = &#123;</span><br><span class="line">  <span class="comment">//将菜单信息写入到vuex实例中</span></span><br><span class="line">  <span class="keyword">async</span> nuxtServerInit (&#123; commit &#125;, &#123; req ,app &#125;) &#123;</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">let</span> &#123;status, data&#125; = <span class="keyword">await</span> app.<span class="property">$axios</span>.<span class="title function_">get</span>(<span class="string">&quot;/api/info&quot;</span>);</span><br><span class="line">      <span class="title function_">commit</span>(<span class="string">&#x27;setlist&#x27;</span>, data)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#<span class="number">2.</span>pages/city.<span class="property">vue</span></span><br><span class="line">&lt;template&gt;</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    Page is city</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">li</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">v-for</span>=<span class="string">&quot;(item,idx) in $store.state.list&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">:key</span>=<span class="string">&quot;idx&quot;</span>&gt;</span> &#123;&#123; item &#125;&#125; <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure><h5 id="b-asyncData和fetch方法"><a href="#b-asyncData和fetch方法" class="headerlink" title="b) asyncData和fetch方法"></a>b) asyncData和fetch方法</h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//使用asyncData进行ssr渲染</span></span><br><span class="line"><span class="keyword">async</span> <span class="title function_">asyncData</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="comment">//给data取别名，请求网址写全，因为在刷新浏览器的时候需要全路径请求服务器</span></span><br><span class="line">    <span class="keyword">let</span> &#123;status,<span class="attr">data</span>:list&#125; = <span class="keyword">await</span> axios.<span class="title function_">get</span>(<span class="string">&quot;http://127.0.0.1:3000/city/info&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span>(status == <span class="number">200</span>) &#123;</span><br><span class="line">        <span class="comment">//这边不能使用this.list = list,因为获取不到this</span></span><br><span class="line">        <span class="comment">//通过return给页面返回数据</span></span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            list</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> fetch (&#123; store, params &#125;)&#123;</span><br><span class="line">      <span class="comment">//当页面加载时触发可以执行请求来触发action来修改state</span></span><br><span class="line">      <span class="comment">//不可以return数据给页面</span></span><br><span class="line">      <span class="comment">//页面可以从this.$store中获取action修改的state</span></span><br><span class="line">      <span class="keyword">let</span> &#123;status,<span class="attr">data</span>:list&#125; = <span class="keyword">await</span> axios.<span class="title function_">get</span>(<span class="string">&quot;http://127.0.0.1:3000/city/info&quot;</span>);</span><br><span class="line">      store.<span class="title function_">commit</span>(<span class="string">&#x27;setlist&#x27;</span>, list)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#注意点：asyncData 和 fetch都只能够在页面组件中使用，如果想要在页面组件的子组件中使用ssr，可以使用nuxtServerInit</span><br><span class="line">#注意点：由于 asyncData方法是在组件初始化前被调用的，所以在方法内是没有办法通过<span class="variable language_">this</span>来引用组件的实例。</span><br><span class="line">#注意点：当用户请求页面时候服务端会先使用<span class="variable constant_">SSR</span>来生成对应的页面文档结构，而在用户切换路由则是使用了<span class="variable constant_">SPA</span>的模式。这意味着如果用户刷新页面，asyncData方法会在服务端执行；如果用户通过nuxt-link路由导航到当前页面，asyncData会在客户端执行</span><br></pre></td></tr></table></figure><blockquote><hr></blockquote><h5 id="c-asyncData运行在服务器和客户端的区分"><a href="#c-asyncData运行在服务器和客户端的区分" class="headerlink" title="c) asyncData运行在服务器和客户端的区分"></a>c) asyncData运行在服务器和客户端的区分</h5><p>当asyncData方法是由路由跳转触发的时候，则使用客户端数据预取，asyncData方法会在客户端执行。可以通过控制台打印来查看是在浏览器执行还是在node执行就可以验证了。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//https://zh.nuxtjs.org/api/#asyncdata-%E6%96%B9%E6%B3%95</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="title function_">asyncData</span>(<span class="params">context</span>)&#123;</span><br><span class="line">    <span class="comment">//给data取别名，请求网址写全</span></span><br><span class="line">    <span class="keyword">let</span> &#123;status,<span class="attr">data</span>:list&#125; = <span class="keyword">await</span> axios.<span class="title function_">get</span>(<span class="string">&quot;http://127.0.0.1:3000/city/info&quot;</span>);</span><br><span class="line">    <span class="comment">//如果是客户端执行，则可以使用window对象</span></span><br><span class="line">    <span class="comment">//如果是服务端执行，则没有window对象</span></span><br><span class="line">    <span class="keyword">if</span>(process.<span class="property">client</span>)&#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">window</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(status == <span class="number">200</span>) &#123;</span><br><span class="line">        <span class="comment">//这边不能使用this.list = list,因为获取不到this</span></span><br><span class="line">        <span class="comment">//通过return给页面返回数据</span></span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            list</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="1-6-SSR原理"><a href="#1-6-SSR原理" class="headerlink" title="1.6 SSR原理"></a>1.6 SSR原理</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/rainlotus97/images/data/2024-01-27/92672015b4914784ae5a800c4a655e25-775b4c.jpeg" alt="img"></p><p><strong>官方文档</strong>:<a href="https://ssr.vuejs.org/zh/">https://ssr.vuejs.org/zh/</a></p><p>如上图所示：webpack将 Source 打包出两个bundle文件。</p><p>服务端渲染：Server Bundle用于服务端渲染，主要是获取异步数据，同步到组件中，并将组件渲染成HTML返回到前端，但是<strong>vue-ssr不能绑定javascript事件</strong>，也就是说服务器端使用vue-ssr渲染出来的返回到浏览器的也只能是HTML+CSS。</p><p>客户端渲染：Client Bundle 用于客户端渲染，之前说过服务器不能增加事件，那只能前端增加。所以我们看到SSR渲染的网页源码中有<code>window.__NUXT__=...</code>代码，这是后端和前端在使用vuex共享数据。后端从vuex里面取到数据之后渲染成真正的HTML和css返回。客户端也是从vuex里面取到数据，客户端的渲染主要做2件事：</p><blockquote><p>1.拿到数据，使用virtual-dom进行预渲染，然后和服务端渲染出来的进行比对，比对两边渲染的内容是不是一致的</p><p>2.对DOM元素的事件进行绑定，也就是回答的问题，事件在这块进行的处理</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> Vue </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Nuxt </tag>
            
            <tag> Vue </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>NextJs</title>
      <link href="/2020/03/22/NextJs/"/>
      <url>/2020/03/22/NextJs/</url>
      
        <content type="html"><![CDATA[<h2 id="1-Next-Js介绍"><a href="#1-Next-Js介绍" class="headerlink" title="1.Next.Js介绍"></a>1.Next.Js介绍</h2><h3 id="1-1-next-js是什么"><a href="#1-1-next-js是什么" class="headerlink" title="1.1 next.js是什么"></a>1.1 next.js是什么</h3><p>next.js作为一款轻量级的应用框架，主要用于构建静态网站和后端渲染网站。</p><blockquote><p>Next.js 只支持<a href="https://reactjs.org/blog/2017/09/26/react-v16.0.html">React 16</a>.<br>由于我们使用 React 16 的特性，所以不得不放弃对 React 15 以及以下版本的支持. 当前译版为7.0.0-canary.8</p></blockquote><h3 id="1-2-框架特点"><a href="#1-2-框架特点" class="headerlink" title="1.2 框架特点"></a>1.2 框架特点</h3><ul><li>使用后端渲染</li><li>自动进行代码分割（code splitting），以获得更快的网页加载速度</li><li>简洁的前端路由实现</li><li>使用webpack进行构建，支持模块热更新（Hot Module Replacement）</li><li>可与主流Node服务器进行对接（如express）</li><li>可自定义babel和webpack的配置</li></ul><h2 id="2-Next项目创建"><a href="#2-Next项目创建" class="headerlink" title="2.Next项目创建"></a>2.Next项目创建</h2><h3 id="2-1-安装create-next-app脚手架"><a href="#2-1-安装create-next-app脚手架" class="headerlink" title="2.1 安装create-next-app脚手架"></a>2.1 安装create-next-app脚手架</h3><p><a href="https://create-next-app.js.org/get-started-with-examples">https://create-next-app.js.org/get-started-with-examples</a></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">yarn <span class="variable language_">global</span> add create-next-app@<span class="number">9.5</span><span class="number">.0</span></span><br><span class="line">create-next-app my-project</span><br><span class="line"><span class="comment">// create-next-app my-project --example with-typescript    //需要等比较久</span></span><br><span class="line">cd my-project</span><br><span class="line">yarn dev</span><br></pre></td></tr></table></figure><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/rainlotus97/images/data/2024-01-27/1603177898229-1de9c1.png"></p><h3 id="2-2-添加antd"><a href="#2-2-添加antd" class="headerlink" title="2.2 添加antd"></a>2.2 添加antd</h3><p>安装<code>antd</code>和按需加载的<code>babel-plugin-import</code>。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">yarn add antd@<span class="number">3.9</span><span class="number">.2</span> babel-plugin-<span class="keyword">import</span>   <span class="comment">//ant design和按需加载</span></span><br><span class="line"></span><br><span class="line">yarn add @zeit/next-css @zeit/next-less less   <span class="comment">//样式</span></span><br><span class="line">yarn add babel-plugin-<span class="variable language_">module</span>-resolver    <span class="comment">//取别名</span></span><br><span class="line">yarn add next-compose-plugins   <span class="comment">//合并插件</span></span><br></pre></td></tr></table></figure><p>跟目录下建立<code>.babelrc</code></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;presets&quot;</span>: [<span class="string">&quot;next/babel&quot;</span>],</span><br><span class="line">  <span class="string">&quot;plugins&quot;</span>: [</span><br><span class="line">    <span class="comment">// 让我们可以使用根路径，避免相对路径的混乱，如import Head from &#x27;@/components/Head&#x27;</span></span><br><span class="line">    [</span><br><span class="line">      <span class="string">&quot;module-resolver&quot;</span>,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="string">&quot;alias&quot;</span>: &#123;</span><br><span class="line">          <span class="string">&quot;@&quot;</span>: <span class="string">&quot;./&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">      <span class="string">&quot;import&quot;</span>,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="string">&quot;libraryName&quot;</span>: <span class="string">&quot;antd&quot;</span>,</span><br><span class="line">        <span class="string">&quot;style&quot;</span>: <span class="string">&quot;css&quot;</span></span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>根目录有个<code>next.config.js</code>，专门用来修改<code>next</code>以及<code>webpack</code>的配置。更改如下：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* eslint-disable */</span></span><br><span class="line"><span class="keyword">const</span> withCss = <span class="built_in">require</span>(<span class="string">&#x27;@zeit/next-css&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> withLess = <span class="built_in">require</span>(<span class="string">&#x27;@zeit/next-less&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> withPlugins = <span class="built_in">require</span>(<span class="string">&quot;next-compose-plugins&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> style = [</span><br><span class="line">  [withCss, &#123;</span><br><span class="line"></span><br><span class="line">  &#125;],</span><br><span class="line">  [withLess, &#123;</span><br><span class="line"></span><br><span class="line">  &#125;],</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = <span class="title function_">withPlugins</span>([...style],&#123;</span><br><span class="line">  <span class="attr">distDir</span>: <span class="string">&#x27;dist&#x27;</span>,</span><br><span class="line">  <span class="attr">webpack</span>: <span class="function">(<span class="params">config, &#123; isServer &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (isServer) &#123;</span><br><span class="line">      <span class="keyword">const</span> antStyles = <span class="regexp">/antd\/.*?\/style\/css.*?/</span></span><br><span class="line">      <span class="keyword">const</span> origExternals = [...config.<span class="property">externals</span>]</span><br><span class="line">      config.<span class="property">externals</span> = [</span><br><span class="line">        <span class="function">(<span class="params">context, request, callback</span>) =&gt;</span> &#123;</span><br><span class="line">          <span class="keyword">if</span> (request.<span class="title function_">match</span>(antStyles)) <span class="keyword">return</span> <span class="title function_">callback</span>()</span><br><span class="line">          <span class="keyword">if</span> (<span class="keyword">typeof</span> origExternals[<span class="number">0</span>] === <span class="string">&#x27;function&#x27;</span>) &#123;</span><br><span class="line">            origExternals[<span class="number">0</span>](context, request, callback)</span><br><span class="line">          &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="title function_">callback</span>()</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        ...(<span class="keyword">typeof</span> origExternals[<span class="number">0</span>] === <span class="string">&#x27;function&#x27;</span> ? [] : origExternals),</span><br><span class="line">      ]</span><br><span class="line"></span><br><span class="line">      config.<span class="property">module</span>.<span class="property">rules</span>.<span class="title function_">unshift</span>(&#123;</span><br><span class="line">        <span class="attr">test</span>: antStyles,</span><br><span class="line">        <span class="attr">use</span>: <span class="string">&#x27;null-loader&#x27;</span>,</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> config</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;)</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="2-3-使用antd组件"><a href="#2-3-使用antd组件" class="headerlink" title="2.3 使用antd组件"></a>2.3 使用antd组件</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">#pages/index.<span class="property">js</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Button</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;antd&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Pagination</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;antd&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">Home</span> = (<span class="params"></span>) =&gt; (</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;container&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">Button</span> <span class="attr">type</span>=<span class="string">&quot;primary&quot;</span>&gt;</span>Primary<span class="tag">&lt;/<span class="name">Button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">Pagination</span> <span class="attr">defaultCurrent</span>=<span class="string">&#123;1&#125;</span> <span class="attr">total</span>=<span class="string">&#123;50&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml"> .........</span></span><br></pre></td></tr></table></figure><h3 id="2-4-使用less"><a href="#2-4-使用less" class="headerlink" title="2.4 使用less"></a>2.4 使用less</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">#<span class="number">1.</span> 编写index.<span class="property">less</span></span><br><span class="line">.<span class="property">title</span>&#123;</span><br><span class="line">  text-<span class="attr">align</span>: center;</span><br><span class="line">  font-<span class="attr">size</span>: 30px;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#<span class="number">2.</span>在pages目录下新建typing.<span class="property">d</span>.<span class="property">ts</span></span><br><span class="line">declare <span class="variable language_">module</span> <span class="string">&#x27;slash2&#x27;</span>;</span><br><span class="line">declare <span class="variable language_">module</span> <span class="string">&#x27;*.css&#x27;</span>;</span><br><span class="line">declare <span class="variable language_">module</span> <span class="string">&#x27;*.less&#x27;</span>;</span><br><span class="line">declare <span class="variable language_">module</span> <span class="string">&#x27;*.scss&#x27;</span>;</span><br><span class="line">declare <span class="variable language_">module</span> <span class="string">&#x27;*.sass&#x27;</span>;</span><br><span class="line">declare <span class="variable language_">module</span> <span class="string">&#x27;*.svg&#x27;</span>;</span><br><span class="line">declare <span class="variable language_">module</span> <span class="string">&#x27;*.png&#x27;</span>;</span><br><span class="line">declare <span class="variable language_">module</span> <span class="string">&#x27;*.jpg&#x27;</span>;</span><br><span class="line">declare <span class="variable language_">module</span> <span class="string">&#x27;*.jpeg&#x27;</span>;</span><br><span class="line">declare <span class="variable language_">module</span> <span class="string">&#x27;*.gif&#x27;</span>;</span><br><span class="line">declare <span class="variable language_">module</span> <span class="string">&#x27;*.bmp&#x27;</span>;</span><br><span class="line">declare <span class="variable language_">module</span> <span class="string">&#x27;*.tiff&#x27;</span>;</span><br><span class="line">declare <span class="variable language_">module</span> <span class="string">&#x27;omit.js&#x27;</span>;</span><br><span class="line"></span><br><span class="line">#<span class="number">3.</span>index.<span class="property">tsx</span>中使用less</span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;./index.less&#x27;</span></span><br><span class="line"></span><br><span class="line">#<span class="number">4.</span>给less开启模块化   修改nuxt.<span class="property">config</span>.<span class="property">js</span></span><br><span class="line">[withLess, &#123;</span><br><span class="line">    <span class="attr">cssModules</span>: <span class="literal">true</span></span><br><span class="line">&#125;],</span><br></pre></td></tr></table></figure><h2 id="3-Next基本使用"><a href="#3-Next基本使用" class="headerlink" title="3.Next基本使用"></a>3.Next基本使用</h2><h3 id="3-1-创建视图"><a href="#3-1-创建视图" class="headerlink" title="3.1  创建视图"></a>3.1  创建视图</h3><p>pages目录下新建about.tsx</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">Link</span> <span class="keyword">from</span> <span class="string">&#x27;next/link&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Layout</span> <span class="keyword">from</span> <span class="string">&#x27;../components/Layout&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">AboutPage</span> = (<span class="params"></span>) =&gt; (</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">Layout</span> <span class="attr">title</span>=<span class="string">&quot;About | Next.js + TypeScript Example&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>About<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>This is the about page<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">Link</span> <span class="attr">href</span>=<span class="string">&quot;/&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">a</span>&gt;</span>Go home<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">Link</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">Layout</span>&gt;</span></span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">AboutPage</span></span><br></pre></td></tr></table></figure><p>浏览器访问：<a href="http://localhost:3000/about">http://localhost:3000/about</a></p><blockquote><p>Next.js 没有路由配置文件，路由的规则跟 PHP 有点像。只要在 pages 文件夹下创建的文件，都会默认生成以文件名命名的路由</p></blockquote><h3 id="3-2-页面跳转和路由参数"><a href="#3-2-页面跳转和路由参数" class="headerlink" title="3.2 页面跳转和路由参数"></a>3.2 页面跳转和路由参数</h3><p>我们可以使用传统的a标签在页面之间进行跳转，但每跳转一次，都需要去服务端请求一次。为了增加页面的访问速度，推荐使用<code>next/link</code>组件进行跳转。将 index.js 改写：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Button</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;antd&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Pagination</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;antd&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Link</span> <span class="keyword">from</span> <span class="string">&#x27;next/link&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">Home</span> = (<span class="params"></span>) =&gt; (</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;container&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">Button</span> <span class="attr">type</span>=<span class="string">&quot;primary&quot;</span>&gt;</span>Primary<span class="tag">&lt;/<span class="name">Button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">Pagination</span> <span class="attr">defaultCurrent</span>=<span class="string">&#123;1&#125;</span> <span class="attr">total</span>=<span class="string">&#123;50&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">Link</span> <span class="attr">href</span>=<span class="string">&quot;/about&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">a</span>&gt;</span>About Page<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">Link</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    .........</span></span><br></pre></td></tr></table></figure><blockquote><p><strong>Link标签支持任意react组件作为其子元素，不一定要用a标签，只要该子元素能响应onClick事件</strong>，就像下面这样：</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="title class_">Link</span> href=<span class="string">&quot;/about&quot;</span>&gt;</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>Go about page<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">&lt;/<span class="title class_">Link</span>&gt;</span><br></pre></td></tr></table></figure><blockquote><p><strong>Link标签不支持添加style和className等属性，如果要给链接增加样式，需要在子元素上添加</strong>：</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="title class_">Link</span> href=<span class="string">&quot;/about&quot;</span>&gt;</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">a</span> <span class="attr">className</span>=<span class="string">&quot;about-link&quot;</span> <span class="attr">style</span>=<span class="string">&#123;&#123;color:</span>&#x27;#<span class="attr">ff0000</span>&#x27;&#125;&#125;&gt;</span>Go about page<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span></span><br><span class="line">&lt;/<span class="title class_">Link</span>&gt;</span><br></pre></td></tr></table></figure><h3 id="3-3-路由传参"><a href="#3-3-路由传参" class="headerlink" title="3.3 路由传参"></a>3.3 路由传参</h3><p>如果需要给路由传参数，则使用<code>query string</code>的形式，将 index.tsx 改写：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">Link</span> <span class="keyword">from</span> <span class="string">&#x27;next/link&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Layout</span> <span class="keyword">from</span> <span class="string">&#x27;../components/Layout&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Button</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;antd&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Pagination</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;antd&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> styles <span class="keyword">from</span> <span class="string">&#x27;./index.less&#x27;</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(styles)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">PostLink</span> = (<span class="params">props:any</span>) =&gt; (</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    &#123;/* <span class="tag">&lt;<span class="name">Link</span> <span class="attr">href</span>=<span class="string">&#123;</span>`/<span class="attr">about</span>?<span class="attr">title</span>=<span class="string">$&#123;props.title&#125;</span>`&#125;&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">a</span>&gt;</span>&#123;props.title&#125;<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">Link</span>&gt;</span> */&#125;</span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">Link</span> <span class="attr">href</span>=<span class="string">&#123;&#123;</span> <span class="attr">pathname:</span> &#x27;/<span class="attr">about</span>&#x27;, <span class="attr">query:</span> &#123; <span class="attr">title:</span> <span class="attr">props.title</span> &#125; &#125;&#125;&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">a</span>&gt;</span>&#123;props.title&#125;<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">Link</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">IndexPage</span> = (<span class="params"></span>) =&gt; (</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">Layout</span> <span class="attr">title</span>=<span class="string">&quot;Home | Next.js + TypeScript Example&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">h1</span> <span class="attr">className</span>=<span class="string">&quot;title&quot;</span>&gt;</span>Hello Next.js 👋<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">Button</span> <span class="attr">type</span>=<span class="string">&quot;primary&quot;</span> <span class="attr">href</span>=<span class="string">&quot;&quot;</span>&gt;</span>Primary<span class="tag">&lt;/<span class="name">Button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">Pagination</span> <span class="attr">defaultCurrent</span>=<span class="string">&#123;1&#125;</span> <span class="attr">total</span>=<span class="string">&#123;50&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">Link</span> <span class="attr">href</span>=<span class="string">&quot;/about?title=hello&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">a</span>&gt;</span>About Page<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">Link</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"> </span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">PostLink</span> <span class="attr">title</span>=<span class="string">&quot;Hello next.js&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">PostLink</span> <span class="attr">title</span>=<span class="string">&quot;next.js is awesome&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">PostLink</span> <span class="attr">title</span>=<span class="string">&quot;Deploy apps with Zeit&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">Layout</span>&gt;</span></span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">IndexPage</span></span><br></pre></td></tr></table></figure><p>取参数的时候，需要借助框架提供的<code>withRouter</code>方法，参数封装在 query 对象中，将 about.tsx 改写：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">Link</span> <span class="keyword">from</span> <span class="string">&quot;next/link&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Layout</span> <span class="keyword">from</span> <span class="string">&quot;../components/Layout&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; withRouter &#125; <span class="keyword">from</span> <span class="string">&quot;next/router&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Button</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;antd&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">AboutPage</span> = (<span class="params">props: any</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">var</span> flag = <span class="literal">false</span>;</span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">Layout</span> <span class="attr">title</span>=<span class="string">&quot;About | Next.js + TypeScript Example&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>&#123;props.router.query.title&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    这是About页面</span></span><br><span class="line"><span class="language-xml">    &#123;flag &amp;&amp; <span class="tag">&lt;<span class="name">Button</span> <span class="attr">type</span>=<span class="string">&quot;primary&quot;</span> <span class="attr">href</span>=<span class="string">&quot;&quot;</span>&gt;</span>Primary<span class="tag">&lt;/<span class="name">Button</span>&gt;</span>&#125;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">Link</span> <span class="attr">href</span>=<span class="string">&quot;/&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">a</span>&gt;</span>首页<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">Link</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">Layout</span>&gt;</span></span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title function_">withRouter</span>(<span class="title class_">AboutPage</span>);</span><br><span class="line"></span><br><span class="line">#注意：这边有个bug，当next和antd结合使用的时候，如果某个页面中没有使用到antd组件，那么这个页面不能被刷新，否则路由导航失效，antd的样式也不会被加载</span><br><span class="line">#因此这边在about页面中使用了<span class="title class_">Button</span>组件，即使<span class="title class_">Button</span>组件没有被渲染到页面</span><br></pre></td></tr></table></figure><blockquote><p><strong>如果希望浏览器地址栏不显示query string，可以使用Link标签的as属性：</strong></p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="title class_">Link</span> <span class="keyword">as</span>=<span class="string">&quot;/t/123&quot;</span> href=<span class="string">&quot;/about?title=123&quot;</span>&gt;</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">a</span>&gt;</span>About Page2<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span></span><br><span class="line">&lt;/<span class="title class_">Link</span>&gt;</span><br></pre></td></tr></table></figure><h3 id="3-4-Layout"><a href="#3-4-Layout" class="headerlink" title="3.4 Layout"></a>3.4 Layout</h3><p>所谓的layout就是就是给不同的页面添加相同的header，footer，navbar等通用的部分，同时又不需要写重复的代码。在next.js中可以通过共享某些组件实现layout。</p><p>在components目录下创建Layout.tsx</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span>, &#123; <span class="title class_">ReactNode</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Link</span> <span class="keyword">from</span> <span class="string">&#x27;next/link&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Head</span> <span class="keyword">from</span> <span class="string">&#x27;next/head&#x27;</span></span><br><span class="line"></span><br><span class="line">type <span class="title class_">Props</span> = &#123;</span><br><span class="line">  children?: <span class="title class_">ReactNode</span></span><br><span class="line">  title?: string</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">Layout</span> = (<span class="params">&#123; children, title = <span class="string">&#x27;This is the default title&#x27;</span> &#125;: Props</span>) =&gt; (</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">Head</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">title</span>&gt;</span>&#123;title&#125;<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charSet</span>=<span class="string">&quot;utf-8&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;initial-scale=1.0, width=device-width&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">Head</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">header</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">nav</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">Link</span> <span class="attr">href</span>=<span class="string">&quot;/&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">a</span>&gt;</span>Home<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">Link</span>&gt;</span>&#123;&#x27; &#x27;&#125;</span></span><br><span class="line"><span class="language-xml">        |&#123;&#x27; &#x27;&#125;</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">Link</span> <span class="attr">href</span>=<span class="string">&quot;/about&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">a</span>&gt;</span>About<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">Link</span>&gt;</span>&#123;&#x27; &#x27;&#125;</span></span><br><span class="line"><span class="language-xml">        |&#123;&#x27; &#x27;&#125;</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">Link</span> <span class="attr">href</span>=<span class="string">&quot;/users&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">a</span>&gt;</span>Users List<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">Link</span>&gt;</span>&#123;&#x27; &#x27;&#125;</span></span><br><span class="line"><span class="language-xml">        | <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;/api/users&quot;</span>&gt;</span>Users API<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">nav</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">header</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    &#123;children&#125;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">footer</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">hr</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">span</span>&gt;</span>I&#x27;m here to stay (Footer)<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">footer</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">Layout</span></span><br></pre></td></tr></table></figure><p>在页面中就可以使用这个Layout布局组件了</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">IndexPage</span> = (<span class="params"></span>) =&gt; (</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">Layout</span> <span class="attr">title</span>=<span class="string">&quot;Home | Next.js + TypeScript Example&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">h1</span> <span class="attr">className</span>=<span class="string">&quot;title&quot;</span>&gt;</span>Hello Next.js 👋<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">Button</span> <span class="attr">type</span>=<span class="string">&quot;primary&quot;</span> <span class="attr">href</span>=<span class="string">&quot;&quot;</span>&gt;</span>Primary<span class="tag">&lt;/<span class="name">Button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">Pagination</span> <span class="attr">defaultCurrent</span>=<span class="string">&#123;1&#125;</span> <span class="attr">total</span>=<span class="string">&#123;50&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">Link</span> <span class="attr">href</span>=<span class="string">&quot;/about?title=hello&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">a</span>&gt;</span>About Page<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">Link</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"> </span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">PostLink</span> <span class="attr">title</span>=<span class="string">&quot;Hello next.js&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">PostLink</span> <span class="attr">title</span>=<span class="string">&quot;next.js is awesome&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">PostLink</span> <span class="attr">title</span>=<span class="string">&quot;Deploy apps with Zeit&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">Layout</span>&gt;</span></span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">IndexPage</span></span><br></pre></td></tr></table></figure><h3 id="3-5-动态路由"><a href="#3-5-动态路由" class="headerlink" title="3.5 动态路由"></a>3.5 动态路由</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/rainlotus97/images/data/2024-01-27/1603180292853-5f184f.png"></p><p>通过localhost:3000&#x2F;users&#x2F;zs   即可访问[id].tsx</p><p>通过localhost:3000&#x2F;users   即可访问index.tsx</p><h2 id="4-样式加载"><a href="#4-样式加载" class="headerlink" title="4.样式加载"></a>4.样式加载</h2><p>对于React应用，有多种方式可以增加样式。主要分为两种： </p><ol><li>使用传统CSS文件（包括SASS，Less等） </li><li>在JS文件中插入CSS</li></ol><p>使用传统CSS文件在实际使用中会用到挺多的问题，所以next.js推荐使用第二种方式。next.js内部默认使用<a href="https://github.com/zeit/styled-jsx">styled-jsx</a>框架向js文件中插入CSS。这种方式引入的样式在不同组件之间不会相互影响，甚至父子组件之间都不会相互影响。</p><h3 id="4-1-styled-jsx"><a href="#4-1-styled-jsx" class="headerlink" title="4.1  styled-jsx"></a>4.1  styled-jsx</h3><p>接下来，我们看一下如何使用styled-jsx。将<code>about.tsx</code>的内容替换如下：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">Link</span> <span class="keyword">from</span> <span class="string">&quot;next/link&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Layout</span> <span class="keyword">from</span> <span class="string">&quot;../components/Layout&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; withRouter &#125; <span class="keyword">from</span> <span class="string">&quot;next/router&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Button</span> &#125; <span class="keyword">from</span> <span class="string">&quot;antd&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">AboutPage</span> = (<span class="params">props: any</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">var</span> flag = <span class="literal">false</span>;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">Layout</span> <span class="attr">title</span>=<span class="string">&quot;About | Next.js + TypeScript Example&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;container&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">h1</span>&gt;</span>&#123;props.router.query.title&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        这是About页面</span></span><br><span class="line"><span class="language-xml">        &#123;flag &amp;&amp; (</span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">Button</span> <span class="attr">type</span>=<span class="string">&quot;primary&quot;</span> <span class="attr">href</span>=<span class="string">&quot;&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            Primary</span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;/<span class="name">Button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        )&#125;</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">Link</span> <span class="attr">href</span>=<span class="string">&quot;/&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">a</span>&gt;</span>首页<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">Link</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">style</span> <span class="attr">jsx</span>&gt;</span><span class="language-css"></span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">        &#123;`</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">          <span class="selector-tag">h1</span> &#123;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">            <span class="attribute">background-color</span>: blue;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">            <span class="attribute">font-size</span>: <span class="number">60px</span>;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">          &#125;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">          <span class="selector-class">.container</span> &#123;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">            <span class="attribute">color</span>: red;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">          &#125;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">        `&#125;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">      </span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">Layout</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title function_">withRouter</span>(<span class="title class_">AboutPage</span>);</span><br></pre></td></tr></table></figure><p>如果需要为导航增加样式，需要修改<code>Layout.tsx</code>：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span>, &#123; <span class="title class_">ReactNode</span> &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Link</span> <span class="keyword">from</span> <span class="string">&quot;next/link&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Head</span> <span class="keyword">from</span> <span class="string">&quot;next/head&quot;</span>;</span><br><span class="line"></span><br><span class="line">type <span class="title class_">Props</span> = &#123;</span><br><span class="line">  children?: <span class="title class_">ReactNode</span>;</span><br><span class="line">  title?: string;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">Layout</span> = (<span class="params">&#123; children, title = <span class="string">&quot;This is the default title&quot;</span> &#125;: Props</span>) =&gt; (</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">Head</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">title</span>&gt;</span>&#123;title&#125;<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charSet</span>=<span class="string">&quot;utf-8&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;initial-scale=1.0, width=device-width&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">Head</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">header</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">nav</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">Link</span> <span class="attr">href</span>=<span class="string">&quot;/&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">a</span>&gt;</span>Home<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">Link</span>&gt;</span>&#123;&quot; &quot;&#125;</span></span><br><span class="line"><span class="language-xml">        |&#123;&quot; &quot;&#125;</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">Link</span> <span class="attr">href</span>=<span class="string">&quot;/about&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">a</span>&gt;</span>About<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">Link</span>&gt;</span>&#123;&quot; &quot;&#125;</span></span><br><span class="line"><span class="language-xml">        |&#123;&quot; &quot;&#125;</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">Link</span> <span class="attr">href</span>=<span class="string">&quot;/users&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">a</span>&gt;</span>Users List<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">Link</span>&gt;</span>&#123;&quot; &quot;&#125;</span></span><br><span class="line"><span class="language-xml">        | <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;/api/users&quot;</span>&gt;</span>Users API<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">nav</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">header</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    &#123;children&#125;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">footer</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">hr</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">span</span>&gt;</span>I&#x27;m here to stay (Footer)<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">footer</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">style</span> <span class="attr">jsx</span>&gt;</span><span class="language-css"></span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">      &#123;`</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">        <span class="selector-tag">a</span> &#123;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">          <span class="attribute">color</span>: <span class="number">#ef141f</span>;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">          <span class="attribute">font-size</span>: <span class="number">26px</span>;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">          <span class="attribute">line-height</span>: <span class="number">40px</span>;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">          <span class="attribute">text-decoration</span>: none;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">          <span class="attribute">padding</span>: <span class="number">0</span> <span class="number">10px</span>;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">          <span class="attribute">text-transform</span>: uppercase;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">        &#125;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">        <span class="selector-tag">a</span><span class="selector-pseudo">:hover</span> &#123;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">          <span class="attribute">opacity</span>: <span class="number">0.8</span>;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">        &#125;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">      `&#125;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">    </span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">Layout</span>;</span><br></pre></td></tr></table></figure><h3 id="4-2-全局样式"><a href="#4-2-全局样式" class="headerlink" title="4.2  全局样式"></a>4.2  全局样式</h3><p>当我们需要添加一些全局的样式，比如rest.css或者鼠标悬浮在a标签上时出现下划线，这时候我们只需要在<code>style-jsx</code>标签上增加<code>global</code>关键词就行了，我们在<code>Layout.tsx</code>新增如下样式：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;style jsx <span class="variable language_">global</span>&gt;</span><br><span class="line">      &#123;<span class="string">`</span></span><br><span class="line"><span class="string">        a:hover &#123;</span></span><br><span class="line"><span class="string">          text-decoration: underline;</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">      `</span>&#125;</span><br><span class="line">    &lt;/style&gt;</span><br></pre></td></tr></table></figure><h3 id="4-3-使用Less-Sass-Css等"><a href="#4-3-使用Less-Sass-Css等" class="headerlink" title="4.3  使用Less&#x2F;Sass&#x2F;Css等"></a>4.3  使用Less&#x2F;Sass&#x2F;Css等</h3><p>支持用<code>.css</code>, <code>.scss</code>, <code>.less</code> or <code>.style</code>，需要配置默认文件 <code>next.config.js</code></p><p>下载安装</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">yarn add @zeit/next-less less    </span><br><span class="line">yarn add @zeit/next-css            </span><br><span class="line">yarn add @zeit/next-sass node-sass</span><br></pre></td></tr></table></figure><p>修改根目录下创建<code>next.config.js</code></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> withCss = <span class="built_in">require</span>(<span class="string">&#x27;@zeit/next-css&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> withLess = <span class="built_in">require</span>(<span class="string">&#x27;@zeit/next-less&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> withSass = <span class="built_in">require</span>(<span class="string">&quot;@zeit/next-sass&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> style = [</span><br><span class="line">  [withCss, &#123;</span><br><span class="line"></span><br><span class="line">  &#125;],</span><br><span class="line">  [withLess, &#123;</span><br><span class="line">    <span class="attr">cssModules</span>: <span class="literal">true</span></span><br><span class="line">  &#125;],</span><br><span class="line">  [withSass,&#123;</span><br><span class="line">    <span class="comment">// cssModules: true</span></span><br><span class="line">  &#125;],</span><br><span class="line">]</span><br></pre></td></tr></table></figure><p>在<code>pages</code>中创建<code>styles.less</code></p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">@font-size</span>: <span class="number">50px</span>;</span><br><span class="line"><span class="selector-class">.example</span> &#123;</span><br><span class="line">  <span class="attribute">font-size</span>: @font-size;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>在about.js中使用</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> lessobj <span class="keyword">from</span> <span class="string">&quot;./styles.less&quot;</span></span><br><span class="line"></span><br><span class="line">&lt;p className=&#123;lessobj.<span class="property">example</span>&#125;&gt;pppp&lt;/p&gt;</span><br></pre></td></tr></table></figure><h2 id="5-静态文件服务"><a href="#5-静态文件服务" class="headerlink" title="5.静态文件服务"></a>5.静态文件服务</h2><h3 id="5-1-图片的使用"><a href="#5-1-图片的使用" class="headerlink" title="5.1 图片的使用"></a>5.1 图片的使用</h3><p>项目中用到的一些静态资源，包括图片、样式文件、字体图标、音频视频等文件都应该放到一个static目录下。</p><p>在根目录下新建文件夹叫<code>static</code>。通过代码可以通过<code>/static/</code>来引入相关的静态资源。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;img src=<span class="string">&quot;../static/images/timg1.jpg&quot;</span> /&gt;</span><br></pre></td></tr></table></figure><h3 id="5-2-字体图标的使用"><a href="#5-2-字体图标的使用" class="headerlink" title="5.2 字体图标的使用"></a>5.2 字体图标的使用</h3><p>从Font AweSome官网下载字体图标(压缩包)，然后将里面的fonts和css文件夹拷贝到项目static目录下</p><p><a href="https://fontawesome.dashgame.com/">https://fontawesome.dashgame.com/</a></p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/rainlotus97/images/data/2024-01-27/1583649395753-3178c1.png"></p><p>安装next-fonts和next-images</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">yarn add next-fonts@1.0.3</span><br><span class="line">yarn add next-images@1.3.1</span><br></pre></td></tr></table></figure><p>在next.config.js中进行配置</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* eslint-disable */</span></span><br><span class="line"><span class="keyword">const</span> withCss = <span class="built_in">require</span>(<span class="string">&#x27;@zeit/next-css&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> withLess = <span class="built_in">require</span>(<span class="string">&#x27;@zeit/next-less&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> withSass = <span class="built_in">require</span>(<span class="string">&quot;@zeit/next-sass&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> withFonts = <span class="built_in">require</span>(<span class="string">&#x27;next-fonts&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> withImages = <span class="built_in">require</span>(<span class="string">&#x27;next-images&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> withPlugins = <span class="built_in">require</span>(<span class="string">&quot;next-compose-plugins&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> style = [</span><br><span class="line">  [withCss, &#123;</span><br><span class="line"></span><br><span class="line">  &#125;],</span><br><span class="line">  [withLess, &#123;</span><br><span class="line">    <span class="attr">cssModules</span>: <span class="literal">true</span></span><br><span class="line">  &#125;],</span><br><span class="line">  [withSass,&#123;</span><br><span class="line">    <span class="comment">// cssModules: true</span></span><br><span class="line">  &#125;],</span><br><span class="line">  [withFonts, &#123;</span><br><span class="line"></span><br><span class="line">  &#125;],</span><br><span class="line">  [withImages, &#123;</span><br><span class="line"></span><br><span class="line">  &#125;],</span><br><span class="line">]</span><br></pre></td></tr></table></figure><p>在about.js中使用字体图标</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">&#x27;@/static/css/font-awesome.css&#x27;</span></span><br><span class="line"></span><br><span class="line">&lt;span className=<span class="string">&quot;fa fa-star&quot;</span>&gt;字体图标&lt;/span&gt;</span><br></pre></td></tr></table></figure><h2 id="6-Next的SSR"><a href="#6-Next的SSR" class="headerlink" title="6.Next的SSR"></a>6.Next的SSR</h2><h3 id="6-1-SSR介绍"><a href="#6-1-SSR介绍" class="headerlink" title="6.1 SSR介绍"></a>6.1 SSR介绍</h3><p>服务器端渲染(SSR: Server Side Rendering)，react前端做好的界面，后台把界面渲染成html之后，在传给前台。</p><p>好处：</p><blockquote><p>1.SEO优化</p><p>2.加快首屏渲染速度</p></blockquote><h3 id="6-2-远程数据获取"><a href="#6-2-远程数据获取" class="headerlink" title="6.2 远程数据获取"></a>6.2 远程数据获取</h3><p>Next.js提供了一个标准的获取远程数据的接口:<code>getInitialProps</code>，通过<code>getInitialProps</code>我们可以获取到远程数据并赋值给页面的props。<code>getInitialProps</code>即可以用在服务端也可以用在前端。</p><p>首先，我们安装<a href="https://github.com/developit/unfetch">isomorphic-unfetch</a>，它是基于fetch实现的一个网络请求库：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn add isomorphic-unfetch</span><br></pre></td></tr></table></figure><h4 id="6-2-1-无状态组件定义getInitialProps"><a href="#6-2-1-无状态组件定义getInitialProps" class="headerlink" title="6.2.1  无状态组件定义getInitialProps"></a>6.2.1  无状态组件定义getInitialProps</h4><p>新建home.tsx，然后我们修改<code>home.tsx</code>如下：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Button</span> &#125; <span class="keyword">from</span> <span class="string">&quot;antd&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Layout</span> <span class="keyword">from</span> <span class="string">&quot;../components/Layout&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> fetch <span class="keyword">from</span> <span class="string">&quot;isomorphic-unfetch&quot;</span>;</span><br><span class="line"></span><br><span class="line">type <span class="title class_">IProps</span> = &#123;</span><br><span class="line">  <span class="attr">shows</span>: </span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">show</span>: &#123;</span><br><span class="line">        <span class="attr">id</span>: number;</span><br><span class="line">        <span class="attr">name</span>: string;</span><br><span class="line">      &#125;;</span><br><span class="line">    &#125;[]</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">Home</span> = (<span class="params">props: IProps</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">Layout</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">h1</span>&gt;</span>Marvel TV Shows<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        &#123;props.shows.map((&#123; show &#125;) =&gt; &#123;</span></span><br><span class="line"><span class="language-xml">          return <span class="tag">&lt;<span class="name">li</span> <span class="attr">key</span>=<span class="string">&#123;show.id&#125;</span>&gt;</span>&#123;show.name&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span>;</span></span><br><span class="line"><span class="language-xml">        &#125;)&#125;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">Button</span>&gt;</span>按钮<span class="tag">&lt;/<span class="name">Button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">Layout</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="title class_">Home</span>.<span class="property">getInitialProps</span> = <span class="keyword">async</span> <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> res = <span class="keyword">await</span> <span class="title function_">fetch</span>(<span class="string">&quot;https://api.tvmaze.com/search/shows?q=marvel&quot;</span>);</span><br><span class="line">  <span class="keyword">const</span> data = <span class="keyword">await</span> res.<span class="title function_">json</span>();</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    <span class="attr">shows</span>: data,</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">Home</span>;</span><br></pre></td></tr></table></figure><h4 id="6-2-2-有状态组件定义getInitialProps"><a href="#6-2-2-有状态组件定义getInitialProps" class="headerlink" title="6.2.2  有状态组件定义getInitialProps"></a>6.2.2  有状态组件定义getInitialProps</h4><p>新建user.tsx，修改内容如下：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">Layout</span> <span class="keyword">from</span> <span class="string">&#x27;@/components/layout&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"><span class="keyword">import</span> fetch <span class="keyword">from</span> <span class="string">&#x27;isomorphic-unfetch&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">class</span> <span class="title class_">extends</span> <span class="title class_">React</span>.<span class="property">Component</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">async</span> <span class="title function_">getInitialProps</span>(<span class="params">context</span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> id = <span class="number">43519</span>;</span><br><span class="line">        <span class="keyword">const</span> res = <span class="keyword">await</span> <span class="title function_">fetch</span>(<span class="string">`https://api.tvmaze.com/shows/<span class="subst">$&#123;id&#125;</span>`</span>);</span><br><span class="line">        <span class="keyword">const</span> show = <span class="keyword">await</span> res.<span class="title function_">json</span>();</span><br><span class="line">        <span class="keyword">return</span> &#123; show &#125;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">var</span> html = <span class="variable language_">this</span>.<span class="property">props</span>.<span class="property">show</span>.<span class="property">summary</span>;</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            <span class="language-xml"><span class="tag">&lt;<span class="name">Layout</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">h1</span>&gt;</span>&#123;this.props.show.name&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;this.props.show.summary&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&#123;this.props.show.image.medium&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">Layout</span>&gt;</span></span></span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="6-3-getInitialProps的原理"><a href="#6-3-getInitialProps的原理" class="headerlink" title="6.3 getInitialProps的原理"></a>6.3 getInitialProps的原理</h3><p>当页面渲染时加载数据，我们使用了一个异步方法<code>getInitialProps</code>。它能异步获取数据，并绑定在组件的<code>props</code>上。</p><p>getInitialProps()能够在服务的运行，也能够在client运行。当页面第一次加载时，服务器收到请求，getInitialProps()会执行，getInitialProps()返回的数据，会序列化后添加到 <code>window.__NEXT_DATA__.props</code>上，写入HTML源码里，类似于<code>&lt;script&gt;window.__NEXT_DATA__=&#123;props:&#123;xxx&#125;&#125;&lt;/script&gt;</code>。这样服务端的getInitialProps()就实现了把数据传送给了客户端。</p><p>客户端的收到了HTML源码，有了数据，想做什么都可以。比如可以拿着<code>window.__NEXT_DATA__.props</code>的数据来初始化React组件的props属性。具体过程如下：</p><blockquote><p>当页面是用户通过超链接跳转过去，而不是用户输入网址或刷新来访问的，这时候是纯客户端的行为，没有HTTP请求发出去。用户如果通过超链接跳转回这个页面，客户端的getInitialProps()开始起作用了，它会自动读取HTML源码里 window.<strong>NEXT_DATA</strong>.props里的数据并作为React组件的props。</p><p>当页面初次加载或者刷新页面时，<code>getInitialProps</code>只会加载在服务端。只有当路由跳转时，客户端才会执行<code>getInitialProps</code>。</p></blockquote><p><strong>注意：<code>getInitialProps</code>将不能使用在子组件中。只能使用在<code>pages</code>页面中。</strong></p><h3 id="6-4-getInitialProps的入参"><a href="#6-4-getInitialProps的入参" class="headerlink" title="6.4  getInitialProps的入参"></a>6.4  getInitialProps的入参</h3><p>Next对React组件的getInitialProps生命周期方法做了改造，传入一个上下文对象，该对象在服务端渲染和客户端渲染时，具有不同的属性：</p><ul><li>req: HTTP请求对象（服务端渲染独有）</li><li>res: HTTP响应对象（服务端渲染独有）</li><li>pathname: URL中的路径部分</li><li>query：URL中的查询字符串部分解析出的对象</li><li>err：错误对象，如果在渲染时发生了错误</li><li>xhr：XMLHttpRequest对象（客户端渲染独有）</li></ul><h2 id="7-后台mock"><a href="#7-后台mock" class="headerlink" title="7.后台mock"></a>7.后台mock</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">pages/api中可以写mock接口</span><br><span class="line"></span><br><span class="line">page/api/city/index.<span class="property">ts</span>    通过<span class="attr">localhost</span>:<span class="number">3000</span>/api/city即可访问该接口</span><br><span class="line">page/api/city/[name].<span class="property">ts</span>   通过<span class="attr">localhost</span>:<span class="number">3000</span>/api/city/wuxi即可访问该接口</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//page/api/city/index.ts</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">NextApiRequest</span>, <span class="title class_">NextApiResponse</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;next&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">handler</span> = (<span class="params">_req: NextApiRequest, res: NextApiResponse</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    res.<span class="title function_">status</span>(<span class="number">200</span>).<span class="title function_">json</span>([<span class="string">&#x27;南京&#x27;</span>,<span class="string">&#x27;无锡&#x27;</span>])</span><br><span class="line">  &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">    res.<span class="title function_">status</span>(<span class="number">500</span>).<span class="title function_">json</span>(&#123; <span class="attr">statusCode</span>: <span class="number">500</span>, <span class="attr">message</span>: err.<span class="property">message</span> &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> handler</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> React </category>
          
      </categories>
      
      
        <tags>
            
            <tag> NextJs </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>github和gitee配置和使用</title>
      <link href="/2020/02/21/github%E5%92%8Cgitee%E9%85%8D%E7%BD%AE%E5%92%8C%E4%BD%BF%E7%94%A8/"/>
      <url>/2020/02/21/github%E5%92%8Cgitee%E9%85%8D%E7%BD%AE%E5%92%8C%E4%BD%BF%E7%94%A8/</url>
      
        <content type="html"><![CDATA[<h1 id="github和gitee的配置与使用"><a href="#github和gitee的配置与使用" class="headerlink" title="github和gitee的配置与使用"></a>github和gitee的配置与使用</h1><h2 id="一、配置SSH公钥免密登录"><a href="#一、配置SSH公钥免密登录" class="headerlink" title="一、配置SSH公钥免密登录"></a>一、配置SSH公钥免密登录</h2><p>由于需要同时配置两个网站的公钥，为了避免冲突，执行如下操作即可：</p><ul><li><p>第一步，先分别获取两个网站的公钥，并命名为不同的名称做于分辨</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ssh-keygen -t rsa -C <span class="string">&quot;s0704127x@163.com&quot;</span> -f <span class="string">&quot;github_id_rsa&quot;</span></span><br><span class="line">ssh-keygen -t rsa -C <span class="string">&quot;2642446152@qq.com&quot;</span> -f <span class="string">&quot;gitee_id_rsa&quot;</span></span><br></pre></td></tr></table></figure><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://i.loli.net/2020/07/30/TfX7Pgh4zUcJ2W9.png" alt="ssh公钥"></p></li><li><p>第二步，将获取的公钥分别在各自官网配置。其中github对应的key为github_id_rsa.pub，而gitee的key则是gitee_id_rsa.pub。分别用记事本打开，copy一份去配置即可。</p><p>以下则以github为例，成功的结果图如下：</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://i.loli.net/2020/07/30/cHeB1JoO7sYZl4k.png" alt="ssh公钥"></p></li><li><p>第三步，在.ssh目录下添加一个config脚本文件，并将下方代码复制进去，以用于避免两个网站的地址冲突。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># gitee</span></span><br><span class="line">Host gitee.com</span><br><span class="line">HostName gitee.com</span><br><span class="line">PreferredAuthentications publickey</span><br><span class="line">IdentityFile ~/.ssh/gitee_id_rsa</span><br><span class="line"></span><br><span class="line"><span class="comment"># github</span></span><br><span class="line">Host github.com</span><br><span class="line">HostName github.com</span><br><span class="line">PreferredAuthentications publickey</span><br><span class="line">IdentityFile ~/.ssh/github_id_rsa</span><br></pre></td></tr></table></figure></li><li><p>第四步，也是最关键的一步，通过下方命令检查有没有连接成功。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ssh -T git@gitee.com</span><br><span class="line">ssh -T git@github.com</span><br></pre></td></tr></table></figure><p>以下为实测成功图，如果和下方相似，基本上你也是连接成功的。</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://i.loli.net/2020/07/30/DHGWvZ2wcnVOL5F.png"></p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://i.loli.net/2020/07/30/WGPuDaFC3emU9jh.png"></p><p> <strong>做完以上步骤，说明SSH免密配置你已经成功完成了！</strong></p></li></ul><h2 id="二、github和gitee新建仓库的步骤"><a href="#二、github和gitee新建仓库的步骤" class="headerlink" title="二、github和gitee新建仓库的步骤"></a>二、github和gitee新建仓库的步骤</h2><h3 id="1-github的网页仓库添加"><a href="#1-github的网页仓库添加" class="headerlink" title="1.github的网页仓库添加"></a>1.github的网页仓库添加</h3><h5 id="第一步，去官网注册github账号，记住自己账号密码，以上！"><a href="#第一步，去官网注册github账号，记住自己账号密码，以上！" class="headerlink" title="第一步，去官网注册github账号，记住自己账号密码，以上！"></a>第一步，去官网注册github账号，记住自己账号密码，以上！</h5><h5 id="第二步，点击页面右上角的-号，选择第一个New-repository来创建，具体如图下所示："><a href="#第二步，点击页面右上角的-号，选择第一个New-repository来创建，具体如图下所示：" class="headerlink" title="第二步，点击页面右上角的**+**号，选择第一个New repository来创建，具体如图下所示："></a>第二步，点击页面右上角的**+**号，选择第一个New repository来创建，具体如图下所示：</h5><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://i.loli.net/2020/07/30/2ADJmVlQxKiPZyf.png"></p><h5 id="第三步，看到如下界面："><a href="#第三步，看到如下界面：" class="headerlink" title="第三步，看到如下界面："></a>第三步，看到如下界面：</h5><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://i.loli.net/2020/07/30/kUiS6RAmb9JVYOv.png"></p><p>重点处已有箭头标识，在此再次解释一下。仓库名称(Repository name)尽量英文名称，Description(描述)这是个可选项，用于识别仓库干什么的。底下还有Public和Private两个选项，是用来私人用还是共享用的，不做强求，但往往默认会共享的，看你心情咯~</p><p>最后创建仓库，没了~~~</p><h5 id="第四步，来到了最关键的一步了，先看下图："><a href="#第四步，来到了最关键的一步了，先看下图：" class="headerlink" title="第四步，来到了最关键的一步了，先看下图："></a>第四步，来到了最关键的一步了，先看下图：</h5><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://i.loli.net/2020/07/30/kltXAJsLrI65mOy.png"></p><p>第一行有个HTTPS&#x2F;SSH 后面还跟着一串链接，这是我们用来让本地和github建立链接的桥梁，不过有个需要注意的是，HTTPS不好的一点是，接下来我们建立连接的时候会需要要求输入用户名和密码。说不定哪一天抽风了，我们一时记不住密码，就~~嘿嘿~</p><p>所以我们使用SSH登录，方便，更关键的是：不用他我之前写的岂不是白费了？？言归正传，以下放出切换到有SSH链接的图片：</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://i.loli.net/2020/07/30/x9by8LRu1TG7DpZ.png"></p><h5 id="以下才是真正的重点："><a href="#以下才是真正的重点：" class="headerlink" title="以下才是真正的重点："></a><strong>以下才是真正的重点：</strong></h5><p>看第二块和第三块区域，第二块是告诉我们第一次在本地建立仓库的操作，第三块则是对我们本地已有的仓库和刚刚创建好的这个仓库建立连接。</p><p>我们是第一次操作，就看第二块区域就好。我们只要在本地选择好一个文件夹，然后在当前文件夹下右键使用git bash here，随后将它的每一行代码一个个敲就能完成本地仓库和github仓库的连接了！</p><p>我根据上图以及个人收获，总结出下方重要代码块，你一步步操作即可：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">touch</span> README.md    //此命令较之github官方更为简单，就是用来在本地创建一个空md文件</span><br><span class="line"></span><br><span class="line">git init           //对本地文件夹初始化，使其变成可建立连接的本地仓库</span><br><span class="line"></span><br><span class="line">git add README.md   //将README.md文档添加到暂存区</span><br><span class="line"></span><br><span class="line">git commit -m <span class="string">&quot;first commit&quot;</span>  //对添加的文件添加备注，引号内可以随便写</span><br><span class="line"></span><br><span class="line">git remote add origin git@github.com:******/CodeServer.git </span><br><span class="line">//第一次操作，这步至关重要，就是让你当前文件夹(本地仓库)和github的个人仓库建立联系</span><br><span class="line"></span><br><span class="line">git push -u origin master   </span><br><span class="line">//最后将之前添加备注的提交文件推送到github仓库的master分支之下</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">touch</span> README.md </span><br><span class="line">git init </span><br><span class="line">git add README.md</span><br><span class="line">git commit -m <span class="string">&quot;first commit&quot;</span></span><br><span class="line">git remote add origin git@github.com:*****/CodeServer.git</span><br><span class="line">git push -u origin master </span><br></pre></td></tr></table></figure><p>以上代码专门拿出来方便你copy使用，记住 <a href="mailto:&#x67;&#105;&#116;&#x40;&#103;&#x69;&#116;&#x68;&#117;&#x62;&#x2e;&#99;&#x6f;&#109;">&#x67;&#105;&#116;&#x40;&#103;&#x69;&#116;&#x68;&#117;&#x62;&#x2e;&#99;&#x6f;&#109;</a>:***&#x2F;CodeServer.git这个是我的SSH链接地址，你需要换成自己的。而且，以上操作1仅限第一次使用，之后上传代码则无需上述那么多繁杂步骤了！</p><p>以下放出我的成功截图：</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://i.loli.net/2020/07/30/FXq8yQA6B4i3vbU.png"></p><h5 id="第五步，平时上传本地仓库的操作"><a href="#第五步，平时上传本地仓库的操作" class="headerlink" title="第五步，平时上传本地仓库的操作"></a>第五步，平时上传本地仓库的操作</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git add .</span><br><span class="line">git commit -m <span class="string">&quot;第二次提交&quot;</span></span><br><span class="line">git push origin master</span><br></pre></td></tr></table></figure><p>只需要这三条命令就可以将本地文件推送到github的个人仓库了！</p><p>最后再顺便聊一下，官方网站上仓库的下载方法吧</p><ol><li><p>直接下载</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://i.loli.net/2020/07/30/ijEUM8w7TAdyobs.png"></p><p>直接下载就是点击Download ZIP即可</p></li><li><p>用命令下载</p><p>上图会有链接，copy一下，我这个是SSH的链接，你也可以选择HTTPS的。我建议你可以把这个地址记录在本地，忘记了打开它复制一下就好了。</p><p>在git bash here中输入以下代码即可下载了。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> git@github.com:*****/CodeServer.git</span><br></pre></td></tr></table></figure></li></ol><h5 id="第六步，错误总结"><a href="#第六步，错误总结" class="headerlink" title="第六步，错误总结"></a>第六步，错误总结</h5><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://i.loli.net/2020/07/30/s19lgxIwcDrO2XT.png"></p><p>有时候你可能会与到上图黄字部分的报错，而你执行的操作则是push -u origin master这一步推送操作而已。这个时候你只需要执行下方代码即可完美解决这个问题：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git pull --rebase origin master</span><br></pre></td></tr></table></figure><h2 id="2-gitee的网页仓库添加"><a href="#2-gitee的网页仓库添加" class="headerlink" title="2.gitee的网页仓库添加"></a>2.gitee的网页仓库添加</h2><p>gitee是国产的类似于github的网站，操作流程和github十分相似，建立仓库，初始化本地仓库的操作都是一样的，就连本地化初始仓库、建立连接等操作所用的命令也是一模一样。没啥好说的了，不过我们可以谈谈另外一件事。</p><p><strong>github下载慢</strong></p><p>这个问题可以解决吗？</p><p>可以，要么VPN(有时候还不管用),外国云服务器下载(超级快，几十兆每秒，就是你还需要再下回到本地，但是依旧比直接在官网下载的快)。我知道的最后一个方法，就是讲github的项目导入到gitee上，再从gitee上下载下来就好了！(速度也就比github上好看些，免费！)</p><h2 id="三、gitee和github的同步刷新"><a href="#三、gitee和github的同步刷新" class="headerlink" title="三、gitee和github的同步刷新"></a>三、gitee和github的同步刷新</h2><p>gitee比较坑的地方就是，对github导入的库不能同步刷新，必须在官网手动刷新很麻烦。这个时候可以尝试同步刷新的方法！</p><ol><li><p>在项目目录找到<code>.git</code>隐藏文件夹，如果在项目目录找不到<code>.git</code>隐藏文件夹，文件夹右上角打开<code>查看</code>然后找到<code>隐藏的项目</code>并勾选即可 </p></li><li><p>用记事本打开<code>config</code>文件，把Gitee(码云)(或者github，看你缺啥)的仓库地址填进去即可。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[core]</span><br><span class="line">repositoryformatversion = 0</span><br><span class="line">filemode = <span class="literal">false</span></span><br><span class="line">bare = <span class="literal">false</span></span><br><span class="line">logallrefupdates = <span class="literal">true</span></span><br><span class="line">symlinks = <span class="literal">false</span></span><br><span class="line">ignorecase = <span class="literal">true</span></span><br><span class="line">[remote <span class="string">&quot;origin&quot;</span>]</span><br><span class="line">url = git@github.com:rainlotus97/CodeServer.git</span><br><span class="line">url = git@gitee.com:rainlotus97/CodeServer2.git   //这是后添加的</span><br><span class="line">fetch = +refs/heads/*:refs/remotes/origin/*</span><br><span class="line">[branch <span class="string">&quot;master&quot;</span>]</span><br><span class="line">remote = origin</span><br><span class="line">merge = refs/heads/master</span><br><span class="line"></span><br></pre></td></tr></table></figure><p> 最后重新<code>push</code>即可，如果Gitee(码云)仓库有过提交，使用此方法第一次提交请使用<code>强行提交</code>，避免抱错 </p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git push -f origin master</span><br></pre></td></tr></table></figure></li></ol>]]></content>
      
      
      
        <tags>
            
            <tag> github gitee </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
